{"ast":null,"code":"var core = require(\"../level1/core\"),\n    applyDocumentFeatures = require('../browser/documentfeatures').applyDocumentFeatures,\n    defineGetter = require('../utils').defineGetter,\n    defineSetter = require('../utils').defineSetter,\n    inheritFrom = require(\"../utils\").inheritFrom,\n    resolveHref = require(\"../utils\").resolveHref,\n    URL = require(\"url\"),\n    Path = require('path'),\n    fs = require(\"fs\"),\n    http = require('http'),\n    https = require('https'); // Setup the javascript language processor\n\n\ncore.languageProcessors = {\n  javascript: require(\"./languages/javascript\").javascript\n};\ncore.resourceLoader = {\n  load: function (element, href, callback) {\n    var ownerDoc = element._ownerDocument;\n    var ownerImplementation = ownerDoc.implementation;\n\n    if (ownerImplementation._hasFeature('FetchExternalResources', element.tagName.toLowerCase())) {\n      var full = this.resolve(ownerDoc, href);\n      var url = URL.parse(full);\n\n      if (ownerImplementation._hasFeature('SkipExternalResources', full)) {\n        return false;\n      }\n\n      var cookie = ownerDoc.cookie;\n      var cookieDomain = ownerDoc._cookieDomain;\n      var baseUrl = this.baseUrl(ownerDoc);\n      var enqueued = this.enqueue(element, callback, full);\n\n      if (typeof ownerDoc._resourceLoader == 'function') {\n        var fetch = this.fetch.bind(this);\n\n        ownerDoc._resourceLoader.call(null, {\n          url: url,\n          cookie: cookie,\n          cookieDomain: cookieDomain,\n          baseUrl: baseUrl,\n          defaultFetch: function (callback) {\n            fetch(this.url, this.cookie, this.cookieDomain, this.baseUrl, callback);\n          }\n        }, enqueued);\n      } else {\n        this.fetch(url, cookie, cookieDomain, baseUrl, enqueued);\n      }\n    }\n  },\n  enqueue: function (element, callback, filename) {\n    var loader = this,\n        doc = element.nodeType === core.Node.DOCUMENT_NODE ? element : element._ownerDocument;\n\n    if (!doc._queue) {\n      return function () {};\n    }\n\n    return doc._queue.push(function (err, data) {\n      var ev = doc.createEvent('HTMLEvents');\n\n      if (!err) {\n        try {\n          callback.call(element, data, filename || doc.URL);\n          ev.initEvent('load', false, false);\n        } catch (e) {\n          err = e;\n        }\n      }\n\n      if (err) {\n        ev.initEvent('error', false, false);\n        ev.error = err;\n      }\n\n      element.dispatchEvent(ev);\n    });\n  },\n  baseUrl: function (document) {\n    var baseElements = document.getElementsByTagName('base');\n    var baseUrl = document.URL;\n\n    if (baseElements.length > 0) {\n      var baseHref = baseElements.item(0).href;\n\n      if (baseHref) {\n        baseUrl = resolveHref(baseUrl, baseHref);\n      }\n    }\n\n    return baseUrl;\n  },\n  resolve: function (document, href) {\n    // if getAttribute returns null, there is no href\n    // lets resolve to an empty string (nulls are not expected farther up)\n    if (href === null) {\n      return '';\n    }\n\n    var baseUrl = this.baseUrl(document);\n    return resolveHref(baseUrl, href);\n  },\n  fetch: function (url, cookie, cookieDomain, referrer, callback) {\n    if (url.hostname) {\n      this.download(url, cookie, cookieDomain, referrer, callback);\n    } else {\n      this.readFile(url.pathname, callback);\n    }\n  },\n  download: function (url, cookie, cookieDomain, referrer, callback) {\n    var path = url.pathname + (url.search || ''),\n        options = {\n      'method': 'GET',\n      'host': url.hostname,\n      'path': path\n    },\n        request;\n\n    if (url.protocol === 'https:') {\n      options.port = url.port || 443;\n      request = https.request(options);\n    } else {\n      options.port = url.port || 80;\n      request = http.request(options);\n    } // set header.\n\n\n    if (referrer) {\n      request.setHeader('Referer', referrer);\n    }\n\n    if (cookie) {\n      var host = url.host.split(':')[0];\n\n      if (host.indexOf(cookieDomain, host.length - cookieDomain.length) !== -1) {\n        request.setHeader('cookie', cookie);\n      }\n    }\n\n    request.on('response', function (response) {\n      var data = '';\n\n      function success() {\n        if ([301, 302, 303, 307].indexOf(response.statusCode) > -1) {\n          var redirect = URL.resolve(url, response.headers[\"location\"]);\n          core.resourceLoader.download(URL.parse(redirect), cookie, cookieDomain, referrer, callback);\n        } else {\n          callback(null, data);\n        }\n      }\n\n      response.setEncoding('utf8');\n      response.on('data', function (chunk) {\n        data += chunk.toString();\n      });\n      response.on('end', function () {\n        // According to node docs, 'close' can fire after 'end', but not\n        // vice versa.  Remove 'close' listener so we don't call success twice.\n        response.removeAllListeners('close');\n        success();\n      });\n      response.on('close', function (err) {\n        if (err) {\n          callback(err);\n        } else {\n          success();\n        }\n      });\n    });\n    request.on('error', callback);\n    request.end();\n  },\n  readFile: function (url, callback) {\n    fs.readFile(url.replace(/^file:\\/\\//, \"\").replace(/^\\/([a-z]):\\//i, '$1:/').replace(/%20/g, ' '), 'utf8', callback);\n  }\n};\n\nfunction define(elementClass, def) {\n  var tagName = def.tagName,\n      tagNames = def.tagNames || (tagName ? [tagName] : []),\n      parentClass = def.parentClass || core.HTMLElement,\n      attrs = def.attributes || [],\n      proto = def.proto || {};\n\n  var elem = core[elementClass] = function (document, name) {\n    parentClass.call(this, document, name || tagName.toUpperCase());\n\n    if (elem._init) {\n      elem._init.call(this);\n    }\n  };\n\n  elem._init = def.init;\n  inheritFrom(parentClass, elem, proto);\n  attrs.forEach(function (n) {\n    var prop = n.prop || n,\n        attr = n.attr || prop.toLowerCase();\n\n    if (!n.prop || n.read !== false) {\n      defineGetter(elem.prototype, prop, function () {\n        var s = this.getAttribute(attr);\n\n        if (n.type && n.type === 'boolean') {\n          return s !== null;\n        }\n\n        if (n.type && n.type === 'long') {\n          return +s;\n        }\n\n        if (typeof n === 'object' && n.normalize) {\n          // see GH-491\n          return n.normalize(s);\n        }\n\n        if (s === null) {\n          s = '';\n        }\n\n        return s;\n      });\n    }\n\n    if (!n.prop || n.write !== false) {\n      defineSetter(elem.prototype, prop, function (val) {\n        if (!val) {\n          this.removeAttribute(attr);\n        } else {\n          var s = val.toString();\n\n          if (typeof n === 'object' && n.normalize) {\n            s = n.normalize(s);\n          }\n\n          this.setAttribute(attr, s);\n        }\n      });\n    }\n  });\n  tagNames.forEach(function (tag) {\n    core.Document.prototype._elementBuilders[tag.toLowerCase()] = function (doc, s) {\n      var el = new elem(doc, s);\n\n      if (def.elementBuilder) {\n        return def.elementBuilder(el, doc, s);\n      }\n\n      return el;\n    };\n  });\n}\n\ncore.HTMLCollection = function HTMLCollection(element, query) {\n  this._keys = [];\n  core.NodeList.call(this, element, query);\n};\n\ninheritFrom(core.NodeList, core.HTMLCollection, {\n  namedItem: function (name) {\n    // Try property shortcut; should work in most cases\n    if (Object.prototype.hasOwnProperty.call(this, name)) {\n      return this[name];\n    }\n\n    var results = this._toArray(),\n        l = results.length,\n        node,\n        matchingName = null;\n\n    for (var i = 0; i < l; i++) {\n      node = results[i];\n\n      if (node.getAttribute('id') === name) {\n        return node;\n      } else if (node.getAttribute('name') === name) {\n        matchingName = node;\n      }\n    }\n\n    return matchingName;\n  },\n  toString: function () {\n    return '[ jsdom HTMLCollection ]: contains ' + this.length + ' items';\n  },\n  _resetTo: function (array) {\n    var i,\n        _this = this;\n\n    for (i = 0; i < this._keys.length; ++i) {\n      delete this[this._keys[i]];\n    }\n\n    this._keys = [];\n\n    core.NodeList.prototype._resetTo.apply(this, arguments);\n\n    function testAttr(node, attr) {\n      var val = node.getAttribute(attr);\n\n      if (val && !Object.prototype.hasOwnProperty.call(_this, val)) {\n        _this[val] = node;\n\n        _this._keys.push(val);\n      }\n    }\n\n    for (i = 0; i < array.length; ++i) {\n      testAttr(array[i], 'id');\n    }\n\n    for (i = 0; i < array.length; ++i) {\n      testAttr(array[i], 'name');\n    }\n  }\n});\nObject.defineProperty(core.HTMLCollection.prototype, 'constructor', {\n  value: core.NodeList,\n  writable: true,\n  configurable: true\n});\ncore.HTMLOptionsCollection = core.HTMLCollection;\n\nfunction closest(e, tagName) {\n  tagName = tagName.toUpperCase();\n\n  while (e) {\n    if (e.nodeName.toUpperCase() === tagName || e.tagName && e.tagName.toUpperCase() === tagName) {\n      return e;\n    }\n\n    e = e._parentNode;\n  }\n\n  return null;\n}\n\nfunction descendants(e, tagName, recursive) {\n  var owner = recursive ? e._ownerDocument || e : e;\n  return new core.HTMLCollection(owner, core.mapper(e, function (n) {\n    return n.tagName === tagName;\n  }, recursive));\n}\n\nfunction firstChild(e, tagName) {\n  if (!e) {\n    return null;\n  }\n\n  var c = descendants(e, tagName, false);\n  return c.length > 0 ? c[0] : null;\n}\n\nfunction ResourceQueue(paused) {\n  this.paused = !!paused;\n}\n\nResourceQueue.prototype = {\n  push: function (callback) {\n    var q = this;\n    var item = {\n      prev: q.tail,\n      check: function () {\n        if (!q.paused && !this.prev && this.fired) {\n          callback(this.err, this.data);\n\n          if (this.next) {\n            this.next.prev = null;\n            this.next.check();\n          } else {\n            //q.tail===this\n            q.tail = null;\n          }\n        }\n      }\n    };\n\n    if (q.tail) {\n      q.tail.next = item;\n    }\n\n    q.tail = item;\n    return function (err, data) {\n      item.fired = 1;\n      item.err = err;\n      item.data = data;\n      item.check();\n    };\n  },\n  resume: function () {\n    if (!this.paused) {\n      return;\n    }\n\n    this.paused = false;\n    var head = this.tail;\n\n    while (head && head.prev) {\n      head = head.prev;\n    }\n\n    if (head) {\n      head.check();\n    }\n  }\n};\n\ncore.HTMLDocument = function HTMLDocument(options) {\n  core.Document.call(this, options);\n  this._referrer = options.referrer;\n  this._cookie = options.cookie;\n  this._cookieDomain = options.cookieDomain || '127.0.0.1';\n  this._documentRoot = options.documentRoot || Path.dirname(this._URL);\n  this._queue = new ResourceQueue(options.deferClose);\n  this._resourceLoader = options.resourceLoader;\n  this.readyState = 'loading'; // Add level2 features\n\n  this.implementation._addFeature('core', '2.0');\n\n  this.implementation._addFeature('html', '2.0');\n\n  this.implementation._addFeature('xhtml', '2.0');\n\n  this.implementation._addFeature('xml', '2.0');\n};\n\ninheritFrom(core.Document, core.HTMLDocument, {\n  _referrer: \"\",\n\n  get referrer() {\n    return this._referrer || '';\n  },\n\n  get domain() {\n    return \"\";\n  },\n\n  get images() {\n    return this.getElementsByTagName('IMG');\n  },\n\n  get applets() {\n    return new core.HTMLCollection(this, core.mapper(this, function (el) {\n      if (el && el.tagName) {\n        var upper = el.tagName.toUpperCase();\n\n        if (upper === \"APPLET\") {\n          return true;\n        } else if (upper === \"OBJECT\" && el.getElementsByTagName('APPLET').length > 0) {\n          return true;\n        }\n      }\n    }));\n  },\n\n  get links() {\n    return new core.HTMLCollection(this, core.mapper(this, function (el) {\n      if (el && el.tagName) {\n        var upper = el.tagName.toUpperCase();\n\n        if (upper === \"AREA\" || upper === \"A\" && el.href) {\n          return true;\n        }\n      }\n    }));\n  },\n\n  get forms() {\n    return this.getElementsByTagName('FORM');\n  },\n\n  get anchors() {\n    return this.getElementsByTagName('A');\n  },\n\n  open: function () {\n    this._childNodes = [];\n    this._documentElement = null;\n\n    this._modified();\n  },\n  close: function () {\n    this._queue.resume(); // Set the readyState to 'complete' once all resources are loaded.\n    // As a side-effect the document's load-event will be dispatched.\n\n\n    core.resourceLoader.enqueue(this, function () {\n      this.readyState = 'complete';\n      var ev = this.createEvent('HTMLEvents');\n      ev.initEvent('DOMContentLoaded', false, false);\n      this.dispatchEvent(ev);\n    })(null, true);\n  },\n  // document.write is defined in browser/index.js.\n  writeln: function (text) {\n    this.write(text + '\\n');\n  },\n  getElementsByName: function (elementName) {\n    return new core.HTMLCollection(this, core.mapper(this, function (el) {\n      return el.getAttribute && el.getAttribute(\"name\") === elementName;\n    }));\n  },\n\n  get title() {\n    var head = this.head,\n        title = head ? firstChild(head, 'TITLE') : null;\n    return title ? title.textContent : '';\n  },\n\n  set title(val) {\n    var title = firstChild(this.head, 'TITLE');\n\n    if (!title) {\n      title = this.createElement('TITLE');\n      var head = this.head;\n\n      if (!head) {\n        head = this.createElement('HEAD');\n        this.documentElement.insertBefore(head, this.documentElement.firstChild);\n      }\n\n      head.appendChild(title);\n    }\n\n    title.textContent = val;\n  },\n\n  get head() {\n    return firstChild(this.documentElement, 'HEAD');\n  },\n\n  set head(unused) {\n    /* noop */\n  },\n\n  get body() {\n    var body = firstChild(this.documentElement, 'BODY');\n\n    if (!body) {\n      body = firstChild(this.documentElement, 'FRAMESET');\n    }\n\n    return body;\n  },\n\n  _cookie: \"\",\n\n  get cookie() {\n    var cookies = Array.isArray(this._cookie) ? this._cookie : this._cookie && this._cookie.length > 0 ? [this._cookie] : [];\n    return cookies.map(function (x) {\n      return x.split(';')[0];\n    }).join('; ');\n  },\n\n  set cookie(val) {\n    if (val == null) return val;\n    var key = val.split('=')[0];\n    var cookies = Array.isArray(this._cookie) ? this._cookie : this._cookie && this._cookie.length > 0 ? [this._cookie] : [];\n\n    for (var i = 0; i < cookies.length; i++) {\n      if (cookies[i].lastIndexOf(key + '=', 0) === 0) {\n        cookies[i] = val;\n        key = null;\n        break;\n      }\n    }\n\n    if (key) {\n      cookies.push(val);\n    }\n\n    if (cookies.length === 1) {\n      this._cookie = cookies[0];\n    } else {\n      this._cookie = cookies;\n    }\n\n    return val;\n  }\n\n});\ndefine('HTMLElement', {\n  parentClass: core.Element,\n  proto: {\n    // Add default event behavior (click link to navigate, click button to submit\n    // form, etc). We start by wrapping dispatchEvent so we can forward events to\n    // the element's _eventDefault function (only events that did not incur\n    // preventDefault).\n    dispatchEvent: function (event) {\n      var outcome = core.Node.prototype.dispatchEvent.call(this, event);\n\n      if (!event._preventDefault && event.target._eventDefaults[event.type] && typeof event.target._eventDefaults[event.type] === 'function') {\n        event.target._eventDefaults[event.type](event);\n      }\n\n      return outcome;\n    },\n    getBoundingClientRect: function () {\n      return {\n        bottom: 0,\n        height: 0,\n        left: 0,\n        right: 0,\n        top: 0,\n        width: 0\n      };\n    },\n    focus: function () {\n      this._ownerDocument.activeElement = this;\n    },\n    blur: function () {\n      this._ownerDocument.activeElement = this._ownerDocument.body;\n    },\n    _eventDefaults: {}\n  },\n  attributes: ['id', 'title', 'lang', 'dir', {\n    prop: 'className',\n    attr: 'class',\n    normalize: function (s) {\n      return s || '';\n    }\n  }]\n});\n\ncore.Document.prototype._defaultElementBuilder = function (document, tagName) {\n  return new core.HTMLElement(document, tagName);\n}; // http://www.whatwg.org/specs/web-apps/current-work/#category-listed\n\n\nvar listedElements = /button|fieldset|input|keygen|object|select|textarea/i;\ndefine('HTMLFormElement', {\n  tagName: 'FORM',\n  proto: {\n    _descendantAdded: function (parent, child) {\n      var form = this;\n      core.visitTree(child, function (el) {\n        if (typeof el._changedFormOwner === 'function') {\n          el._changedFormOwner(form);\n        }\n      });\n\n      core.HTMLElement.prototype._descendantAdded.apply(this, arguments);\n    },\n    _descendantRemoved: function (parent, child) {\n      core.visitTree(child, function (el) {\n        if (typeof el._changedFormOwner === 'function') {\n          el._changedFormOwner(null);\n        }\n      });\n\n      core.HTMLElement.prototype._descendantRemoved.apply(this, arguments);\n    },\n\n    get elements() {\n      return new core.HTMLCollection(this._ownerDocument, core.mapper(this, function (e) {\n        return listedElements.test(e.nodeName); // TODO exclude <input type=\"image\">\n      }));\n    },\n\n    get length() {\n      return this.elements.length;\n    },\n\n    _dispatchSubmitEvent: function () {\n      var ev = this._ownerDocument.createEvent('HTMLEvents');\n\n      ev.initEvent('submit', true, true);\n\n      if (!this.dispatchEvent(ev)) {\n        this.submit();\n      }\n\n      ;\n    },\n    submit: function () {},\n    reset: function () {\n      this.elements._toArray().forEach(function (el) {\n        if (typeof el._formReset === 'function') {\n          el._formReset();\n        }\n      });\n    }\n  },\n  attributes: ['name', {\n    prop: 'acceptCharset',\n    attr: 'accept-charset'\n  }, 'action', 'enctype', 'method', 'target']\n});\ndefine('HTMLLinkElement', {\n  tagName: 'LINK',\n  proto: {\n    get href() {\n      return core.resourceLoader.resolve(this._ownerDocument, this.getAttribute('href'));\n    }\n\n  },\n  attributes: [{\n    prop: 'disabled',\n    type: 'boolean'\n  }, 'charset', 'href', 'hreflang', 'media', 'rel', 'rev', 'target', 'type']\n});\ndefine('HTMLMetaElement', {\n  tagName: 'META',\n  attributes: ['content', {\n    prop: 'httpEquiv',\n    attr: 'http-equiv'\n  }, 'name', 'scheme']\n});\ndefine('HTMLHtmlElement', {\n  tagName: 'HTML',\n  attributes: ['version']\n});\ndefine('HTMLHeadElement', {\n  tagName: 'HEAD',\n  attributes: ['profile']\n});\ndefine('HTMLTitleElement', {\n  tagName: 'TITLE',\n  proto: {\n    get text() {\n      return this.innerHTML;\n    },\n\n    set text(s) {\n      this.innerHTML = s;\n    }\n\n  }\n});\ndefine('HTMLBaseElement', {\n  tagName: 'BASE',\n  attributes: ['href', 'target']\n}); //**Deprecated**\n\ndefine('HTMLIsIndexElement', {\n  tagName: 'ISINDEX',\n  parentClass: core.Element,\n  proto: {\n    get form() {\n      return closest(this, 'FORM');\n    }\n\n  },\n  attributes: ['prompt']\n});\ndefine('HTMLStyleElement', {\n  tagName: 'STYLE',\n  attributes: [{\n    prop: 'disabled',\n    type: 'boolean'\n  }, 'media', 'type']\n});\ndefine('HTMLBodyElement', {\n  proto: function () {\n    var proto = {}; // The body element's \"traditional\" event handlers are proxied to the\n    // window object.\n    // See: http://www.whatwg.org/specs/web-apps/current-work/#the-body-element\n\n    ['onafterprint', 'onbeforeprint', 'onbeforeunload', 'onblur', 'onerror', 'onfocus', 'onhashchange', 'onload', 'onmessage', 'onoffline', 'ononline', 'onpagehide', 'onpageshow', 'onpopstate', 'onresize', 'onscroll', 'onstorage', 'onunload'].forEach(function (name) {\n      defineSetter(proto, name, function (handler) {\n        this._ownerDocument.parentWindow[name] = handler;\n      });\n      defineGetter(proto, name, function () {\n        return this._ownerDocument.parentWindow[name];\n      });\n    });\n    return proto;\n  }(),\n  tagName: 'BODY',\n  attributes: ['aLink', 'background', 'bgColor', 'link', 'text', 'vLink']\n});\ndefine('HTMLSelectElement', {\n  tagName: 'SELECT',\n  proto: {\n    _formReset: function () {\n      this.options._toArray().forEach(function (option, i) {\n        option._selectedness = option.defaultSelected;\n        option._dirtyness = false;\n      });\n\n      this._askedForAReset();\n    },\n    _askedForAReset: function () {\n      if (this.hasAttribute('multiple')) {\n        return;\n      }\n\n      var options = this.options._toArray();\n\n      var selected = options.filter(function (option) {\n        return option._selectedness;\n      }); // size = 1 is default if not multiple\n\n      if ((!this.size || this.size === 1) && !selected.length) {\n        // select the first option that is not disabled\n        for (var i = 0; i < options.length; ++i) {\n          var option = options[i];\n          var disabled = option.disabled;\n\n          if (option._parentNode && option._parentNode.nodeName.toUpperCase() === 'OPTGROUP' && option._parentNode.disabled) {\n            disabled = true;\n          }\n\n          if (!disabled) {\n            // (do not set dirty)\n            option._selectedness = true;\n            break;\n          }\n        }\n      } else if (selected.length >= 2) {\n        // select the last selected option\n        selected.forEach(function (option, index) {\n          option._selectedness = index === selected.length - 1;\n        });\n      }\n    },\n    _descendantAdded: function (parent, child) {\n      if (child.nodeType === core.Node.ELEMENT_NODE) {\n        this._askedForAReset();\n      }\n\n      core.HTMLElement.prototype._descendantAdded.apply(this, arguments);\n    },\n    _descendantRemoved: function (parent, child) {\n      if (child.nodeType === core.Node.ELEMENT_NODE) {\n        this._askedForAReset();\n      }\n\n      core.HTMLElement.prototype._descendantRemoved.apply(this, arguments);\n    },\n    _attrModified: function (name, value) {\n      if (name === 'multiple' || name === 'size') {\n        this._askedForAReset();\n      }\n\n      core.HTMLElement.prototype._attrModified.apply(this, arguments);\n    },\n\n    get options() {\n      return new core.HTMLOptionsCollection(this, core.mapper(this, function (n) {\n        return n.nodeName === 'OPTION';\n      }));\n    },\n\n    get length() {\n      return this.options.length;\n    },\n\n    get selectedIndex() {\n      return this.options._toArray().reduceRight(function (prev, option, i) {\n        return option.selected ? i : prev;\n      }, -1);\n    },\n\n    set selectedIndex(index) {\n      this.options._toArray().forEach(function (option, i) {\n        option.selected = i === index;\n      });\n    },\n\n    get value() {\n      var i = this.selectedIndex;\n\n      if (this.options.length && i === -1) {\n        i = 0;\n      }\n\n      if (i === -1) {\n        return '';\n      }\n\n      return this.options[i].value;\n    },\n\n    set value(val) {\n      var self = this;\n\n      this.options._toArray().forEach(function (option) {\n        if (option.value === val) {\n          option.selected = true;\n        } else {\n          if (!self.hasAttribute('multiple')) {\n            // Remove the selected bit from all other options in this group\n            // if the multiple attr is not present on the select\n            option.selected = false;\n          }\n        }\n      });\n    },\n\n    get form() {\n      return closest(this, 'FORM');\n    },\n\n    get type() {\n      return this.multiple ? 'select-multiple' : 'select-one';\n    },\n\n    add: function (opt, before) {\n      if (before) {\n        this.insertBefore(opt, before);\n      } else {\n        this.appendChild(opt);\n      }\n    },\n    remove: function (index) {\n      var opts = this.options._toArray();\n\n      if (index >= 0 && index < opts.length) {\n        var el = opts[index];\n\n        el._parentNode.removeChild(el);\n      }\n    }\n  },\n  attributes: [{\n    prop: 'disabled',\n    type: 'boolean'\n  }, {\n    prop: 'multiple',\n    type: 'boolean'\n  }, 'name', {\n    prop: 'size',\n    type: 'long'\n  }, {\n    prop: 'tabIndex',\n    type: 'long'\n  }]\n});\ndefine('HTMLOptGroupElement', {\n  tagName: 'OPTGROUP',\n  attributes: [{\n    prop: 'disabled',\n    type: 'boolean'\n  }, 'label']\n});\ndefine('HTMLOptionElement', {\n  tagName: 'OPTION',\n  proto: {\n    // whenever selectedness is set to true, make sure all\n    // other options set selectedness to false\n    _selectedness: false,\n    _dirtyness: false,\n    _removeOtherSelectedness: function () {\n      //Remove the selectedness flag from all other options in this select\n      var select = this._selectNode;\n\n      if (select && !select.multiple) {\n        var o = select.options;\n\n        for (var i = 0; i < o.length; i++) {\n          if (o[i] !== this) {\n            o[i]._selectedness = false;\n          }\n        }\n      }\n    },\n    _askForAReset: function () {\n      var select = this._selectNode;\n\n      if (select) {\n        select._askedForAReset();\n      }\n    },\n    _attrModified: function (name, value) {\n      if (!this._dirtyness && name === 'selected') {\n        this._selectedness = this.defaultSelected;\n\n        if (this._selectedness) {\n          this._removeOtherSelectedness();\n        }\n\n        this._askForAReset();\n      }\n\n      core.HTMLElement.prototype._attrModified.apply(this, arguments);\n    },\n\n    get _selectNode() {\n      var select = this._parentNode;\n      if (!select) return null;\n\n      if (select.nodeName.toUpperCase() !== 'SELECT') {\n        select = select._parentNode;\n        if (!select) return null;\n        if (select.nodeName.toUpperCase() !== 'SELECT') return null;\n      }\n\n      return select;\n    },\n\n    get form() {\n      return closest(this, 'FORM');\n    },\n\n    get defaultSelected() {\n      return this.getAttribute('selected') !== null;\n    },\n\n    set defaultSelected(s) {\n      if (s) this.setAttribute('selected', 'selected');else this.removeAttribute('selected');\n    },\n\n    get text() {\n      return this.innerHTML;\n    },\n\n    get value() {\n      return this.hasAttribute('value') ? this.getAttribute('value') : this.innerHTML;\n    },\n\n    set value(val) {\n      this.setAttribute('value', val);\n    },\n\n    get index() {\n      return closest(this, 'SELECT').options._toArray().indexOf(this);\n    },\n\n    get selected() {\n      return this._selectedness;\n    },\n\n    set selected(s) {\n      this._dirtyness = true;\n      this._selectedness = !!s;\n\n      if (this._selectedness) {\n        this._removeOtherSelectedness();\n      }\n\n      this._askForAReset();\n    }\n\n  },\n  attributes: [{\n    prop: 'disabled',\n    type: 'boolean'\n  }, 'label']\n});\ndefine('HTMLInputElement', {\n  tagName: 'INPUT',\n  init: function () {\n    if (!this.type) {\n      this.type = 'text';\n    }\n  },\n  proto: {\n    _value: null,\n    _dirtyValue: false,\n    _checkedness: false,\n    _dirtyCheckedness: false,\n    _attrModified: function (name, value) {\n      if (!this._dirtyValue && name === 'value') {\n        this._value = this.defaultValue;\n      }\n\n      if (!this._dirtyCheckedness && name === 'checked') {\n        this._checkedness = this.defaultChecked;\n\n        if (this._checkedness) {\n          this._removeOtherRadioCheckedness();\n        }\n      }\n\n      if (name === 'name' || name === 'type') {\n        if (this._checkedness) {\n          this._removeOtherRadioCheckedness();\n        }\n      }\n\n      core.HTMLElement.prototype._attrModified.apply(this, arguments);\n    },\n    _formReset: function () {\n      this._value = this.defaultValue;\n      this._dirtyValue = false;\n      this._checkedness = this.defaultChecked;\n      this._dirtyCheckedness = false;\n\n      if (this._checkedness) {\n        this._removeOtherRadioCheckedness();\n      }\n    },\n    _changedFormOwner: function (newForm) {\n      if (this._checkedness) {\n        this._removeOtherRadioCheckedness();\n      }\n    },\n    _removeOtherRadioCheckedness: function () {\n      var root = this._radioButtonGroupRoot;\n\n      if (!root) {\n        return;\n      }\n\n      var name = this.name.toLowerCase();\n      var radios = new core.HTMLCollection(this, core.mapper(root, function (el) {\n        return el.type === 'radio' && el.name && el.name.toLowerCase() === name && el._radioButtonGroupRoot === root;\n      }));\n\n      radios._toArray().forEach(function (radio) {\n        if (radio !== this) {\n          radio._checkedness = false;\n        }\n      }, this);\n    },\n\n    get _radioButtonGroupRoot() {\n      if (this.type !== 'radio' || !this.name) {\n        return null;\n      }\n\n      var e = this._parentNode;\n\n      while (e) {\n        // root node of this home sub tree\n        // or the form element we belong to\n        if (!e._parentNode || e.nodeName.toUpperCase() === 'FORM') {\n          return e;\n        }\n\n        e = e._parentNode;\n      }\n\n      return null;\n    },\n\n    get form() {\n      return closest(this, 'FORM');\n    },\n\n    get defaultValue() {\n      var val = this.getAttribute('value');\n      return val !== null ? val : \"\";\n    },\n\n    set defaultValue(val) {\n      this.setAttribute('value', String(val));\n    },\n\n    get defaultChecked() {\n      return this.getAttribute('checked') !== null;\n    },\n\n    set defaultChecked(s) {\n      if (s) this.setAttribute('checked', 'checked');else this.removeAttribute('checked');\n    },\n\n    get checked() {\n      return this._checkedness;\n    },\n\n    set checked(checked) {\n      this._checkedness = !!checked;\n      this._dirtyCheckedness = true;\n\n      if (this._checkedness) {\n        this._removeOtherRadioCheckedness();\n      }\n    },\n\n    get value() {\n      if (this._value === null) {\n        return '';\n      }\n\n      return this._value;\n    },\n\n    set value(val) {\n      this._dirtyValue = true;\n\n      if (val === null) {\n        this._value = null;\n      } else {\n        this._value = String(val);\n      }\n    },\n\n    get type() {\n      var type = this.getAttribute('type');\n      return type ? type : 'text';\n    },\n\n    set type(type) {\n      this.setAttribute('type', type);\n    },\n\n    select: function () {},\n    _dispatchClickEvent: function () {\n      var event = this._ownerDocument.createEvent(\"HTMLEvents\");\n\n      event.initEvent(\"click\", true, true);\n      this.dispatchEvent(event);\n    },\n    click: function () {\n      if (this.type === 'checkbox') {\n        this.checked = !this.checked;\n      } else if (this.type === 'radio') {\n        this.checked = true;\n      } else if (this.type === 'submit') {\n        var form = this.form;\n\n        if (form) {\n          form._dispatchSubmitEvent();\n        }\n      }\n\n      this._dispatchClickEvent();\n    }\n  },\n  attributes: ['accept', 'accessKey', 'align', 'alt', {\n    prop: 'disabled',\n    type: 'boolean'\n  }, {\n    prop: 'maxLength',\n    type: 'long'\n  }, 'name', {\n    prop: 'readOnly',\n    type: 'boolean'\n  }, {\n    prop: 'size',\n    type: 'long'\n  }, 'src', {\n    prop: 'tabIndex',\n    type: 'long'\n  }, {\n    prop: 'type',\n    normalize: function (val) {\n      return val ? val.toLowerCase() : 'text';\n    }\n  }, 'useMap']\n});\ndefine('HTMLTextAreaElement', {\n  tagName: 'TEXTAREA',\n  proto: {\n    _apiValue: null,\n    _dirtyValue: false,\n    // \"raw value\" and \"value\" are not used here because jsdom has no GUI\n    _formReset: function () {\n      this._apiValue = null;\n      this._dirtyValue = false;\n    },\n\n    get form() {\n      return closest(this, 'FORM');\n    },\n\n    get defaultValue() {\n      return this.textContent;\n    },\n\n    set defaultValue(val) {\n      this.textContent = val;\n    },\n\n    get value() {\n      // The WHATWG specifies that when \"textContent\" changes, the \"raw value\"\n      // (just the API value in jsdom) must also be updated.\n      // This slightly different solution has identical results, but is a lot less complex.\n      if (this._dirtyValue) {\n        if (this._apiValue === null) {\n          return '';\n        }\n\n        return this._apiValue;\n      }\n\n      var val = this.defaultValue;\n      val = val.replace(/\\r\\n|\\r/g, '\\n'); // API value normalizes line breaks per WHATWG\n\n      return val;\n    },\n\n    set value(val) {\n      if (val) {\n        val = val.replace(/\\r\\n|\\r/g, '\\n'); // API value normalizes line breaks per WHATWG\n      }\n\n      this._dirtyValue = true;\n      this._apiValue = val;\n    },\n\n    get textLength() {\n      return this.value.length; // code unit length (16 bit)\n    },\n\n    get type() {\n      return 'textarea';\n    },\n\n    select: function () {}\n  },\n  attributes: ['accessKey', {\n    prop: 'cols',\n    type: 'long'\n  }, {\n    prop: 'disabled',\n    type: 'boolean'\n  }, {\n    prop: 'maxLength',\n    type: 'long'\n  }, 'name', {\n    prop: 'readOnly',\n    type: 'boolean'\n  }, {\n    prop: 'rows',\n    type: 'long'\n  }, {\n    prop: 'tabIndex',\n    type: 'long'\n  }]\n});\ndefine('HTMLButtonElement', {\n  tagName: 'BUTTON',\n  proto: {\n    get form() {\n      return closest(this, 'FORM');\n    }\n\n  },\n  attributes: ['accessKey', {\n    prop: 'disabled',\n    type: 'boolean'\n  }, 'name', {\n    prop: 'tabIndex',\n    type: 'long'\n  }, 'type', 'value']\n});\ndefine('HTMLLabelElement', {\n  tagName: 'LABEL',\n  proto: {\n    get form() {\n      return closest(this, 'FORM');\n    }\n\n  },\n  attributes: ['accessKey', {\n    prop: 'htmlFor',\n    attr: 'for'\n  }]\n});\ndefine('HTMLFieldSetElement', {\n  tagName: 'FIELDSET',\n  proto: {\n    get form() {\n      return closest(this, 'FORM');\n    }\n\n  }\n});\ndefine('HTMLLegendElement', {\n  tagName: 'LEGEND',\n  proto: {\n    get form() {\n      return closest(this, 'FORM');\n    }\n\n  },\n  attributes: ['accessKey', 'align']\n});\ndefine('HTMLUListElement', {\n  tagName: 'UL',\n  attributes: [{\n    prop: 'compact',\n    type: 'boolean'\n  }, 'type']\n});\ndefine('HTMLOListElement', {\n  tagName: 'OL',\n  attributes: [{\n    prop: 'compact',\n    type: 'boolean'\n  }, {\n    prop: 'start',\n    type: 'long'\n  }, 'type']\n});\ndefine('HTMLDListElement', {\n  tagName: 'DL',\n  attributes: [{\n    prop: 'compact',\n    type: 'boolean'\n  }]\n});\ndefine('HTMLDirectoryElement', {\n  tagName: 'DIR',\n  attributes: [{\n    prop: 'compact',\n    type: 'boolean'\n  }]\n});\ndefine('HTMLMenuElement', {\n  tagName: 'MENU',\n  attributes: [{\n    prop: 'compact',\n    type: 'boolean'\n  }]\n});\ndefine('HTMLLIElement', {\n  tagName: 'LI',\n  attributes: ['type', {\n    prop: 'value',\n    type: 'long'\n  }]\n});\ndefine('HTMLCanvasElement', {\n  tagName: 'CANVAS',\n  attributes: ['align'],\n  elementBuilder: function (element) {\n    // require node-canvas and catch the error if it blows up\n    try {\n      var canvas = new (require('canvas'))(0, 0);\n\n      for (var attr in element) {\n        if (!canvas[attr]) {\n          canvas[attr] = element[attr];\n        }\n      }\n\n      return canvas;\n    } catch (e) {\n      return element;\n    }\n  }\n});\ndefine('HTMLDivElement', {\n  tagName: 'DIV',\n  attributes: ['align'],\n  proto: {\n    toString: function () {\n      return '[object HTMLDivElement]';\n    }\n  }\n});\ndefine('HTMLParagraphElement', {\n  tagName: 'P',\n  attributes: ['align']\n});\ndefine('HTMLHeadingElement', {\n  tagNames: ['H1', 'H2', 'H3', 'H4', 'H5', 'H6'],\n  attributes: ['align']\n});\ndefine('HTMLQuoteElement', {\n  tagNames: ['Q', 'BLOCKQUOTE'],\n  attributes: ['cite']\n});\ndefine('HTMLPreElement', {\n  tagName: 'PRE',\n  attributes: [{\n    prop: 'width',\n    type: 'long'\n  }]\n});\ndefine('HTMLBRElement', {\n  tagName: 'BR',\n  attributes: ['clear']\n});\ndefine('HTMLBaseFontElement', {\n  tagName: 'BASEFONT',\n  attributes: ['color', 'face', {\n    prop: 'size',\n    type: 'long'\n  }]\n});\ndefine('HTMLFontElement', {\n  tagName: 'FONT',\n  attributes: ['color', 'face', 'size']\n});\ndefine('HTMLHRElement', {\n  tagName: 'HR',\n  attributes: ['align', {\n    prop: 'noShade',\n    type: 'boolean'\n  }, 'size', 'width']\n});\ndefine('HTMLModElement', {\n  tagNames: ['INS', 'DEL'],\n  attributes: ['cite', 'dateTime']\n});\ndefine('HTMLAnchorElement', {\n  tagName: 'A',\n  proto: {\n    get href() {\n      return core.resourceLoader.resolve(this._ownerDocument, this.getAttribute('href'));\n    },\n\n    get hostname() {\n      return URL.parse(this.href).hostname || '';\n    },\n\n    get host() {\n      return URL.parse(this.href).host || '';\n    },\n\n    get origin() {\n      var proto = URL.parse(this.href).protocol;\n\n      if (proto !== undefined && proto !== null) {\n        proto += '//';\n      }\n\n      return proto + URL.parse(this.href).host || '';\n    },\n\n    get port() {\n      return URL.parse(this.href).port || '';\n    },\n\n    get protocol() {\n      var protocol = URL.parse(this.href).protocol;\n      return protocol == null ? ':' : protocol;\n    },\n\n    get password() {\n      var auth = URL.parse(this.href).auth;\n      return auth.substr(auth.indexOf(':') + 1);\n    },\n\n    get pathname() {\n      return URL.parse(this.href).pathname || '';\n    },\n\n    get username() {\n      var auth = URL.parse(this.href).auth;\n      return auth.substr(0, auth.indexOf(':'));\n    },\n\n    get search() {\n      return URL.parse(this.href).search || '';\n    },\n\n    get hash() {\n      return URL.parse(this.href).hash || '';\n    }\n\n  },\n  attributes: ['accessKey', 'charset', 'coords', {\n    prop: 'href',\n    type: 'string',\n    read: false\n  }, 'hreflang', 'name', 'rel', 'rev', 'shape', {\n    prop: 'tabIndex',\n    type: 'long'\n  }, 'target', 'type']\n});\ndefine('HTMLImageElement', {\n  tagName: 'IMG',\n  proto: {\n    _attrModified: function (name, value, oldVal) {\n      if (name == 'src' && value !== oldVal) {\n        core.resourceLoader.enqueue(this, function () {})();\n      }\n    },\n\n    get src() {\n      return core.resourceLoader.resolve(this._ownerDocument, this.getAttribute('src'));\n    }\n\n  },\n  attributes: ['name', 'align', 'alt', 'border', {\n    prop: 'height',\n    type: 'long'\n  }, {\n    prop: 'hspace',\n    type: 'long'\n  }, {\n    prop: 'isMap',\n    type: 'boolean'\n  }, 'longDesc', {\n    prop: 'src',\n    type: 'string',\n    read: false\n  }, 'useMap', {\n    prop: 'vspace',\n    type: 'long'\n  }, {\n    prop: 'width',\n    type: 'long'\n  }]\n});\ndefine('HTMLObjectElement', {\n  tagName: 'OBJECT',\n  proto: {\n    get form() {\n      return closest(this, 'FORM');\n    },\n\n    get contentDocument() {\n      return null;\n    }\n\n  },\n  attributes: ['code', 'align', 'archive', 'border', 'codeBase', 'codeType', 'data', {\n    prop: 'declare',\n    type: 'boolean'\n  }, {\n    prop: 'height',\n    type: 'long'\n  }, {\n    prop: 'hspace',\n    type: 'long'\n  }, 'name', 'standby', {\n    prop: 'tabIndex',\n    type: 'long'\n  }, 'type', 'useMap', {\n    prop: 'vspace',\n    type: 'long'\n  }, {\n    prop: 'width',\n    type: 'long'\n  }]\n});\ndefine('HTMLParamElement', {\n  tagName: 'PARAM',\n  attributes: ['name', 'type', 'value', 'valueType']\n});\ndefine('HTMLAppletElement', {\n  tagName: 'APPLET',\n  attributes: ['align', 'alt', 'archive', 'code', 'codeBase', 'height', {\n    prop: 'hspace',\n    type: 'long'\n  }, 'name', 'object', {\n    prop: 'vspace',\n    type: 'long'\n  }, 'width']\n});\ndefine('HTMLMapElement', {\n  tagName: 'MAP',\n  proto: {\n    get areas() {\n      return this.getElementsByTagName(\"AREA\");\n    }\n\n  },\n  attributes: ['name']\n});\ndefine('HTMLAreaElement', {\n  tagName: 'AREA',\n  attributes: ['accessKey', 'alt', 'coords', 'href', {\n    prop: 'noHref',\n    type: 'boolean'\n  }, 'shape', {\n    prop: 'tabIndex',\n    type: 'long'\n  }, 'target']\n});\ndefine('HTMLScriptElement', {\n  tagName: 'SCRIPT',\n  init: function () {\n    this.addEventListener('DOMNodeInsertedIntoDocument', function () {\n      if (this.src) {\n        core.resourceLoader.load(this, this.src, this._eval);\n      } else {\n        var src = this.sourceLocation || {},\n            filename = src.file || this._ownerDocument.URL;\n\n        if (src) {\n          filename += ':' + src.line + ':' + src.col;\n        }\n\n        filename += '<script>';\n        core.resourceLoader.enqueue(this, this._eval, filename)(null, this.text);\n      }\n    });\n  },\n  proto: {\n    _eval: function (text, filename) {\n      if (this._ownerDocument.implementation._hasFeature(\"ProcessExternalResources\", \"script\") && this.language && core.languageProcessors[this.language]) {\n        this._ownerDocument._writeAfterElement = this;\n        core.languageProcessors[this.language](this, text, filename);\n        delete this._ownerDocument._writeAfterElement;\n      }\n    },\n\n    get language() {\n      var type = this.type || \"text/javascript\";\n      return type.split(\"/\").pop().toLowerCase();\n    },\n\n    get text() {\n      var i = 0,\n          children = this._childNodes,\n          l = children.length,\n          ret = [];\n\n      for (i; i < l; i++) {\n        ret.push(children[i].nodeValue);\n      }\n\n      return ret.join(\"\");\n    },\n\n    set text(text) {\n      while (this._childNodes.length) {\n        this.removeChild(this._childNodes[this._childNodes.length - 1]);\n      }\n\n      this.appendChild(this._ownerDocument.createTextNode(text));\n    }\n\n  },\n  attributes: [{\n    prop: 'defer',\n    'type': 'boolean'\n  }, 'htmlFor', 'event', 'charset', 'type', 'src']\n});\ndefine('HTMLTableElement', {\n  tagName: 'TABLE',\n  proto: {\n    get caption() {\n      return firstChild(this, 'CAPTION');\n    },\n\n    get tHead() {\n      return firstChild(this, 'THEAD');\n    },\n\n    get tFoot() {\n      return firstChild(this, 'TFOOT');\n    },\n\n    get rows() {\n      if (!this._rows) {\n        var table = this;\n        this._rows = new core.HTMLCollection(this._ownerDocument, function () {\n          var sections = [table.tHead].concat(table.tBodies._toArray(), table.tFoot).filter(function (s) {\n            return !!s;\n          });\n\n          if (sections.length === 0) {\n            return core.mapDOMNodes(table, false, function (el) {\n              return el.tagName === 'TR';\n            });\n          }\n\n          return sections.reduce(function (prev, s) {\n            return prev.concat(s.rows._toArray());\n          }, []);\n        });\n      }\n\n      return this._rows;\n    },\n\n    get tBodies() {\n      if (!this._tBodies) {\n        this._tBodies = descendants(this, 'TBODY', false);\n      }\n\n      return this._tBodies;\n    },\n\n    createTHead: function () {\n      var el = this.tHead;\n\n      if (!el) {\n        el = this._ownerDocument.createElement('THEAD');\n        this.appendChild(el);\n      }\n\n      return el;\n    },\n    deleteTHead: function () {\n      var el = this.tHead;\n\n      if (el) {\n        el._parentNode.removeChild(el);\n      }\n    },\n    createTFoot: function () {\n      var el = this.tFoot;\n\n      if (!el) {\n        el = this._ownerDocument.createElement('TFOOT');\n        this.appendChild(el);\n      }\n\n      return el;\n    },\n    deleteTFoot: function () {\n      var el = this.tFoot;\n\n      if (el) {\n        el._parentNode.removeChild(el);\n      }\n    },\n    createCaption: function () {\n      var el = this.caption;\n\n      if (!el) {\n        el = this._ownerDocument.createElement('CAPTION');\n        this.appendChild(el);\n      }\n\n      return el;\n    },\n    deleteCaption: function () {\n      var c = this.caption;\n\n      if (c) {\n        c._parentNode.removeChild(c);\n      }\n    },\n    insertRow: function (index) {\n      var tr = this._ownerDocument.createElement('TR');\n\n      if (this._childNodes.length === 0) {\n        this.appendChild(this._ownerDocument.createElement('TBODY'));\n      }\n\n      var rows = this.rows._toArray();\n\n      if (index < -1 || index > rows.length) {\n        throw new core.DOMException(core.INDEX_SIZE_ERR);\n      }\n\n      if (index === -1 || index === 0 && rows.length === 0) {\n        this.tBodies.item(0).appendChild(tr);\n      } else if (index === rows.length) {\n        var ref = rows[index - 1];\n\n        ref._parentNode.appendChild(tr);\n      } else {\n        var ref = rows[index];\n\n        ref._parentNode.insertBefore(tr, ref);\n      }\n\n      return tr;\n    },\n    deleteRow: function (index) {\n      var rows = this.rows._toArray(),\n          l = rows.length;\n\n      if (index === -1) {\n        index = l - 1;\n      }\n\n      if (index < 0 || index >= l) {\n        throw new core.DOMException(core.INDEX_SIZE_ERR);\n      }\n\n      var tr = rows[index];\n\n      tr._parentNode.removeChild(tr);\n    }\n  },\n  attributes: ['align', 'bgColor', 'border', 'cellPadding', 'cellSpacing', 'frame', 'rules', 'summary', 'width']\n});\ndefine('HTMLTableCaptionElement', {\n  tagName: 'CAPTION',\n  attributes: ['align']\n});\ndefine('HTMLTableColElement', {\n  tagNames: ['COL', 'COLGROUP'],\n  attributes: ['align', {\n    prop: 'ch',\n    attr: 'char'\n  }, {\n    prop: 'chOff',\n    attr: 'charoff'\n  }, {\n    prop: 'span',\n    type: 'long'\n  }, 'vAlign', 'width']\n});\ndefine('HTMLTableSectionElement', {\n  tagNames: ['THEAD', 'TBODY', 'TFOOT'],\n  proto: {\n    get rows() {\n      if (!this._rows) {\n        this._rows = descendants(this, 'TR', false);\n      }\n\n      return this._rows;\n    },\n\n    insertRow: function (index) {\n      var tr = this._ownerDocument.createElement('TR');\n\n      var rows = this.rows._toArray();\n\n      if (index < -1 || index > rows.length) {\n        throw new core.DOMException(core.INDEX_SIZE_ERR);\n      }\n\n      if (index === -1 || index === rows.length) {\n        this.appendChild(tr);\n      } else {\n        var ref = rows[index];\n        this.insertBefore(tr, ref);\n      }\n\n      return tr;\n    },\n    deleteRow: function (index) {\n      var rows = this.rows._toArray();\n\n      if (index === -1) {\n        index = rows.length - 1;\n      }\n\n      if (index < 0 || index >= rows.length) {\n        throw new core.DOMException(core.INDEX_SIZE_ERR);\n      }\n\n      var tr = this.rows[index];\n      this.removeChild(tr);\n    }\n  },\n  attributes: ['align', {\n    prop: 'ch',\n    attr: 'char'\n  }, {\n    prop: 'chOff',\n    attr: 'charoff'\n  }, {\n    prop: 'span',\n    type: 'long'\n  }, 'vAlign', 'width']\n});\ndefine('HTMLTableRowElement', {\n  tagName: 'TR',\n  proto: {\n    get cells() {\n      if (!this._cells) {\n        this._cells = new core.HTMLCollection(this, core.mapper(this, function (n) {\n          return n.nodeName === 'TD' || n.nodeName === 'TH';\n        }, false));\n      }\n\n      return this._cells;\n    },\n\n    get rowIndex() {\n      var table = closest(this, 'TABLE');\n      return table ? table.rows._toArray().indexOf(this) : -1;\n    },\n\n    get sectionRowIndex() {\n      return this._parentNode.rows._toArray().indexOf(this);\n    },\n\n    insertCell: function (index) {\n      var td = this._ownerDocument.createElement('TD');\n\n      var cells = this.cells._toArray();\n\n      if (index < -1 || index > cells.length) {\n        throw new core.DOMException(core.INDEX_SIZE_ERR);\n      }\n\n      if (index === -1 || index === cells.length) {\n        this.appendChild(td);\n      } else {\n        var ref = cells[index];\n        this.insertBefore(td, ref);\n      }\n\n      return td;\n    },\n    deleteCell: function (index) {\n      var cells = this.cells._toArray();\n\n      if (index === -1) {\n        index = cells.length - 1;\n      }\n\n      if (index < 0 || index >= cells.length) {\n        throw new core.DOMException(core.INDEX_SIZE_ERR);\n      }\n\n      var td = this.cells[index];\n      this.removeChild(td);\n    }\n  },\n  attributes: ['align', 'bgColor', {\n    prop: 'ch',\n    attr: 'char'\n  }, {\n    prop: 'chOff',\n    attr: 'charoff'\n  }, 'vAlign']\n});\ndefine('HTMLTableCellElement', {\n  tagNames: ['TH', 'TD'],\n  proto: {\n    _headers: null,\n\n    set headers(h) {\n      if (h === '') {\n        //Handle resetting headers so the dynamic getter returns a query\n        this._headers = null;\n        return;\n      }\n\n      if (!(h instanceof Array)) {\n        h = [h];\n      }\n\n      this._headers = h;\n    },\n\n    get headers() {\n      if (this._headers) {\n        return this._headers.join(' ');\n      }\n\n      var cellIndex = this.cellIndex,\n          headings = [],\n          siblings = this._parentNode.getElementsByTagName(this.tagName);\n\n      for (var i = 0; i < siblings.length; i++) {\n        if (siblings.item(i).cellIndex >= cellIndex) {\n          break;\n        }\n\n        headings.push(siblings.item(i).id);\n      }\n\n      this._headers = headings;\n      return headings.join(' ');\n    },\n\n    get cellIndex() {\n      return closest(this, 'TR').cells._toArray().indexOf(this);\n    }\n\n  },\n  attributes: ['abbr', 'align', 'axis', 'bgColor', {\n    prop: 'ch',\n    attr: 'char'\n  }, {\n    prop: 'chOff',\n    attr: 'charoff'\n  }, {\n    prop: 'colSpan',\n    type: 'long'\n  }, 'height', {\n    prop: 'noWrap',\n    type: 'boolean'\n  }, {\n    prop: 'rowSpan',\n    type: 'long'\n  }, 'scope', 'vAlign', 'width']\n});\ndefine('HTMLFrameSetElement', {\n  tagName: 'FRAMESET',\n  attributes: ['cols', 'rows']\n});\n\nfunction loadFrame(frame) {\n  if (frame._contentDocument) {\n    // We don't want to access document.parentWindow, since the getter will\n    // cause a new window to be allocated if it doesn't exist.  Probe the\n    // private variable instead.\n    if (frame._contentDocument._parentWindow) {\n      // close calls delete on its document.\n      frame._contentDocument.parentWindow.close();\n    } else {\n      delete frame._contentDocument;\n    }\n  }\n\n  var src = frame.src.trim() === '' ? 'about:blank' : frame.src;\n  var parentDoc = frame._ownerDocument; // If the URL can't be resolved or the src attribute is missing / blank,\n  // then url should be set to the string \"about:blank\".\n  // (http://www.whatwg.org/specs/web-apps/current-work/#the-iframe-element)\n\n  var url = core.resourceLoader.resolve(parentDoc, src);\n  var contentDoc = frame._contentDocument = new core.HTMLDocument({\n    parsingMode: 'html',\n    url: url,\n    documentRoot: Path.dirname(url)\n  });\n  applyDocumentFeatures(contentDoc, parentDoc.implementation._features);\n  var parent = parentDoc.parentWindow;\n  var contentWindow = contentDoc.parentWindow;\n  contentWindow.parent = parent;\n  contentWindow.top = parent.top; // Handle about:blank with a simulated load of an empty document.\n\n  if (url === 'about:blank') {\n    core.resourceLoader.enqueue(frame, function () {\n      contentDoc.write();\n      contentDoc.close();\n    })();\n  } else {\n    core.resourceLoader.load(frame, url, function (html, filename) {\n      contentDoc.write(html);\n      contentDoc.close();\n    });\n  }\n}\n\ndefine('HTMLFrameElement', {\n  tagName: 'FRAME',\n  init: function () {\n    // Set up the frames array.  window.frames really just returns a reference\n    // to the window object, so the frames array is just implemented as indexes\n    // on the window.\n    var parent = this._ownerDocument.parentWindow;\n    var frameID = parent._length++;\n    var self = this;\n    defineGetter(parent, frameID, function () {\n      return self.contentWindow;\n    }); // The contentDocument/contentWindow shouldn't be created until the frame\n    // is inserted:\n    // \"When an iframe element is first inserted into a document, the user\n    //  agent must create a nested browsing context, and then process the\n    //  iframe attributes for the first time.\"\n    //  (http://www.whatwg.org/specs/web-apps/current-work/#the-iframe-element)\n\n    this._initInsertListener = function () {\n      loadFrame(self);\n    };\n\n    this.addEventListener('DOMNodeInsertedIntoDocument', this._initInsertListener, false);\n  },\n  proto: {\n    _attrModified: function (name, value, oldVal) {\n      core.HTMLElement.prototype._attrModified.call(this, name, value, oldVal);\n\n      var self = this;\n\n      if (name === 'name') {\n        // Remove named frame access.\n        if (oldVal) {\n          this._ownerDocument.parentWindow._frame(oldVal);\n        } // Set up named frame access.\n\n\n        if (value) {\n          this._ownerDocument.parentWindow._frame(value, this);\n        }\n      } else if (name === 'src') {\n        // Page we don't fetch the page until the node is inserted. This at\n        // least seems to be the way Chrome does it.\n        if (!this._attachedToDocument) {\n          if (!this._waitingOnInsert) {\n            // First, remove the listener added in 'init'.\n            this.removeEventListener('DOMNodeInsertedIntoDocument', this._initInsertListener, false); // If we aren't already waiting on an insert, add a listener.\n            // This guards against src being set multiple times before the frame\n            // is inserted into the document - we don't want to register multiple\n            // callbacks.\n\n            this.addEventListener('DOMNodeInsertedIntoDocument', function loader() {\n              self.removeEventListener('DOMNodeInsertedIntoDocument', loader, false);\n              this._waitingOnInsert = false;\n              loadFrame(self);\n            }, false);\n            this._waitingOnInsert = true;\n          }\n        } else {\n          loadFrame(self);\n        }\n      }\n    },\n    _contentDocument: null,\n\n    get contentDocument() {\n      if (this._contentDocument == null) {\n        this._contentDocument = new core.HTMLDocument({\n          parsingMode: \"html\"\n        });\n      }\n\n      return this._contentDocument;\n    },\n\n    get contentWindow() {\n      return this.contentDocument.parentWindow;\n    }\n\n  },\n  attributes: ['frameBorder', 'longDesc', 'marginHeight', 'marginWidth', 'name', {\n    prop: 'noResize',\n    type: 'boolean'\n  }, 'scrolling', {\n    prop: 'src',\n    type: 'string',\n    write: false\n  }]\n});\ndefine('HTMLIFrameElement', {\n  tagName: 'IFRAME',\n  parentClass: core.HTMLFrameElement,\n  attributes: ['align', 'frameBorder', 'height', 'longDesc', 'marginHeight', 'marginWidth', 'name', 'scrolling', 'src', 'width']\n});","map":{"version":3,"sources":["F:/JavaScript/Projects/chemistryphile/node_modules/jsdom-no-contextify/lib/jsdom/level2/html.js"],"names":["core","require","applyDocumentFeatures","defineGetter","defineSetter","inheritFrom","resolveHref","URL","Path","fs","http","https","languageProcessors","javascript","resourceLoader","load","element","href","callback","ownerDoc","_ownerDocument","ownerImplementation","implementation","_hasFeature","tagName","toLowerCase","full","resolve","url","parse","cookie","cookieDomain","_cookieDomain","baseUrl","enqueued","enqueue","_resourceLoader","fetch","bind","call","defaultFetch","filename","loader","doc","nodeType","Node","DOCUMENT_NODE","_queue","push","err","data","ev","createEvent","initEvent","e","error","dispatchEvent","document","baseElements","getElementsByTagName","length","baseHref","item","referrer","hostname","download","readFile","pathname","path","search","options","request","protocol","port","setHeader","host","split","indexOf","on","response","success","statusCode","redirect","headers","setEncoding","chunk","toString","removeAllListeners","end","replace","define","elementClass","def","tagNames","parentClass","HTMLElement","attrs","attributes","proto","elem","name","toUpperCase","_init","init","forEach","n","prop","attr","read","prototype","s","getAttribute","type","normalize","write","val","removeAttribute","setAttribute","tag","Document","_elementBuilders","el","elementBuilder","HTMLCollection","query","_keys","NodeList","namedItem","Object","hasOwnProperty","results","_toArray","l","node","matchingName","i","_resetTo","array","_this","apply","arguments","testAttr","defineProperty","value","writable","configurable","HTMLOptionsCollection","closest","nodeName","_parentNode","descendants","recursive","owner","mapper","firstChild","c","ResourceQueue","paused","q","prev","tail","check","fired","next","resume","head","HTMLDocument","_referrer","_cookie","_documentRoot","documentRoot","dirname","_URL","deferClose","readyState","_addFeature","domain","images","applets","upper","links","forms","anchors","open","_childNodes","_documentElement","_modified","close","writeln","text","getElementsByName","elementName","title","textContent","createElement","documentElement","insertBefore","appendChild","unused","body","cookies","Array","isArray","map","x","join","key","lastIndexOf","Element","event","outcome","_preventDefault","target","_eventDefaults","getBoundingClientRect","bottom","height","left","right","top","width","focus","activeElement","blur","_defaultElementBuilder","listedElements","_descendantAdded","parent","child","form","visitTree","_changedFormOwner","_descendantRemoved","elements","test","_dispatchSubmitEvent","submit","reset","_formReset","innerHTML","handler","parentWindow","option","_selectedness","defaultSelected","_dirtyness","_askedForAReset","hasAttribute","selected","filter","size","disabled","index","ELEMENT_NODE","_attrModified","selectedIndex","reduceRight","self","multiple","add","opt","before","remove","opts","removeChild","_removeOtherSelectedness","select","_selectNode","o","_askForAReset","_value","_dirtyValue","_checkedness","_dirtyCheckedness","defaultValue","defaultChecked","_removeOtherRadioCheckedness","newForm","root","_radioButtonGroupRoot","radios","radio","String","checked","_dispatchClickEvent","click","_apiValue","textLength","canvas","origin","undefined","password","auth","substr","username","hash","oldVal","src","contentDocument","areas","addEventListener","_eval","sourceLocation","file","line","col","language","_writeAfterElement","pop","children","ret","nodeValue","createTextNode","caption","tHead","tFoot","rows","_rows","table","sections","concat","tBodies","mapDOMNodes","reduce","_tBodies","createTHead","deleteTHead","createTFoot","deleteTFoot","createCaption","deleteCaption","insertRow","tr","DOMException","INDEX_SIZE_ERR","ref","deleteRow","cells","_cells","rowIndex","sectionRowIndex","insertCell","td","deleteCell","_headers","h","cellIndex","headings","siblings","id","loadFrame","frame","_contentDocument","_parentWindow","trim","parentDoc","contentDoc","parsingMode","_features","contentWindow","html","frameID","_length","_initInsertListener","_frame","_attachedToDocument","_waitingOnInsert","removeEventListener","HTMLFrameElement"],"mappings":"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","sourcesContent":["var core                  = require(\"../level1/core\"),\n    applyDocumentFeatures = require('../browser/documentfeatures').applyDocumentFeatures,\n    defineGetter          = require('../utils').defineGetter,\n    defineSetter          = require('../utils').defineSetter,\n    inheritFrom           = require(\"../utils\").inheritFrom,\n    resolveHref           = require(\"../utils\").resolveHref,\n    URL                   = require(\"url\"),\n    Path                  = require('path'),\n    fs                    = require(\"fs\"),\n    http                  = require('http'),\n    https                 = require('https');\n\n// Setup the javascript language processor\ncore.languageProcessors = {\n  javascript : require(\"./languages/javascript\").javascript\n};\n\ncore.resourceLoader = {\n  load: function(element, href, callback) {\n    var ownerDoc = element._ownerDocument;\n    var ownerImplementation = ownerDoc.implementation;\n\n    if (ownerImplementation._hasFeature('FetchExternalResources', element.tagName.toLowerCase())) {\n      var full = this.resolve(ownerDoc, href);\n      var url = URL.parse(full);\n      if (ownerImplementation._hasFeature('SkipExternalResources', full)) {\n        return false;\n      }\n\n      var cookie = ownerDoc.cookie;\n      var cookieDomain = ownerDoc._cookieDomain;\n      var baseUrl = this.baseUrl(ownerDoc);\n      var enqueued = this.enqueue(element, callback, full);\n\n      if (typeof ownerDoc._resourceLoader == 'function') {\n        var fetch = this.fetch.bind(this);\n        ownerDoc._resourceLoader.call(null, {\n          url: url,\n          cookie: cookie,\n          cookieDomain: cookieDomain,\n          baseUrl: baseUrl,\n          defaultFetch: function(callback) {\n            fetch(this.url, this.cookie, this.cookieDomain, this.baseUrl, callback);\n          }\n        }, enqueued);\n      } else {\n        this.fetch(url, cookie, cookieDomain, baseUrl, enqueued);\n      }\n    }\n  },\n  enqueue: function(element, callback, filename) {\n    var loader = this,\n        doc    = element.nodeType === core.Node.DOCUMENT_NODE ?\n                 element                :\n                 element._ownerDocument;\n\n    if (!doc._queue) {\n      return function() {};\n    }\n\n    return doc._queue.push(function(err, data) {\n      var ev = doc.createEvent('HTMLEvents');\n\n      if (!err) {\n        try {\n          callback.call(element, data, filename || doc.URL);\n          ev.initEvent('load', false, false);\n        }\n        catch(e) {\n          err = e;\n        }\n      }\n\n      if (err) {\n        ev.initEvent('error', false, false);\n        ev.error = err;\n      }\n\n      element.dispatchEvent(ev);\n    });\n  },\n\n  baseUrl: function(document) {\n    var baseElements = document.getElementsByTagName('base');\n    var baseUrl = document.URL;\n\n    if (baseElements.length > 0) {\n      var baseHref = baseElements.item(0).href;\n      if (baseHref) {\n        baseUrl = resolveHref(baseUrl, baseHref);\n      }\n    }\n\n    return baseUrl;\n  },\n  resolve: function(document, href) {\n    // if getAttribute returns null, there is no href\n    // lets resolve to an empty string (nulls are not expected farther up)\n    if (href === null) {\n      return '';\n    }\n\n    var baseUrl = this.baseUrl(document);\n\n    return resolveHref(baseUrl, href);\n  },\n  fetch: function(url, cookie, cookieDomain, referrer, callback) {\n    if (url.hostname) {\n      this.download(url, cookie, cookieDomain, referrer, callback);\n    } else {\n      this.readFile(url.pathname, callback);\n    }\n  },\n  download: function(url, cookie, cookieDomain, referrer, callback) {\n    var path    = url.pathname + (url.search || ''),\n        options = {'method': 'GET', 'host': url.hostname, 'path': path},\n        request;\n    if (url.protocol === 'https:') {\n      options.port = url.port || 443;\n      request = https.request(options);\n    } else {\n      options.port = url.port || 80;\n      request = http.request(options);\n    }\n\n    // set header.\n    if (referrer) {\n        request.setHeader('Referer', referrer);\n    }\n    if (cookie) {\n      var host = url.host.split(':')[0];\n      if (host.indexOf(cookieDomain, host.length - cookieDomain.length) !== -1) {\n        request.setHeader('cookie', cookie);\n      }\n    }\n\n    request.on('response', function (response) {\n      var data = '';\n      function success () {\n        if ([301, 302, 303, 307].indexOf(response.statusCode) > -1) {\n          var redirect = URL.resolve(url, response.headers[\"location\"]);\n          core.resourceLoader.download(URL.parse(redirect), cookie, cookieDomain, referrer, callback);\n        } else {\n          callback(null, data);\n        }\n      }\n      response.setEncoding('utf8');\n      response.on('data', function (chunk) {\n        data += chunk.toString();\n      });\n      response.on('end', function() {\n        // According to node docs, 'close' can fire after 'end', but not\n        // vice versa.  Remove 'close' listener so we don't call success twice.\n        response.removeAllListeners('close');\n        success();\n      });\n      response.on('close', function (err) {\n        if (err) {\n          callback(err);\n        } else {\n          success();\n        }\n      });\n    });\n\n    request.on('error', callback);\n    request.end();\n  },\n  readFile: function(url, callback) {\n    fs.readFile(url.replace(/^file:\\/\\//, \"\").replace(/^\\/([a-z]):\\//i, '$1:/').replace(/%20/g, ' '), 'utf8', callback);\n  }\n};\n\nfunction define(elementClass, def) {\n  var tagName = def.tagName,\n    tagNames = def.tagNames || (tagName? [tagName] : []),\n    parentClass = def.parentClass || core.HTMLElement,\n    attrs = def.attributes || [],\n    proto = def.proto || {};\n\n  var elem = core[elementClass] = function(document, name) {\n    parentClass.call(this, document, name || tagName.toUpperCase());\n    if (elem._init) {\n      elem._init.call(this);\n    }\n  };\n  elem._init = def.init;\n\n  inheritFrom(parentClass, elem, proto);\n\n  attrs.forEach(function(n) {\n      var prop = n.prop || n,\n        attr = n.attr || prop.toLowerCase();\n\n      if (!n.prop || n.read !== false) {\n        defineGetter(elem.prototype, prop, function() {\n          var s = this.getAttribute(attr);\n          if (n.type && n.type === 'boolean') {\n            return s !== null;\n          }\n          if (n.type && n.type === 'long') {\n            return +s;\n          }\n          if (typeof n === 'object' && n.normalize) { // see GH-491\n            return n.normalize(s);\n          }\n          if (s === null) {\n            s = '';\n          }\n          return s;\n        });\n      }\n\n      if (!n.prop || n.write !== false) {\n        defineSetter(elem.prototype, prop, function(val) {\n          if (!val) {\n            this.removeAttribute(attr);\n          }\n          else {\n            var s = val.toString();\n            if (typeof n === 'object' && n.normalize) {\n              s = n.normalize(s);\n            }\n            this.setAttribute(attr, s);\n          }\n        });\n      }\n  });\n\n  tagNames.forEach(function(tag) {\n    core.Document.prototype._elementBuilders[tag.toLowerCase()] = function(doc, s) {\n      var el = new elem(doc, s);\n\n      if (def.elementBuilder) {\n        return def.elementBuilder(el, doc, s);\n      }\n\n      return el;\n    };\n  });\n}\n\n\n\ncore.HTMLCollection = function HTMLCollection(element, query) {\n  this._keys = [];\n  core.NodeList.call(this, element, query);\n};\ninheritFrom(core.NodeList, core.HTMLCollection, {\n  namedItem: function(name) {\n    // Try property shortcut; should work in most cases\n    if (Object.prototype.hasOwnProperty.call(this, name)) {\n      return this[name];\n    }\n\n    var results = this._toArray(),\n        l       = results.length,\n        node,\n        matchingName = null;\n\n    for (var i=0; i<l; i++) {\n      node = results[i];\n      if (node.getAttribute('id') === name) {\n        return node;\n      } else if (node.getAttribute('name') === name) {\n        matchingName = node;\n      }\n    }\n    return matchingName;\n  },\n  toString: function() {\n    return '[ jsdom HTMLCollection ]: contains ' + this.length + ' items';\n  },\n  _resetTo: function(array) {\n    var i, _this = this;\n\n    for (i = 0; i < this._keys.length; ++i) {\n      delete this[this._keys[i]];\n    }\n    this._keys = [];\n\n    core.NodeList.prototype._resetTo.apply(this, arguments);\n\n    function testAttr(node, attr) {\n      var val = node.getAttribute(attr);\n      if (val && !Object.prototype.hasOwnProperty.call(_this, val)) {\n        _this[val] = node;\n        _this._keys.push(val);\n      }\n    }\n    for (i = 0; i < array.length; ++i) {\n      testAttr(array[i], 'id');\n    }\n    for (i = 0; i < array.length; ++i) {\n      testAttr(array[i], 'name');\n    }\n  }\n});\nObject.defineProperty(core.HTMLCollection.prototype, 'constructor', {\n  value: core.NodeList,\n  writable: true,\n  configurable: true\n});\n\ncore.HTMLOptionsCollection = core.HTMLCollection;\n\nfunction closest(e, tagName) {\n  tagName = tagName.toUpperCase();\n  while (e) {\n    if (e.nodeName.toUpperCase() === tagName ||\n        (e.tagName && e.tagName.toUpperCase() === tagName))\n    {\n      return e;\n    }\n    e = e._parentNode;\n  }\n  return null;\n}\n\nfunction descendants(e, tagName, recursive) {\n  var owner = recursive ? e._ownerDocument || e : e;\n  return new core.HTMLCollection(owner, core.mapper(e, function(n) {\n    return n.tagName === tagName;\n  }, recursive));\n}\n\nfunction firstChild(e, tagName) {\n  if (!e) {\n    return null;\n  }\n  var c = descendants(e, tagName, false);\n  return c.length > 0 ? c[0] : null;\n}\n\nfunction ResourceQueue(paused) {\n  this.paused = !!paused;\n}\nResourceQueue.prototype = {\n  push: function(callback) {\n    var q = this;\n    var item = {\n      prev: q.tail,\n      check: function() {\n        if (!q.paused && !this.prev && this.fired){\n          callback(this.err, this.data);\n          if (this.next) {\n            this.next.prev = null;\n            this.next.check();\n          }else{//q.tail===this\n      q.tail = null;\n    }\n        }\n      }\n    };\n    if (q.tail) {\n      q.tail.next = item;\n    }\n    q.tail = item;\n    return function(err, data) {\n      item.fired = 1;\n      item.err = err;\n      item.data = data;\n      item.check();\n    };\n  },\n  resume: function() {\n    if(!this.paused){\n      return;\n    }\n    this.paused = false;\n    var head = this.tail;\n    while(head && head.prev){\n      head = head.prev;\n    }\n    if(head){\n      head.check();\n    }\n  }\n};\n\ncore.HTMLDocument = function HTMLDocument(options) {\n  core.Document.call(this, options);\n  this._referrer = options.referrer;\n  this._cookie = options.cookie;\n  this._cookieDomain = options.cookieDomain || '127.0.0.1';\n  this._documentRoot = options.documentRoot || Path.dirname(this._URL);\n  this._queue = new ResourceQueue(options.deferClose);\n  this._resourceLoader = options.resourceLoader;\n  this.readyState = 'loading';\n\n  // Add level2 features\n  this.implementation._addFeature('core'  , '2.0');\n  this.implementation._addFeature('html'  , '2.0');\n  this.implementation._addFeature('xhtml' , '2.0');\n  this.implementation._addFeature('xml'   , '2.0');\n};\n\ninheritFrom(core.Document, core.HTMLDocument, {\n  _referrer : \"\",\n  get referrer() {\n    return this._referrer || '';\n  },\n  get domain() {\n    return \"\";\n  },\n  get images() {\n    return this.getElementsByTagName('IMG');\n  },\n  get applets() {\n    return new core.HTMLCollection(this, core.mapper(this, function(el) {\n      if (el && el.tagName) {\n        var upper = el.tagName.toUpperCase();\n        if (upper === \"APPLET\") {\n          return true;\n        } else if (upper === \"OBJECT\" &&\n          el.getElementsByTagName('APPLET').length > 0)\n        {\n          return true;\n        }\n      }\n    }));\n  },\n  get links() {\n    return new core.HTMLCollection(this, core.mapper(this, function(el) {\n      if (el && el.tagName) {\n        var upper = el.tagName.toUpperCase();\n        if (upper === \"AREA\" || (upper === \"A\" && el.href)) {\n          return true;\n        }\n      }\n    }));\n  },\n  get forms() {\n    return this.getElementsByTagName('FORM');\n  },\n  get anchors() {\n    return this.getElementsByTagName('A');\n  },\n  open  : function() {\n    this._childNodes = [];\n    this._documentElement = null;\n    this._modified();\n  },\n  close : function() {\n    this._queue.resume();\n    // Set the readyState to 'complete' once all resources are loaded.\n    // As a side-effect the document's load-event will be dispatched.\n    core.resourceLoader.enqueue(this, function() {\n      this.readyState = 'complete';\n      var ev = this.createEvent('HTMLEvents');\n      ev.initEvent('DOMContentLoaded', false, false);\n      this.dispatchEvent(ev);\n    })(null, true);\n  },\n\n  // document.write is defined in browser/index.js.\n\n  writeln : function(text) {\n    this.write(text + '\\n');\n  },\n\n  getElementsByName : function(elementName) {\n    return new core.HTMLCollection(this, core.mapper(this, function(el) {\n      return (el.getAttribute && el.getAttribute(\"name\") === elementName);\n    }));\n  },\n\n  get title() {\n    var head = this.head,\n      title = head ? firstChild(head, 'TITLE') : null;\n    return title ? title.textContent : '';\n  },\n\n  set title(val) {\n    var title = firstChild(this.head, 'TITLE');\n    if (!title) {\n      title = this.createElement('TITLE');\n      var head = this.head;\n      if (!head) {\n        head = this.createElement('HEAD');\n        this.documentElement.insertBefore(head, this.documentElement.firstChild);\n      }\n      head.appendChild(title);\n    }\n    title.textContent = val;\n  },\n\n  get head() {\n    return firstChild(this.documentElement, 'HEAD');\n  },\n\n  set head(unused) { /* noop */ },\n\n  get body() {\n    var body = firstChild(this.documentElement, 'BODY');\n    if (!body) {\n      body = firstChild(this.documentElement, 'FRAMESET');\n    }\n    return body;\n  },\n\n  _cookie : \"\",\n  get cookie() {\n    var cookies = Array.isArray(this._cookie) ?\n      this._cookie :\n      (this._cookie && this._cookie.length > 0 ? [this._cookie] : []);\n\n    return cookies.map(function (x) {\n      return x.split(';')[0];\n    }).join('; ');\n  },\n  set cookie(val) {\n    if (val == null) return val;\n    var key = val.split('=')[0];\n    var cookies = Array.isArray(this._cookie) ?\n      this._cookie :\n      (this._cookie && this._cookie.length > 0 ? [this._cookie] : []);\n    for (var i = 0; i < cookies.length; i++) {\n      if (cookies[i].lastIndexOf(key + '=', 0) === 0) {\n        cookies[i] = val;\n        key = null;\n        break;\n      }\n    }\n    if (key) {\n      cookies.push(val);\n    }\n    if (cookies.length === 1) {\n      this._cookie = cookies[0];\n    } else {\n      this._cookie = cookies;\n    }\n    return val;\n  }\n});\n\ndefine('HTMLElement', {\n  parentClass: core.Element,\n  proto : {\n    // Add default event behavior (click link to navigate, click button to submit\n    // form, etc). We start by wrapping dispatchEvent so we can forward events to\n    // the element's _eventDefault function (only events that did not incur\n    // preventDefault).\n    dispatchEvent : function (event) {\n      var outcome = core.Node.prototype.dispatchEvent.call(this, event)\n\n      if (!event._preventDefault     &&\n          event.target._eventDefaults[event.type] &&\n          typeof event.target._eventDefaults[event.type] === 'function')\n      {\n        event.target._eventDefaults[event.type](event)\n      }\n      return outcome;\n    },\n    getBoundingClientRect: function () {\n      return {\n        bottom: 0,\n        height: 0,\n        left: 0,\n        right: 0,\n        top: 0,\n        width: 0\n      };\n    },\n    focus : function() {\n      this._ownerDocument.activeElement = this;\n    },\n    blur : function() {\n      this._ownerDocument.activeElement = this._ownerDocument.body;\n    },\n    _eventDefaults : {}\n  },\n  attributes: [\n    'id',\n    'title',\n    'lang',\n    'dir',\n    {prop: 'className', attr: 'class', normalize: function(s) { return s || ''; }}\n  ]\n});\n\ncore.Document.prototype._defaultElementBuilder = function(document, tagName) {\n  return new core.HTMLElement(document, tagName);\n};\n\n// http://www.whatwg.org/specs/web-apps/current-work/#category-listed\nvar listedElements = /button|fieldset|input|keygen|object|select|textarea/i;\n\ndefine('HTMLFormElement', {\n  tagName: 'FORM',\n  proto: {\n    _descendantAdded: function(parent, child) {\n      var form = this;\n      core.visitTree(child, function(el) {\n        if (typeof el._changedFormOwner === 'function') {\n          el._changedFormOwner(form);\n        }\n      });\n\n      core.HTMLElement.prototype._descendantAdded.apply(this, arguments);\n    },\n    _descendantRemoved: function(parent, child) {\n      core.visitTree(child, function(el) {\n        if (typeof el._changedFormOwner === 'function') {\n          el._changedFormOwner(null);\n        }\n      });\n\n      core.HTMLElement.prototype._descendantRemoved.apply(this, arguments);\n    },\n    get elements() {\n      return new core.HTMLCollection(this._ownerDocument, core.mapper(this, function(e) {\n        return listedElements.test(e.nodeName) ; // TODO exclude <input type=\"image\">\n      }));\n    },\n    get length() {\n      return this.elements.length;\n    },\n    _dispatchSubmitEvent: function() {\n      var ev = this._ownerDocument.createEvent('HTMLEvents');\n      ev.initEvent('submit', true, true);\n      if (!this.dispatchEvent(ev)) {\n        this.submit();\n      };\n    },\n    submit: function() {\n    },\n    reset: function() {\n      this.elements._toArray().forEach(function(el) {\n        if (typeof el._formReset === 'function') {\n          el._formReset();\n        }\n      });\n    }\n  },\n  attributes: [\n    'name',\n    {prop: 'acceptCharset', attr: 'accept-charset'},\n    'action',\n    'enctype',\n    'method',\n    'target'\n  ]\n});\n\ndefine('HTMLLinkElement', {\n  tagName: 'LINK',\n  proto: {\n    get href() {\n      return core.resourceLoader.resolve(this._ownerDocument, this.getAttribute('href'));\n    }\n  },\n  attributes: [\n    {prop: 'disabled', type: 'boolean'},\n    'charset',\n    'href',\n    'hreflang',\n    'media',\n    'rel',\n    'rev',\n    'target',\n    'type'\n  ]\n});\n\ndefine('HTMLMetaElement', {\n  tagName: 'META',\n  attributes: [\n    'content',\n    {prop: 'httpEquiv', attr: 'http-equiv'},\n    'name',\n    'scheme'\n  ]\n});\n\ndefine('HTMLHtmlElement', {\n  tagName: 'HTML',\n  attributes: [\n    'version'\n  ]\n});\n\ndefine('HTMLHeadElement', {\n  tagName: 'HEAD',\n  attributes: [\n    'profile'\n  ]\n});\n\ndefine('HTMLTitleElement', {\n  tagName: 'TITLE',\n  proto: {\n    get text() {\n      return this.innerHTML;\n    },\n    set text(s) {\n      this.innerHTML = s;\n    }\n  }\n});\n\ndefine('HTMLBaseElement', {\n  tagName: 'BASE',\n  attributes: [\n    'href',\n    'target'\n  ]\n});\n\n\n//**Deprecated**\ndefine('HTMLIsIndexElement', {\n  tagName : 'ISINDEX',\n  parentClass : core.Element,\n  proto : {\n    get form() {\n      return closest(this, 'FORM');\n    }\n  },\n  attributes : [\n    'prompt'\n  ]\n});\n\n\ndefine('HTMLStyleElement', {\n  tagName: 'STYLE',\n  attributes: [\n    {prop: 'disabled', type: 'boolean'},\n    'media',\n    'type',\n  ]\n});\n\ndefine('HTMLBodyElement', {\n  proto: (function() {\n    var proto = {};\n    // The body element's \"traditional\" event handlers are proxied to the\n    // window object.\n    // See: http://www.whatwg.org/specs/web-apps/current-work/#the-body-element\n    ['onafterprint', 'onbeforeprint', 'onbeforeunload', 'onblur', 'onerror',\n     'onfocus', 'onhashchange', 'onload', 'onmessage', 'onoffline', 'ononline',\n     'onpagehide', 'onpageshow', 'onpopstate', 'onresize', 'onscroll',\n     'onstorage', 'onunload'].forEach(function (name) {\n      defineSetter(proto, name, function (handler) {\n        this._ownerDocument.parentWindow[name] = handler;\n      });\n      defineGetter(proto, name, function () {\n        return this._ownerDocument.parentWindow[name];\n      });\n    });\n    return proto;\n  })(),\n  tagName: 'BODY',\n  attributes: [\n    'aLink',\n    'background',\n    'bgColor',\n    'link',\n    'text',\n    'vLink'\n  ]\n});\n\ndefine('HTMLSelectElement', {\n  tagName: 'SELECT',\n  proto: {\n    _formReset: function() {\n      this.options._toArray().forEach(function(option, i) {\n        option._selectedness = option.defaultSelected;\n        option._dirtyness = false;\n      });\n      this._askedForAReset();\n    },\n    _askedForAReset: function() {\n      if (this.hasAttribute('multiple')) {\n        return;\n      }\n\n      var options = this.options._toArray();\n      var selected = options.filter(function(option){\n        return option._selectedness;\n      });\n\n      // size = 1 is default if not multiple\n      if ((!this.size || this.size === 1) && !selected.length) {\n        // select the first option that is not disabled\n        for (var i = 0; i < options.length; ++i) {\n          var option = options[i];\n          var disabled = option.disabled;\n          if (option._parentNode &&\n              option._parentNode.nodeName.toUpperCase() === 'OPTGROUP' &&\n              option._parentNode.disabled) {\n            disabled = true;\n          }\n\n          if (!disabled) {\n            // (do not set dirty)\n            option._selectedness = true;\n            break;\n          }\n        }\n      } else if (selected.length >= 2) {\n        // select the last selected option\n        selected.forEach(function(option, index) {\n          option._selectedness = index === selected.length - 1;\n        });\n      }\n    },\n    _descendantAdded: function(parent, child) {\n      if (child.nodeType === core.Node.ELEMENT_NODE) {\n        this._askedForAReset();\n      }\n\n      core.HTMLElement.prototype._descendantAdded.apply(this, arguments);\n    },\n    _descendantRemoved: function(parent, child) {\n      if (child.nodeType === core.Node.ELEMENT_NODE) {\n        this._askedForAReset();\n      }\n\n      core.HTMLElement.prototype._descendantRemoved.apply(this, arguments);\n    },\n    _attrModified: function(name, value) {\n      if (name === 'multiple' || name === 'size') {\n        this._askedForAReset();\n      }\n      core.HTMLElement.prototype._attrModified.apply(this, arguments);\n    },\n    get options() {\n      return new core.HTMLOptionsCollection(this, core.mapper(this, function(n) {\n        return n.nodeName === 'OPTION';\n      }));\n    },\n\n    get length() {\n      return this.options.length;\n    },\n\n    get selectedIndex() {\n      return this.options._toArray().reduceRight(function(prev, option, i) {\n        return option.selected ? i : prev;\n      }, -1);\n    },\n\n    set selectedIndex(index) {\n      this.options._toArray().forEach(function(option, i) {\n        option.selected = i === index;\n      });\n    },\n\n    get value() {\n      var i = this.selectedIndex;\n      if (this.options.length && (i === -1)) {\n        i = 0;\n      }\n      if (i === -1) {\n        return '';\n      }\n      return this.options[i].value;\n    },\n\n    set value(val) {\n      var self = this;\n      this.options._toArray().forEach(function(option) {\n        if (option.value === val) {\n          option.selected = true;\n        } else {\n          if (!self.hasAttribute('multiple')) {\n            // Remove the selected bit from all other options in this group\n            // if the multiple attr is not present on the select\n            option.selected = false;\n          }\n        }\n      });\n    },\n\n    get form() {\n      return closest(this, 'FORM');\n    },\n\n    get type() {\n      return this.multiple ? 'select-multiple' : 'select-one';\n    },\n\n    add: function(opt, before) {\n      if (before) {\n        this.insertBefore(opt, before);\n      }\n      else {\n        this.appendChild(opt);\n      }\n    },\n\n    remove: function(index) {\n      var opts = this.options._toArray();\n      if (index >= 0 && index < opts.length) {\n        var el = opts[index];\n        el._parentNode.removeChild(el);\n      }\n    }\n\n  },\n  attributes: [\n    {prop: 'disabled', type: 'boolean'},\n    {prop: 'multiple', type: 'boolean'},\n    'name',\n    {prop: 'size', type: 'long'},\n    {prop: 'tabIndex', type: 'long'},\n  ]\n});\n\ndefine('HTMLOptGroupElement', {\n  tagName: 'OPTGROUP',\n  attributes: [\n    {prop: 'disabled', type: 'boolean'},\n    'label'\n  ]\n});\n\ndefine('HTMLOptionElement', {\n  tagName: 'OPTION',\n  proto: {\n    // whenever selectedness is set to true, make sure all\n    // other options set selectedness to false\n    _selectedness: false,\n    _dirtyness: false,\n    _removeOtherSelectedness: function() {\n      //Remove the selectedness flag from all other options in this select\n      var select = this._selectNode;\n\n      if (select && !select.multiple) {\n        var o = select.options;\n        for (var i = 0; i < o.length; i++) {\n          if (o[i] !== this) {\n            o[i]._selectedness = false;\n          }\n        }\n      }\n    },\n    _askForAReset: function() {\n      var select = this._selectNode;\n      if (select) {\n        select._askedForAReset();\n      }\n    },\n    _attrModified: function(name, value) {\n      if (!this._dirtyness && name === 'selected') {\n        this._selectedness = this.defaultSelected;\n        if (this._selectedness) {\n          this._removeOtherSelectedness();\n        }\n        this._askForAReset();\n      }\n      core.HTMLElement.prototype._attrModified.apply(this, arguments);\n    },\n    get _selectNode() {\n      var select = this._parentNode;\n      if (!select) return null;\n      if (select.nodeName.toUpperCase() !== 'SELECT') {\n        select = select._parentNode;\n        if (!select) return null;\n        if (select.nodeName.toUpperCase() !== 'SELECT') return null;\n      }\n      return select;\n    },\n    get form() {\n      return closest(this, 'FORM');\n    },\n    get defaultSelected() {\n      return this.getAttribute('selected') !== null;\n    },\n    set defaultSelected(s) {\n      if (s) this.setAttribute('selected', 'selected');\n      else this.removeAttribute('selected');\n    },\n    get text() {\n      return this.innerHTML;\n    },\n    get value() {\n      return (this.hasAttribute('value')) ? this.getAttribute('value') : this.innerHTML;\n    },\n    set value(val) {\n      this.setAttribute('value', val);\n    },\n    get index() {\n      return closest(this, 'SELECT').options._toArray().indexOf(this);\n    },\n    get selected() {\n      return this._selectedness;\n    },\n    set selected(s) {\n      this._dirtyness = true;\n      this._selectedness = !!s;\n      if (this._selectedness) {\n        this._removeOtherSelectedness();\n      }\n      this._askForAReset();\n    }\n  },\n  attributes: [\n    {prop: 'disabled', type: 'boolean'},\n    'label'\n  ]\n});\n\ndefine('HTMLInputElement', {\n  tagName: 'INPUT',\n  init: function() {\n    if (!this.type) {\n      this.type = 'text';\n    }\n  },\n  proto: {\n    _value: null,\n    _dirtyValue: false,\n    _checkedness: false,\n    _dirtyCheckedness: false,\n    _attrModified: function(name, value) {\n      if (!this._dirtyValue && name === 'value') {\n        this._value = this.defaultValue;\n      }\n      if (!this._dirtyCheckedness && name === 'checked') {\n        this._checkedness = this.defaultChecked;\n        if (this._checkedness) {\n          this._removeOtherRadioCheckedness();\n        }\n      }\n\n      if (name === 'name' || name === 'type') {\n        if (this._checkedness) {\n          this._removeOtherRadioCheckedness();\n        }\n      }\n\n      core.HTMLElement.prototype._attrModified.apply(this, arguments);\n    },\n    _formReset: function() {\n      this._value = this.defaultValue;\n      this._dirtyValue = false;\n      this._checkedness = this.defaultChecked;\n      this._dirtyCheckedness = false;\n      if (this._checkedness) {\n        this._removeOtherRadioCheckedness();\n      }\n    },\n    _changedFormOwner: function(newForm) {\n      if (this._checkedness) {\n        this._removeOtherRadioCheckedness();\n      }\n    },\n    _removeOtherRadioCheckedness: function() {\n      var root = this._radioButtonGroupRoot;\n      if (!root) {\n        return;\n      }\n\n      var name = this.name.toLowerCase();\n      var radios = new core.HTMLCollection(this, core.mapper(root, function(el) {\n        return el.type === 'radio' &&\n               el.name &&\n               el.name.toLowerCase() === name &&\n               el._radioButtonGroupRoot === root;\n      }));\n\n      radios._toArray().forEach(function(radio) {\n        if (radio !== this) {\n          radio._checkedness = false;\n        }\n      }, this);\n    },\n    get _radioButtonGroupRoot() {\n      if (this.type !== 'radio' || !this.name) {\n        return null;\n      }\n\n      var e = this._parentNode;\n      while (e) {\n        // root node of this home sub tree\n        // or the form element we belong to\n        if (!e._parentNode || e.nodeName.toUpperCase() === 'FORM') {\n          return e;\n        }\n        e = e._parentNode;\n      }\n      return null;\n    },\n    get form() {\n      return closest(this, 'FORM');\n    },\n    get defaultValue() {\n      var val = this.getAttribute('value');\n      return val !== null ? val : \"\";\n    },\n    set defaultValue(val) {\n      this.setAttribute('value', String(val));\n    },\n    get defaultChecked() {\n      return this.getAttribute('checked') !== null;\n    },\n    set defaultChecked(s) {\n      if (s) this.setAttribute('checked', 'checked');\n      else this.removeAttribute('checked');\n    },\n    get checked() {\n      return this._checkedness;\n    },\n    set checked(checked) {\n      this._checkedness = !!checked;\n      this._dirtyCheckedness = true;\n      if (this._checkedness) {\n        this._removeOtherRadioCheckedness();\n      }\n    },\n    get value() {\n      if (this._value === null) {\n        return '';\n      }\n      return this._value;\n    },\n    set value(val) {\n      this._dirtyValue = true;\n      if (val === null) {\n        this._value = null;\n      } else {\n        this._value = String(val);\n      }\n    },\n    get type() {\n        var type = this.getAttribute('type');\n        return type ? type : 'text';\n    },\n    set type(type) {\n        this.setAttribute('type', type);\n    },\n    select: function() {\n    },\n\n    _dispatchClickEvent: function() {\n      var event = this._ownerDocument.createEvent(\"HTMLEvents\");\n      event.initEvent(\"click\", true, true);\n      this.dispatchEvent(event);\n    },\n\n    click: function() {\n      if (this.type === 'checkbox') {\n        this.checked = !this.checked;\n      }\n      else if (this.type === 'radio') {\n        this.checked = true;\n      }\n      else if (this.type === 'submit') {\n        var form = this.form;\n        if (form) {\n          form._dispatchSubmitEvent();\n        }\n      }\n      this._dispatchClickEvent();\n    }\n  },\n  attributes: [\n    'accept',\n    'accessKey',\n    'align',\n    'alt',\n    {prop: 'disabled', type: 'boolean'},\n    {prop: 'maxLength', type: 'long'},\n    'name',\n    {prop: 'readOnly', type: 'boolean'},\n    {prop: 'size', type: 'long'},\n    'src',\n    {prop: 'tabIndex', type: 'long'},\n    {prop: 'type', normalize: function(val) {\n        return val ? val.toLowerCase() : 'text';\n    }},\n    'useMap'\n  ]\n});\n\ndefine('HTMLTextAreaElement', {\n  tagName: 'TEXTAREA',\n  proto: {\n    _apiValue: null,\n    _dirtyValue: false,\n    // \"raw value\" and \"value\" are not used here because jsdom has no GUI\n    _formReset: function() {\n      this._apiValue = null;\n      this._dirtyValue = false;\n    },\n    get form() {\n      return closest(this, 'FORM');\n    },\n    get defaultValue() {\n      return this.textContent;\n    },\n    set defaultValue(val) {\n      this.textContent = val;\n    },\n    get value() {\n      // The WHATWG specifies that when \"textContent\" changes, the \"raw value\"\n      // (just the API value in jsdom) must also be updated.\n      // This slightly different solution has identical results, but is a lot less complex.\n      if (this._dirtyValue) {\n        if (this._apiValue === null) {\n          return '';\n        }\n        return this._apiValue;\n      }\n\n      var val = this.defaultValue;\n      val = val.replace(/\\r\\n|\\r/g, '\\n'); // API value normalizes line breaks per WHATWG\n      return val;\n    },\n    set value(val) {\n      if (val) {\n        val = val.replace(/\\r\\n|\\r/g, '\\n'); // API value normalizes line breaks per WHATWG\n      }\n\n      this._dirtyValue = true;\n      this._apiValue = val;\n    },\n    get textLength() {\n      return this.value.length; // code unit length (16 bit)\n    },\n    get type() {\n      return 'textarea';\n    },\n    select: function() {\n    }\n  },\n  attributes: [\n    'accessKey',\n    {prop: 'cols', type: 'long'},\n    {prop: 'disabled', type: 'boolean'},\n    {prop: 'maxLength', type: 'long'},\n    'name',\n    {prop: 'readOnly', type: 'boolean'},\n    {prop: 'rows', type: 'long'},\n    {prop: 'tabIndex', type: 'long'}\n  ]\n});\n\ndefine('HTMLButtonElement', {\n  tagName: 'BUTTON',\n  proto: {\n    get form() {\n      return closest(this, 'FORM');\n    }\n  },\n  attributes: [\n    'accessKey',\n    {prop: 'disabled', type: 'boolean'},\n    'name',\n    {prop: 'tabIndex', type: 'long'},\n    'type',\n    'value'\n  ]\n});\n\ndefine('HTMLLabelElement', {\n  tagName: 'LABEL',\n  proto: {\n    get form() {\n      return closest(this, 'FORM');\n    }\n  },\n  attributes: [\n    'accessKey',\n    {prop: 'htmlFor', attr: 'for'}\n  ]\n});\n\ndefine('HTMLFieldSetElement', {\n  tagName: 'FIELDSET',\n  proto: {\n    get form() {\n      return closest(this, 'FORM');\n    }\n  }\n});\n\ndefine('HTMLLegendElement', {\n  tagName: 'LEGEND',\n  proto: {\n    get form() {\n      return closest(this, 'FORM');\n    }\n  },\n  attributes: [\n    'accessKey',\n    'align'\n  ]\n});\n\ndefine('HTMLUListElement', {\n  tagName: 'UL',\n  attributes: [\n    {prop: 'compact', type: 'boolean'},\n    'type'\n  ]\n});\n\ndefine('HTMLOListElement', {\n  tagName: 'OL',\n  attributes: [\n    {prop: 'compact', type: 'boolean'},\n    {prop: 'start', type: 'long'},\n    'type'\n  ]\n});\n\ndefine('HTMLDListElement', {\n  tagName: 'DL',\n  attributes: [\n    {prop: 'compact', type: 'boolean'}\n  ]\n});\n\ndefine('HTMLDirectoryElement', {\n  tagName: 'DIR',\n  attributes: [\n    {prop: 'compact', type: 'boolean'}\n  ]\n});\n\ndefine('HTMLMenuElement', {\n  tagName: 'MENU',\n  attributes: [\n    {prop: 'compact', type: 'boolean'}\n  ]\n});\n\ndefine('HTMLLIElement', {\n  tagName: 'LI',\n  attributes: [\n    'type',\n    {prop: 'value', type: 'long'}\n  ]\n});\n\ndefine('HTMLCanvasElement', {\n  tagName: 'CANVAS',\n  attributes: [\n    'align'\n  ],\n  elementBuilder: function (element) {\n    // require node-canvas and catch the error if it blows up\n    try {\n      var canvas = new (require('canvas'))(0,0);\n      for (var attr in element) {\n        if (!canvas[attr]) {\n          canvas[attr] = element[attr];\n        }\n      }\n      return canvas;\n    } catch (e) {\n      return element;\n    }\n  }\n});\n\ndefine('HTMLDivElement', {\n  tagName: 'DIV',\n  attributes: [\n    'align'\n  ],\n  proto: {\n    toString: function() { return '[object HTMLDivElement]'; }\n  }\n});\n\ndefine('HTMLParagraphElement', {\n  tagName: 'P',\n  attributes: [\n    'align'\n  ]\n});\n\ndefine('HTMLHeadingElement', {\n  tagNames: ['H1','H2','H3','H4','H5','H6'],\n  attributes: [\n    'align'\n  ]\n});\n\ndefine('HTMLQuoteElement', {\n  tagNames: ['Q','BLOCKQUOTE'],\n  attributes: [\n    'cite'\n  ]\n});\n\ndefine('HTMLPreElement', {\n  tagName: 'PRE',\n  attributes: [\n    {prop: 'width', type: 'long'}\n  ]\n});\n\ndefine('HTMLBRElement', {\n  tagName: 'BR',\n  attributes: [\n    'clear'\n  ]\n});\n\ndefine('HTMLBaseFontElement', {\n  tagName: 'BASEFONT',\n  attributes: [\n    'color',\n    'face',\n    {prop: 'size', type: 'long'}\n  ]\n});\n\ndefine('HTMLFontElement', {\n  tagName: 'FONT',\n  attributes: [\n    'color',\n    'face',\n    'size'\n  ]\n});\n\ndefine('HTMLHRElement', {\n  tagName: 'HR',\n  attributes: [\n    'align',\n    {prop: 'noShade', type: 'boolean'},\n    'size',\n    'width'\n  ]\n});\n\ndefine('HTMLModElement', {\n  tagNames: ['INS', 'DEL'],\n  attributes: [\n    'cite',\n    'dateTime'\n  ]\n});\n\ndefine('HTMLAnchorElement', {\n  tagName: 'A',\n\n  proto: {\n    get href() {\n      return core.resourceLoader.resolve(this._ownerDocument, this.getAttribute('href'));\n    },\n    get hostname() {\n      return URL.parse(this.href).hostname || '';\n    },\n    get host() {\n      return URL.parse(this.href).host || '';\n    },\n    get origin() {\n      var proto = URL.parse(this.href).protocol;\n\n      if (proto !== undefined && proto !== null) {\n        proto += '//';\n      }\n\n      return proto + URL.parse(this.href).host || '';\n    },\n    get port() {\n      return URL.parse(this.href).port || '';\n    },\n    get protocol() {\n      var protocol = URL.parse(this.href).protocol;\n      return (protocol == null) ? ':' : protocol;\n    },\n    get password() {\n      var auth = URL.parse(this.href).auth;\n      return auth.substr(auth.indexOf(':') + 1);\n    },\n    get pathname() {\n      return URL.parse(this.href).pathname || '';\n    },\n    get username() {\n      var auth = URL.parse(this.href).auth;\n      return auth.substr(0, auth.indexOf(':'));\n    },\n    get search() {\n      return URL.parse(this.href).search || '';\n    },\n    get hash() {\n      return URL.parse(this.href).hash || '';\n    }\n  },\n  attributes: [\n    'accessKey',\n    'charset',\n    'coords',\n    {prop: 'href', type: 'string', read: false},\n    'hreflang',\n    'name',\n    'rel',\n    'rev',\n    'shape',\n    {prop: 'tabIndex', type: 'long'},\n    'target',\n    'type'\n  ]\n});\n\ndefine('HTMLImageElement', {\n  tagName: 'IMG',\n  proto: {\n    _attrModified: function(name, value, oldVal) {\n      if (name == 'src' && value !== oldVal) {\n        core.resourceLoader.enqueue(this, function() {})();\n      }\n    },\n    get src() {\n      return core.resourceLoader.resolve(this._ownerDocument, this.getAttribute('src'));\n    }\n  },\n  attributes: [\n    'name',\n    'align',\n    'alt',\n    'border',\n    {prop: 'height', type: 'long'},\n    {prop: 'hspace', type: 'long'},\n    {prop: 'isMap', type: 'boolean'},\n    'longDesc',\n    {prop: 'src', type: 'string', read: false},\n    'useMap',\n    {prop: 'vspace', type: 'long'},\n    {prop: 'width', type: 'long'}\n  ]\n});\n\ndefine('HTMLObjectElement', {\n  tagName: 'OBJECT',\n  proto: {\n    get form() {\n      return closest(this, 'FORM');\n    },\n    get contentDocument() {\n      return null;\n    }\n  },\n  attributes: [\n    'code',\n    'align',\n    'archive',\n    'border',\n    'codeBase',\n    'codeType',\n    'data',\n    {prop: 'declare', type: 'boolean'},\n    {prop: 'height',  type: 'long'},\n    {prop: 'hspace',  type: 'long'},\n    'name',\n    'standby',\n    {prop: 'tabIndex', type: 'long'},\n    'type',\n    'useMap',\n    {prop: 'vspace', type: 'long'},\n    {prop: 'width', type: 'long'}\n  ]\n});\n\ndefine('HTMLParamElement', {\n  tagName: 'PARAM',\n  attributes: [\n    'name',\n    'type',\n    'value',\n    'valueType'\n  ]\n});\n\ndefine('HTMLAppletElement', {\n  tagName: 'APPLET',\n  attributes: [\n    'align',\n    'alt',\n    'archive',\n    'code',\n    'codeBase',\n    'height',\n    {prop: 'hspace', type: 'long'},\n    'name',\n    'object',\n    {prop: 'vspace', type: 'long'},\n    'width'\n  ]\n});\n\ndefine('HTMLMapElement', {\n  tagName: 'MAP',\n  proto: {\n    get areas() {\n      return this.getElementsByTagName(\"AREA\");\n    }\n  },\n  attributes: [\n    'name'\n  ]\n});\n\ndefine('HTMLAreaElement', {\n  tagName: 'AREA',\n  attributes: [\n    'accessKey',\n    'alt',\n    'coords',\n    'href',\n    {prop: 'noHref', type: 'boolean'},\n    'shape',\n    {prop: 'tabIndex', type: 'long'},\n    'target'\n  ]\n});\n\ndefine('HTMLScriptElement', {\n  tagName: 'SCRIPT',\n  init: function() {\n    this.addEventListener('DOMNodeInsertedIntoDocument', function() {\n      if (this.src) {\n        core.resourceLoader.load(this, this.src, this._eval);\n      }\n      else {\n        var src = this.sourceLocation || {},\n            filename = src.file || this._ownerDocument.URL;\n\n        if (src) {\n          filename += ':' + src.line + ':' + src.col;\n        }\n        filename += '<script>';\n\n        core.resourceLoader.enqueue(this, this._eval, filename)(null, this.text);\n      }\n    });\n  },\n  proto: {\n    _eval: function(text, filename) {\n      if (this._ownerDocument.implementation._hasFeature(\"ProcessExternalResources\", \"script\") &&\n          this.language                                                                      &&\n          core.languageProcessors[this.language])\n      {\n        this._ownerDocument._writeAfterElement = this;\n        core.languageProcessors[this.language](this, text, filename);\n        delete this._ownerDocument._writeAfterElement;\n      }\n    },\n    get language() {\n      var type = this.type || \"text/javascript\";\n      return type.split(\"/\").pop().toLowerCase();\n    },\n    get text() {\n      var i=0, children = this._childNodes, l = children.length, ret = [];\n\n      for (i; i<l; i++) {\n        ret.push(children[i].nodeValue);\n      }\n\n      return ret.join(\"\");\n    },\n    set text(text) {\n      while (this._childNodes.length) {\n        this.removeChild(this._childNodes[this._childNodes.length-1]);\n      }\n      this.appendChild(this._ownerDocument.createTextNode(text));\n    }\n  },\n  attributes : [\n    {prop: 'defer', 'type': 'boolean'},\n    'htmlFor',\n    'event',\n    'charset',\n    'type',\n    'src'\n  ]\n})\n\ndefine('HTMLTableElement', {\n  tagName: 'TABLE',\n  proto: {\n    get caption() {\n      return firstChild(this, 'CAPTION');\n    },\n    get tHead() {\n      return firstChild(this, 'THEAD');\n    },\n    get tFoot() {\n      return firstChild(this, 'TFOOT');\n    },\n    get rows() {\n      if (!this._rows) {\n        var table = this;\n        this._rows = new core.HTMLCollection(this._ownerDocument, function() {\n          var sections = [table.tHead].concat(table.tBodies._toArray(), table.tFoot).filter(function(s) { return !!s });\n\n          if (sections.length === 0) {\n            return core.mapDOMNodes(table, false, function(el) {\n              return el.tagName === 'TR';\n            });\n          }\n\n          return sections.reduce(function(prev, s) {\n            return prev.concat(s.rows._toArray());\n          }, []);\n\n        });\n      }\n      return this._rows;\n    },\n    get tBodies() {\n      if (!this._tBodies) {\n        this._tBodies = descendants(this, 'TBODY', false);\n      }\n      return this._tBodies;\n    },\n    createTHead: function() {\n      var el = this.tHead;\n      if (!el) {\n        el = this._ownerDocument.createElement('THEAD');\n        this.appendChild(el);\n      }\n      return el;\n    },\n    deleteTHead: function() {\n      var el = this.tHead;\n      if (el) {\n        el._parentNode.removeChild(el);\n      }\n    },\n    createTFoot: function() {\n      var el = this.tFoot;\n      if (!el) {\n        el = this._ownerDocument.createElement('TFOOT');\n        this.appendChild(el);\n      }\n      return el;\n    },\n    deleteTFoot: function() {\n      var el = this.tFoot;\n      if (el) {\n        el._parentNode.removeChild(el);\n      }\n    },\n    createCaption: function() {\n      var el = this.caption;\n      if (!el) {\n        el = this._ownerDocument.createElement('CAPTION');\n        this.appendChild(el);\n      }\n      return el;\n    },\n    deleteCaption: function() {\n      var c = this.caption;\n      if (c) {\n        c._parentNode.removeChild(c);\n      }\n    },\n    insertRow: function(index) {\n      var tr = this._ownerDocument.createElement('TR');\n      if (this._childNodes.length === 0) {\n        this.appendChild(this._ownerDocument.createElement('TBODY'));\n      }\n      var rows = this.rows._toArray();\n      if (index < -1 || index > rows.length) {\n        throw new core.DOMException(core.INDEX_SIZE_ERR);\n      }\n      if (index === -1 || (index === 0 && rows.length === 0)) {\n        this.tBodies.item(0).appendChild(tr);\n      }\n      else if (index === rows.length) {\n        var ref = rows[index-1];\n        ref._parentNode.appendChild(tr);\n      }\n      else {\n        var ref = rows[index];\n        ref._parentNode.insertBefore(tr, ref);\n      }\n      return tr;\n    },\n    deleteRow: function(index) {\n      var rows = this.rows._toArray(), l = rows.length;\n      if (index === -1) {\n        index = l-1;\n      }\n      if (index < 0 || index >= l) {\n        throw new core.DOMException(core.INDEX_SIZE_ERR);\n      }\n      var tr = rows[index];\n      tr._parentNode.removeChild(tr);\n    }\n  },\n  attributes: [\n    'align',\n    'bgColor',\n    'border',\n    'cellPadding',\n    'cellSpacing',\n    'frame',\n    'rules',\n    'summary',\n    'width'\n  ]\n});\n\ndefine('HTMLTableCaptionElement', {\n  tagName: 'CAPTION',\n  attributes: [\n    'align'\n  ]\n});\n\ndefine('HTMLTableColElement', {\n  tagNames: ['COL','COLGROUP'],\n  attributes: [\n    'align',\n    {prop: 'ch', attr: 'char'},\n    {prop: 'chOff', attr: 'charoff'},\n    {prop: 'span', type: 'long'},\n    'vAlign',\n    'width',\n  ]\n});\n\ndefine('HTMLTableSectionElement', {\n  tagNames: ['THEAD','TBODY','TFOOT'],\n  proto: {\n    get rows() {\n      if (!this._rows) {\n        this._rows = descendants(this, 'TR', false);\n      }\n      return this._rows;\n    },\n    insertRow: function(index) {\n      var tr = this._ownerDocument.createElement('TR');\n      var rows = this.rows._toArray();\n      if (index < -1 || index > rows.length) {\n        throw new core.DOMException(core.INDEX_SIZE_ERR);\n      }\n      if (index === -1 || index === rows.length) {\n        this.appendChild(tr);\n      }\n      else {\n        var ref = rows[index];\n        this.insertBefore(tr, ref);\n      }\n      return tr;\n    },\n    deleteRow: function(index) {\n      var rows = this.rows._toArray();\n      if (index === -1) {\n        index = rows.length-1;\n      }\n      if (index < 0 || index >= rows.length) {\n        throw new core.DOMException(core.INDEX_SIZE_ERR);\n      }\n      var tr = this.rows[index];\n      this.removeChild(tr);\n    }\n  },\n  attributes: [\n    'align',\n    {prop: 'ch', attr: 'char'},\n    {prop: 'chOff', attr: 'charoff'},\n    {prop: 'span', type: 'long'},\n    'vAlign',\n    'width',\n  ]\n});\n\ndefine('HTMLTableRowElement', {\n  tagName: 'TR',\n  proto: {\n    get cells() {\n      if (!this._cells) {\n        this._cells = new core.HTMLCollection(this, core.mapper(this, function(n) {\n          return n.nodeName === 'TD' || n.nodeName === 'TH';\n        }, false));\n      }\n      return this._cells;\n    },\n    get rowIndex() {\n      var table = closest(this, 'TABLE');\n      return table ? table.rows._toArray().indexOf(this) : -1;\n    },\n\n    get sectionRowIndex() {\n      return this._parentNode.rows._toArray().indexOf(this);\n    },\n    insertCell: function(index) {\n      var td = this._ownerDocument.createElement('TD');\n      var cells = this.cells._toArray();\n      if (index < -1 || index > cells.length) {\n        throw new core.DOMException(core.INDEX_SIZE_ERR);\n      }\n      if (index === -1 || index === cells.length) {\n        this.appendChild(td);\n      }\n      else {\n        var ref = cells[index];\n        this.insertBefore(td, ref);\n      }\n      return td;\n    },\n    deleteCell: function(index) {\n      var cells = this.cells._toArray();\n      if (index === -1) {\n        index = cells.length-1;\n      }\n      if (index < 0 || index >= cells.length) {\n        throw new core.DOMException(core.INDEX_SIZE_ERR);\n      }\n      var td = this.cells[index];\n      this.removeChild(td);\n    }\n  },\n  attributes: [\n    'align',\n    'bgColor',\n    {prop: 'ch', attr: 'char'},\n    {prop: 'chOff', attr: 'charoff'},\n    'vAlign'\n  ]\n});\n\ndefine('HTMLTableCellElement', {\n  tagNames: ['TH','TD'],\n  proto: {\n    _headers: null,\n    set headers(h) {\n      if (h === '') {\n        //Handle resetting headers so the dynamic getter returns a query\n        this._headers = null;\n        return;\n      }\n      if (!(h instanceof Array)) {\n        h = [h];\n      }\n      this._headers = h;\n    },\n    get headers() {\n      if (this._headers) {\n        return this._headers.join(' ');\n      }\n      var cellIndex = this.cellIndex,\n          headings  = [],\n          siblings  = this._parentNode.getElementsByTagName(this.tagName);\n\n      for (var i=0; i<siblings.length; i++) {\n        if (siblings.item(i).cellIndex >= cellIndex) {\n          break;\n        }\n        headings.push(siblings.item(i).id);\n      }\n      this._headers = headings;\n      return headings.join(' ');\n    },\n    get cellIndex() {\n      return closest(this, 'TR').cells._toArray().indexOf(this);\n    }\n  },\n  attributes: [\n    'abbr',\n    'align',\n    'axis',\n    'bgColor',\n    {prop: 'ch', attr: 'char'},\n    {prop: 'chOff', attr: 'charoff'},\n    {prop: 'colSpan', type: 'long'},\n    'height',\n    {prop: 'noWrap', type: 'boolean'},\n    {prop: 'rowSpan', type: 'long'},\n    'scope',\n    'vAlign',\n    'width'\n  ]\n});\n\ndefine('HTMLFrameSetElement', {\n  tagName: 'FRAMESET',\n  attributes: [\n    'cols',\n    'rows'\n  ]\n});\n\nfunction loadFrame (frame) {\n  if (frame._contentDocument) {\n    // We don't want to access document.parentWindow, since the getter will\n    // cause a new window to be allocated if it doesn't exist.  Probe the\n    // private variable instead.\n    if (frame._contentDocument._parentWindow) {\n      // close calls delete on its document.\n      frame._contentDocument.parentWindow.close();\n    } else {\n      delete frame._contentDocument;\n    }\n  }\n\n  var src = frame.src.trim() === '' ? 'about:blank' : frame.src;\n  var parentDoc = frame._ownerDocument;\n\n  // If the URL can't be resolved or the src attribute is missing / blank,\n  // then url should be set to the string \"about:blank\".\n  // (http://www.whatwg.org/specs/web-apps/current-work/#the-iframe-element)\n  var url = core.resourceLoader.resolve(parentDoc, src);\n  var contentDoc = frame._contentDocument = new core.HTMLDocument({\n    parsingMode: 'html',\n    url: url,\n    documentRoot: Path.dirname(url)\n  });\n  applyDocumentFeatures(contentDoc, parentDoc.implementation._features);\n\n  var parent = parentDoc.parentWindow;\n  var contentWindow = contentDoc.parentWindow;\n  contentWindow.parent = parent;\n  contentWindow.top = parent.top;\n\n  // Handle about:blank with a simulated load of an empty document.\n  if(url === 'about:blank') {\n    core.resourceLoader.enqueue(frame, function() {\n      contentDoc.write();\n      contentDoc.close();\n    })();\n  } else {\n    core.resourceLoader.load(frame, url, function(html, filename) {\n      contentDoc.write(html);\n      contentDoc.close();\n    });\n  }\n}\n\ndefine('HTMLFrameElement', {\n  tagName: 'FRAME',\n  init : function () {\n    // Set up the frames array.  window.frames really just returns a reference\n    // to the window object, so the frames array is just implemented as indexes\n    // on the window.\n    var parent = this._ownerDocument.parentWindow;\n    var frameID = parent._length++;\n    var self = this;\n    defineGetter(parent, frameID, function () {\n      return self.contentWindow;\n    });\n\n    // The contentDocument/contentWindow shouldn't be created until the frame\n    // is inserted:\n    // \"When an iframe element is first inserted into a document, the user\n    //  agent must create a nested browsing context, and then process the\n    //  iframe attributes for the first time.\"\n    //  (http://www.whatwg.org/specs/web-apps/current-work/#the-iframe-element)\n    this._initInsertListener = function () {\n      loadFrame(self);\n    };\n    this.addEventListener('DOMNodeInsertedIntoDocument', this._initInsertListener, false);\n  },\n  proto: {\n    _attrModified: function(name, value, oldVal) {\n      core.HTMLElement.prototype._attrModified.call(this, name, value, oldVal);\n      var self = this;\n      if (name === 'name') {\n        // Remove named frame access.\n        if (oldVal) {\n          this._ownerDocument.parentWindow._frame(oldVal);\n        }\n        // Set up named frame access.\n        if (value) {\n          this._ownerDocument.parentWindow._frame(value, this);\n        }\n      } else if (name === 'src') {\n        // Page we don't fetch the page until the node is inserted. This at\n        // least seems to be the way Chrome does it.\n        if (!this._attachedToDocument) {\n          if (!this._waitingOnInsert) {\n            // First, remove the listener added in 'init'.\n            this.removeEventListener('DOMNodeInsertedIntoDocument',\n                                     this._initInsertListener, false)\n\n            // If we aren't already waiting on an insert, add a listener.\n            // This guards against src being set multiple times before the frame\n            // is inserted into the document - we don't want to register multiple\n            // callbacks.\n            this.addEventListener('DOMNodeInsertedIntoDocument', function loader () {\n              self.removeEventListener('DOMNodeInsertedIntoDocument', loader, false);\n              this._waitingOnInsert = false;\n              loadFrame(self);\n            }, false);\n            this._waitingOnInsert = true;\n          }\n        } else {\n          loadFrame(self);\n        }\n      }\n    },\n    _contentDocument : null,\n    get contentDocument() {\n      if (this._contentDocument == null) {\n        this._contentDocument = new core.HTMLDocument({ parsingMode: \"html\" });\n      }\n      return this._contentDocument;\n    },\n    get contentWindow() {\n      return this.contentDocument.parentWindow;\n    }\n  },\n  attributes: [\n    'frameBorder',\n    'longDesc',\n    'marginHeight',\n    'marginWidth',\n    'name',\n    {prop: 'noResize', type: 'boolean'},\n    'scrolling',\n    {prop: 'src', type: 'string', write: false}\n  ]\n});\n\ndefine('HTMLIFrameElement', {\n  tagName: 'IFRAME',\n  parentClass: core.HTMLFrameElement,\n  attributes: [\n    'align',\n    'frameBorder',\n    'height',\n    'longDesc',\n    'marginHeight',\n    'marginWidth',\n    'name',\n    'scrolling',\n    'src',\n    'width'\n  ]\n});\n"]},"metadata":{},"sourceType":"script"}