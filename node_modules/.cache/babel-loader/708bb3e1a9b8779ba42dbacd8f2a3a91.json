{"ast":null,"code":"// Browser Request\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n// UMD HEADER START \n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals (root is window)\n    root.returnExports = factory();\n  }\n})(this, function () {\n  // UMD HEADER END\n  var XHR = XMLHttpRequest;\n  if (!XHR) throw new Error('missing XMLHttpRequest');\n  request.log = {\n    'trace': noop,\n    'debug': noop,\n    'info': noop,\n    'warn': noop,\n    'error': noop\n  };\n  var DEFAULT_TIMEOUT = 3 * 60 * 1000; // 3 minutes\n  //\n  // request\n  //\n\n  function request(options, callback) {\n    // The entry-point to the API: prep the options object and pass the real work to run_xhr.\n    if (typeof callback !== 'function') throw new Error('Bad callback given: ' + callback);\n    if (!options) throw new Error('No options given');\n    var options_onResponse = options.onResponse; // Save this for later.\n\n    if (typeof options === 'string') options = {\n      'uri': options\n    };else options = JSON.parse(JSON.stringify(options)); // Use a duplicate for mutating.\n\n    options.onResponse = options_onResponse; // And put it back.\n\n    if (options.verbose) request.log = getLogger();\n\n    if (options.url) {\n      options.uri = options.url;\n      delete options.url;\n    }\n\n    if (!options.uri && options.uri !== \"\") throw new Error(\"options.uri is a required argument\");\n    if (typeof options.uri != \"string\") throw new Error(\"options.uri must be a string\");\n    var unsupported_options = ['proxy', '_redirectsFollowed', 'maxRedirects', 'followRedirect'];\n\n    for (var i = 0; i < unsupported_options.length; i++) if (options[unsupported_options[i]]) throw new Error(\"options.\" + unsupported_options[i] + \" is not supported\");\n\n    options.callback = callback;\n    options.method = options.method || 'GET';\n    options.headers = options.headers || {};\n    options.body = options.body || null;\n    options.timeout = options.timeout || request.DEFAULT_TIMEOUT;\n    if (options.headers.host) throw new Error(\"Options.headers.host is not supported\");\n\n    if (options.json) {\n      options.headers.accept = options.headers.accept || 'application/json';\n      if (options.method !== 'GET') options.headers['content-type'] = 'application/json';\n      if (typeof options.json !== 'boolean') options.body = JSON.stringify(options.json);else if (typeof options.body !== 'string') options.body = JSON.stringify(options.body);\n    } //BEGIN QS Hack\n\n\n    var serialize = function (obj) {\n      var str = [];\n\n      for (var p in obj) if (obj.hasOwnProperty(p)) {\n        str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]));\n      }\n\n      return str.join(\"&\");\n    };\n\n    if (options.qs) {\n      var qs = typeof options.qs == 'string' ? options.qs : serialize(options.qs);\n\n      if (options.uri.indexOf('?') !== -1) {\n        //no get params\n        options.uri = options.uri + '&' + qs;\n      } else {\n        //existing get params\n        options.uri = options.uri + '?' + qs;\n      }\n    } //END QS Hack\n    //BEGIN FORM Hack\n\n\n    var multipart = function (obj) {\n      //todo: support file type (useful?)\n      var result = {};\n      result.boundry = '-------------------------------' + Math.floor(Math.random() * 1000000000);\n      var lines = [];\n\n      for (var p in obj) {\n        if (obj.hasOwnProperty(p)) {\n          lines.push('--' + result.boundry + \"\\n\" + 'Content-Disposition: form-data; name=\"' + p + '\"' + \"\\n\" + \"\\n\" + obj[p] + \"\\n\");\n        }\n      }\n\n      lines.push('--' + result.boundry + '--');\n      result.body = lines.join('');\n      result.length = result.body.length;\n      result.type = 'multipart/form-data; boundary=' + result.boundry;\n      return result;\n    };\n\n    if (options.form) {\n      if (typeof options.form == 'string') throw 'form name unsupported';\n\n      if (options.method === 'POST') {\n        var encoding = (options.encoding || 'application/x-www-form-urlencoded').toLowerCase();\n        options.headers['content-type'] = encoding;\n\n        switch (encoding) {\n          case 'application/x-www-form-urlencoded':\n            options.body = serialize(options.form).replace(/%20/g, \"+\");\n            break;\n\n          case 'multipart/form-data':\n            var multi = multipart(options.form); //options.headers['content-length'] = multi.length;\n\n            options.body = multi.body;\n            options.headers['content-type'] = multi.type;\n            break;\n\n          default:\n            throw new Error('unsupported encoding:' + encoding);\n        }\n      }\n    } //END FORM Hack\n    // If onResponse is boolean true, call back immediately when the response is known,\n    // not when the full request is complete.\n\n\n    options.onResponse = options.onResponse || noop;\n\n    if (options.onResponse === true) {\n      options.onResponse = callback;\n      options.callback = noop;\n    } // XXX Browsers do not like this.\n    //if(options.body)\n    //  options.headers['content-length'] = options.body.length;\n    // HTTP basic authentication\n\n\n    if (!options.headers.authorization && options.auth) options.headers.authorization = 'Basic ' + b64_enc(options.auth.username + ':' + options.auth.password);\n    return run_xhr(options);\n  }\n\n  var req_seq = 0;\n\n  function run_xhr(options) {\n    var xhr = new XHR(),\n        timed_out = false,\n        is_cors = is_crossDomain(options.uri),\n        supports_cors = ('withCredentials' in xhr);\n    req_seq += 1;\n    xhr.seq_id = req_seq;\n    xhr.id = req_seq + ': ' + options.method + ' ' + options.uri;\n    xhr._id = xhr.id; // I know I will type \"_id\" from habit all the time.\n\n    if (is_cors && !supports_cors) {\n      var cors_err = new Error('Browser does not support cross-origin request: ' + options.uri);\n      cors_err.cors = 'unsupported';\n      return options.callback(cors_err, xhr);\n    }\n\n    xhr.timeoutTimer = setTimeout(too_late, options.timeout);\n\n    function too_late() {\n      timed_out = true;\n      var er = new Error('ETIMEDOUT');\n      er.code = 'ETIMEDOUT';\n      er.duration = options.timeout;\n      request.log.error('Timeout', {\n        'id': xhr._id,\n        'milliseconds': options.timeout\n      });\n      return options.callback(er, xhr);\n    } // Some states can be skipped over, so remember what is still incomplete.\n\n\n    var did = {\n      'response': false,\n      'loading': false,\n      'end': false\n    };\n    xhr.onreadystatechange = on_state_change;\n    xhr.open(options.method, options.uri, true); // asynchronous\n\n    if (is_cors) xhr.withCredentials = !!options.withCredentials;\n    xhr.send(options.body);\n    return xhr;\n\n    function on_state_change(event) {\n      if (timed_out) return request.log.debug('Ignoring timed out state change', {\n        'state': xhr.readyState,\n        'id': xhr.id\n      });\n      request.log.debug('State change', {\n        'state': xhr.readyState,\n        'id': xhr.id,\n        'timed_out': timed_out\n      });\n\n      if (xhr.readyState === XHR.OPENED) {\n        request.log.debug('Request started', {\n          'id': xhr.id\n        });\n\n        for (var key in options.headers) xhr.setRequestHeader(key, options.headers[key]);\n      } else if (xhr.readyState === XHR.HEADERS_RECEIVED) on_response();else if (xhr.readyState === XHR.LOADING) {\n        on_response();\n        on_loading();\n      } else if (xhr.readyState === XHR.DONE) {\n        on_response();\n        on_loading();\n        on_end();\n      }\n    }\n\n    function on_response() {\n      if (did.response) return;\n      did.response = true;\n      request.log.debug('Got response', {\n        'id': xhr.id,\n        'status': xhr.status\n      });\n      clearTimeout(xhr.timeoutTimer);\n      xhr.statusCode = xhr.status; // Node request compatibility\n      // Detect failed CORS requests.\n\n      if (is_cors && xhr.statusCode == 0) {\n        var cors_err = new Error('CORS request rejected: ' + options.uri);\n        cors_err.cors = 'rejected'; // Do not process this request further.\n\n        did.loading = true;\n        did.end = true;\n        return options.callback(cors_err, xhr);\n      }\n\n      options.onResponse(null, xhr);\n    }\n\n    function on_loading() {\n      if (did.loading) return;\n      did.loading = true;\n      request.log.debug('Response body loading', {\n        'id': xhr.id\n      }); // TODO: Maybe simulate \"data\" events by watching xhr.responseText\n    }\n\n    function on_end() {\n      if (did.end) return;\n      did.end = true;\n      request.log.debug('Request done', {\n        'id': xhr.id\n      });\n      xhr.body = xhr.responseText;\n\n      if (options.json) {\n        try {\n          xhr.body = JSON.parse(xhr.responseText);\n        } catch (er) {\n          return options.callback(er, xhr);\n        }\n      }\n\n      options.callback(null, xhr, xhr.body);\n    }\n  } // request\n\n\n  request.withCredentials = false;\n  request.DEFAULT_TIMEOUT = DEFAULT_TIMEOUT; //\n  // defaults\n  //\n\n  request.defaults = function (options, requester) {\n    var def = function (method) {\n      var d = function (params, callback) {\n        if (typeof params === 'string') params = {\n          'uri': params\n        };else {\n          params = JSON.parse(JSON.stringify(params));\n        }\n\n        for (var i in options) {\n          if (params[i] === undefined) params[i] = options[i];\n        }\n\n        return method(params, callback);\n      };\n\n      return d;\n    };\n\n    var de = def(request);\n    de.get = def(request.get);\n    de.post = def(request.post);\n    de.put = def(request.put);\n    de.head = def(request.head);\n    return de;\n  }; //\n  // HTTP method shortcuts\n  //\n\n\n  var shortcuts = ['get', 'put', 'post', 'head'];\n  shortcuts.forEach(function (shortcut) {\n    var method = shortcut.toUpperCase();\n    var func = shortcut.toLowerCase();\n\n    request[func] = function (opts) {\n      if (typeof opts === 'string') opts = {\n        'method': method,\n        'uri': opts\n      };else {\n        opts = JSON.parse(JSON.stringify(opts));\n        opts.method = method;\n      }\n      var args = [opts].concat(Array.prototype.slice.apply(arguments, [1]));\n      return request.apply(this, args);\n    };\n  }); //\n  // CouchDB shortcut\n  //\n\n  request.couch = function (options, callback) {\n    if (typeof options === 'string') options = {\n      'uri': options\n    }; // Just use the request API to do JSON.\n\n    options.json = true;\n    if (options.body) options.json = options.body;\n    delete options.body;\n    callback = callback || noop;\n    var xhr = request(options, couch_handler);\n    return xhr;\n\n    function couch_handler(er, resp, body) {\n      if (er) return callback(er, resp, body);\n\n      if ((resp.statusCode < 200 || resp.statusCode > 299) && body.error) {\n        // The body is a Couch JSON object indicating the error.\n        er = new Error('CouchDB error: ' + (body.error.reason || body.error.error));\n\n        for (var key in body) er[key] = body[key];\n\n        return callback(er, resp, body);\n      }\n\n      return callback(er, resp, body);\n    }\n  }; //\n  // Utility\n  //\n\n\n  function noop() {}\n\n  function getLogger() {\n    var logger = {},\n        levels = ['trace', 'debug', 'info', 'warn', 'error'],\n        level,\n        i;\n\n    for (i = 0; i < levels.length; i++) {\n      level = levels[i];\n      logger[level] = noop;\n      if (typeof console !== 'undefined' && console && console[level]) logger[level] = formatted(console, level);\n    }\n\n    return logger;\n  }\n\n  function formatted(obj, method) {\n    return formatted_logger;\n\n    function formatted_logger(str, context) {\n      if (typeof context === 'object') str += ' ' + JSON.stringify(context);\n      return obj[method].call(obj, str);\n    }\n  } // Return whether a URL is a cross-domain request.\n\n\n  function is_crossDomain(url) {\n    var rurl = /^([\\w\\+\\.\\-]+:)(?:\\/\\/([^\\/?#:]*)(?::(\\d+))?)?/; // jQuery #8138, IE may throw an exception when accessing\n    // a field from window.location if document.domain has been set\n\n    var ajaxLocation;\n\n    try {\n      ajaxLocation = location.href;\n    } catch (e) {\n      // Use the href attribute of an A element since IE will modify it given document.location\n      ajaxLocation = document.createElement(\"a\");\n      ajaxLocation.href = \"\";\n      ajaxLocation = ajaxLocation.href;\n    }\n\n    var ajaxLocParts = rurl.exec(ajaxLocation.toLowerCase()) || [],\n        parts = rurl.exec(url.toLowerCase());\n    var result = !!(parts && (parts[1] != ajaxLocParts[1] || parts[2] != ajaxLocParts[2] || (parts[3] || (parts[1] === \"http:\" ? 80 : 443)) != (ajaxLocParts[3] || (ajaxLocParts[1] === \"http:\" ? 80 : 443)))); //console.debug('is_crossDomain('+url+') -> ' + result)\n\n    return result;\n  } // MIT License from http://phpjs.org/functions/base64_encode:358\n\n\n  function b64_enc(data) {\n    // Encodes string using MIME base64 algorithm\n    var b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n    var o1,\n        o2,\n        o3,\n        h1,\n        h2,\n        h3,\n        h4,\n        bits,\n        i = 0,\n        ac = 0,\n        enc = \"\",\n        tmp_arr = [];\n\n    if (!data) {\n      return data;\n    } // assume utf8 data\n    // data = this.utf8_encode(data+'');\n\n\n    do {\n      // pack three octets into four hexets\n      o1 = data.charCodeAt(i++);\n      o2 = data.charCodeAt(i++);\n      o3 = data.charCodeAt(i++);\n      bits = o1 << 16 | o2 << 8 | o3;\n      h1 = bits >> 18 & 0x3f;\n      h2 = bits >> 12 & 0x3f;\n      h3 = bits >> 6 & 0x3f;\n      h4 = bits & 0x3f; // use hexets to index into b64, and append result to encoded string\n\n      tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n    } while (i < data.length);\n\n    enc = tmp_arr.join('');\n\n    switch (data.length % 3) {\n      case 1:\n        enc = enc.slice(0, -2) + '==';\n        break;\n\n      case 2:\n        enc = enc.slice(0, -1) + '=';\n        break;\n    }\n\n    return enc;\n  }\n\n  return request; //UMD FOOTER START\n}); //UMD FOOTER END","map":{"version":3,"sources":["F:/JavaScript/Projects/chemistryphile/node_modules/browser-request/index.js"],"names":["root","factory","define","amd","exports","module","returnExports","XHR","XMLHttpRequest","Error","request","log","noop","DEFAULT_TIMEOUT","options","callback","options_onResponse","onResponse","JSON","parse","stringify","verbose","getLogger","url","uri","unsupported_options","i","length","method","headers","body","timeout","host","json","accept","serialize","obj","str","p","hasOwnProperty","push","encodeURIComponent","join","qs","indexOf","multipart","result","boundry","Math","floor","random","lines","type","form","encoding","toLowerCase","replace","multi","authorization","auth","b64_enc","username","password","run_xhr","req_seq","xhr","timed_out","is_cors","is_crossDomain","supports_cors","seq_id","id","_id","cors_err","cors","timeoutTimer","setTimeout","too_late","er","code","duration","error","did","onreadystatechange","on_state_change","open","withCredentials","send","event","debug","readyState","OPENED","key","setRequestHeader","HEADERS_RECEIVED","on_response","LOADING","on_loading","DONE","on_end","response","status","clearTimeout","statusCode","loading","end","responseText","defaults","requester","def","d","params","undefined","de","get","post","put","head","shortcuts","forEach","shortcut","toUpperCase","func","opts","args","concat","Array","prototype","slice","apply","arguments","couch","couch_handler","resp","reason","logger","levels","level","console","formatted","formatted_logger","context","call","rurl","ajaxLocation","location","href","e","document","createElement","ajaxLocParts","exec","parts","data","b64","o1","o2","o3","h1","h2","h3","h4","bits","ac","enc","tmp_arr","charCodeAt","charAt"],"mappings":"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","sourcesContent":["// Browser Request\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n// UMD HEADER START \n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([], factory);\n    } else if (typeof exports === 'object') {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like enviroments that support module.exports,\n        // like Node.\n        module.exports = factory();\n    } else {\n        // Browser globals (root is window)\n        root.returnExports = factory();\n  }\n}(this, function () {\n// UMD HEADER END\n\nvar XHR = XMLHttpRequest\nif (!XHR) throw new Error('missing XMLHttpRequest')\nrequest.log = {\n  'trace': noop, 'debug': noop, 'info': noop, 'warn': noop, 'error': noop\n}\n\nvar DEFAULT_TIMEOUT = 3 * 60 * 1000 // 3 minutes\n\n//\n// request\n//\n\nfunction request(options, callback) {\n  // The entry-point to the API: prep the options object and pass the real work to run_xhr.\n  if(typeof callback !== 'function')\n    throw new Error('Bad callback given: ' + callback)\n\n  if(!options)\n    throw new Error('No options given')\n\n  var options_onResponse = options.onResponse; // Save this for later.\n\n  if(typeof options === 'string')\n    options = {'uri':options};\n  else\n    options = JSON.parse(JSON.stringify(options)); // Use a duplicate for mutating.\n\n  options.onResponse = options_onResponse // And put it back.\n\n  if (options.verbose) request.log = getLogger();\n\n  if(options.url) {\n    options.uri = options.url;\n    delete options.url;\n  }\n\n  if(!options.uri && options.uri !== \"\")\n    throw new Error(\"options.uri is a required argument\");\n\n  if(typeof options.uri != \"string\")\n    throw new Error(\"options.uri must be a string\");\n\n  var unsupported_options = ['proxy', '_redirectsFollowed', 'maxRedirects', 'followRedirect']\n  for (var i = 0; i < unsupported_options.length; i++)\n    if(options[ unsupported_options[i] ])\n      throw new Error(\"options.\" + unsupported_options[i] + \" is not supported\")\n\n  options.callback = callback\n  options.method = options.method || 'GET';\n  options.headers = options.headers || {};\n  options.body    = options.body || null\n  options.timeout = options.timeout || request.DEFAULT_TIMEOUT\n\n  if(options.headers.host)\n    throw new Error(\"Options.headers.host is not supported\");\n\n  if(options.json) {\n    options.headers.accept = options.headers.accept || 'application/json'\n    if(options.method !== 'GET')\n      options.headers['content-type'] = 'application/json'\n\n    if(typeof options.json !== 'boolean')\n      options.body = JSON.stringify(options.json)\n    else if(typeof options.body !== 'string')\n      options.body = JSON.stringify(options.body)\n  }\n  \n  //BEGIN QS Hack\n  var serialize = function(obj) {\n    var str = [];\n    for(var p in obj)\n      if (obj.hasOwnProperty(p)) {\n        str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]));\n      }\n    return str.join(\"&\");\n  }\n  \n  if(options.qs){\n    var qs = (typeof options.qs == 'string')? options.qs : serialize(options.qs);\n    if(options.uri.indexOf('?') !== -1){ //no get params\n        options.uri = options.uri+'&'+qs;\n    }else{ //existing get params\n        options.uri = options.uri+'?'+qs;\n    }\n  }\n  //END QS Hack\n  \n  //BEGIN FORM Hack\n  var multipart = function(obj) {\n    //todo: support file type (useful?)\n    var result = {};\n    result.boundry = '-------------------------------'+Math.floor(Math.random()*1000000000);\n    var lines = [];\n    for(var p in obj){\n        if (obj.hasOwnProperty(p)) {\n            lines.push(\n                '--'+result.boundry+\"\\n\"+\n                'Content-Disposition: form-data; name=\"'+p+'\"'+\"\\n\"+\n                \"\\n\"+\n                obj[p]+\"\\n\"\n            );\n        }\n    }\n    lines.push( '--'+result.boundry+'--' );\n    result.body = lines.join('');\n    result.length = result.body.length;\n    result.type = 'multipart/form-data; boundary='+result.boundry;\n    return result;\n  }\n  \n  if(options.form){\n    if(typeof options.form == 'string') throw('form name unsupported');\n    if(options.method === 'POST'){\n        var encoding = (options.encoding || 'application/x-www-form-urlencoded').toLowerCase();\n        options.headers['content-type'] = encoding;\n        switch(encoding){\n            case 'application/x-www-form-urlencoded':\n                options.body = serialize(options.form).replace(/%20/g, \"+\");\n                break;\n            case 'multipart/form-data':\n                var multi = multipart(options.form);\n                //options.headers['content-length'] = multi.length;\n                options.body = multi.body;\n                options.headers['content-type'] = multi.type;\n                break;\n            default : throw new Error('unsupported encoding:'+encoding);\n        }\n    }\n  }\n  //END FORM Hack\n\n  // If onResponse is boolean true, call back immediately when the response is known,\n  // not when the full request is complete.\n  options.onResponse = options.onResponse || noop\n  if(options.onResponse === true) {\n    options.onResponse = callback\n    options.callback = noop\n  }\n\n  // XXX Browsers do not like this.\n  //if(options.body)\n  //  options.headers['content-length'] = options.body.length;\n\n  // HTTP basic authentication\n  if(!options.headers.authorization && options.auth)\n    options.headers.authorization = 'Basic ' + b64_enc(options.auth.username + ':' + options.auth.password);\n\n  return run_xhr(options)\n}\n\nvar req_seq = 0\nfunction run_xhr(options) {\n  var xhr = new XHR\n    , timed_out = false\n    , is_cors = is_crossDomain(options.uri)\n    , supports_cors = ('withCredentials' in xhr)\n\n  req_seq += 1\n  xhr.seq_id = req_seq\n  xhr.id = req_seq + ': ' + options.method + ' ' + options.uri\n  xhr._id = xhr.id // I know I will type \"_id\" from habit all the time.\n\n  if(is_cors && !supports_cors) {\n    var cors_err = new Error('Browser does not support cross-origin request: ' + options.uri)\n    cors_err.cors = 'unsupported'\n    return options.callback(cors_err, xhr)\n  }\n\n  xhr.timeoutTimer = setTimeout(too_late, options.timeout)\n  function too_late() {\n    timed_out = true\n    var er = new Error('ETIMEDOUT')\n    er.code = 'ETIMEDOUT'\n    er.duration = options.timeout\n\n    request.log.error('Timeout', { 'id':xhr._id, 'milliseconds':options.timeout })\n    return options.callback(er, xhr)\n  }\n\n  // Some states can be skipped over, so remember what is still incomplete.\n  var did = {'response':false, 'loading':false, 'end':false}\n\n  xhr.onreadystatechange = on_state_change\n  xhr.open(options.method, options.uri, true) // asynchronous\n  if(is_cors)\n    xhr.withCredentials = !! options.withCredentials\n  xhr.send(options.body)\n  return xhr\n\n  function on_state_change(event) {\n    if(timed_out)\n      return request.log.debug('Ignoring timed out state change', {'state':xhr.readyState, 'id':xhr.id})\n\n    request.log.debug('State change', {'state':xhr.readyState, 'id':xhr.id, 'timed_out':timed_out})\n\n    if(xhr.readyState === XHR.OPENED) {\n      request.log.debug('Request started', {'id':xhr.id})\n      for (var key in options.headers)\n        xhr.setRequestHeader(key, options.headers[key])\n    }\n\n    else if(xhr.readyState === XHR.HEADERS_RECEIVED)\n      on_response()\n\n    else if(xhr.readyState === XHR.LOADING) {\n      on_response()\n      on_loading()\n    }\n\n    else if(xhr.readyState === XHR.DONE) {\n      on_response()\n      on_loading()\n      on_end()\n    }\n  }\n\n  function on_response() {\n    if(did.response)\n      return\n\n    did.response = true\n    request.log.debug('Got response', {'id':xhr.id, 'status':xhr.status})\n    clearTimeout(xhr.timeoutTimer)\n    xhr.statusCode = xhr.status // Node request compatibility\n\n    // Detect failed CORS requests.\n    if(is_cors && xhr.statusCode == 0) {\n      var cors_err = new Error('CORS request rejected: ' + options.uri)\n      cors_err.cors = 'rejected'\n\n      // Do not process this request further.\n      did.loading = true\n      did.end = true\n\n      return options.callback(cors_err, xhr)\n    }\n\n    options.onResponse(null, xhr)\n  }\n\n  function on_loading() {\n    if(did.loading)\n      return\n\n    did.loading = true\n    request.log.debug('Response body loading', {'id':xhr.id})\n    // TODO: Maybe simulate \"data\" events by watching xhr.responseText\n  }\n\n  function on_end() {\n    if(did.end)\n      return\n\n    did.end = true\n    request.log.debug('Request done', {'id':xhr.id})\n\n    xhr.body = xhr.responseText\n    if(options.json) {\n      try        { xhr.body = JSON.parse(xhr.responseText) }\n      catch (er) { return options.callback(er, xhr)        }\n    }\n\n    options.callback(null, xhr, xhr.body)\n  }\n\n} // request\n\nrequest.withCredentials = false;\nrequest.DEFAULT_TIMEOUT = DEFAULT_TIMEOUT;\n\n//\n// defaults\n//\n\nrequest.defaults = function(options, requester) {\n  var def = function (method) {\n    var d = function (params, callback) {\n      if(typeof params === 'string')\n        params = {'uri': params};\n      else {\n        params = JSON.parse(JSON.stringify(params));\n      }\n      for (var i in options) {\n        if (params[i] === undefined) params[i] = options[i]\n      }\n      return method(params, callback)\n    }\n    return d\n  }\n  var de = def(request)\n  de.get = def(request.get)\n  de.post = def(request.post)\n  de.put = def(request.put)\n  de.head = def(request.head)\n  return de\n}\n\n//\n// HTTP method shortcuts\n//\n\nvar shortcuts = [ 'get', 'put', 'post', 'head' ];\nshortcuts.forEach(function(shortcut) {\n  var method = shortcut.toUpperCase();\n  var func   = shortcut.toLowerCase();\n\n  request[func] = function(opts) {\n    if(typeof opts === 'string')\n      opts = {'method':method, 'uri':opts};\n    else {\n      opts = JSON.parse(JSON.stringify(opts));\n      opts.method = method;\n    }\n\n    var args = [opts].concat(Array.prototype.slice.apply(arguments, [1]));\n    return request.apply(this, args);\n  }\n})\n\n//\n// CouchDB shortcut\n//\n\nrequest.couch = function(options, callback) {\n  if(typeof options === 'string')\n    options = {'uri':options}\n\n  // Just use the request API to do JSON.\n  options.json = true\n  if(options.body)\n    options.json = options.body\n  delete options.body\n\n  callback = callback || noop\n\n  var xhr = request(options, couch_handler)\n  return xhr\n\n  function couch_handler(er, resp, body) {\n    if(er)\n      return callback(er, resp, body)\n\n    if((resp.statusCode < 200 || resp.statusCode > 299) && body.error) {\n      // The body is a Couch JSON object indicating the error.\n      er = new Error('CouchDB error: ' + (body.error.reason || body.error.error))\n      for (var key in body)\n        er[key] = body[key]\n      return callback(er, resp, body);\n    }\n\n    return callback(er, resp, body);\n  }\n}\n\n//\n// Utility\n//\n\nfunction noop() {}\n\nfunction getLogger() {\n  var logger = {}\n    , levels = ['trace', 'debug', 'info', 'warn', 'error']\n    , level, i\n\n  for(i = 0; i < levels.length; i++) {\n    level = levels[i]\n\n    logger[level] = noop\n    if(typeof console !== 'undefined' && console && console[level])\n      logger[level] = formatted(console, level)\n  }\n\n  return logger\n}\n\nfunction formatted(obj, method) {\n  return formatted_logger\n\n  function formatted_logger(str, context) {\n    if(typeof context === 'object')\n      str += ' ' + JSON.stringify(context)\n\n    return obj[method].call(obj, str)\n  }\n}\n\n// Return whether a URL is a cross-domain request.\nfunction is_crossDomain(url) {\n  var rurl = /^([\\w\\+\\.\\-]+:)(?:\\/\\/([^\\/?#:]*)(?::(\\d+))?)?/\n\n  // jQuery #8138, IE may throw an exception when accessing\n  // a field from window.location if document.domain has been set\n  var ajaxLocation\n  try { ajaxLocation = location.href }\n  catch (e) {\n    // Use the href attribute of an A element since IE will modify it given document.location\n    ajaxLocation = document.createElement( \"a\" );\n    ajaxLocation.href = \"\";\n    ajaxLocation = ajaxLocation.href;\n  }\n\n  var ajaxLocParts = rurl.exec(ajaxLocation.toLowerCase()) || []\n    , parts = rurl.exec(url.toLowerCase() )\n\n  var result = !!(\n    parts &&\n    (  parts[1] != ajaxLocParts[1]\n    || parts[2] != ajaxLocParts[2]\n    || (parts[3] || (parts[1] === \"http:\" ? 80 : 443)) != (ajaxLocParts[3] || (ajaxLocParts[1] === \"http:\" ? 80 : 443))\n    )\n  )\n\n  //console.debug('is_crossDomain('+url+') -> ' + result)\n  return result\n}\n\n// MIT License from http://phpjs.org/functions/base64_encode:358\nfunction b64_enc (data) {\n    // Encodes string using MIME base64 algorithm\n    var b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, ac = 0, enc=\"\", tmp_arr = [];\n\n    if (!data) {\n        return data;\n    }\n\n    // assume utf8 data\n    // data = this.utf8_encode(data+'');\n\n    do { // pack three octets into four hexets\n        o1 = data.charCodeAt(i++);\n        o2 = data.charCodeAt(i++);\n        o3 = data.charCodeAt(i++);\n\n        bits = o1<<16 | o2<<8 | o3;\n\n        h1 = bits>>18 & 0x3f;\n        h2 = bits>>12 & 0x3f;\n        h3 = bits>>6 & 0x3f;\n        h4 = bits & 0x3f;\n\n        // use hexets to index into b64, and append result to encoded string\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n    } while (i < data.length);\n\n    enc = tmp_arr.join('');\n\n    switch (data.length % 3) {\n        case 1:\n            enc = enc.slice(0, -2) + '==';\n        break;\n        case 2:\n            enc = enc.slice(0, -1) + '=';\n        break;\n    }\n\n    return enc;\n}\n    return request;\n//UMD FOOTER START\n}));\n//UMD FOOTER END\n"]},"metadata":{},"sourceType":"script"}