{"ast":null,"code":"\"use strict\";\n\nvar URL = require(\"url\");\n\nvar CSSStyleDeclaration = require(\"cssstyle\").CSSStyleDeclaration;\n\nvar XMLHttpRequest = require(\"xmlhttprequest\").XMLHttpRequest;\n\nvar dom = require(\"../level1/core\");\n\nvar NOT_IMPLEMENTED = require(\"./utils\").NOT_IMPLEMENTED;\n\nvar createFrom = require(\"../utils\").createFrom;\n\nvar History = require(\"./history\");\n\nvar VirtualConsole = require(\"../virtual-console\");\n\nvar cssSelectorSplitRE = /((?:[^,\"']|\"[^\"]*\"|'[^']*')+)/;\n\nfunction matchesDontThrow(el, selector) {\n  try {\n    return el.matches(selector);\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction startTimer(window, startFn, stopFn, callback, ms) {\n  var res = startFn(callback, ms);\n\n  window.__timers.push([res, stopFn]);\n\n  return res;\n}\n\nfunction stopTimer(window, id) {\n  if (typeof id === \"undefined\") {\n    return;\n  }\n\n  for (var i in window.__timers) {\n    if (window.__timers[i][0] === id) {\n      window.__timers[i][1].call(window, id);\n\n      window.__timers.splice(i, 1);\n\n      break;\n    }\n  }\n}\n\nfunction stopAllTimers(window) {\n  window.__timers.forEach(function (t) {\n    t[1].call(window, t[0]);\n  });\n\n  window.__timers = [];\n}\n\nfunction Window(document) {\n  this.__timers = []; // TODO: very little of this belongs on the instance; they should be prototype methods instead.\n\n  var window = this;\n  this._document = document;\n  this.history = new History(this);\n\n  this.addEventListener = function () {\n    dom.Node.prototype.addEventListener.apply(window, arguments);\n  };\n\n  this.removeEventListener = function () {\n    dom.Node.prototype.removeEventListener.apply(window, arguments);\n  };\n\n  this.dispatchEvent = function () {\n    dom.Node.prototype.dispatchEvent.apply(window, arguments);\n  };\n\n  this.raise = function () {\n    dom.Node.prototype.raise.apply(window.document, arguments);\n  };\n\n  this.setTimeout = function (fn, ms) {\n    return startTimer(window, setTimeout, clearTimeout, fn, ms);\n  };\n\n  this.setInterval = function (fn, ms) {\n    return startTimer(window, setInterval, clearInterval, fn, ms);\n  };\n\n  this.clearInterval = stopTimer.bind(this, window);\n  this.clearTimeout = stopTimer.bind(this, window);\n  this.__stopAllTimers = stopAllTimers.bind(this, window);\n\n  this.Image = function (width, height) {\n    var element = window._document.createElement(\"img\");\n\n    element.width = width;\n    element.height = height;\n    return element;\n  };\n\n  this._virtualConsole = new VirtualConsole();\n\n  function wrapConsoleMethod(method) {\n    return function () {\n      var args = Array.prototype.slice.call(arguments);\n\n      window._virtualConsole.emit.apply(window._virtualConsole, [method].concat(args));\n    };\n  }\n\n  this.console = {\n    assert: wrapConsoleMethod(\"assert\"),\n    clear: wrapConsoleMethod(\"clear\"),\n    count: wrapConsoleMethod(\"count\"),\n    debug: wrapConsoleMethod(\"debug\"),\n    error: wrapConsoleMethod(\"error\"),\n    group: wrapConsoleMethod(\"group\"),\n    groupCollapse: wrapConsoleMethod(\"groupCollapse\"),\n    groupEnd: wrapConsoleMethod(\"groupEnd\"),\n    info: wrapConsoleMethod(\"info\"),\n    log: wrapConsoleMethod(\"log\"),\n    table: wrapConsoleMethod(\"table\"),\n    time: wrapConsoleMethod(\"time\"),\n    timeEnd: wrapConsoleMethod(\"timeEnd\"),\n    trace: wrapConsoleMethod(\"trace\"),\n    warn: wrapConsoleMethod(\"warn\")\n  };\n\n  this.XMLHttpRequest = function () {\n    var xhr = new XMLHttpRequest();\n    var lastUrl = \"\";\n    xhr._open = xhr.open;\n\n    xhr.open = function (method, url, async, user, password) {\n      url = URL.resolve(window.document.URL, url);\n      lastUrl = url;\n      return xhr._open(method, url, async, user, password);\n    };\n\n    xhr._send = xhr.send;\n\n    xhr.send = function (data) {\n      if (window.document.cookie) {\n        var cookieDomain = window.document._cookieDomain;\n        var url = URL.parse(lastUrl);\n        var host = url.host.split(\":\")[0];\n\n        if (host.indexOf(cookieDomain, host.length - cookieDomain.length) !== -1) {\n          xhr.setDisableHeaderCheck(true);\n          xhr.setRequestHeader(\"cookie\", window.document.cookie);\n          xhr.setDisableHeaderCheck(false);\n        }\n      }\n\n      return xhr._send(data);\n    };\n\n    return xhr;\n  };\n}\n\nWindow.prototype = createFrom(dom || null, {\n  constructor: Window,\n  // This implements window.frames.length, since window.frames returns a\n  // self reference to the window object.  This value is incremented in the\n  // HTMLFrameElement init function (see: level2/html.js).\n  _length: 0,\n\n  get length() {\n    return this._length;\n  },\n\n  get document() {\n    return this._document;\n  },\n\n  get location() {\n    return this._document._location;\n  },\n\n  close: function () {\n    // Recursively close child frame windows, then ourselves.\n    var currentWindow = this;\n\n    (function windowCleaner(window) {\n      var i; // We could call window.frames.length etc, but window.frames just points\n      // back to window.\n\n      if (window.length > 0) {\n        for (i = 0; i < window.length; i++) {\n          windowCleaner(window[i]);\n        }\n      } // We\"re already in our own window.close().\n\n\n      if (window !== currentWindow) {\n        window.close();\n      }\n    })(this);\n\n    if (this._document) {\n      if (this._document.body) {\n        this._document.body.innerHTML = \"\";\n      }\n\n      if (this._document.close) {\n        // We need to empty out the event listener array because\n        // document.close() causes \"load\" event to re-fire.\n        this._document._listeners = [];\n\n        this._document.close();\n      }\n\n      delete this._document;\n    }\n\n    stopAllTimers(currentWindow); // Clean up the window\"s execution context.\n    // dispose() is added by Contextify.\n\n    this.dispose();\n  },\n  getComputedStyle: function (node) {\n    var s = node.style,\n        cs = new CSSStyleDeclaration(),\n        forEach = Array.prototype.forEach;\n\n    function setPropertiesFromRule(rule) {\n      if (!rule.selectorText) {\n        return;\n      }\n\n      var selectors = rule.selectorText.split(cssSelectorSplitRE);\n      var matched = false;\n      selectors.forEach(function (selectorText) {\n        if (selectorText !== \"\" && selectorText !== \",\" && !matched && matchesDontThrow(node, selectorText)) {\n          matched = true;\n          forEach.call(rule.style, function (property) {\n            cs.setProperty(property, rule.style.getPropertyValue(property), rule.style.getPropertyPriority(property));\n          });\n        }\n      });\n    }\n\n    forEach.call(node.ownerDocument.styleSheets, function (sheet) {\n      forEach.call(sheet.cssRules, function (rule) {\n        if (rule.media) {\n          if (Array.prototype.indexOf.call(rule.media, \"screen\") !== -1) {\n            forEach.call(rule.cssRules, setPropertiesFromRule);\n          }\n        } else {\n          setPropertiesFromRule(rule);\n        }\n      });\n    });\n    forEach.call(s, function (property) {\n      cs.setProperty(property, s.getPropertyValue(property), s.getPropertyPriority(property));\n    });\n    return cs;\n  },\n  // TODO: all of the below data properties should be getters; right now they are shared between Window instances\n  // which is of course bad.\n  navigator: {\n    get userAgent() {\n      return \"Node.js (\" + process.platform + \"; U; rv:\" + process.version + \")\";\n    },\n\n    get appName() {\n      return \"Node.js jsDom\";\n    },\n\n    get platform() {\n      return process.platform;\n    },\n\n    get appVersion() {\n      return process.version;\n    },\n\n    noUI: true,\n\n    get cookieEnabled() {\n      return true;\n    }\n\n  },\n  name: \"nodejs\",\n  innerWidth: 1024,\n  innerHeight: 768,\n  outerWidth: 1024,\n  outerHeight: 768,\n  pageXOffset: 0,\n  pageYOffset: 0,\n  screenX: 0,\n  screenY: 0,\n  screenLeft: 0,\n  screenTop: 0,\n  scrollX: 0,\n  scrollY: 0,\n  scrollTop: 0,\n  scrollLeft: 0,\n  alert: NOT_IMPLEMENTED(null, \"window.alert\"),\n  blur: NOT_IMPLEMENTED(null, \"window.blur\"),\n  confirm: NOT_IMPLEMENTED(null, \"window.confirm\"),\n  createPopup: NOT_IMPLEMENTED(null, \"window.createPopup\"),\n  focus: NOT_IMPLEMENTED(null, \"window.focus\"),\n  moveBy: NOT_IMPLEMENTED(null, \"window.moveBy\"),\n  moveTo: NOT_IMPLEMENTED(null, \"window.moveTo\"),\n  open: NOT_IMPLEMENTED(null, \"window.open\"),\n  print: NOT_IMPLEMENTED(null, \"window.print\"),\n  prompt: NOT_IMPLEMENTED(null, \"window.prompt\"),\n  resizeBy: NOT_IMPLEMENTED(null, \"window.resizeBy\"),\n  resizeTo: NOT_IMPLEMENTED(null, \"window.resizeTo\"),\n  scroll: NOT_IMPLEMENTED(null, \"window.scroll\"),\n  scrollBy: NOT_IMPLEMENTED(null, \"window.scrollBy\"),\n  scrollTo: NOT_IMPLEMENTED(null, \"window.scrollTo\"),\n  screen: {\n    width: 0,\n    height: 0\n  },\n  // Note: these will not be necessary for newer Node.js versions, which have\n  // typed arrays in V8 and thus on every global object. (That is, in newer\n  // versions we\"ll get `ArrayBuffer` just as automatically as we get\n  // `Array`.) But to support older versions, we explicitly set them here.\n  Int8Array: global.Int8Array,\n  Int16Array: global.Int16Array,\n  Int32Array: global.Int32Array,\n  Float32Array: global.Float32Array,\n  Float64Array: global.Float64Array,\n  Uint8Array: global.Uint8Array,\n  Uint8ClampedArray: global.Uint8ClampedArray,\n  Uint16Array: global.Uint16Array,\n  Uint32Array: global.Uint32Array,\n  ArrayBuffer: global.ArrayBuffer\n});\nmodule.exports = Window;","map":{"version":3,"sources":["F:/JavaScript/Projects/chemistryphile/node_modules/jsdom-no-contextify/lib/jsdom/browser/Window.js"],"names":["URL","require","CSSStyleDeclaration","XMLHttpRequest","dom","NOT_IMPLEMENTED","createFrom","History","VirtualConsole","cssSelectorSplitRE","matchesDontThrow","el","selector","matches","e","startTimer","window","startFn","stopFn","callback","ms","res","__timers","push","stopTimer","id","i","call","splice","stopAllTimers","forEach","t","Window","document","_document","history","addEventListener","Node","prototype","apply","arguments","removeEventListener","dispatchEvent","raise","setTimeout","fn","clearTimeout","setInterval","clearInterval","bind","__stopAllTimers","Image","width","height","element","createElement","_virtualConsole","wrapConsoleMethod","method","args","Array","slice","emit","concat","console","assert","clear","count","debug","error","group","groupCollapse","groupEnd","info","log","table","time","timeEnd","trace","warn","xhr","lastUrl","_open","open","url","async","user","password","resolve","_send","send","data","cookie","cookieDomain","_cookieDomain","parse","host","split","indexOf","length","setDisableHeaderCheck","setRequestHeader","constructor","_length","location","_location","close","currentWindow","windowCleaner","body","innerHTML","_listeners","dispose","getComputedStyle","node","s","style","cs","setPropertiesFromRule","rule","selectorText","selectors","matched","property","setProperty","getPropertyValue","getPropertyPriority","ownerDocument","styleSheets","sheet","cssRules","media","navigator","userAgent","process","platform","version","appName","appVersion","noUI","cookieEnabled","name","innerWidth","innerHeight","outerWidth","outerHeight","pageXOffset","pageYOffset","screenX","screenY","screenLeft","screenTop","scrollX","scrollY","scrollTop","scrollLeft","alert","blur","confirm","createPopup","focus","moveBy","moveTo","print","prompt","resizeBy","resizeTo","scroll","scrollBy","scrollTo","screen","Int8Array","global","Int16Array","Int32Array","Float32Array","Float64Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","ArrayBuffer","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar URL = require(\"url\");\nvar CSSStyleDeclaration = require(\"cssstyle\").CSSStyleDeclaration;\nvar XMLHttpRequest = require(\"xmlhttprequest\").XMLHttpRequest;\nvar dom = require(\"../level1/core\");\nvar NOT_IMPLEMENTED = require(\"./utils\").NOT_IMPLEMENTED;\nvar createFrom = require(\"../utils\").createFrom;\nvar History = require(\"./history\");\nvar VirtualConsole = require(\"../virtual-console\");\n\nvar cssSelectorSplitRE = /((?:[^,\"']|\"[^\"]*\"|'[^']*')+)/;\n\nfunction matchesDontThrow(el, selector) {\n  try {\n    return el.matches(selector);\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction startTimer(window, startFn, stopFn, callback, ms) {\n  var res = startFn(callback, ms);\n  window.__timers.push([res, stopFn]);\n  return res;\n}\n\nfunction stopTimer(window, id) {\n  if (typeof id === \"undefined\") {\n    return;\n  }\n  for (var i in window.__timers) {\n    if (window.__timers[i][0] === id) {\n      window.__timers[i][1].call(window, id);\n      window.__timers.splice(i, 1);\n      break;\n    }\n  }\n}\n\nfunction stopAllTimers(window) {\n  window.__timers.forEach(function (t) {\n    t[1].call(window, t[0]);\n  });\n  window.__timers = [];\n}\n\nfunction Window(document) {\n  this.__timers = [];\n\n  // TODO: very little of this belongs on the instance; they should be prototype methods instead.\n\n  var window = this;\n  this._document = document;\n  this.history = new History(this);\n\n  this.addEventListener = function () {\n    dom.Node.prototype.addEventListener.apply(window, arguments);\n  };\n  this.removeEventListener = function () {\n    dom.Node.prototype.removeEventListener.apply(window, arguments);\n  };\n  this.dispatchEvent = function () {\n    dom.Node.prototype.dispatchEvent.apply(window, arguments);\n  };\n  this.raise = function () {\n    dom.Node.prototype.raise.apply(window.document, arguments);\n  };\n\n  this.setTimeout = function (fn, ms) { return startTimer(window, setTimeout, clearTimeout, fn, ms); };\n  this.setInterval = function (fn, ms) { return startTimer(window, setInterval, clearInterval, fn, ms); };\n  this.clearInterval = stopTimer.bind(this, window);\n  this.clearTimeout = stopTimer.bind(this, window);\n  this.__stopAllTimers = stopAllTimers.bind(this, window);\n  this.Image = function (width, height) {\n    var element = window._document.createElement(\"img\");\n    element.width = width;\n    element.height = height;\n    return element;\n  };\n\n  this._virtualConsole = new VirtualConsole();\n\n  function wrapConsoleMethod(method) {\n    return function () {\n      var args = Array.prototype.slice.call(arguments);\n      window._virtualConsole.emit.apply(window._virtualConsole, [method].concat(args));\n    };\n  }\n\n  this.console = {\n    assert: wrapConsoleMethod(\"assert\"),\n    clear: wrapConsoleMethod(\"clear\"),\n    count: wrapConsoleMethod(\"count\"),\n    debug: wrapConsoleMethod(\"debug\"),\n    error: wrapConsoleMethod(\"error\"),\n    group: wrapConsoleMethod(\"group\"),\n    groupCollapse: wrapConsoleMethod(\"groupCollapse\"),\n    groupEnd: wrapConsoleMethod(\"groupEnd\"),\n    info: wrapConsoleMethod(\"info\"),\n    log: wrapConsoleMethod(\"log\"),\n    table: wrapConsoleMethod(\"table\"),\n    time: wrapConsoleMethod(\"time\"),\n    timeEnd: wrapConsoleMethod(\"timeEnd\"),\n    trace: wrapConsoleMethod(\"trace\"),\n    warn: wrapConsoleMethod(\"warn\")\n  };\n\n  this.XMLHttpRequest = function () {\n    var xhr = new XMLHttpRequest();\n    var lastUrl = \"\";\n    xhr._open = xhr.open;\n    xhr.open = function (method, url, async, user, password) {\n      url = URL.resolve(window.document.URL, url);\n      lastUrl = url;\n      return xhr._open(method, url, async, user, password);\n    };\n    xhr._send = xhr.send;\n    xhr.send = function (data) {\n      if (window.document.cookie) {\n        var cookieDomain = window.document._cookieDomain;\n        var url = URL.parse(lastUrl);\n        var host = url.host.split(\":\")[0];\n        if (host.indexOf(cookieDomain, host.length - cookieDomain.length) !== -1) {\n          xhr.setDisableHeaderCheck(true);\n          xhr.setRequestHeader(\"cookie\", window.document.cookie);\n          xhr.setDisableHeaderCheck(false);\n        }\n      }\n      return xhr._send(data);\n    };\n    return xhr;\n  };\n}\n\nWindow.prototype = createFrom(dom || null, {\n  constructor: Window,\n  // This implements window.frames.length, since window.frames returns a\n  // self reference to the window object.  This value is incremented in the\n  // HTMLFrameElement init function (see: level2/html.js).\n  _length: 0,\n  get length() {\n    return this._length;\n  },\n  get document() {\n    return this._document;\n  },\n  get location() {\n    return this._document._location;\n  },\n  close: function () {\n    // Recursively close child frame windows, then ourselves.\n    var currentWindow = this;\n    (function windowCleaner(window) {\n      var i;\n      // We could call window.frames.length etc, but window.frames just points\n      // back to window.\n      if (window.length > 0) {\n        for (i = 0; i < window.length; i++) {\n          windowCleaner(window[i]);\n        }\n      }\n      // We\"re already in our own window.close().\n      if (window !== currentWindow) {\n        window.close();\n      }\n    })(this);\n\n    if (this._document) {\n      if (this._document.body) {\n        this._document.body.innerHTML = \"\";\n      }\n\n      if (this._document.close) {\n        // We need to empty out the event listener array because\n        // document.close() causes \"load\" event to re-fire.\n        this._document._listeners = [];\n        this._document.close();\n      }\n      delete this._document;\n    }\n\n    stopAllTimers(currentWindow);\n    // Clean up the window\"s execution context.\n    // dispose() is added by Contextify.\n    this.dispose();\n  },\n  getComputedStyle: function (node) {\n    var s = node.style,\n        cs = new CSSStyleDeclaration(),\n        forEach = Array.prototype.forEach;\n\n    function setPropertiesFromRule(rule) {\n      if (!rule.selectorText) {\n        return;\n      }\n\n      var selectors = rule.selectorText.split(cssSelectorSplitRE);\n      var matched = false;\n      selectors.forEach(function (selectorText) {\n        if (selectorText !== \"\" && selectorText !== \",\" && !matched && matchesDontThrow(node, selectorText)) {\n          matched = true;\n          forEach.call(rule.style, function (property) {\n            cs.setProperty(property, rule.style.getPropertyValue(property), rule.style.getPropertyPriority(property));\n          });\n        }\n      });\n    }\n\n    forEach.call(node.ownerDocument.styleSheets, function (sheet) {\n      forEach.call(sheet.cssRules, function (rule) {\n        if (rule.media) {\n          if (Array.prototype.indexOf.call(rule.media, \"screen\") !== -1) {\n            forEach.call(rule.cssRules, setPropertiesFromRule);\n          }\n        } else {\n          setPropertiesFromRule(rule);\n        }\n      });\n    });\n\n    forEach.call(s, function (property) {\n      cs.setProperty(property, s.getPropertyValue(property), s.getPropertyPriority(property));\n    });\n\n    return cs;\n  },\n\n  // TODO: all of the below data properties should be getters; right now they are shared between Window instances\n  // which is of course bad.\n  navigator: {\n    get userAgent() { return \"Node.js (\" + process.platform + \"; U; rv:\" + process.version + \")\"; },\n    get appName() { return \"Node.js jsDom\"; },\n    get platform() { return process.platform; },\n    get appVersion() { return process.version; },\n    noUI: true,\n    get cookieEnabled() { return true; }\n  },\n\n  name: \"nodejs\",\n  innerWidth: 1024,\n  innerHeight: 768,\n  outerWidth: 1024,\n  outerHeight: 768,\n  pageXOffset: 0,\n  pageYOffset: 0,\n  screenX: 0,\n  screenY: 0,\n  screenLeft: 0,\n  screenTop: 0,\n  scrollX: 0,\n  scrollY: 0,\n  scrollTop: 0,\n  scrollLeft: 0,\n  alert: NOT_IMPLEMENTED(null, \"window.alert\"),\n  blur: NOT_IMPLEMENTED(null, \"window.blur\"),\n  confirm: NOT_IMPLEMENTED(null, \"window.confirm\"),\n  createPopup: NOT_IMPLEMENTED(null, \"window.createPopup\"),\n  focus: NOT_IMPLEMENTED(null, \"window.focus\"),\n  moveBy: NOT_IMPLEMENTED(null, \"window.moveBy\"),\n  moveTo: NOT_IMPLEMENTED(null, \"window.moveTo\"),\n  open: NOT_IMPLEMENTED(null, \"window.open\"),\n  print: NOT_IMPLEMENTED(null, \"window.print\"),\n  prompt: NOT_IMPLEMENTED(null, \"window.prompt\"),\n  resizeBy: NOT_IMPLEMENTED(null, \"window.resizeBy\"),\n  resizeTo: NOT_IMPLEMENTED(null, \"window.resizeTo\"),\n  scroll: NOT_IMPLEMENTED(null, \"window.scroll\"),\n  scrollBy: NOT_IMPLEMENTED(null, \"window.scrollBy\"),\n  scrollTo: NOT_IMPLEMENTED(null, \"window.scrollTo\"),\n  screen: {\n    width: 0,\n    height: 0\n  },\n\n  // Note: these will not be necessary for newer Node.js versions, which have\n  // typed arrays in V8 and thus on every global object. (That is, in newer\n  // versions we\"ll get `ArrayBuffer` just as automatically as we get\n  // `Array`.) But to support older versions, we explicitly set them here.\n  Int8Array: global.Int8Array,\n  Int16Array: global.Int16Array,\n  Int32Array: global.Int32Array,\n  Float32Array: global.Float32Array,\n  Float64Array: global.Float64Array,\n  Uint8Array: global.Uint8Array,\n  Uint8ClampedArray: global.Uint8ClampedArray,\n  Uint16Array: global.Uint16Array,\n  Uint32Array: global.Uint32Array,\n  ArrayBuffer: global.ArrayBuffer\n});\n\nmodule.exports = Window;\n"]},"metadata":{},"sourceType":"script"}