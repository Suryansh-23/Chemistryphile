{"ast":null,"code":"/* DOM Level2 Events implemented as described here:\n *\n * http://www.w3.org/TR/2000/REC-DOM-Level-2-Events-20001113/events.html\n *\n */\nvar core = require(\"../level1/core\"),\n    utils = require(\"../utils\"),\n    defineGetter = utils.defineGetter,\n    defineSetter = utils.defineSetter,\n    inheritFrom = utils.inheritFrom;\n\ncore.EventException = function () {\n  if (arguments.length > 0) {\n    this._code = arguments[0];\n  } else {\n    this._code = 0;\n  }\n\n  if (arguments.length > 1) {\n    this._message = arguments[1];\n  } else {\n    this._message = \"Unspecified event type\";\n  }\n\n  Error.call(this, this._message);\n\n  if (Error.captureStackTrace) {\n    Error.captureStackTrace(this, core.EventException);\n  }\n};\n\ninheritFrom(Error, core.EventException, {\n  UNSPECIFIED_EVENT_TYPE_ERR: 0,\n\n  get code() {\n    return this._code;\n  }\n\n});\n\ncore.Event = function (eventType) {\n  this._eventType = eventType;\n  this._type = null;\n  this._bubbles = null;\n  this._cancelable = null;\n  this._target = null;\n  this._currentTarget = null;\n  this._eventPhase = 0;\n  this._timeStamp = null;\n  this._preventDefault = false;\n  this._stopPropagation = false;\n};\n\ncore.Event.prototype = {\n  initEvent: function (type, bubbles, cancelable) {\n    this._type = type;\n    this._bubbles = bubbles;\n    this._cancelable = cancelable;\n  },\n  preventDefault: function () {\n    if (this._cancelable) {\n      this._preventDefault = true;\n    }\n  },\n  stopPropagation: function () {\n    this._stopPropagation = true;\n  },\n  NONE: 0,\n  CAPTURING_PHASE: 1,\n  AT_TARGET: 2,\n  BUBBLING_PHASE: 3,\n\n  get eventType() {\n    return this._eventType;\n  },\n\n  get type() {\n    return this._type;\n  },\n\n  get bubbles() {\n    return this._bubbles;\n  },\n\n  get cancelable() {\n    return this._cancelable;\n  },\n\n  get target() {\n    return this._target;\n  },\n\n  get currentTarget() {\n    return this._currentTarget;\n  },\n\n  get eventPhase() {\n    return this._eventPhase;\n  },\n\n  get timeStamp() {\n    return this._timeStamp;\n  }\n\n};\n\ncore.UIEvent = function (eventType) {\n  core.Event.call(this, eventType);\n  this.view = null;\n  this.detail = null;\n};\n\ninheritFrom(core.Event, core.UIEvent, {\n  initUIEvent: function (type, bubbles, cancelable, view, detail) {\n    this.initEvent(type, bubbles, cancelable);\n    this.view = view;\n    this.detail = detail;\n  }\n});\n\ncore.MouseEvent = function (eventType) {\n  core.UIEvent.call(this, eventType);\n  this.screenX = null;\n  this.screenY = null;\n  this.clientX = null;\n  this.clientY = null;\n  this.ctrlKey = null;\n  this.shiftKey = null;\n  this.altKey = null;\n  this.metaKey = null;\n  this.button = null;\n  this.relatedTarget = null;\n};\n\ninheritFrom(core.UIEvent, core.MouseEvent, {\n  initMouseEvent: function (type, bubbles, cancelable, view, detail, screenX, screenY, clientX, clientY, ctrlKey, altKey, shiftKey, metaKey, button, relatedTarget) {\n    this.initUIEvent(type, bubbles, cancelable, view, detail);\n    this.screenX = screenX;\n    this.screenY = screenY;\n    this.clientX = clientX;\n    this.clientY = clientY;\n    this.ctrlKey = ctrlKey;\n    this.shiftKey = shiftKey;\n    this.altKey = altKey;\n    this.metaKey = metaKey;\n    this.button = button;\n    this.relatedTarget = relatedTarget;\n  }\n});\n\ncore.MutationEvent = function (eventType) {\n  core.Event.call(this, eventType);\n  this.relatedNode = null;\n  this.prevValue = null;\n  this.newValue = null;\n  this.attrName = null;\n  this.attrChange = null;\n};\n\ninheritFrom(core.Event, core.MutationEvent, {\n  initMutationEvent: function (type, bubbles, cancelable, relatedNode, prevValue, newValue, attrName, attrChange) {\n    this.initEvent(type, bubbles, cancelable);\n    this.relatedNode = relatedNode;\n    this.prevValue = prevValue;\n    this.newValue = newValue;\n    this.attrName = attrName;\n    this.attrChange = attrChange;\n  },\n  MODIFICATION: 1,\n  ADDITION: 2,\n  REMOVAL: 3\n});\n\ncore.EventTarget = function () {};\n\nfunction getListeners(target, type, capturing) {\n  var listeners = target._listeners && target._listeners[type] && target._listeners[type][capturing] || [];\n\n  if (!capturing) {\n    var traditionalHandler = target['on' + type];\n\n    if (traditionalHandler) {\n      var implementation = target._ownerDocument ? target._ownerDocument.implementation : target.document.implementation;\n\n      if (implementation._hasFeature('ProcessExternalResources', 'script')) {\n        if (listeners.indexOf(traditionalHandler) < 0) {\n          listeners.push(traditionalHandler);\n        }\n      }\n    }\n  }\n\n  return listeners;\n}\n\nfunction dispatchPhase(event, iterator) {\n  var target = iterator();\n\n  while (target && !event._stopPropagation) {\n    if (event._eventPhase === event.CAPTURING_PHASE || event._eventPhase === event.AT_TARGET) {\n      callListeners(event, target, getListeners(target, event._type, true));\n    }\n\n    if (event._eventPhase === event.AT_TARGET || event._eventPhase === event.BUBBLING_PHASE) {\n      callListeners(event, target, getListeners(target, event._type, false));\n    }\n\n    target = iterator();\n  }\n}\n\nfunction callListeners(event, target, listeners) {\n  var currentListener = listeners.length;\n\n  while (currentListener--) {\n    event._currentTarget = target;\n\n    try {\n      listeners[currentListener].call(target, event);\n    } catch (e) {\n      target.raise('error', \"Dispatching event '\" + event._type + \"' failed\", {\n        error: e,\n        event: event\n      });\n    }\n  }\n}\n\nfunction forwardIterator(list) {\n  var i = 0,\n      len = list.length;\n  return function iterator() {\n    return i < len ? list[i++] : null;\n  };\n}\n\nfunction backwardIterator(list) {\n  var i = list.length;\n  return function iterator() {\n    return i >= 0 ? list[--i] : null;\n  };\n}\n\nfunction singleIterator(obj) {\n  var i = 1;\n  return function iterator() {\n    return i-- ? obj : null;\n  };\n}\n\ncore.EventTarget.prototype = {\n  addEventListener: function (type, listener, capturing) {\n    this._listeners = this._listeners || {};\n    var listeners = this._listeners[type] || {};\n    capturing = capturing === true;\n    var capturingListeners = listeners[capturing] || [];\n\n    for (var i = 0; i < capturingListeners.length; i++) {\n      if (capturingListeners[i] === listener) {\n        return;\n      }\n    }\n\n    capturingListeners.push(listener);\n    listeners[capturing] = capturingListeners;\n    this._listeners[type] = listeners;\n  },\n  removeEventListener: function (type, listener, capturing) {\n    var listeners = this._listeners && this._listeners[type];\n    if (!listeners) return;\n    var capturingListeners = listeners[capturing === true];\n    if (!capturingListeners) return;\n\n    for (var i = 0; i < capturingListeners.length; i++) {\n      if (capturingListeners[i] === listener) {\n        capturingListeners.splice(i, 1);\n        return;\n      }\n    }\n  },\n  dispatchEvent: function (event) {\n    if (event == null) {\n      throw new core.EventException(0, \"Null event\");\n    }\n\n    if (event._type == null || event._type == \"\") {\n      throw new core.EventException(0, \"Uninitialized event\");\n    }\n\n    var targetList = [];\n    event._target = this; //per the spec we gather the list of targets first to ensure\n    //against dom modifications during actual event dispatch\n\n    var target = this,\n        targetParent = target._parentNode;\n\n    while (targetParent) {\n      targetList.push(targetParent);\n      target = targetParent;\n      targetParent = target._parentNode;\n    }\n\n    targetParent = target._parentWindow;\n\n    if (targetParent) {\n      targetList.push(targetParent);\n    }\n\n    var iterator = backwardIterator(targetList);\n    event._eventPhase = event.CAPTURING_PHASE;\n    dispatchPhase(event, iterator);\n    iterator = singleIterator(event._target);\n    event._eventPhase = event.AT_TARGET;\n    dispatchPhase(event, iterator);\n\n    if (event._bubbles) {\n      iterator = forwardIterator(targetList);\n      event._eventPhase = event.BUBBLING_PHASE;\n      dispatchPhase(event, iterator);\n    }\n\n    event._currentTarget = null;\n    event._eventPhase = event.NONE;\n    return !event._preventDefault;\n  }\n}; // Reinherit class heirarchy with EventTarget at its root\n\ninheritFrom(core.EventTarget, core.Node, core.Node.prototype); // Node\n\ninheritFrom(core.Node, core.Attr, core.Attr.prototype);\ninheritFrom(core.Node, core.Document, core.Document.prototype);\ninheritFrom(core.Node, core.DocumentFragment, core.DocumentFragment.prototype);\ninheritFrom(core.Node, core.Element, core.Element.prototype);\n\nfunction getDocument(el) {\n  return el.nodeType == core.Node.DOCUMENT_NODE ? el : el._ownerDocument;\n}\n\nfunction mutationEventsEnabled(el) {\n  return el.nodeType != core.Node.ATTRIBUTE_NODE && getDocument(el).implementation._hasFeature('MutationEvents');\n}\n\nvar insertBefore_super = core.Node.prototype.insertBefore;\n\ncore.Node.prototype.insertBefore = function (newChild, refChild) {\n  var ret = insertBefore_super.apply(this, arguments);\n\n  if (mutationEventsEnabled(this)) {\n    var doc = getDocument(this),\n        ev = doc.createEvent(\"MutationEvents\");\n    ev.initMutationEvent(\"DOMNodeInserted\", true, false, this, null, null, null, null);\n    newChild.dispatchEvent(ev);\n\n    if (this.nodeType == core.Node.DOCUMENT_NODE || this._attachedToDocument) {\n      ev = doc.createEvent(\"MutationEvents\");\n      ev.initMutationEvent(\"DOMNodeInsertedIntoDocument\", false, false, null, null, null, null, null);\n      core.visitTree(newChild, function (el) {\n        if (el.nodeType == core.Node.ELEMENT_NODE) {\n          el.dispatchEvent(ev);\n          el._attachedToDocument = true;\n        }\n      });\n    }\n  }\n\n  return ret;\n};\n\nvar removeChild_super = core.Node.prototype.removeChild;\n\ncore.Node.prototype.removeChild = function (oldChild) {\n  if (mutationEventsEnabled(this)) {\n    var doc = getDocument(this),\n        ev = doc.createEvent(\"MutationEvents\");\n    ev.initMutationEvent(\"DOMNodeRemoved\", true, false, this, null, null, null, null);\n    oldChild.dispatchEvent(ev);\n    ev = doc.createEvent(\"MutationEvents\");\n    ev.initMutationEvent(\"DOMNodeRemovedFromDocument\", false, false, null, null, null, null, null);\n    core.visitTree(oldChild, function (el) {\n      if (el.nodeType == core.Node.ELEMENT_NODE) {\n        el.dispatchEvent(ev);\n        el._attachedToDocument = false;\n      }\n    });\n  }\n\n  return removeChild_super.apply(this, arguments);\n};\n\nfunction dispatchAttrEvent(doc, target, prevVal, newVal, attrName, attrChange) {\n  if (!newVal || newVal != prevVal) {\n    var ev = doc.createEvent(\"MutationEvents\");\n    ev.initMutationEvent(\"DOMAttrModified\", true, false, target, prevVal, newVal, attrName, attrChange);\n    target.dispatchEvent(ev);\n  }\n}\n\nfunction attrNodeInterceptor(_super, change) {\n  return function (node) {\n    var target = this._parentNode,\n        prev = _super.apply(this, arguments);\n\n    if (mutationEventsEnabled(target)) {\n      dispatchAttrEvent(target._ownerDocument, target, prev && prev.value || null, change == 'ADDITION' ? node.value : null, prev && prev.name || node.name, core.MutationEvent.prototype[change]);\n    }\n\n    return prev;\n  };\n}\n\nfunction attrInterceptor(_super, ns) {\n  return function (localName, value, _name, _prefix, _namespace) {\n    var target = this._parentNode,\n        namespace = _namespace; // do not reassign parameters when using \"arguments\" (performance)\n\n    if (!mutationEventsEnabled(target)) {\n      _super.apply(this, arguments);\n\n      return;\n    }\n\n    if (namespace === undefined) {\n      namespace = null;\n    }\n\n    var prev = ns ? this.$getNode(namespace, localName) : this.$getNoNS(localName);\n    var prevVal = prev && prev.value || null;\n\n    _super.apply(this, arguments);\n\n    var node = ns ? this.$getNode(namespace, localName) : this.$getNoNS(localName);\n    dispatchAttrEvent(target._ownerDocument, target, prevVal, node.value, node.name, core.MutationEvent.prototype.ADDITION);\n  };\n}\n\ncore.AttributeList.prototype.$removeNode = attrNodeInterceptor(core.AttributeList.prototype.$removeNode, 'REMOVAL');\ncore.AttributeList.prototype.$setNode = attrNodeInterceptor(core.AttributeList.prototype.$setNode, 'ADDITION');\ncore.AttributeList.prototype.$set = attrInterceptor(core.AttributeList.prototype.$set, true);\ncore.AttributeList.prototype.$setNoNS = attrInterceptor(core.AttributeList.prototype.$setNoNS, false);\n\ncore.Document.prototype.createEvent = function (eventType) {\n  switch (eventType) {\n    case \"MutationEvents\":\n      return new core.MutationEvent(eventType);\n\n    case \"UIEvents\":\n      return new core.UIEvent(eventType);\n\n    case \"MouseEvents\":\n      return new core.MouseEvent(eventType);\n\n    case \"HTMLEvents\":\n      return new core.Event(eventType);\n  }\n\n  return new core.Event(eventType);\n};","map":{"version":3,"sources":["F:/JavaScript/Projects/chemistryphile/node_modules/jsdom-no-contextify/lib/jsdom/level2/events.js"],"names":["core","require","utils","defineGetter","defineSetter","inheritFrom","EventException","arguments","length","_code","_message","Error","call","captureStackTrace","UNSPECIFIED_EVENT_TYPE_ERR","code","Event","eventType","_eventType","_type","_bubbles","_cancelable","_target","_currentTarget","_eventPhase","_timeStamp","_preventDefault","_stopPropagation","prototype","initEvent","type","bubbles","cancelable","preventDefault","stopPropagation","NONE","CAPTURING_PHASE","AT_TARGET","BUBBLING_PHASE","target","currentTarget","eventPhase","timeStamp","UIEvent","view","detail","initUIEvent","MouseEvent","screenX","screenY","clientX","clientY","ctrlKey","shiftKey","altKey","metaKey","button","relatedTarget","initMouseEvent","MutationEvent","relatedNode","prevValue","newValue","attrName","attrChange","initMutationEvent","MODIFICATION","ADDITION","REMOVAL","EventTarget","getListeners","capturing","listeners","_listeners","traditionalHandler","implementation","_ownerDocument","document","_hasFeature","indexOf","push","dispatchPhase","event","iterator","callListeners","currentListener","e","raise","error","forwardIterator","list","i","len","backwardIterator","singleIterator","obj","addEventListener","listener","capturingListeners","removeEventListener","splice","dispatchEvent","targetList","targetParent","_parentNode","_parentWindow","Node","Attr","Document","DocumentFragment","Element","getDocument","el","nodeType","DOCUMENT_NODE","mutationEventsEnabled","ATTRIBUTE_NODE","insertBefore_super","insertBefore","newChild","refChild","ret","apply","doc","ev","createEvent","_attachedToDocument","visitTree","ELEMENT_NODE","removeChild_super","removeChild","oldChild","dispatchAttrEvent","prevVal","newVal","attrNodeInterceptor","_super","change","node","prev","value","name","attrInterceptor","ns","localName","_name","_prefix","_namespace","namespace","undefined","$getNode","$getNoNS","AttributeList","$removeNode","$setNode","$set","$setNoNS"],"mappings":"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","sourcesContent":["/* DOM Level2 Events implemented as described here:\n *\n * http://www.w3.org/TR/2000/REC-DOM-Level-2-Events-20001113/events.html\n *\n */\nvar core = require(\"../level1/core\"),\n    utils = require(\"../utils\"),\n    defineGetter = utils.defineGetter,\n    defineSetter = utils.defineSetter,\n    inheritFrom = utils.inheritFrom;\n\ncore.EventException = function() {\n    if (arguments.length > 0) {\n        this._code = arguments[0];\n    } else {\n        this._code = 0;\n    }\n    if (arguments.length > 1) {\n        this._message = arguments[1];\n    } else {\n        this._message = \"Unspecified event type\";\n    }\n    Error.call(this, this._message);\n    if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, core.EventException);\n    }\n};\ninheritFrom(Error, core.EventException, {\n  UNSPECIFIED_EVENT_TYPE_ERR : 0,\n  get code() { return this._code;}\n});\n\ncore.Event = function(eventType) {\n    this._eventType = eventType;\n    this._type = null;\n    this._bubbles = null;\n    this._cancelable = null;\n    this._target = null;\n    this._currentTarget = null;\n    this._eventPhase = 0;\n    this._timeStamp = null;\n    this._preventDefault = false;\n    this._stopPropagation = false;\n};\ncore.Event.prototype = {\n    initEvent: function(type, bubbles, cancelable) {\n        this._type = type;\n        this._bubbles = bubbles;\n        this._cancelable = cancelable;\n    },\n    preventDefault: function() {\n        if (this._cancelable) {\n            this._preventDefault = true;\n        }\n    },\n    stopPropagation: function() {\n        this._stopPropagation = true;\n    },\n    NONE            : 0,\n    CAPTURING_PHASE : 1,\n    AT_TARGET       : 2,\n    BUBBLING_PHASE  : 3,\n    get eventType() { return this._eventType; },\n    get type() { return this._type; },\n    get bubbles() { return this._bubbles; },\n    get cancelable() { return this._cancelable; },\n    get target() { return this._target; },\n    get currentTarget() { return this._currentTarget; },\n    get eventPhase() { return this._eventPhase; },\n    get timeStamp() { return this._timeStamp; }\n};\n\n\ncore.UIEvent = function(eventType) {\n    core.Event.call(this, eventType);\n    this.view = null;\n    this.detail = null;\n};\ninheritFrom(core.Event, core.UIEvent, {\n    initUIEvent: function(type, bubbles, cancelable, view, detail) {\n        this.initEvent(type, bubbles, cancelable);\n        this.view = view;\n        this.detail = detail;\n    },\n});\n\n\ncore.MouseEvent = function(eventType) {\n    core.UIEvent.call(this, eventType);\n    this.screenX = null;\n    this.screenY = null;\n    this.clientX = null;\n    this.clientY = null;\n    this.ctrlKey = null;\n    this.shiftKey = null;\n    this.altKey = null;\n    this.metaKey = null;\n    this.button = null;\n    this.relatedTarget = null;\n};\ninheritFrom(core.UIEvent, core.MouseEvent, {\n    initMouseEvent:   function(type,\n                               bubbles,\n                               cancelable,\n                               view,\n                               detail,\n                               screenX,\n                               screenY,\n                               clientX,\n                               clientY,\n                               ctrlKey,\n                               altKey,\n                               shiftKey,\n                               metaKey,\n                               button,\n                               relatedTarget) {\n        this.initUIEvent(type, bubbles, cancelable, view, detail);\n        this.screenX  = screenX\n        this.screenY  = screenY\n        this.clientX  = clientX\n        this.clientY  = clientY\n        this.ctrlKey  = ctrlKey\n        this.shiftKey  = shiftKey\n        this.altKey  = altKey\n        this.metaKey  = metaKey\n        this.button  = button\n        this.relatedTarget  = relatedTarget\n    }\n});\n\n\ncore.MutationEvent = function(eventType) {\n    core.Event.call(this, eventType);\n    this.relatedNode = null;\n    this.prevValue = null;\n    this.newValue = null;\n    this.attrName = null;\n    this.attrChange = null;\n};\ninheritFrom(core.Event, core.MutationEvent, {\n    initMutationEvent:   function(type,\n                                  bubbles,\n                                  cancelable,\n                                  relatedNode,\n                                  prevValue,\n                                  newValue,\n                                  attrName,\n                                  attrChange) {\n        this.initEvent(type, bubbles, cancelable);\n        this.relatedNode = relatedNode;\n        this.prevValue = prevValue;\n        this.newValue = newValue;\n        this.attrName = attrName;\n        this.attrChange = attrChange;\n    },\n    MODIFICATION : 1,\n    ADDITION     : 2,\n    REMOVAL      : 3\n});\n\ncore.EventTarget = function() {};\n\nfunction getListeners(target, type, capturing) {\n    var listeners = target._listeners\n            && target._listeners[type]\n            && target._listeners[type][capturing] || [];\n    if (!capturing) {\n        var traditionalHandler = target['on' + type];\n        if (traditionalHandler) {\n            var implementation = (target._ownerDocument ? target._ownerDocument.implementation\n                                                        : target.document.implementation);\n\n            if (implementation._hasFeature('ProcessExternalResources', 'script')) {\n                if (listeners.indexOf(traditionalHandler) < 0) {\n                    listeners.push(traditionalHandler);\n                }\n            }\n        }\n    }\n    return listeners;\n}\n\nfunction dispatchPhase(event, iterator) {\n    var target = iterator();\n\n    while (target && !event._stopPropagation) {\n        if (event._eventPhase === event.CAPTURING_PHASE || event._eventPhase === event.AT_TARGET) {\n            callListeners(event, target, getListeners(target, event._type, true));\n        }\n        if (event._eventPhase === event.AT_TARGET || event._eventPhase === event.BUBBLING_PHASE) {\n            callListeners(event, target, getListeners(target, event._type, false));\n        }\n        target = iterator();\n    }\n}\n\nfunction callListeners(event, target, listeners) {\n    var currentListener = listeners.length;\n    while (currentListener--) {\n        event._currentTarget = target;\n        try {\n          listeners[currentListener].call(target, event);\n        } catch (e) {\n          target.raise(\n            'error', \"Dispatching event '\" + event._type + \"' failed\",\n            {error: e, event: event}\n          );\n        }\n    }\n}\n\nfunction forwardIterator(list) {\n  var i = 0, len = list.length;\n  return function iterator() { return i < len ? list[i++] : null };\n}\n\nfunction backwardIterator(list) {\n  var i = list.length;\n  return function iterator() { return i >=0 ? list[--i] : null };\n}\n\nfunction singleIterator(obj) {\n  var i = 1;\n  return function iterator() { return i-- ? obj : null };\n}\n\ncore.EventTarget.prototype = {\n    addEventListener: function(type, listener, capturing) {\n        this._listeners = this._listeners || {};\n        var listeners = this._listeners[type] || {};\n        capturing = (capturing === true);\n        var capturingListeners = listeners[capturing] || [];\n        for (var i=0; i < capturingListeners.length; i++) {\n            if (capturingListeners[i] === listener) {\n                return;\n            }\n        }\n        capturingListeners.push(listener);\n        listeners[capturing] = capturingListeners;\n        this._listeners[type] = listeners;\n    },\n\n    removeEventListener: function(type, listener, capturing) {\n        var listeners  = this._listeners && this._listeners[type];\n        if (!listeners) return;\n        var capturingListeners = listeners[(capturing === true)];\n        if (!capturingListeners) return;\n        for (var i=0; i < capturingListeners.length; i++) {\n            if (capturingListeners[i] === listener) {\n                capturingListeners.splice(i, 1);\n                return;\n            }\n        }\n    },\n\n    dispatchEvent: function(event) {\n        if (event == null) {\n            throw new core.EventException(0, \"Null event\");\n        }\n        if (event._type == null || event._type == \"\") {\n            throw new core.EventException(0, \"Uninitialized event\");\n        }\n\n        var targetList = [];\n\n        event._target = this;\n\n        //per the spec we gather the list of targets first to ensure\n        //against dom modifications during actual event dispatch\n        var target = this,\n            targetParent = target._parentNode;\n        while (targetParent) {\n            targetList.push(targetParent);\n            target = targetParent;\n            targetParent = target._parentNode;\n        }\n        targetParent = target._parentWindow;\n        if (targetParent) {\n            targetList.push(targetParent);\n        }\n\n        var iterator = backwardIterator(targetList);\n\n        event._eventPhase = event.CAPTURING_PHASE;\n        dispatchPhase(event, iterator);\n\n        iterator = singleIterator(event._target);\n        event._eventPhase = event.AT_TARGET;\n        dispatchPhase(event, iterator);\n\n        if (event._bubbles) {\n            iterator = forwardIterator(targetList);\n            event._eventPhase = event.BUBBLING_PHASE;\n            dispatchPhase(event, iterator);\n        }\n\n        event._currentTarget = null;\n        event._eventPhase = event.NONE;\n\n        return !event._preventDefault;\n    }\n\n};\n\n// Reinherit class heirarchy with EventTarget at its root\ninheritFrom(core.EventTarget, core.Node, core.Node.prototype);\n\n// Node\ninheritFrom(core.Node, core.Attr, core.Attr.prototype);\ninheritFrom(core.Node, core.Document, core.Document.prototype);\ninheritFrom(core.Node, core.DocumentFragment, core.DocumentFragment.prototype);\ninheritFrom(core.Node, core.Element, core.Element.prototype);\n\n\nfunction getDocument(el) {\n  return el.nodeType == core.Node.DOCUMENT_NODE ? el : el._ownerDocument;\n}\n\nfunction mutationEventsEnabled(el) {\n  return el.nodeType != core.Node.ATTRIBUTE_NODE &&\n         getDocument(el).implementation._hasFeature('MutationEvents');\n}\n\nvar insertBefore_super = core.Node.prototype.insertBefore;\ncore.Node.prototype.insertBefore = function(newChild, refChild) {\n  var ret = insertBefore_super.apply(this, arguments);\n  if (mutationEventsEnabled(this)) {\n    var doc = getDocument(this),\n        ev = doc.createEvent(\"MutationEvents\");\n\n    ev.initMutationEvent(\"DOMNodeInserted\", true, false, this, null, null, null, null);\n    newChild.dispatchEvent(ev);\n    if (this.nodeType == core.Node.DOCUMENT_NODE || this._attachedToDocument) {\n      ev = doc.createEvent(\"MutationEvents\");\n      ev.initMutationEvent(\"DOMNodeInsertedIntoDocument\", false, false, null, null, null, null, null);\n      core.visitTree(newChild, function(el) {\n        if (el.nodeType == core.Node.ELEMENT_NODE) {\n          el.dispatchEvent(ev);\n          el._attachedToDocument = true;\n        }\n      });\n    }\n  }\n  return ret;\n};\n\nvar removeChild_super = core.Node.prototype.removeChild;\ncore.Node.prototype.removeChild = function (oldChild) {\n  if (mutationEventsEnabled(this)) {\n    var doc = getDocument(this),\n        ev = doc.createEvent(\"MutationEvents\");\n\n    ev.initMutationEvent(\"DOMNodeRemoved\", true, false, this, null, null, null, null);\n    oldChild.dispatchEvent(ev);\n\n    ev = doc.createEvent(\"MutationEvents\");\n    ev.initMutationEvent(\"DOMNodeRemovedFromDocument\", false, false, null, null, null, null, null);\n    core.visitTree(oldChild, function(el) {\n      if (el.nodeType == core.Node.ELEMENT_NODE) {\n        el.dispatchEvent(ev);\n        el._attachedToDocument = false;\n      }\n    });\n  }\n  return removeChild_super.apply(this, arguments);\n};\n\nfunction dispatchAttrEvent(doc, target, prevVal, newVal, attrName, attrChange) {\n  if (!newVal || newVal != prevVal) {\n    var ev = doc.createEvent(\"MutationEvents\");\n    ev.initMutationEvent(\"DOMAttrModified\", true, false, target, prevVal,\n                         newVal, attrName, attrChange);\n    target.dispatchEvent(ev);\n  }\n}\n\nfunction attrNodeInterceptor(_super, change) {\n  return function(node) {\n    var target = this._parentNode,\n        prev = _super.apply(this, arguments);\n\n    if (mutationEventsEnabled(target)) {\n      dispatchAttrEvent(target._ownerDocument,\n                        target,\n                        prev && prev.value || null,\n                        change == 'ADDITION' ? node.value : null,\n                        prev && prev.name || node.name,\n                        core.MutationEvent.prototype[change]);\n    }\n\n    return prev;\n  };\n}\n\nfunction attrInterceptor(_super, ns) {\n  return function(localName, value, _name, _prefix, _namespace) {\n    var target = this._parentNode,\n        namespace = _namespace; // do not reassign parameters when using \"arguments\" (performance)\n\n    if (!mutationEventsEnabled(target)) {\n      _super.apply(this, arguments);\n      return;\n    }\n\n    if (namespace === undefined) {\n        namespace = null;\n    }\n\n    var prev =\n          ns ? this.$getNode(namespace, localName) : this.$getNoNS(localName);\n    var prevVal = prev && prev.value || null;\n\n    _super.apply(this, arguments);\n\n    var node = ns ? this.$getNode(namespace, localName):\n            this.$getNoNS(localName);\n\n    dispatchAttrEvent(target._ownerDocument,\n                      target,\n                      prevVal,\n                      node.value,\n                      node.name,\n                      core.MutationEvent.prototype.ADDITION);\n  };\n}\n\n\ncore.AttributeList.prototype.$removeNode = attrNodeInterceptor(core.AttributeList.prototype.$removeNode, 'REMOVAL');\ncore.AttributeList.prototype.$setNode = attrNodeInterceptor(core.AttributeList.prototype.$setNode, 'ADDITION');\ncore.AttributeList.prototype.$set = attrInterceptor(core.AttributeList.prototype.$set, true);\ncore.AttributeList.prototype.$setNoNS = attrInterceptor(core.AttributeList.prototype.$setNoNS, false);\n\ncore.Document.prototype.createEvent = function(eventType) {\n    switch (eventType) {\n        case \"MutationEvents\": return new core.MutationEvent(eventType);\n        case \"UIEvents\": return new core.UIEvent(eventType);\n        case \"MouseEvents\": return new core.MouseEvent(eventType);\n        case \"HTMLEvents\": return new core.Event(eventType);\n    }\n    return new core.Event(eventType);\n};\n"]},"metadata":{},"sourceType":"script"}