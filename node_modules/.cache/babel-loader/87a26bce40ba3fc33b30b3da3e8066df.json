{"ast":null,"code":"'use strict';\n\nvar UNICODE = require('../common/unicode'); //Aliases\n\n\nvar $ = UNICODE.CODE_POINTS; //Utils\n//OPTIMIZATION: these utility functions should not be moved out of this module. V8 Crankshaft will not inline\n//this functions if they will be situated in another module due to context switch.\n//Always perform inlining check before modifying this functions ('node --trace-inlining').\n\nfunction isReservedCodePoint(cp) {\n  return cp >= 0xD800 && cp <= 0xDFFF || cp > 0x10FFFF;\n}\n\nfunction isSurrogatePair(cp1, cp2) {\n  return cp1 >= 0xD800 && cp1 <= 0xDBFF && cp2 >= 0xDC00 && cp2 <= 0xDFFF;\n}\n\nfunction getSurrogatePairCodePoint(cp1, cp2) {\n  return (cp1 - 0xD800) * 0x400 + 0x2400 + cp2;\n} //Preprocessor\n//NOTE: HTML input preprocessing\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/parsing.html#preprocessing-the-input-stream)\n\n\nvar Preprocessor = module.exports = function (html) {\n  this.write(html); //NOTE: one leading U+FEFF BYTE ORDER MARK character must be ignored if any are present in the input stream.\n\n  this.pos = this.html.charCodeAt(0) === $.BOM ? 0 : -1;\n  this.gapStack = [];\n  this.lastGapPos = -1;\n  this.skipNextNewLine = false;\n};\n\nPreprocessor.prototype.write = function (html) {\n  if (this.html) {\n    this.html = this.html.substring(0, this.pos + 1) + html + this.html.substring(this.pos + 1, this.html.length);\n  } else this.html = html;\n\n  this.lastCharPos = this.html.length - 1;\n};\n\nPreprocessor.prototype.advanceAndPeekCodePoint = function () {\n  this.pos++;\n  if (this.pos > this.lastCharPos) return $.EOF;\n  var cp = this.html.charCodeAt(this.pos); //NOTE: any U+000A LINE FEED (LF) characters that immediately follow a U+000D CARRIAGE RETURN (CR) character\n  //must be ignored.\n\n  if (this.skipNextNewLine && cp === $.LINE_FEED) {\n    this.skipNextNewLine = false;\n\n    this._addGap();\n\n    return this.advanceAndPeekCodePoint();\n  } //NOTE: all U+000D CARRIAGE RETURN (CR) characters must be converted to U+000A LINE FEED (LF) characters\n\n\n  if (cp === $.CARRIAGE_RETURN) {\n    this.skipNextNewLine = true;\n    return $.LINE_FEED;\n  }\n\n  this.skipNextNewLine = false; //OPTIMIZATION: first perform check if the code point in the allowed range that covers most common\n  //HTML input (e.g. ASCII codes) to avoid performance-cost operations for high-range code points.\n\n  return cp >= 0xD800 ? this._processHighRangeCodePoint(cp) : cp;\n};\n\nPreprocessor.prototype._processHighRangeCodePoint = function (cp) {\n  //NOTE: try to peek a surrogate pair\n  if (this.pos !== this.lastCharPos) {\n    var nextCp = this.html.charCodeAt(this.pos + 1);\n\n    if (isSurrogatePair(cp, nextCp)) {\n      //NOTE: we have a surrogate pair. Peek pair character and recalculate code point.\n      this.pos++;\n      cp = getSurrogatePairCodePoint(cp, nextCp); //NOTE: add gap that should be avoided during retreat\n\n      this._addGap();\n    }\n  }\n\n  if (isReservedCodePoint(cp)) cp = $.REPLACEMENT_CHARACTER;\n  return cp;\n};\n\nPreprocessor.prototype._addGap = function () {\n  this.gapStack.push(this.lastGapPos);\n  this.lastGapPos = this.pos;\n};\n\nPreprocessor.prototype.retreat = function () {\n  if (this.pos === this.lastGapPos) {\n    this.lastGapPos = this.gapStack.pop();\n    this.pos--;\n  }\n\n  this.pos--;\n};","map":{"version":3,"sources":["F:/JavaScript/Projects/chemistryphile/node_modules/jsdom-no-contextify/node_modules/parse5/lib/tokenization/preprocessor.js"],"names":["UNICODE","require","$","CODE_POINTS","isReservedCodePoint","cp","isSurrogatePair","cp1","cp2","getSurrogatePairCodePoint","Preprocessor","module","exports","html","write","pos","charCodeAt","BOM","gapStack","lastGapPos","skipNextNewLine","prototype","substring","length","lastCharPos","advanceAndPeekCodePoint","EOF","LINE_FEED","_addGap","CARRIAGE_RETURN","_processHighRangeCodePoint","nextCp","REPLACEMENT_CHARACTER","push","retreat","pop"],"mappings":"AAAA;;AAEA,IAAIA,OAAO,GAAGC,OAAO,CAAC,mBAAD,CAArB,C,CAEA;;;AACA,IAAIC,CAAC,GAAGF,OAAO,CAACG,WAAhB,C,CAEA;AAEA;AACA;AACA;;AACA,SAASC,mBAAT,CAA6BC,EAA7B,EAAiC;AAC7B,SAAOA,EAAE,IAAI,MAAN,IAAgBA,EAAE,IAAI,MAAtB,IAAgCA,EAAE,GAAG,QAA5C;AACH;;AAED,SAASC,eAAT,CAAyBC,GAAzB,EAA8BC,GAA9B,EAAmC;AAC/B,SAAOD,GAAG,IAAI,MAAP,IAAiBA,GAAG,IAAI,MAAxB,IAAkCC,GAAG,IAAI,MAAzC,IAAmDA,GAAG,IAAI,MAAjE;AACH;;AAED,SAASC,yBAAT,CAAmCF,GAAnC,EAAwCC,GAAxC,EAA6C;AACzC,SAAO,CAACD,GAAG,GAAG,MAAP,IAAiB,KAAjB,GAAyB,MAAzB,GAAkCC,GAAzC;AACH,C,CAED;AACA;AACA;;;AACA,IAAIE,YAAY,GAAGC,MAAM,CAACC,OAAP,GAAiB,UAAUC,IAAV,EAAgB;AAChD,OAAKC,KAAL,CAAWD,IAAX,EADgD,CAGhD;;AACA,OAAKE,GAAL,GAAW,KAAKF,IAAL,CAAUG,UAAV,CAAqB,CAArB,MAA4Bd,CAAC,CAACe,GAA9B,GAAoC,CAApC,GAAwC,CAAC,CAApD;AAEA,OAAKC,QAAL,GAAgB,EAAhB;AACA,OAAKC,UAAL,GAAkB,CAAC,CAAnB;AACA,OAAKC,eAAL,GAAuB,KAAvB;AACH,CATD;;AAWAV,YAAY,CAACW,SAAb,CAAuBP,KAAvB,GAA+B,UAAUD,IAAV,EAAgB;AAC3C,MAAI,KAAKA,IAAT,EAAe;AACX,SAAKA,IAAL,GAAY,KAAKA,IAAL,CAAUS,SAAV,CAAoB,CAApB,EAAuB,KAAKP,GAAL,GAAW,CAAlC,IACAF,IADA,GAEA,KAAKA,IAAL,CAAUS,SAAV,CAAoB,KAAKP,GAAL,GAAW,CAA/B,EAAkC,KAAKF,IAAL,CAAUU,MAA5C,CAFZ;AAIH,GALD,MAOI,KAAKV,IAAL,GAAYA,IAAZ;;AAGJ,OAAKW,WAAL,GAAmB,KAAKX,IAAL,CAAUU,MAAV,GAAmB,CAAtC;AACH,CAZD;;AAcAb,YAAY,CAACW,SAAb,CAAuBI,uBAAvB,GAAiD,YAAY;AACzD,OAAKV,GAAL;AAEA,MAAI,KAAKA,GAAL,GAAW,KAAKS,WAApB,EACI,OAAOtB,CAAC,CAACwB,GAAT;AAEJ,MAAIrB,EAAE,GAAG,KAAKQ,IAAL,CAAUG,UAAV,CAAqB,KAAKD,GAA1B,CAAT,CANyD,CAQzD;AACA;;AACA,MAAI,KAAKK,eAAL,IAAwBf,EAAE,KAAKH,CAAC,CAACyB,SAArC,EAAgD;AAC5C,SAAKP,eAAL,GAAuB,KAAvB;;AACA,SAAKQ,OAAL;;AACA,WAAO,KAAKH,uBAAL,EAAP;AACH,GAdwD,CAgBzD;;;AACA,MAAIpB,EAAE,KAAKH,CAAC,CAAC2B,eAAb,EAA8B;AAC1B,SAAKT,eAAL,GAAuB,IAAvB;AACA,WAAOlB,CAAC,CAACyB,SAAT;AACH;;AAED,OAAKP,eAAL,GAAuB,KAAvB,CAtByD,CAwBzD;AACA;;AACA,SAAOf,EAAE,IAAI,MAAN,GAAe,KAAKyB,0BAAL,CAAgCzB,EAAhC,CAAf,GAAqDA,EAA5D;AACH,CA3BD;;AA6BAK,YAAY,CAACW,SAAb,CAAuBS,0BAAvB,GAAoD,UAAUzB,EAAV,EAAc;AAC9D;AACA,MAAI,KAAKU,GAAL,KAAa,KAAKS,WAAtB,EAAmC;AAC/B,QAAIO,MAAM,GAAG,KAAKlB,IAAL,CAAUG,UAAV,CAAqB,KAAKD,GAAL,GAAW,CAAhC,CAAb;;AAEA,QAAIT,eAAe,CAACD,EAAD,EAAK0B,MAAL,CAAnB,EAAiC;AAC7B;AACA,WAAKhB,GAAL;AACAV,MAAAA,EAAE,GAAGI,yBAAyB,CAACJ,EAAD,EAAK0B,MAAL,CAA9B,CAH6B,CAK7B;;AACA,WAAKH,OAAL;AACH;AACJ;;AAED,MAAIxB,mBAAmB,CAACC,EAAD,CAAvB,EACIA,EAAE,GAAGH,CAAC,CAAC8B,qBAAP;AAEJ,SAAO3B,EAAP;AACH,CAnBD;;AAqBAK,YAAY,CAACW,SAAb,CAAuBO,OAAvB,GAAiC,YAAY;AACzC,OAAKV,QAAL,CAAce,IAAd,CAAmB,KAAKd,UAAxB;AACA,OAAKA,UAAL,GAAkB,KAAKJ,GAAvB;AACH,CAHD;;AAKAL,YAAY,CAACW,SAAb,CAAuBa,OAAvB,GAAiC,YAAY;AACzC,MAAI,KAAKnB,GAAL,KAAa,KAAKI,UAAtB,EAAkC;AAC9B,SAAKA,UAAL,GAAkB,KAAKD,QAAL,CAAciB,GAAd,EAAlB;AACA,SAAKpB,GAAL;AACH;;AAED,OAAKA,GAAL;AACH,CAPD","sourcesContent":["'use strict';\r\n\r\nvar UNICODE = require('../common/unicode');\r\n\r\n//Aliases\r\nvar $ = UNICODE.CODE_POINTS;\r\n\r\n//Utils\r\n\r\n//OPTIMIZATION: these utility functions should not be moved out of this module. V8 Crankshaft will not inline\r\n//this functions if they will be situated in another module due to context switch.\r\n//Always perform inlining check before modifying this functions ('node --trace-inlining').\r\nfunction isReservedCodePoint(cp) {\r\n    return cp >= 0xD800 && cp <= 0xDFFF || cp > 0x10FFFF;\r\n}\r\n\r\nfunction isSurrogatePair(cp1, cp2) {\r\n    return cp1 >= 0xD800 && cp1 <= 0xDBFF && cp2 >= 0xDC00 && cp2 <= 0xDFFF;\r\n}\r\n\r\nfunction getSurrogatePairCodePoint(cp1, cp2) {\r\n    return (cp1 - 0xD800) * 0x400 + 0x2400 + cp2;\r\n}\r\n\r\n//Preprocessor\r\n//NOTE: HTML input preprocessing\r\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/parsing.html#preprocessing-the-input-stream)\r\nvar Preprocessor = module.exports = function (html) {\r\n    this.write(html);\r\n\r\n    //NOTE: one leading U+FEFF BYTE ORDER MARK character must be ignored if any are present in the input stream.\r\n    this.pos = this.html.charCodeAt(0) === $.BOM ? 0 : -1;\r\n\r\n    this.gapStack = [];\r\n    this.lastGapPos = -1;\r\n    this.skipNextNewLine = false;\r\n};\r\n\r\nPreprocessor.prototype.write = function (html) {\r\n    if (this.html) {\r\n        this.html = this.html.substring(0, this.pos + 1) +\r\n                    html +\r\n                    this.html.substring(this.pos + 1, this.html.length);\r\n\r\n    }\r\n    else\r\n        this.html = html;\r\n\r\n\r\n    this.lastCharPos = this.html.length - 1;\r\n};\r\n\r\nPreprocessor.prototype.advanceAndPeekCodePoint = function () {\r\n    this.pos++;\r\n\r\n    if (this.pos > this.lastCharPos)\r\n        return $.EOF;\r\n\r\n    var cp = this.html.charCodeAt(this.pos);\r\n\r\n    //NOTE: any U+000A LINE FEED (LF) characters that immediately follow a U+000D CARRIAGE RETURN (CR) character\r\n    //must be ignored.\r\n    if (this.skipNextNewLine && cp === $.LINE_FEED) {\r\n        this.skipNextNewLine = false;\r\n        this._addGap();\r\n        return this.advanceAndPeekCodePoint();\r\n    }\r\n\r\n    //NOTE: all U+000D CARRIAGE RETURN (CR) characters must be converted to U+000A LINE FEED (LF) characters\r\n    if (cp === $.CARRIAGE_RETURN) {\r\n        this.skipNextNewLine = true;\r\n        return $.LINE_FEED;\r\n    }\r\n\r\n    this.skipNextNewLine = false;\r\n\r\n    //OPTIMIZATION: first perform check if the code point in the allowed range that covers most common\r\n    //HTML input (e.g. ASCII codes) to avoid performance-cost operations for high-range code points.\r\n    return cp >= 0xD800 ? this._processHighRangeCodePoint(cp) : cp;\r\n};\r\n\r\nPreprocessor.prototype._processHighRangeCodePoint = function (cp) {\r\n    //NOTE: try to peek a surrogate pair\r\n    if (this.pos !== this.lastCharPos) {\r\n        var nextCp = this.html.charCodeAt(this.pos + 1);\r\n\r\n        if (isSurrogatePair(cp, nextCp)) {\r\n            //NOTE: we have a surrogate pair. Peek pair character and recalculate code point.\r\n            this.pos++;\r\n            cp = getSurrogatePairCodePoint(cp, nextCp);\r\n\r\n            //NOTE: add gap that should be avoided during retreat\r\n            this._addGap();\r\n        }\r\n    }\r\n\r\n    if (isReservedCodePoint(cp))\r\n        cp = $.REPLACEMENT_CHARACTER;\r\n\r\n    return cp;\r\n};\r\n\r\nPreprocessor.prototype._addGap = function () {\r\n    this.gapStack.push(this.lastGapPos);\r\n    this.lastGapPos = this.pos;\r\n};\r\n\r\nPreprocessor.prototype.retreat = function () {\r\n    if (this.pos === this.lastGapPos) {\r\n        this.lastGapPos = this.gapStack.pop();\r\n        this.pos--;\r\n    }\r\n\r\n    this.pos--;\r\n};\r\n"]},"metadata":{},"sourceType":"script"}