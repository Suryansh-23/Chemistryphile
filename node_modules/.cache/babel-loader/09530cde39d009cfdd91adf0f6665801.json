{"ast":null,"code":"'use strict';\n\nvar HTML = require('../common/html'); //Aliases\n\n\nvar $ = HTML.TAG_NAMES,\n    NS = HTML.NAMESPACES; //Element utils\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\n//It's faster than using dictionary.\n\nfunction isImpliedEndTagRequired(tn) {\n  switch (tn.length) {\n    case 1:\n      return tn === $.P;\n\n    case 2:\n      return tn === $.RP || tn === $.RT || tn === $.DD || tn === $.DT || tn === $.LI;\n\n    case 6:\n      return tn === $.OPTION;\n\n    case 8:\n      return tn === $.OPTGROUP;\n  }\n\n  return false;\n}\n\nfunction isScopingElement(tn, ns) {\n  switch (tn.length) {\n    case 2:\n      if (tn === $.TD || tn === $.TH) return ns === NS.HTML;else if (tn === $.MI || tn === $.MO || tn == $.MN || tn === $.MS) return ns === NS.MATHML;\n      break;\n\n    case 4:\n      if (tn === $.HTML) return ns === NS.HTML;else if (tn === $.DESC) return ns === NS.SVG;\n      break;\n\n    case 5:\n      if (tn === $.TABLE) return ns === NS.HTML;else if (tn === $.MTEXT) return ns === NS.MATHML;else if (tn === $.TITLE) return ns === NS.SVG;\n      break;\n\n    case 6:\n      return (tn === $.APPLET || tn === $.OBJECT) && ns === NS.HTML;\n\n    case 7:\n      return (tn === $.CAPTION || tn === $.MARQUEE) && ns === NS.HTML;\n\n    case 8:\n      return tn === $.TEMPLATE && ns === NS.HTML;\n\n    case 13:\n      return tn === $.FOREIGN_OBJECT && ns === NS.SVG;\n\n    case 14:\n      return tn === $.ANNOTATION_XML && ns === NS.MATHML;\n  }\n\n  return false;\n} //Stack of open elements\n\n\nvar OpenElementStack = module.exports = function (document, treeAdapter) {\n  this.stackTop = -1;\n  this.items = [];\n  this.current = document;\n  this.currentTagName = null;\n  this.currentTmplContent = null;\n  this.tmplCount = 0;\n  this.treeAdapter = treeAdapter;\n}; //Index of element\n\n\nOpenElementStack.prototype._indexOf = function (element) {\n  var idx = -1;\n\n  for (var i = this.stackTop; i >= 0; i--) {\n    if (this.items[i] === element) {\n      idx = i;\n      break;\n    }\n  }\n\n  return idx;\n}; //Update current element\n\n\nOpenElementStack.prototype._isInTemplate = function () {\n  if (this.currentTagName !== $.TEMPLATE) return false;\n  return this.treeAdapter.getNamespaceURI(this.current) === NS.HTML;\n};\n\nOpenElementStack.prototype._updateCurrentElement = function () {\n  this.current = this.items[this.stackTop];\n  this.currentTagName = this.current && this.treeAdapter.getTagName(this.current);\n  this.currentTmplContent = this._isInTemplate() ? this.treeAdapter.getChildNodes(this.current)[0] : null;\n}; //Mutations\n\n\nOpenElementStack.prototype.push = function (element) {\n  this.items[++this.stackTop] = element;\n\n  this._updateCurrentElement();\n\n  if (this._isInTemplate()) this.tmplCount++;\n};\n\nOpenElementStack.prototype.pop = function () {\n  this.stackTop--;\n  if (this.tmplCount > 0 && this._isInTemplate()) this.tmplCount--;\n\n  this._updateCurrentElement();\n};\n\nOpenElementStack.prototype.replace = function (oldElement, newElement) {\n  var idx = this._indexOf(oldElement);\n\n  this.items[idx] = newElement;\n  if (idx === this.stackTop) this._updateCurrentElement();\n};\n\nOpenElementStack.prototype.insertAfter = function (referenceElement, newElement) {\n  var insertionIdx = this._indexOf(referenceElement) + 1;\n  this.items.splice(insertionIdx, 0, newElement);\n  if (insertionIdx == ++this.stackTop) this._updateCurrentElement();\n};\n\nOpenElementStack.prototype.popUntilTagNamePopped = function (tagName) {\n  while (this.stackTop > -1) {\n    var tn = this.currentTagName;\n    this.pop();\n    if (tn === tagName) break;\n  }\n};\n\nOpenElementStack.prototype.popUntilTemplatePopped = function () {\n  while (this.stackTop > -1) {\n    var tn = this.currentTagName,\n        ns = this.treeAdapter.getNamespaceURI(this.current);\n    this.pop();\n    if (tn === $.TEMPLATE && ns === NS.HTML) break;\n  }\n};\n\nOpenElementStack.prototype.popUntilElementPopped = function (element) {\n  while (this.stackTop > -1) {\n    var poppedElement = this.current;\n    this.pop();\n    if (poppedElement === element) break;\n  }\n};\n\nOpenElementStack.prototype.popUntilNumberedHeaderPopped = function () {\n  while (this.stackTop > -1) {\n    var tn = this.currentTagName;\n    this.pop();\n    if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) break;\n  }\n};\n\nOpenElementStack.prototype.popAllUpToHtmlElement = function () {\n  //NOTE: here we assume that root <html> element is always first in the open element stack, so\n  //we perform this fast stack clean up.\n  this.stackTop = 0;\n\n  this._updateCurrentElement();\n};\n\nOpenElementStack.prototype.clearBackToTableContext = function () {\n  while (this.currentTagName !== $.TABLE && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML) this.pop();\n};\n\nOpenElementStack.prototype.clearBackToTableBodyContext = function () {\n  while (this.currentTagName !== $.TBODY && this.currentTagName !== $.TFOOT && this.currentTagName !== $.THEAD && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML) {\n    this.pop();\n  }\n};\n\nOpenElementStack.prototype.clearBackToTableRowContext = function () {\n  while (this.currentTagName !== $.TR && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML) this.pop();\n};\n\nOpenElementStack.prototype.remove = function (element) {\n  for (var i = this.stackTop; i >= 0; i--) {\n    if (this.items[i] === element) {\n      this.items.splice(i, 1);\n      this.stackTop--;\n\n      this._updateCurrentElement();\n\n      break;\n    }\n  }\n}; //Search\n\n\nOpenElementStack.prototype.tryPeekProperlyNestedBodyElement = function () {\n  //Properly nested <body> element (should be second element in stack).\n  var element = this.items[1];\n  return element && this.treeAdapter.getTagName(element) === $.BODY ? element : null;\n};\n\nOpenElementStack.prototype.contains = function (element) {\n  return this._indexOf(element) > -1;\n};\n\nOpenElementStack.prototype.getCommonAncestor = function (element) {\n  var elementIdx = this._indexOf(element);\n\n  return --elementIdx >= 0 ? this.items[elementIdx] : null;\n};\n\nOpenElementStack.prototype.isRootHtmlElementCurrent = function () {\n  return this.stackTop === 0 && this.currentTagName === $.HTML;\n}; //Element in scope\n\n\nOpenElementStack.prototype.hasInScope = function (tagName) {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]);\n    if (tn === tagName) return true;\n    var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n    if (isScopingElement(tn, ns)) return false;\n  }\n\n  return true;\n};\n\nOpenElementStack.prototype.hasNumberedHeaderInScope = function () {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]);\n    if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) return true;\n    if (isScopingElement(tn, this.treeAdapter.getNamespaceURI(this.items[i]))) return false;\n  }\n\n  return true;\n};\n\nOpenElementStack.prototype.hasInListItemScope = function (tagName) {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]);\n    if (tn === tagName) return true;\n    var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n    if ((tn === $.UL || tn === $.OL) && ns === NS.HTML || isScopingElement(tn, ns)) return false;\n  }\n\n  return true;\n};\n\nOpenElementStack.prototype.hasInButtonScope = function (tagName) {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]);\n    if (tn === tagName) return true;\n    var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n    if (tn === $.BUTTON && ns === NS.HTML || isScopingElement(tn, ns)) return false;\n  }\n\n  return true;\n};\n\nOpenElementStack.prototype.hasInTableScope = function (tagName) {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]);\n    if (tn === tagName) return true;\n    var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n    if ((tn === $.TABLE || tn === $.TEMPLATE || tn === $.HTML) && ns === NS.HTML) return false;\n  }\n\n  return true;\n};\n\nOpenElementStack.prototype.hasTableBodyContextInTableScope = function () {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]);\n    if (tn === $.TBODY || tn === $.THEAD || tn === $.TFOOT) return true;\n    var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n    if ((tn === $.TABLE || tn === $.HTML) && ns === NS.HTML) return false;\n  }\n\n  return true;\n};\n\nOpenElementStack.prototype.hasInSelectScope = function (tagName) {\n  for (var i = this.stackTop; i >= 0; i--) {\n    var tn = this.treeAdapter.getTagName(this.items[i]);\n    if (tn === tagName) return true;\n    var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n    if (tn !== $.OPTION && tn !== $.OPTGROUP && ns === NS.HTML) return false;\n  }\n\n  return true;\n}; //Implied end tags\n\n\nOpenElementStack.prototype.generateImpliedEndTags = function () {\n  while (isImpliedEndTagRequired(this.currentTagName)) this.pop();\n};\n\nOpenElementStack.prototype.generateImpliedEndTagsWithExclusion = function (exclusionTagName) {\n  while (isImpliedEndTagRequired(this.currentTagName) && this.currentTagName !== exclusionTagName) this.pop();\n};","map":{"version":3,"sources":["F:/JavaScript/Projects/chemistryphile/node_modules/jsdom-no-contextify/node_modules/parse5/lib/tree_construction/open_element_stack.js"],"names":["HTML","require","$","TAG_NAMES","NS","NAMESPACES","isImpliedEndTagRequired","tn","length","P","RP","RT","DD","DT","LI","OPTION","OPTGROUP","isScopingElement","ns","TD","TH","MI","MO","MN","MS","MATHML","DESC","SVG","TABLE","MTEXT","TITLE","APPLET","OBJECT","CAPTION","MARQUEE","TEMPLATE","FOREIGN_OBJECT","ANNOTATION_XML","OpenElementStack","module","exports","document","treeAdapter","stackTop","items","current","currentTagName","currentTmplContent","tmplCount","prototype","_indexOf","element","idx","i","_isInTemplate","getNamespaceURI","_updateCurrentElement","getTagName","getChildNodes","push","pop","replace","oldElement","newElement","insertAfter","referenceElement","insertionIdx","splice","popUntilTagNamePopped","tagName","popUntilTemplatePopped","popUntilElementPopped","poppedElement","popUntilNumberedHeaderPopped","H1","H2","H3","H4","H5","H6","popAllUpToHtmlElement","clearBackToTableContext","clearBackToTableBodyContext","TBODY","TFOOT","THEAD","clearBackToTableRowContext","TR","remove","tryPeekProperlyNestedBodyElement","BODY","contains","getCommonAncestor","elementIdx","isRootHtmlElementCurrent","hasInScope","hasNumberedHeaderInScope","hasInListItemScope","UL","OL","hasInButtonScope","BUTTON","hasInTableScope","hasTableBodyContextInTableScope","hasInSelectScope","generateImpliedEndTags","generateImpliedEndTagsWithExclusion","exclusionTagName"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nvar HTML = require('../common/html');\r\n\r\n//Aliases\r\nvar $ = HTML.TAG_NAMES,\r\n    NS = HTML.NAMESPACES;\r\n\r\n//Element utils\r\n\r\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\r\n//It's faster than using dictionary.\r\nfunction isImpliedEndTagRequired(tn) {\r\n    switch (tn.length) {\r\n        case 1:\r\n            return tn === $.P;\r\n\r\n        case 2:\r\n            return tn === $.RP || tn === $.RT || tn === $.DD || tn === $.DT || tn === $.LI;\r\n\r\n        case 6:\r\n            return tn === $.OPTION;\r\n\r\n        case 8:\r\n            return tn === $.OPTGROUP;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfunction isScopingElement(tn, ns) {\r\n    switch (tn.length) {\r\n        case 2:\r\n            if (tn === $.TD || tn === $.TH)\r\n                return ns === NS.HTML;\r\n\r\n            else if (tn === $.MI || tn === $.MO || tn == $.MN || tn === $.MS)\r\n                return ns === NS.MATHML;\r\n\r\n            break;\r\n\r\n        case 4:\r\n            if (tn === $.HTML)\r\n                return ns === NS.HTML;\r\n\r\n            else if (tn === $.DESC)\r\n                return ns === NS.SVG;\r\n\r\n            break;\r\n\r\n        case 5:\r\n            if (tn === $.TABLE)\r\n                return ns === NS.HTML;\r\n\r\n            else if (tn === $.MTEXT)\r\n                return ns === NS.MATHML;\r\n\r\n            else if (tn === $.TITLE)\r\n                return ns === NS.SVG;\r\n\r\n            break;\r\n\r\n        case 6:\r\n            return (tn === $.APPLET || tn === $.OBJECT) && ns === NS.HTML;\r\n\r\n        case 7:\r\n            return (tn === $.CAPTION || tn === $.MARQUEE) && ns === NS.HTML;\r\n\r\n        case 8:\r\n            return tn === $.TEMPLATE && ns === NS.HTML;\r\n\r\n        case 13:\r\n            return tn === $.FOREIGN_OBJECT && ns === NS.SVG;\r\n\r\n        case 14:\r\n            return tn === $.ANNOTATION_XML && ns === NS.MATHML;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n//Stack of open elements\r\nvar OpenElementStack = module.exports = function (document, treeAdapter) {\r\n    this.stackTop = -1;\r\n    this.items = [];\r\n    this.current = document;\r\n    this.currentTagName = null;\r\n    this.currentTmplContent = null;\r\n    this.tmplCount = 0;\r\n    this.treeAdapter = treeAdapter;\r\n};\r\n\r\n//Index of element\r\nOpenElementStack.prototype._indexOf = function (element) {\r\n    var idx = -1;\r\n\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        if (this.items[i] === element) {\r\n            idx = i;\r\n            break;\r\n        }\r\n    }\r\n    return idx;\r\n};\r\n\r\n//Update current element\r\nOpenElementStack.prototype._isInTemplate = function () {\r\n    if (this.currentTagName !== $.TEMPLATE)\r\n        return false;\r\n\r\n    return this.treeAdapter.getNamespaceURI(this.current) === NS.HTML;\r\n};\r\n\r\nOpenElementStack.prototype._updateCurrentElement = function () {\r\n    this.current = this.items[this.stackTop];\r\n    this.currentTagName = this.current && this.treeAdapter.getTagName(this.current);\r\n\r\n    this.currentTmplContent = this._isInTemplate() ? this.treeAdapter.getChildNodes(this.current)[0] : null;\r\n};\r\n\r\n//Mutations\r\nOpenElementStack.prototype.push = function (element) {\r\n    this.items[++this.stackTop] = element;\r\n    this._updateCurrentElement();\r\n\r\n    if (this._isInTemplate())\r\n        this.tmplCount++;\r\n\r\n};\r\n\r\nOpenElementStack.prototype.pop = function () {\r\n    this.stackTop--;\r\n\r\n    if (this.tmplCount > 0 && this._isInTemplate())\r\n        this.tmplCount--;\r\n\r\n    this._updateCurrentElement();\r\n};\r\n\r\nOpenElementStack.prototype.replace = function (oldElement, newElement) {\r\n    var idx = this._indexOf(oldElement);\r\n    this.items[idx] = newElement;\r\n\r\n    if (idx === this.stackTop)\r\n        this._updateCurrentElement();\r\n};\r\n\r\nOpenElementStack.prototype.insertAfter = function (referenceElement, newElement) {\r\n    var insertionIdx = this._indexOf(referenceElement) + 1;\r\n\r\n    this.items.splice(insertionIdx, 0, newElement);\r\n\r\n    if (insertionIdx == ++this.stackTop)\r\n        this._updateCurrentElement();\r\n};\r\n\r\nOpenElementStack.prototype.popUntilTagNamePopped = function (tagName) {\r\n    while (this.stackTop > -1) {\r\n        var tn = this.currentTagName;\r\n\r\n        this.pop();\r\n\r\n        if (tn === tagName)\r\n            break;\r\n    }\r\n};\r\n\r\nOpenElementStack.prototype.popUntilTemplatePopped = function () {\r\n    while (this.stackTop > -1) {\r\n        var tn = this.currentTagName,\r\n            ns = this.treeAdapter.getNamespaceURI(this.current);\r\n\r\n        this.pop();\r\n\r\n        if (tn === $.TEMPLATE && ns === NS.HTML)\r\n            break;\r\n    }\r\n};\r\n\r\nOpenElementStack.prototype.popUntilElementPopped = function (element) {\r\n    while (this.stackTop > -1) {\r\n        var poppedElement = this.current;\r\n\r\n        this.pop();\r\n\r\n        if (poppedElement === element)\r\n            break;\r\n    }\r\n};\r\n\r\nOpenElementStack.prototype.popUntilNumberedHeaderPopped = function () {\r\n    while (this.stackTop > -1) {\r\n        var tn = this.currentTagName;\r\n\r\n        this.pop();\r\n\r\n        if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6)\r\n            break;\r\n    }\r\n};\r\n\r\nOpenElementStack.prototype.popAllUpToHtmlElement = function () {\r\n    //NOTE: here we assume that root <html> element is always first in the open element stack, so\r\n    //we perform this fast stack clean up.\r\n    this.stackTop = 0;\r\n    this._updateCurrentElement();\r\n};\r\n\r\nOpenElementStack.prototype.clearBackToTableContext = function () {\r\n    while (this.currentTagName !== $.TABLE && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML)\r\n        this.pop();\r\n};\r\n\r\nOpenElementStack.prototype.clearBackToTableBodyContext = function () {\r\n    while (this.currentTagName !== $.TBODY && this.currentTagName !== $.TFOOT &&\r\n           this.currentTagName !== $.THEAD && this.currentTagName !== $.TEMPLATE &&\r\n           this.currentTagName !== $.HTML) {\r\n        this.pop();\r\n    }\r\n};\r\n\r\nOpenElementStack.prototype.clearBackToTableRowContext = function () {\r\n    while (this.currentTagName !== $.TR && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML)\r\n        this.pop();\r\n};\r\n\r\nOpenElementStack.prototype.remove = function (element) {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        if (this.items[i] === element) {\r\n            this.items.splice(i, 1);\r\n            this.stackTop--;\r\n            this._updateCurrentElement();\r\n            break;\r\n        }\r\n    }\r\n};\r\n\r\n//Search\r\nOpenElementStack.prototype.tryPeekProperlyNestedBodyElement = function () {\r\n    //Properly nested <body> element (should be second element in stack).\r\n    var element = this.items[1];\r\n    return element && this.treeAdapter.getTagName(element) === $.BODY ? element : null;\r\n};\r\n\r\nOpenElementStack.prototype.contains = function (element) {\r\n    return this._indexOf(element) > -1;\r\n};\r\n\r\nOpenElementStack.prototype.getCommonAncestor = function (element) {\r\n    var elementIdx = this._indexOf(element);\r\n\r\n    return --elementIdx >= 0 ? this.items[elementIdx] : null;\r\n};\r\n\r\nOpenElementStack.prototype.isRootHtmlElementCurrent = function () {\r\n    return this.stackTop === 0 && this.currentTagName === $.HTML;\r\n};\r\n\r\n//Element in scope\r\nOpenElementStack.prototype.hasInScope = function (tagName) {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === tagName)\r\n            return true;\r\n\r\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\r\n\r\n        if (isScopingElement(tn, ns))\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nOpenElementStack.prototype.hasNumberedHeaderInScope = function () {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6)\r\n            return true;\r\n\r\n        if (isScopingElement(tn, this.treeAdapter.getNamespaceURI(this.items[i])))\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nOpenElementStack.prototype.hasInListItemScope = function (tagName) {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === tagName)\r\n            return true;\r\n\r\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\r\n\r\n        if (((tn === $.UL || tn === $.OL) && ns === NS.HTML) || isScopingElement(tn, ns))\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nOpenElementStack.prototype.hasInButtonScope = function (tagName) {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === tagName)\r\n            return true;\r\n\r\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\r\n\r\n        if ((tn === $.BUTTON && ns === NS.HTML) || isScopingElement(tn, ns))\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nOpenElementStack.prototype.hasInTableScope = function (tagName) {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === tagName)\r\n            return true;\r\n\r\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\r\n\r\n        if ((tn === $.TABLE || tn === $.TEMPLATE || tn === $.HTML) && ns === NS.HTML)\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nOpenElementStack.prototype.hasTableBodyContextInTableScope = function () {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === $.TBODY || tn === $.THEAD || tn === $.TFOOT)\r\n            return true;\r\n\r\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\r\n\r\n        if ((tn === $.TABLE || tn === $.HTML) && ns === NS.HTML)\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nOpenElementStack.prototype.hasInSelectScope = function (tagName) {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === tagName)\r\n            return true;\r\n\r\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\r\n\r\n        if (tn !== $.OPTION && tn !== $.OPTGROUP && ns === NS.HTML)\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n//Implied end tags\r\nOpenElementStack.prototype.generateImpliedEndTags = function () {\r\n    while (isImpliedEndTagRequired(this.currentTagName))\r\n        this.pop();\r\n};\r\n\r\nOpenElementStack.prototype.generateImpliedEndTagsWithExclusion = function (exclusionTagName) {\r\n    while (isImpliedEndTagRequired(this.currentTagName) && this.currentTagName !== exclusionTagName)\r\n        this.pop();\r\n};\r\n"]},"metadata":{},"sourceType":"script"}