{"ast":null,"code":"'use strict';\n\nvar Tokenizer = require('../tokenization/tokenizer'),\n    OpenElementStack = require('./open_element_stack'),\n    FormattingElementList = require('./formatting_element_list'),\n    LocationInfoMixin = require('./location_info_mixin'),\n    DefaultTreeAdapter = require('../tree_adapters/default'),\n    Doctype = require('../common/doctype'),\n    ForeignContent = require('../common/foreign_content'),\n    Utils = require('../common/utils'),\n    UNICODE = require('../common/unicode'),\n    HTML = require('../common/html'); //Aliases\n\n\nvar $ = HTML.TAG_NAMES,\n    NS = HTML.NAMESPACES,\n    ATTRS = HTML.ATTRS; //Default options\n\nvar DEFAULT_OPTIONS = {\n  decodeHtmlEntities: true,\n  locationInfo: false\n}; //Misc constants\n\nvar SEARCHABLE_INDEX_DEFAULT_PROMPT = 'This is a searchable index. Enter search keywords: ',\n    SEARCHABLE_INDEX_INPUT_NAME = 'isindex',\n    HIDDEN_INPUT_TYPE = 'hidden'; //Adoption agency loops iteration count\n\nvar AA_OUTER_LOOP_ITER = 8,\n    AA_INNER_LOOP_ITER = 3; //Insertion modes\n\nvar INITIAL_MODE = 'INITIAL_MODE',\n    BEFORE_HTML_MODE = 'BEFORE_HTML_MODE',\n    BEFORE_HEAD_MODE = 'BEFORE_HEAD_MODE',\n    IN_HEAD_MODE = 'IN_HEAD_MODE',\n    AFTER_HEAD_MODE = 'AFTER_HEAD_MODE',\n    IN_BODY_MODE = 'IN_BODY_MODE',\n    TEXT_MODE = 'TEXT_MODE',\n    IN_TABLE_MODE = 'IN_TABLE_MODE',\n    IN_TABLE_TEXT_MODE = 'IN_TABLE_TEXT_MODE',\n    IN_CAPTION_MODE = 'IN_CAPTION_MODE',\n    IN_COLUMN_GROUP_MODE = 'IN_COLUMN_GROUP_MODE',\n    IN_TABLE_BODY_MODE = 'IN_TABLE_BODY_MODE',\n    IN_ROW_MODE = 'IN_ROW_MODE',\n    IN_CELL_MODE = 'IN_CELL_MODE',\n    IN_SELECT_MODE = 'IN_SELECT_MODE',\n    IN_SELECT_IN_TABLE_MODE = 'IN_SELECT_IN_TABLE_MODE',\n    IN_TEMPLATE_MODE = 'IN_TEMPLATE_MODE',\n    AFTER_BODY_MODE = 'AFTER_BODY_MODE',\n    IN_FRAMESET_MODE = 'IN_FRAMESET_MODE',\n    AFTER_FRAMESET_MODE = 'AFTER_FRAMESET_MODE',\n    AFTER_AFTER_BODY_MODE = 'AFTER_AFTER_BODY_MODE',\n    AFTER_AFTER_FRAMESET_MODE = 'AFTER_AFTER_FRAMESET_MODE'; //Insertion mode reset map\n\nvar INSERTION_MODE_RESET_MAP = {};\nINSERTION_MODE_RESET_MAP[$.TR] = IN_ROW_MODE;\nINSERTION_MODE_RESET_MAP[$.TBODY] = INSERTION_MODE_RESET_MAP[$.THEAD] = INSERTION_MODE_RESET_MAP[$.TFOOT] = IN_TABLE_BODY_MODE;\nINSERTION_MODE_RESET_MAP[$.CAPTION] = IN_CAPTION_MODE;\nINSERTION_MODE_RESET_MAP[$.COLGROUP] = IN_COLUMN_GROUP_MODE;\nINSERTION_MODE_RESET_MAP[$.TABLE] = IN_TABLE_MODE;\nINSERTION_MODE_RESET_MAP[$.BODY] = IN_BODY_MODE;\nINSERTION_MODE_RESET_MAP[$.FRAMESET] = IN_FRAMESET_MODE; //Template insertion mode switch map\n\nvar TEMPLATE_INSERTION_MODE_SWITCH_MAP = {};\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.CAPTION] = TEMPLATE_INSERTION_MODE_SWITCH_MAP[$.COLGROUP] = TEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TBODY] = TEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TFOOT] = TEMPLATE_INSERTION_MODE_SWITCH_MAP[$.THEAD] = IN_TABLE_MODE;\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.COL] = IN_COLUMN_GROUP_MODE;\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TR] = IN_TABLE_BODY_MODE;\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TD] = TEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TH] = IN_ROW_MODE; //Token handlers map for insertion modes\n\nvar _ = {};\n_[INITIAL_MODE] = {};\n_[INITIAL_MODE][Tokenizer.CHARACTER_TOKEN] = _[INITIAL_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenInInitialMode;\n_[INITIAL_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = ignoreToken;\n_[INITIAL_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[INITIAL_MODE][Tokenizer.DOCTYPE_TOKEN] = doctypeInInitialMode;\n_[INITIAL_MODE][Tokenizer.START_TAG_TOKEN] = _[INITIAL_MODE][Tokenizer.END_TAG_TOKEN] = _[INITIAL_MODE][Tokenizer.EOF_TOKEN] = tokenInInitialMode;\n_[BEFORE_HTML_MODE] = {};\n_[BEFORE_HTML_MODE][Tokenizer.CHARACTER_TOKEN] = _[BEFORE_HTML_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenBeforeHtml;\n_[BEFORE_HTML_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = ignoreToken;\n_[BEFORE_HTML_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[BEFORE_HTML_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[BEFORE_HTML_MODE][Tokenizer.START_TAG_TOKEN] = startTagBeforeHtml;\n_[BEFORE_HTML_MODE][Tokenizer.END_TAG_TOKEN] = endTagBeforeHtml;\n_[BEFORE_HTML_MODE][Tokenizer.EOF_TOKEN] = tokenBeforeHtml;\n_[BEFORE_HEAD_MODE] = {};\n_[BEFORE_HEAD_MODE][Tokenizer.CHARACTER_TOKEN] = _[BEFORE_HEAD_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenBeforeHead;\n_[BEFORE_HEAD_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = ignoreToken;\n_[BEFORE_HEAD_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[BEFORE_HEAD_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[BEFORE_HEAD_MODE][Tokenizer.START_TAG_TOKEN] = startTagBeforeHead;\n_[BEFORE_HEAD_MODE][Tokenizer.END_TAG_TOKEN] = endTagBeforeHead;\n_[BEFORE_HEAD_MODE][Tokenizer.EOF_TOKEN] = tokenBeforeHead;\n_[IN_HEAD_MODE] = {};\n_[IN_HEAD_MODE][Tokenizer.CHARACTER_TOKEN] = _[IN_HEAD_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenInHead;\n_[IN_HEAD_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[IN_HEAD_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_HEAD_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_HEAD_MODE][Tokenizer.START_TAG_TOKEN] = startTagInHead;\n_[IN_HEAD_MODE][Tokenizer.END_TAG_TOKEN] = endTagInHead;\n_[IN_HEAD_MODE][Tokenizer.EOF_TOKEN] = tokenInHead;\n_[AFTER_HEAD_MODE] = {};\n_[AFTER_HEAD_MODE][Tokenizer.CHARACTER_TOKEN] = _[AFTER_HEAD_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenAfterHead;\n_[AFTER_HEAD_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[AFTER_HEAD_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[AFTER_HEAD_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[AFTER_HEAD_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterHead;\n_[AFTER_HEAD_MODE][Tokenizer.END_TAG_TOKEN] = endTagAfterHead;\n_[AFTER_HEAD_MODE][Tokenizer.EOF_TOKEN] = tokenAfterHead;\n_[IN_BODY_MODE] = {};\n_[IN_BODY_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\n_[IN_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[IN_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagInBody;\n_[IN_BODY_MODE][Tokenizer.END_TAG_TOKEN] = endTagInBody;\n_[IN_BODY_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[TEXT_MODE] = {};\n_[TEXT_MODE][Tokenizer.CHARACTER_TOKEN] = _[TEXT_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = _[TEXT_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[TEXT_MODE][Tokenizer.COMMENT_TOKEN] = _[TEXT_MODE][Tokenizer.DOCTYPE_TOKEN] = _[TEXT_MODE][Tokenizer.START_TAG_TOKEN] = ignoreToken;\n_[TEXT_MODE][Tokenizer.END_TAG_TOKEN] = endTagInText;\n_[TEXT_MODE][Tokenizer.EOF_TOKEN] = eofInText;\n_[IN_TABLE_MODE] = {};\n_[IN_TABLE_MODE][Tokenizer.CHARACTER_TOKEN] = _[IN_TABLE_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = _[IN_TABLE_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = characterInTable;\n_[IN_TABLE_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_TABLE_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_TABLE_MODE][Tokenizer.START_TAG_TOKEN] = startTagInTable;\n_[IN_TABLE_MODE][Tokenizer.END_TAG_TOKEN] = endTagInTable;\n_[IN_TABLE_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_TABLE_TEXT_MODE] = {};\n_[IN_TABLE_TEXT_MODE][Tokenizer.CHARACTER_TOKEN] = characterInTableText;\n_[IN_TABLE_TEXT_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_TABLE_TEXT_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInTableText;\n_[IN_TABLE_TEXT_MODE][Tokenizer.COMMENT_TOKEN] = _[IN_TABLE_TEXT_MODE][Tokenizer.DOCTYPE_TOKEN] = _[IN_TABLE_TEXT_MODE][Tokenizer.START_TAG_TOKEN] = _[IN_TABLE_TEXT_MODE][Tokenizer.END_TAG_TOKEN] = _[IN_TABLE_TEXT_MODE][Tokenizer.EOF_TOKEN] = tokenInTableText;\n_[IN_CAPTION_MODE] = {};\n_[IN_CAPTION_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\n_[IN_CAPTION_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_CAPTION_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[IN_CAPTION_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_CAPTION_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_CAPTION_MODE][Tokenizer.START_TAG_TOKEN] = startTagInCaption;\n_[IN_CAPTION_MODE][Tokenizer.END_TAG_TOKEN] = endTagInCaption;\n_[IN_CAPTION_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_COLUMN_GROUP_MODE] = {};\n_[IN_COLUMN_GROUP_MODE][Tokenizer.CHARACTER_TOKEN] = _[IN_COLUMN_GROUP_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenInColumnGroup;\n_[IN_COLUMN_GROUP_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[IN_COLUMN_GROUP_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_COLUMN_GROUP_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_COLUMN_GROUP_MODE][Tokenizer.START_TAG_TOKEN] = startTagInColumnGroup;\n_[IN_COLUMN_GROUP_MODE][Tokenizer.END_TAG_TOKEN] = endTagInColumnGroup;\n_[IN_COLUMN_GROUP_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_TABLE_BODY_MODE] = {};\n_[IN_TABLE_BODY_MODE][Tokenizer.CHARACTER_TOKEN] = _[IN_TABLE_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = _[IN_TABLE_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = characterInTable;\n_[IN_TABLE_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_TABLE_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_TABLE_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagInTableBody;\n_[IN_TABLE_BODY_MODE][Tokenizer.END_TAG_TOKEN] = endTagInTableBody;\n_[IN_TABLE_BODY_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_ROW_MODE] = {};\n_[IN_ROW_MODE][Tokenizer.CHARACTER_TOKEN] = _[IN_ROW_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = _[IN_ROW_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = characterInTable;\n_[IN_ROW_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_ROW_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_ROW_MODE][Tokenizer.START_TAG_TOKEN] = startTagInRow;\n_[IN_ROW_MODE][Tokenizer.END_TAG_TOKEN] = endTagInRow;\n_[IN_ROW_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_CELL_MODE] = {};\n_[IN_CELL_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\n_[IN_CELL_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_CELL_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[IN_CELL_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_CELL_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_CELL_MODE][Tokenizer.START_TAG_TOKEN] = startTagInCell;\n_[IN_CELL_MODE][Tokenizer.END_TAG_TOKEN] = endTagInCell;\n_[IN_CELL_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_SELECT_MODE] = {};\n_[IN_SELECT_MODE][Tokenizer.CHARACTER_TOKEN] = insertCharacters;\n_[IN_SELECT_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_SELECT_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[IN_SELECT_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_SELECT_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_SELECT_MODE][Tokenizer.START_TAG_TOKEN] = startTagInSelect;\n_[IN_SELECT_MODE][Tokenizer.END_TAG_TOKEN] = endTagInSelect;\n_[IN_SELECT_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_SELECT_IN_TABLE_MODE] = {};\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.CHARACTER_TOKEN] = insertCharacters;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.START_TAG_TOKEN] = startTagInSelectInTable;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.END_TAG_TOKEN] = endTagInSelectInTable;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_TEMPLATE_MODE] = {};\n_[IN_TEMPLATE_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\n_[IN_TEMPLATE_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_TEMPLATE_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[IN_TEMPLATE_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_TEMPLATE_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_TEMPLATE_MODE][Tokenizer.START_TAG_TOKEN] = startTagInTemplate;\n_[IN_TEMPLATE_MODE][Tokenizer.END_TAG_TOKEN] = endTagInTemplate;\n_[IN_TEMPLATE_MODE][Tokenizer.EOF_TOKEN] = eofInTemplate;\n_[AFTER_BODY_MODE] = {};\n_[AFTER_BODY_MODE][Tokenizer.CHARACTER_TOKEN] = _[AFTER_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenAfterBody;\n_[AFTER_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[AFTER_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendCommentToRootHtmlElement;\n_[AFTER_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[AFTER_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterBody;\n_[AFTER_BODY_MODE][Tokenizer.END_TAG_TOKEN] = endTagAfterBody;\n_[AFTER_BODY_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\n_[IN_FRAMESET_MODE] = {};\n_[IN_FRAMESET_MODE][Tokenizer.CHARACTER_TOKEN] = _[IN_FRAMESET_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_FRAMESET_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[IN_FRAMESET_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_FRAMESET_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_FRAMESET_MODE][Tokenizer.START_TAG_TOKEN] = startTagInFrameset;\n_[IN_FRAMESET_MODE][Tokenizer.END_TAG_TOKEN] = endTagInFrameset;\n_[IN_FRAMESET_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\n_[AFTER_FRAMESET_MODE] = {};\n_[AFTER_FRAMESET_MODE][Tokenizer.CHARACTER_TOKEN] = _[AFTER_FRAMESET_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[AFTER_FRAMESET_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[AFTER_FRAMESET_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[AFTER_FRAMESET_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[AFTER_FRAMESET_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterFrameset;\n_[AFTER_FRAMESET_MODE][Tokenizer.END_TAG_TOKEN] = endTagAfterFrameset;\n_[AFTER_FRAMESET_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\n_[AFTER_AFTER_BODY_MODE] = {};\n_[AFTER_AFTER_BODY_MODE][Tokenizer.CHARACTER_TOKEN] = tokenAfterAfterBody;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenAfterAfterBody;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendCommentToDocument;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterAfterBody;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.END_TAG_TOKEN] = tokenAfterAfterBody;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\n_[AFTER_AFTER_FRAMESET_MODE] = {};\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.CHARACTER_TOKEN] = _[AFTER_AFTER_FRAMESET_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.COMMENT_TOKEN] = appendCommentToDocument;\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterAfterFrameset;\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.END_TAG_TOKEN] = ignoreToken;\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.EOF_TOKEN] = stopParsing; //Searchable index building utils (<isindex> tag)\n\nfunction getSearchableIndexFormAttrs(isindexStartTagToken) {\n  var indexAction = Tokenizer.getTokenAttr(isindexStartTagToken, ATTRS.ACTION),\n      attrs = [];\n\n  if (indexAction !== null) {\n    attrs.push({\n      name: ATTRS.ACTION,\n      value: indexAction\n    });\n  }\n\n  return attrs;\n}\n\nfunction getSearchableIndexLabelText(isindexStartTagToken) {\n  var indexPrompt = Tokenizer.getTokenAttr(isindexStartTagToken, ATTRS.PROMPT);\n  return indexPrompt === null ? SEARCHABLE_INDEX_DEFAULT_PROMPT : indexPrompt;\n}\n\nfunction getSearchableIndexInputAttrs(isindexStartTagToken) {\n  var isindexAttrs = isindexStartTagToken.attrs,\n      inputAttrs = [];\n\n  for (var i = 0; i < isindexAttrs.length; i++) {\n    var name = isindexAttrs[i].name;\n    if (name !== ATTRS.NAME && name !== ATTRS.ACTION && name !== ATTRS.PROMPT) inputAttrs.push(isindexAttrs[i]);\n  }\n\n  inputAttrs.push({\n    name: ATTRS.NAME,\n    value: SEARCHABLE_INDEX_INPUT_NAME\n  });\n  return inputAttrs;\n} //Parser\n\n\nvar Parser = module.exports = function (treeAdapter, options) {\n  this.treeAdapter = treeAdapter || DefaultTreeAdapter;\n  this.options = Utils.mergeOptions(DEFAULT_OPTIONS, options);\n  this.scriptHandler = null;\n  if (this.options.locationInfo) LocationInfoMixin.assign(this);\n}; //API\n\n\nParser.prototype.parse = function (html) {\n  var document = this.treeAdapter.createDocument();\n\n  this._reset(html, document, null);\n\n  this._runParsingLoop();\n\n  return document;\n};\n\nParser.prototype.parseFragment = function (html, fragmentContext) {\n  //NOTE: use <template> element as a fragment context if context element was not provided,\n  //so we will parse in \"forgiving\" manner\n  if (!fragmentContext) fragmentContext = this.treeAdapter.createElement($.TEMPLATE, NS.HTML, []); //NOTE: create fake element which will be used as 'document' for fragment parsing.\n  //This is important for jsdom there 'document' can't be recreated, therefore\n  //fragment parsing causes messing of the main `document`.\n\n  var documentMock = this.treeAdapter.createElement('documentmock', NS.HTML, []);\n\n  this._reset(html, documentMock, fragmentContext);\n\n  if (this.treeAdapter.getTagName(fragmentContext) === $.TEMPLATE) this._pushTmplInsertionMode(IN_TEMPLATE_MODE);\n\n  this._initTokenizerForFragmentParsing();\n\n  this._insertFakeRootElement();\n\n  this._resetInsertionMode();\n\n  this._findFormInFragmentContext();\n\n  this._runParsingLoop();\n\n  var rootElement = this.treeAdapter.getFirstChild(documentMock),\n      fragment = this.treeAdapter.createDocumentFragment();\n\n  this._adoptNodes(rootElement, fragment);\n\n  return fragment;\n}; //Reset state\n\n\nParser.prototype._reset = function (html, document, fragmentContext) {\n  this.tokenizer = new Tokenizer(html, this.options);\n  this.stopped = false;\n  this.insertionMode = INITIAL_MODE;\n  this.originalInsertionMode = '';\n  this.document = document;\n  this.fragmentContext = fragmentContext;\n  this.headElement = null;\n  this.formElement = null;\n  this.openElements = new OpenElementStack(this.document, this.treeAdapter);\n  this.activeFormattingElements = new FormattingElementList(this.treeAdapter);\n  this.tmplInsertionModeStack = [];\n  this.tmplInsertionModeStackTop = -1;\n  this.currentTmplInsertionMode = null;\n  this.pendingCharacterTokens = [];\n  this.hasNonWhitespacePendingCharacterToken = false;\n  this.framesetOk = true;\n  this.skipNextNewLine = false;\n  this.fosterParentingEnabled = false;\n}; //Parsing loop\n\n\nParser.prototype._iterateParsingLoop = function () {\n  this._setupTokenizerCDATAMode();\n\n  var token = this.tokenizer.getNextToken();\n\n  if (this.skipNextNewLine) {\n    this.skipNextNewLine = false;\n\n    if (token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN && token.chars[0] === '\\n') {\n      if (token.chars.length === 1) return;\n      token.chars = token.chars.substr(1);\n    }\n  }\n\n  if (this._shouldProcessTokenInForeignContent(token)) this._processTokenInForeignContent(token);else this._processToken(token);\n};\n\nParser.prototype._runParsingLoop = function () {\n  while (!this.stopped) this._iterateParsingLoop();\n}; //Text parsing\n\n\nParser.prototype._setupTokenizerCDATAMode = function () {\n  var current = this._getAdjustedCurrentElement();\n\n  this.tokenizer.allowCDATA = current && current !== this.document && this.treeAdapter.getNamespaceURI(current) !== NS.HTML && !this._isHtmlIntegrationPoint(current) && !this._isMathMLTextIntegrationPoint(current);\n};\n\nParser.prototype._switchToTextParsing = function (currentToken, nextTokenizerState) {\n  this._insertElement(currentToken, NS.HTML);\n\n  this.tokenizer.state = nextTokenizerState;\n  this.originalInsertionMode = this.insertionMode;\n  this.insertionMode = TEXT_MODE;\n}; //Fragment parsing\n\n\nParser.prototype._getAdjustedCurrentElement = function () {\n  return this.openElements.stackTop === 0 && this.fragmentContext ? this.fragmentContext : this.openElements.current;\n};\n\nParser.prototype._findFormInFragmentContext = function () {\n  var node = this.fragmentContext;\n\n  do {\n    if (this.treeAdapter.getTagName(node) === $.FORM) {\n      this.formElement = node;\n      break;\n    }\n\n    node = this.treeAdapter.getParentNode(node);\n  } while (node);\n};\n\nParser.prototype._initTokenizerForFragmentParsing = function () {\n  var tn = this.treeAdapter.getTagName(this.fragmentContext);\n  if (tn === $.TITLE || tn === $.TEXTAREA) this.tokenizer.state = Tokenizer.MODE.RCDATA;else if (tn === $.STYLE || tn === $.XMP || tn === $.IFRAME || tn === $.NOEMBED || tn === $.NOFRAMES || tn === $.NOSCRIPT) {\n    this.tokenizer.state = Tokenizer.MODE.RAWTEXT;\n  } else if (tn === $.SCRIPT) this.tokenizer.state = Tokenizer.MODE.SCRIPT_DATA;else if (tn === $.PLAINTEXT) this.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\n}; //Tree mutation\n\n\nParser.prototype._setDocumentType = function (token) {\n  this.treeAdapter.setDocumentType(this.document, token.name, token.publicId, token.systemId);\n};\n\nParser.prototype._attachElementToTree = function (element) {\n  if (this._shouldFosterParentOnInsertion()) this._fosterParentElement(element);else {\n    var parent = this.openElements.currentTmplContent || this.openElements.current;\n    this.treeAdapter.appendChild(parent, element);\n  }\n};\n\nParser.prototype._appendElement = function (token, namespaceURI) {\n  var element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n\n  this._attachElementToTree(element);\n};\n\nParser.prototype._insertElement = function (token, namespaceURI) {\n  var element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n\n  this._attachElementToTree(element);\n\n  this.openElements.push(element);\n};\n\nParser.prototype._insertTemplate = function (token) {\n  var tmpl = this.treeAdapter.createElement(token.tagName, NS.HTML, token.attrs),\n      content = this.treeAdapter.createDocumentFragment();\n  this.treeAdapter.appendChild(tmpl, content);\n\n  this._attachElementToTree(tmpl);\n\n  this.openElements.push(tmpl);\n};\n\nParser.prototype._insertFakeRootElement = function () {\n  var element = this.treeAdapter.createElement($.HTML, NS.HTML, []);\n  this.treeAdapter.appendChild(this.openElements.current, element);\n  this.openElements.push(element);\n};\n\nParser.prototype._appendCommentNode = function (token, parent) {\n  var commentNode = this.treeAdapter.createCommentNode(token.data);\n  this.treeAdapter.appendChild(parent, commentNode);\n};\n\nParser.prototype._insertCharacters = function (token) {\n  if (this._shouldFosterParentOnInsertion()) this._fosterParentText(token.chars);else {\n    var parent = this.openElements.currentTmplContent || this.openElements.current;\n    this.treeAdapter.insertText(parent, token.chars);\n  }\n};\n\nParser.prototype._adoptNodes = function (donor, recipient) {\n  while (true) {\n    var child = this.treeAdapter.getFirstChild(donor);\n    if (!child) break;\n    this.treeAdapter.detachNode(child);\n    this.treeAdapter.appendChild(recipient, child);\n  }\n}; //Token processing\n\n\nParser.prototype._shouldProcessTokenInForeignContent = function (token) {\n  var current = this._getAdjustedCurrentElement();\n\n  if (!current || current === this.document) return false;\n  var ns = this.treeAdapter.getNamespaceURI(current);\n  if (ns === NS.HTML) return false;\n\n  if (this.treeAdapter.getTagName(current) === $.ANNOTATION_XML && ns === NS.MATHML && token.type === Tokenizer.START_TAG_TOKEN && token.tagName === $.SVG) {\n    return false;\n  }\n\n  var isCharacterToken = token.type === Tokenizer.CHARACTER_TOKEN || token.type === Tokenizer.NULL_CHARACTER_TOKEN || token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN,\n      isMathMLTextStartTag = token.type === Tokenizer.START_TAG_TOKEN && token.tagName !== $.MGLYPH && token.tagName !== $.MALIGNMARK;\n  if ((isMathMLTextStartTag || isCharacterToken) && this._isMathMLTextIntegrationPoint(current)) return false;\n  if ((token.type === Tokenizer.START_TAG_TOKEN || isCharacterToken) && this._isHtmlIntegrationPoint(current)) return false;\n  return token.type !== Tokenizer.EOF_TOKEN;\n};\n\nParser.prototype._processToken = function (token) {\n  _[this.insertionMode][token.type](this, token);\n};\n\nParser.prototype._processTokenInBodyMode = function (token) {\n  _[IN_BODY_MODE][token.type](this, token);\n};\n\nParser.prototype._processTokenInForeignContent = function (token) {\n  if (token.type === Tokenizer.CHARACTER_TOKEN) characterInForeignContent(this, token);else if (token.type === Tokenizer.NULL_CHARACTER_TOKEN) nullCharacterInForeignContent(this, token);else if (token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN) insertCharacters(this, token);else if (token.type === Tokenizer.COMMENT_TOKEN) appendComment(this, token);else if (token.type === Tokenizer.START_TAG_TOKEN) startTagInForeignContent(this, token);else if (token.type === Tokenizer.END_TAG_TOKEN) endTagInForeignContent(this, token);\n};\n\nParser.prototype._processFakeStartTagWithAttrs = function (tagName, attrs) {\n  var fakeToken = this.tokenizer.buildStartTagToken(tagName);\n  fakeToken.attrs = attrs;\n\n  this._processToken(fakeToken);\n};\n\nParser.prototype._processFakeStartTag = function (tagName) {\n  var fakeToken = this.tokenizer.buildStartTagToken(tagName);\n\n  this._processToken(fakeToken);\n\n  return fakeToken;\n};\n\nParser.prototype._processFakeEndTag = function (tagName) {\n  var fakeToken = this.tokenizer.buildEndTagToken(tagName);\n\n  this._processToken(fakeToken);\n\n  return fakeToken;\n}; //Integration points\n\n\nParser.prototype._isMathMLTextIntegrationPoint = function (element) {\n  var tn = this.treeAdapter.getTagName(element),\n      ns = this.treeAdapter.getNamespaceURI(element);\n  return ForeignContent.isMathMLTextIntegrationPoint(tn, ns);\n};\n\nParser.prototype._isHtmlIntegrationPoint = function (element) {\n  var tn = this.treeAdapter.getTagName(element),\n      ns = this.treeAdapter.getNamespaceURI(element),\n      attrs = this.treeAdapter.getAttrList(element);\n  return ForeignContent.isHtmlIntegrationPoint(tn, ns, attrs);\n}; //Active formatting elements reconstruction\n\n\nParser.prototype._reconstructActiveFormattingElements = function () {\n  var listLength = this.activeFormattingElements.length;\n\n  if (listLength) {\n    var unopenIdx = listLength,\n        entry = null;\n\n    do {\n      unopenIdx--;\n      entry = this.activeFormattingElements.entries[unopenIdx];\n\n      if (entry.type === FormattingElementList.MARKER_ENTRY || this.openElements.contains(entry.element)) {\n        unopenIdx++;\n        break;\n      }\n    } while (unopenIdx > 0);\n\n    for (var i = unopenIdx; i < listLength; i++) {\n      entry = this.activeFormattingElements.entries[i];\n\n      this._insertElement(entry.token, this.treeAdapter.getNamespaceURI(entry.element));\n\n      entry.element = this.openElements.current;\n    }\n  }\n}; //Close elements\n\n\nParser.prototype._closeTableCell = function () {\n  if (this.openElements.hasInTableScope($.TD)) this._processFakeEndTag($.TD);else this._processFakeEndTag($.TH);\n};\n\nParser.prototype._closePElement = function () {\n  this.openElements.generateImpliedEndTagsWithExclusion($.P);\n  this.openElements.popUntilTagNamePopped($.P);\n}; //Insertion modes\n\n\nParser.prototype._resetInsertionMode = function () {\n  for (var i = this.openElements.stackTop, last = false; i >= 0; i--) {\n    var element = this.openElements.items[i];\n\n    if (i === 0) {\n      last = true;\n      if (this.fragmentContext) element = this.fragmentContext;\n    }\n\n    var tn = this.treeAdapter.getTagName(element),\n        newInsertionMode = INSERTION_MODE_RESET_MAP[tn];\n\n    if (newInsertionMode) {\n      this.insertionMode = newInsertionMode;\n      break;\n    } else if (!last && (tn === $.TD || tn === $.TH)) {\n      this.insertionMode = IN_CELL_MODE;\n      break;\n    } else if (!last && tn === $.HEAD) {\n      this.insertionMode = IN_HEAD_MODE;\n      break;\n    } else if (tn === $.SELECT) {\n      this._resetInsertionModeForSelect(i);\n\n      break;\n    } else if (tn === $.TEMPLATE) {\n      this.insertionMode = this.currentTmplInsertionMode;\n      break;\n    } else if (tn === $.HTML) {\n      this.insertionMode = this.headElement ? AFTER_HEAD_MODE : BEFORE_HEAD_MODE;\n      break;\n    } else if (last) {\n      this.insertionMode = IN_BODY_MODE;\n      break;\n    }\n  }\n};\n\nParser.prototype._resetInsertionModeForSelect = function (selectIdx) {\n  if (selectIdx > 0) {\n    for (var i = selectIdx - 1; i > 0; i--) {\n      var ancestor = this.openElements.items[i],\n          tn = this.treeAdapter.getTagName(ancestor);\n      if (tn === $.TEMPLATE) break;else if (tn === $.TABLE) {\n        this.insertionMode = IN_SELECT_IN_TABLE_MODE;\n        return;\n      }\n    }\n  }\n\n  this.insertionMode = IN_SELECT_MODE;\n};\n\nParser.prototype._pushTmplInsertionMode = function (mode) {\n  this.tmplInsertionModeStack.push(mode);\n  this.tmplInsertionModeStackTop++;\n  this.currentTmplInsertionMode = mode;\n};\n\nParser.prototype._popTmplInsertionMode = function () {\n  this.tmplInsertionModeStack.pop();\n  this.tmplInsertionModeStackTop--;\n  this.currentTmplInsertionMode = this.tmplInsertionModeStack[this.tmplInsertionModeStackTop];\n}; //Foster parenting\n\n\nParser.prototype._isElementCausesFosterParenting = function (element) {\n  var tn = this.treeAdapter.getTagName(element);\n  return tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn == $.THEAD || tn === $.TR;\n};\n\nParser.prototype._shouldFosterParentOnInsertion = function () {\n  return this.fosterParentingEnabled && this._isElementCausesFosterParenting(this.openElements.current);\n};\n\nParser.prototype._findFosterParentingLocation = function () {\n  var location = {\n    parent: null,\n    beforeElement: null\n  };\n\n  for (var i = this.openElements.stackTop; i >= 0; i--) {\n    var openElement = this.openElements.items[i],\n        tn = this.treeAdapter.getTagName(openElement),\n        ns = this.treeAdapter.getNamespaceURI(openElement);\n\n    if (tn === $.TEMPLATE && ns === NS.HTML) {\n      location.parent = this.treeAdapter.getChildNodes(openElement)[0];\n      break;\n    } else if (tn === $.TABLE) {\n      location.parent = this.treeAdapter.getParentNode(openElement);\n      if (location.parent) location.beforeElement = openElement;else location.parent = this.openElements.items[i - 1];\n      break;\n    }\n  }\n\n  if (!location.parent) location.parent = this.openElements.items[0];\n  return location;\n};\n\nParser.prototype._fosterParentElement = function (element) {\n  var location = this._findFosterParentingLocation();\n\n  if (location.beforeElement) this.treeAdapter.insertBefore(location.parent, element, location.beforeElement);else this.treeAdapter.appendChild(location.parent, element);\n};\n\nParser.prototype._fosterParentText = function (chars) {\n  var location = this._findFosterParentingLocation();\n\n  if (location.beforeElement) this.treeAdapter.insertTextBefore(location.parent, chars, location.beforeElement);else this.treeAdapter.insertText(location.parent, chars);\n}; //Special elements\n\n\nParser.prototype._isSpecialElement = function (element) {\n  var tn = this.treeAdapter.getTagName(element),\n      ns = this.treeAdapter.getNamespaceURI(element);\n  return HTML.SPECIAL_ELEMENTS[ns][tn];\n}; //Adoption agency algorithm\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#adoptionAgency)\n//------------------------------------------------------------------\n//Steps 5-8 of the algorithm\n\n\nfunction aaObtainFormattingElementEntry(p, token) {\n  var formattingElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(token.tagName);\n\n  if (formattingElementEntry) {\n    if (!p.openElements.contains(formattingElementEntry.element)) {\n      p.activeFormattingElements.removeEntry(formattingElementEntry);\n      formattingElementEntry = null;\n    } else if (!p.openElements.hasInScope(token.tagName)) formattingElementEntry = null;\n  } else genericEndTagInBody(p, token);\n\n  return formattingElementEntry;\n} //Steps 9 and 10 of the algorithm\n\n\nfunction aaObtainFurthestBlock(p, formattingElementEntry) {\n  var furthestBlock = null;\n\n  for (var i = p.openElements.stackTop; i >= 0; i--) {\n    var element = p.openElements.items[i];\n    if (element === formattingElementEntry.element) break;\n    if (p._isSpecialElement(element)) furthestBlock = element;\n  }\n\n  if (!furthestBlock) {\n    p.openElements.popUntilElementPopped(formattingElementEntry.element);\n    p.activeFormattingElements.removeEntry(formattingElementEntry);\n  }\n\n  return furthestBlock;\n} //Step 13 of the algorithm\n\n\nfunction aaInnerLoop(p, furthestBlock, formattingElement) {\n  var element = null,\n      lastElement = furthestBlock,\n      nextElement = p.openElements.getCommonAncestor(furthestBlock);\n\n  for (var i = 0; i < AA_INNER_LOOP_ITER; i++) {\n    element = nextElement; //NOTE: store next element for the next loop iteration (it may be deleted from the stack by step 9.5)\n\n    nextElement = p.openElements.getCommonAncestor(element);\n    var elementEntry = p.activeFormattingElements.getElementEntry(element);\n\n    if (!elementEntry) {\n      p.openElements.remove(element);\n      continue;\n    }\n\n    if (element === formattingElement) break;\n    element = aaRecreateElementFromEntry(p, elementEntry);\n    if (lastElement === furthestBlock) p.activeFormattingElements.bookmark = elementEntry;\n    p.treeAdapter.detachNode(lastElement);\n    p.treeAdapter.appendChild(element, lastElement);\n    lastElement = element;\n  }\n\n  return lastElement;\n} //Step 13.7 of the algorithm\n\n\nfunction aaRecreateElementFromEntry(p, elementEntry) {\n  var ns = p.treeAdapter.getNamespaceURI(elementEntry.element),\n      newElement = p.treeAdapter.createElement(elementEntry.token.tagName, ns, elementEntry.token.attrs);\n  p.openElements.replace(elementEntry.element, newElement);\n  elementEntry.element = newElement;\n  return newElement;\n} //Step 14 of the algorithm\n\n\nfunction aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement) {\n  if (p._isElementCausesFosterParenting(commonAncestor)) p._fosterParentElement(lastElement);else {\n    var tn = p.treeAdapter.getTagName(commonAncestor),\n        ns = p.treeAdapter.getNamespaceURI(commonAncestor);\n    if (tn === $.TEMPLATE && ns === NS.HTML) commonAncestor = p.treeAdapter.getChildNodes(commonAncestor)[0];\n    p.treeAdapter.appendChild(commonAncestor, lastElement);\n  }\n} //Steps 15-19 of the algorithm\n\n\nfunction aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry) {\n  var ns = p.treeAdapter.getNamespaceURI(formattingElementEntry.element),\n      token = formattingElementEntry.token,\n      newElement = p.treeAdapter.createElement(token.tagName, ns, token.attrs);\n\n  p._adoptNodes(furthestBlock, newElement);\n\n  p.treeAdapter.appendChild(furthestBlock, newElement);\n  p.activeFormattingElements.insertElementAfterBookmark(newElement, formattingElementEntry.token);\n  p.activeFormattingElements.removeEntry(formattingElementEntry);\n  p.openElements.remove(formattingElementEntry.element);\n  p.openElements.insertAfter(furthestBlock, newElement);\n} //Algorithm entry point\n\n\nfunction callAdoptionAgency(p, token) {\n  for (var i = 0; i < AA_OUTER_LOOP_ITER; i++) {\n    var formattingElementEntry = aaObtainFormattingElementEntry(p, token, formattingElementEntry);\n    if (!formattingElementEntry) break;\n    var furthestBlock = aaObtainFurthestBlock(p, formattingElementEntry);\n    if (!furthestBlock) break;\n    p.activeFormattingElements.bookmark = formattingElementEntry;\n    var lastElement = aaInnerLoop(p, furthestBlock, formattingElementEntry.element),\n        commonAncestor = p.openElements.getCommonAncestor(formattingElementEntry.element);\n    p.treeAdapter.detachNode(lastElement);\n    aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement);\n    aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry);\n  }\n} //Generic token handlers\n//------------------------------------------------------------------\n\n\nfunction ignoreToken(p, token) {//NOTE: do nothing =)\n}\n\nfunction appendComment(p, token) {\n  p._appendCommentNode(token, p.openElements.currentTmplContent || p.openElements.current);\n}\n\nfunction appendCommentToRootHtmlElement(p, token) {\n  p._appendCommentNode(token, p.openElements.items[0]);\n}\n\nfunction appendCommentToDocument(p, token) {\n  p._appendCommentNode(token, p.document);\n}\n\nfunction insertCharacters(p, token) {\n  p._insertCharacters(token);\n}\n\nfunction stopParsing(p, token) {\n  p.stopped = true;\n} //12.2.5.4.1 The \"initial\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction doctypeInInitialMode(p, token) {\n  p._setDocumentType(token);\n\n  if (token.forceQuirks || Doctype.isQuirks(token.name, token.publicId, token.systemId)) p.treeAdapter.setQuirksMode(p.document);\n  p.insertionMode = BEFORE_HTML_MODE;\n}\n\nfunction tokenInInitialMode(p, token) {\n  p.treeAdapter.setQuirksMode(p.document);\n  p.insertionMode = BEFORE_HTML_MODE;\n\n  p._processToken(token);\n} //12.2.5.4.2 The \"before html\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagBeforeHtml(p, token) {\n  if (token.tagName === $.HTML) {\n    p._insertElement(token, NS.HTML);\n\n    p.insertionMode = BEFORE_HEAD_MODE;\n  } else tokenBeforeHtml(p, token);\n}\n\nfunction endTagBeforeHtml(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML || tn === $.HEAD || tn === $.BODY || tn === $.BR) tokenBeforeHtml(p, token);\n}\n\nfunction tokenBeforeHtml(p, token) {\n  p._insertFakeRootElement();\n\n  p.insertionMode = BEFORE_HEAD_MODE;\n\n  p._processToken(token);\n} //12.2.5.4.3 The \"before head\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagBeforeHead(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.HEAD) {\n    p._insertElement(token, NS.HTML);\n\n    p.headElement = p.openElements.current;\n    p.insertionMode = IN_HEAD_MODE;\n  } else tokenBeforeHead(p, token);\n}\n\nfunction endTagBeforeHead(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HEAD || tn === $.BODY || tn === $.HTML || tn === $.BR) tokenBeforeHead(p, token);\n}\n\nfunction tokenBeforeHead(p, token) {\n  p._processFakeStartTag($.HEAD);\n\n  p._processToken(token);\n} //12.2.5.4.4 The \"in head\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInHead(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.COMMAND || tn === $.LINK || tn === $.META) {\n    p._appendElement(token, NS.HTML);\n  } else if (tn === $.TITLE) p._switchToTextParsing(token, Tokenizer.MODE.RCDATA); //NOTE: here we assume that we always act as an interactive user agent with enabled scripting, so we parse\n  //<noscript> as a rawtext.\n  else if (tn === $.NOSCRIPT || tn === $.NOFRAMES || tn === $.STYLE) p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);else if (tn === $.SCRIPT) p._switchToTextParsing(token, Tokenizer.MODE.SCRIPT_DATA);else if (tn === $.TEMPLATE) {\n      p._insertTemplate(token, NS.HTML);\n\n      p.activeFormattingElements.insertMarker();\n      p.framesetOk = false;\n      p.insertionMode = IN_TEMPLATE_MODE;\n\n      p._pushTmplInsertionMode(IN_TEMPLATE_MODE);\n    } else if (tn !== $.HEAD) tokenInHead(p, token);\n}\n\nfunction endTagInHead(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.HEAD) {\n    p.openElements.pop();\n    p.insertionMode = AFTER_HEAD_MODE;\n  } else if (tn === $.BODY || tn === $.BR || tn === $.HTML) tokenInHead(p, token);else if (tn === $.TEMPLATE && p.openElements.tmplCount > 0) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTemplatePopped();\n    p.activeFormattingElements.clearToLastMarker();\n\n    p._popTmplInsertionMode();\n\n    p._resetInsertionMode();\n  }\n}\n\nfunction tokenInHead(p, token) {\n  p._processFakeEndTag($.HEAD);\n\n  p._processToken(token);\n} //12.2.5.4.6 The \"after head\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterHead(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.BODY) {\n    p._insertElement(token, NS.HTML);\n\n    p.framesetOk = false;\n    p.insertionMode = IN_BODY_MODE;\n  } else if (tn === $.FRAMESET) {\n    p._insertElement(token, NS.HTML);\n\n    p.insertionMode = IN_FRAMESET_MODE;\n  } else if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META || tn === $.NOFRAMES || tn === $.SCRIPT || tn === $.STYLE || tn === $.TEMPLATE || tn === $.TITLE) {\n    p.openElements.push(p.headElement);\n    startTagInHead(p, token);\n    p.openElements.remove(p.headElement);\n  } else if (tn !== $.HEAD) tokenAfterHead(p, token);\n}\n\nfunction endTagAfterHead(p, token) {\n  var tn = token.tagName;\n  if (tn === $.BODY || tn === $.HTML || tn === $.BR) tokenAfterHead(p, token);else if (tn === $.TEMPLATE) endTagInHead(p, token);\n}\n\nfunction tokenAfterHead(p, token) {\n  p._processFakeStartTag($.BODY);\n\n  p.framesetOk = true;\n\n  p._processToken(token);\n} //12.2.5.4.7 The \"in body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction whitespaceCharacterInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertCharacters(token);\n}\n\nfunction characterInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertCharacters(token);\n\n  p.framesetOk = false;\n}\n\nfunction htmlStartTagInBody(p, token) {\n  if (p.openElements.tmplCount === 0) p.treeAdapter.adoptAttributes(p.openElements.items[0], token.attrs);\n}\n\nfunction bodyStartTagInBody(p, token) {\n  var bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n\n  if (bodyElement && p.openElements.tmplCount === 0) {\n    p.framesetOk = false;\n    p.treeAdapter.adoptAttributes(bodyElement, token.attrs);\n  }\n}\n\nfunction framesetStartTagInBody(p, token) {\n  var bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n\n  if (p.framesetOk && bodyElement) {\n    p.treeAdapter.detachNode(bodyElement);\n    p.openElements.popAllUpToHtmlElement();\n\n    p._insertElement(token, NS.HTML);\n\n    p.insertionMode = IN_FRAMESET_MODE;\n  }\n}\n\nfunction addressStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction numberedHeaderStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n  var tn = p.openElements.currentTagName;\n  if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) p.openElements.pop();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction preStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n  p._insertElement(token, NS.HTML); //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n  //on to the next one. (Newlines at the start of pre blocks are ignored as an authoring convenience.)\n\n\n  p.skipNextNewLine = true;\n  p.framesetOk = false;\n}\n\nfunction formStartTagInBody(p, token) {\n  var inTemplate = p.openElements.tmplCount > 0;\n\n  if (!p.formElement || inTemplate) {\n    if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n    p._insertElement(token, NS.HTML);\n\n    if (!inTemplate) p.formElement = p.openElements.current;\n  }\n}\n\nfunction listItemStartTagInBody(p, token) {\n  p.framesetOk = false;\n\n  for (var i = p.openElements.stackTop; i >= 0; i--) {\n    var element = p.openElements.items[i],\n        tn = p.treeAdapter.getTagName(element);\n\n    if (token.tagName === $.LI && tn === $.LI || (token.tagName === $.DD || token.tagName === $.DT) && (tn === $.DD || tn == $.DT)) {\n      p._processFakeEndTag(tn);\n\n      break;\n    }\n\n    if (tn !== $.ADDRESS && tn !== $.DIV && tn !== $.P && p._isSpecialElement(element)) break;\n  }\n\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction plaintextStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n  p._insertElement(token, NS.HTML);\n\n  p.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\n}\n\nfunction buttonStartTagInBody(p, token) {\n  if (p.openElements.hasInScope($.BUTTON)) {\n    p._processFakeEndTag($.BUTTON);\n\n    buttonStartTagInBody(p, token);\n  } else {\n    p._reconstructActiveFormattingElements();\n\n    p._insertElement(token, NS.HTML);\n\n    p.framesetOk = false;\n  }\n}\n\nfunction aStartTagInBody(p, token) {\n  var activeElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName($.A);\n\n  if (activeElementEntry) {\n    p._processFakeEndTag($.A);\n\n    p.openElements.remove(activeElementEntry.element);\n    p.activeFormattingElements.removeEntry(activeElementEntry);\n  }\n\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction bStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction nobrStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  if (p.openElements.hasInScope($.NOBR)) {\n    p._processFakeEndTag($.NOBR);\n\n    p._reconstructActiveFormattingElements();\n  }\n\n  p._insertElement(token, NS.HTML);\n\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction appletStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.activeFormattingElements.insertMarker();\n  p.framesetOk = false;\n}\n\nfunction tableStartTagInBody(p, token) {\n  if (!p.treeAdapter.isQuirksMode(p.document) && p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n  p._insertElement(token, NS.HTML);\n\n  p.framesetOk = false;\n  p.insertionMode = IN_TABLE_MODE;\n}\n\nfunction areaStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._appendElement(token, NS.HTML);\n\n  p.framesetOk = false;\n}\n\nfunction inputStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._appendElement(token, NS.HTML);\n\n  var inputType = Tokenizer.getTokenAttr(token, ATTRS.TYPE);\n  if (!inputType || inputType.toLowerCase() !== HIDDEN_INPUT_TYPE) p.framesetOk = false;\n}\n\nfunction paramStartTagInBody(p, token) {\n  p._appendElement(token, NS.HTML);\n}\n\nfunction hrStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n  p._appendElement(token, NS.HTML);\n\n  p.framesetOk = false;\n}\n\nfunction imageStartTagInBody(p, token) {\n  token.tagName = $.IMG;\n  areaStartTagInBody(p, token);\n}\n\nfunction isindexStartTagInBody(p, token) {\n  if (!p.formElement || p.openElements.tmplCount > 0) {\n    p._processFakeStartTagWithAttrs($.FORM, getSearchableIndexFormAttrs(token));\n\n    p._processFakeStartTag($.HR);\n\n    p._processFakeStartTag($.LABEL);\n\n    p.treeAdapter.insertText(p.openElements.current, getSearchableIndexLabelText(token));\n\n    p._processFakeStartTagWithAttrs($.INPUT, getSearchableIndexInputAttrs(token));\n\n    p._processFakeEndTag($.LABEL);\n\n    p._processFakeStartTag($.HR);\n\n    p._processFakeEndTag($.FORM);\n  }\n}\n\nfunction textareaStartTagInBody(p, token) {\n  p._insertElement(token, NS.HTML); //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n  //on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)\n\n\n  p.skipNextNewLine = true;\n  p.tokenizer.state = Tokenizer.MODE.RCDATA;\n  p.originalInsertionMode = p.insertionMode;\n  p.framesetOk = false;\n  p.insertionMode = TEXT_MODE;\n}\n\nfunction xmpStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n  p._reconstructActiveFormattingElements();\n\n  p.framesetOk = false;\n\n  p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n}\n\nfunction iframeStartTagInBody(p, token) {\n  p.framesetOk = false;\n\n  p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n} //NOTE: here we assume that we always act as an user agent with enabled plugins, so we parse\n//<noembed> as a rawtext.\n\n\nfunction noembedStartTagInBody(p, token) {\n  p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n}\n\nfunction selectStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.framesetOk = false;\n\n  if (p.insertionMode === IN_TABLE_MODE || p.insertionMode === IN_CAPTION_MODE || p.insertionMode === IN_TABLE_BODY_MODE || p.insertionMode === IN_ROW_MODE || p.insertionMode === IN_CELL_MODE) {\n    p.insertionMode = IN_SELECT_IN_TABLE_MODE;\n  } else p.insertionMode = IN_SELECT_MODE;\n}\n\nfunction optgroupStartTagInBody(p, token) {\n  if (p.openElements.currentTagName === $.OPTION) p._processFakeEndTag($.OPTION);\n\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction rpStartTagInBody(p, token) {\n  if (p.openElements.hasInScope($.RUBY)) p.openElements.generateImpliedEndTags();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction menuitemStartTagInBody(p, token) {\n  p._appendElement(token, NS.HTML);\n}\n\nfunction mathStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  ForeignContent.adjustTokenMathMLAttrs(token);\n  ForeignContent.adjustTokenXMLAttrs(token);\n  if (token.selfClosing) p._appendElement(token, NS.MATHML);else p._insertElement(token, NS.MATHML);\n}\n\nfunction svgStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  ForeignContent.adjustTokenSVGAttrs(token);\n  ForeignContent.adjustTokenXMLAttrs(token);\n  if (token.selfClosing) p._appendElement(token, NS.SVG);else p._insertElement(token, NS.SVG);\n}\n\nfunction genericStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n} //OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\n//It's faster than using dictionary.\n\n\nfunction startTagInBody(p, token) {\n  var tn = token.tagName;\n\n  switch (tn.length) {\n    case 1:\n      if (tn === $.I || tn === $.S || tn === $.B || tn === $.U) bStartTagInBody(p, token);else if (tn === $.P) addressStartTagInBody(p, token);else if (tn === $.A) aStartTagInBody(p, token);else genericStartTagInBody(p, token);\n      break;\n\n    case 2:\n      if (tn === $.DL || tn === $.OL || tn === $.UL) addressStartTagInBody(p, token);else if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) numberedHeaderStartTagInBody(p, token);else if (tn === $.LI || tn === $.DD || tn === $.DT) listItemStartTagInBody(p, token);else if (tn === $.EM || tn === $.TT) bStartTagInBody(p, token);else if (tn === $.BR) areaStartTagInBody(p, token);else if (tn === $.HR) hrStartTagInBody(p, token);else if (tn === $.RP || tn === $.RT) rpStartTagInBody(p, token);else if (tn !== $.TH && tn !== $.TD && tn !== $.TR) genericStartTagInBody(p, token);\n      break;\n\n    case 3:\n      if (tn === $.DIV || tn === $.DIR || tn === $.NAV) addressStartTagInBody(p, token);else if (tn === $.PRE) preStartTagInBody(p, token);else if (tn === $.BIG) bStartTagInBody(p, token);else if (tn === $.IMG || tn === $.WBR) areaStartTagInBody(p, token);else if (tn === $.XMP) xmpStartTagInBody(p, token);else if (tn === $.SVG) svgStartTagInBody(p, token);else if (tn !== $.COL) genericStartTagInBody(p, token);\n      break;\n\n    case 4:\n      if (tn === $.HTML) htmlStartTagInBody(p, token);else if (tn === $.BASE || tn === $.LINK || tn === $.META) startTagInHead(p, token);else if (tn === $.BODY) bodyStartTagInBody(p, token);else if (tn === $.MAIN || tn === $.MENU) addressStartTagInBody(p, token);else if (tn === $.FORM) formStartTagInBody(p, token);else if (tn === $.CODE || tn === $.FONT) bStartTagInBody(p, token);else if (tn === $.NOBR) nobrStartTagInBody(p, token);else if (tn === $.AREA) areaStartTagInBody(p, token);else if (tn === $.MATH) mathStartTagInBody(p, token);else if (tn !== $.HEAD) genericStartTagInBody(p, token);\n      break;\n\n    case 5:\n      if (tn === $.STYLE || tn === $.TITLE) startTagInHead(p, token);else if (tn === $.ASIDE) addressStartTagInBody(p, token);else if (tn === $.SMALL) bStartTagInBody(p, token);else if (tn === $.TABLE) tableStartTagInBody(p, token);else if (tn === $.EMBED) areaStartTagInBody(p, token);else if (tn === $.INPUT) inputStartTagInBody(p, token);else if (tn === $.PARAM || tn === $.TRACK) paramStartTagInBody(p, token);else if (tn === $.IMAGE) imageStartTagInBody(p, token);else if (tn !== $.FRAME && tn !== $.TBODY && tn !== $.TFOOT && tn !== $.THEAD) genericStartTagInBody(p, token);\n      break;\n\n    case 6:\n      if (tn === $.SCRIPT) startTagInHead(p, token);else if (tn === $.CENTER || tn === $.FIGURE || tn === $.FOOTER || tn === $.HEADER || tn === $.HGROUP) addressStartTagInBody(p, token);else if (tn === $.BUTTON) buttonStartTagInBody(p, token);else if (tn === $.STRIKE || tn === $.STRONG) bStartTagInBody(p, token);else if (tn === $.APPLET || tn === $.OBJECT) appletStartTagInBody(p, token);else if (tn === $.KEYGEN) areaStartTagInBody(p, token);else if (tn === $.SOURCE) paramStartTagInBody(p, token);else if (tn === $.IFRAME) iframeStartTagInBody(p, token);else if (tn === $.SELECT) selectStartTagInBody(p, token);else if (tn === $.OPTION) optgroupStartTagInBody(p, token);else genericStartTagInBody(p, token);\n      break;\n\n    case 7:\n      if (tn === $.BGSOUND || tn === $.COMMAND) startTagInHead(p, token);else if (tn === $.DETAILS || tn === $.ADDRESS || tn === $.ARTICLE || tn === $.SECTION || tn === $.SUMMARY) addressStartTagInBody(p, token);else if (tn === $.LISTING) preStartTagInBody(p, token);else if (tn === $.MARQUEE) appletStartTagInBody(p, token);else if (tn === $.ISINDEX) isindexStartTagInBody(p, token);else if (tn === $.NOEMBED) noembedStartTagInBody(p, token);else if (tn !== $.CAPTION) genericStartTagInBody(p, token);\n      break;\n\n    case 8:\n      if (tn === $.BASEFONT || tn === $.MENUITEM) menuitemStartTagInBody(p, token);else if (tn === $.FRAMESET) framesetStartTagInBody(p, token);else if (tn === $.FIELDSET) addressStartTagInBody(p, token);else if (tn === $.TEXTAREA) textareaStartTagInBody(p, token);else if (tn === $.TEMPLATE) startTagInHead(p, token);else if (tn === $.NOSCRIPT) noembedStartTagInBody(p, token);else if (tn === $.OPTGROUP) optgroupStartTagInBody(p, token);else if (tn !== $.COLGROUP) genericStartTagInBody(p, token);\n      break;\n\n    case 9:\n      if (tn === $.PLAINTEXT) plaintextStartTagInBody(p, token);else genericStartTagInBody(p, token);\n      break;\n\n    case 10:\n      if (tn === $.BLOCKQUOTE || tn === $.FIGCAPTION) addressStartTagInBody(p, token);else genericStartTagInBody(p, token);\n      break;\n\n    default:\n      genericStartTagInBody(p, token);\n  }\n}\n\nfunction bodyEndTagInBody(p, token) {\n  if (p.openElements.hasInScope($.BODY)) p.insertionMode = AFTER_BODY_MODE;else token.ignored = true;\n}\n\nfunction htmlEndTagInBody(p, token) {\n  var fakeToken = p._processFakeEndTag($.BODY);\n\n  if (!fakeToken.ignored) p._processToken(token);\n}\n\nfunction addressEndTagInBody(p, token) {\n  var tn = token.tagName;\n\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped(tn);\n  }\n}\n\nfunction formEndTagInBody(p, token) {\n  var inTemplate = p.openElements.tmplCount > 0,\n      formElement = p.formElement;\n  if (!inTemplate) p.formElement = null;\n\n  if ((formElement || inTemplate) && p.openElements.hasInScope($.FORM)) {\n    p.openElements.generateImpliedEndTags();\n    if (inTemplate) p.openElements.popUntilTagNamePopped($.FORM);else p.openElements.remove(formElement);\n  }\n}\n\nfunction pEndTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) {\n    p.openElements.generateImpliedEndTagsWithExclusion($.P);\n    p.openElements.popUntilTagNamePopped($.P);\n  } else {\n    p._processFakeStartTag($.P);\n\n    p._processToken(token);\n  }\n}\n\nfunction liEndTagInBody(p, token) {\n  if (p.openElements.hasInListItemScope($.LI)) {\n    p.openElements.generateImpliedEndTagsWithExclusion($.LI);\n    p.openElements.popUntilTagNamePopped($.LI);\n  }\n}\n\nfunction ddEndTagInBody(p, token) {\n  var tn = token.tagName;\n\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTagsWithExclusion(tn);\n    p.openElements.popUntilTagNamePopped(tn);\n  }\n}\n\nfunction numberedHeaderEndTagInBody(p, token) {\n  if (p.openElements.hasNumberedHeaderInScope()) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilNumberedHeaderPopped();\n  }\n}\n\nfunction appletEndTagInBody(p, token) {\n  var tn = token.tagName;\n\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped(tn);\n    p.activeFormattingElements.clearToLastMarker();\n  }\n}\n\nfunction brEndTagInBody(p, token) {\n  p._processFakeStartTag($.BR);\n}\n\nfunction genericEndTagInBody(p, token) {\n  var tn = token.tagName;\n\n  for (var i = p.openElements.stackTop; i > 0; i--) {\n    var element = p.openElements.items[i];\n\n    if (p.treeAdapter.getTagName(element) === tn) {\n      p.openElements.generateImpliedEndTagsWithExclusion(tn);\n      p.openElements.popUntilElementPopped(element);\n      break;\n    }\n\n    if (p._isSpecialElement(element)) break;\n  }\n} //OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\n//It's faster than using dictionary.\n\n\nfunction endTagInBody(p, token) {\n  var tn = token.tagName;\n\n  switch (tn.length) {\n    case 1:\n      if (tn === $.A || tn === $.B || tn === $.I || tn === $.S || tn == $.U) callAdoptionAgency(p, token);else if (tn === $.P) pEndTagInBody(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 2:\n      if (tn == $.DL || tn === $.UL || tn === $.OL) addressEndTagInBody(p, token);else if (tn === $.LI) liEndTagInBody(p, token);else if (tn === $.DD || tn === $.DT) ddEndTagInBody(p, token);else if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) numberedHeaderEndTagInBody(p, token);else if (tn === $.BR) brEndTagInBody(p, token);else if (tn === $.EM || tn === $.TT) callAdoptionAgency(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 3:\n      if (tn === $.BIG) callAdoptionAgency(p, token);else if (tn === $.DIR || tn === $.DIV || tn === $.NAV) addressEndTagInBody(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 4:\n      if (tn === $.BODY) bodyEndTagInBody(p, token);else if (tn === $.HTML) htmlEndTagInBody(p, token);else if (tn === $.FORM) formEndTagInBody(p, token);else if (tn === $.CODE || tn === $.FONT || tn === $.NOBR) callAdoptionAgency(p, token);else if (tn === $.MAIN || tn === $.MENU) addressEndTagInBody(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 5:\n      if (tn === $.ASIDE) addressEndTagInBody(p, token);else if (tn === $.SMALL) callAdoptionAgency(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 6:\n      if (tn === $.CENTER || tn === $.FIGURE || tn === $.FOOTER || tn === $.HEADER || tn === $.HGROUP) addressEndTagInBody(p, token);else if (tn === $.APPLET || tn === $.OBJECT) appletEndTagInBody(p, token);else if (tn == $.STRIKE || tn === $.STRONG) callAdoptionAgency(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 7:\n      if (tn === $.ADDRESS || tn === $.ARTICLE || tn === $.DETAILS || tn === $.SECTION || tn === $.SUMMARY) addressEndTagInBody(p, token);else if (tn === $.MARQUEE) appletEndTagInBody(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 8:\n      if (tn === $.FIELDSET) addressEndTagInBody(p, token);else if (tn === $.TEMPLATE) endTagInHead(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 10:\n      if (tn === $.BLOCKQUOTE || tn === $.FIGCAPTION) addressEndTagInBody(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    default:\n      genericEndTagInBody(p, token);\n  }\n}\n\nfunction eofInBody(p, token) {\n  if (p.tmplInsertionModeStackTop > -1) eofInTemplate(p, token);else p.stopped = true;\n} //12.2.5.4.8 The \"text\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction endTagInText(p, token) {\n  if (!p.fragmentContext && p.scriptHandler && token.tagName === $.SCRIPT) p.scriptHandler(p.document, p.openElements.current);\n  p.openElements.pop();\n  p.insertionMode = p.originalInsertionMode;\n}\n\nfunction eofInText(p, token) {\n  p.openElements.pop();\n  p.insertionMode = p.originalInsertionMode;\n\n  p._processToken(token);\n} //12.2.5.4.9 The \"in table\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction characterInTable(p, token) {\n  var curTn = p.openElements.currentTagName;\n\n  if (curTn === $.TABLE || curTn === $.TBODY || curTn === $.TFOOT || curTn === $.THEAD || curTn === $.TR) {\n    p.pendingCharacterTokens = [];\n    p.hasNonWhitespacePendingCharacterToken = false;\n    p.originalInsertionMode = p.insertionMode;\n    p.insertionMode = IN_TABLE_TEXT_MODE;\n\n    p._processToken(token);\n  } else tokenInTable(p, token);\n}\n\nfunction captionStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n  p.activeFormattingElements.insertMarker();\n\n  p._insertElement(token, NS.HTML);\n\n  p.insertionMode = IN_CAPTION_MODE;\n}\n\nfunction colgroupStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertElement(token, NS.HTML);\n\n  p.insertionMode = IN_COLUMN_GROUP_MODE;\n}\n\nfunction colStartTagInTable(p, token) {\n  p._processFakeStartTag($.COLGROUP);\n\n  p._processToken(token);\n}\n\nfunction tbodyStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertElement(token, NS.HTML);\n\n  p.insertionMode = IN_TABLE_BODY_MODE;\n}\n\nfunction tdStartTagInTable(p, token) {\n  p._processFakeStartTag($.TBODY);\n\n  p._processToken(token);\n}\n\nfunction tableStartTagInTable(p, token) {\n  var fakeToken = p._processFakeEndTag($.TABLE); //NOTE: The fake end tag token here can only be ignored in the fragment case.\n\n\n  if (!fakeToken.ignored) p._processToken(token);\n}\n\nfunction inputStartTagInTable(p, token) {\n  var inputType = Tokenizer.getTokenAttr(token, ATTRS.TYPE);\n  if (inputType && inputType.toLowerCase() === HIDDEN_INPUT_TYPE) p._appendElement(token, NS.HTML);else tokenInTable(p, token);\n}\n\nfunction formStartTagInTable(p, token) {\n  if (!p.formElement && p.openElements.tmplCount === 0) {\n    p._insertElement(token, NS.HTML);\n\n    p.formElement = p.openElements.current;\n    p.openElements.pop();\n  }\n}\n\nfunction startTagInTable(p, token) {\n  var tn = token.tagName;\n\n  switch (tn.length) {\n    case 2:\n      if (tn === $.TD || tn === $.TH || tn === $.TR) tdStartTagInTable(p, token);else tokenInTable(p, token);\n      break;\n\n    case 3:\n      if (tn === $.COL) colStartTagInTable(p, token);else tokenInTable(p, token);\n      break;\n\n    case 4:\n      if (tn === $.FORM) formStartTagInTable(p, token);else tokenInTable(p, token);\n      break;\n\n    case 5:\n      if (tn === $.TABLE) tableStartTagInTable(p, token);else if (tn === $.STYLE) startTagInHead(p, token);else if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) tbodyStartTagInTable(p, token);else if (tn === $.INPUT) inputStartTagInTable(p, token);else tokenInTable(p, token);\n      break;\n\n    case 6:\n      if (tn === $.SCRIPT) startTagInHead(p, token);else tokenInTable(p, token);\n      break;\n\n    case 7:\n      if (tn === $.CAPTION) captionStartTagInTable(p, token);else tokenInTable(p, token);\n      break;\n\n    case 8:\n      if (tn === $.COLGROUP) colgroupStartTagInTable(p, token);else if (tn === $.TEMPLATE) startTagInHead(p, token);else tokenInTable(p, token);\n      break;\n\n    default:\n      tokenInTable(p, token);\n  }\n}\n\nfunction endTagInTable(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.TABLE) {\n    if (p.openElements.hasInTableScope($.TABLE)) {\n      p.openElements.popUntilTagNamePopped($.TABLE);\n\n      p._resetInsertionMode();\n    } else token.ignored = true;\n  } else if (tn === $.TEMPLATE) endTagInHead(p, token);else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML && tn !== $.TBODY && tn !== $.TD && tn !== $.TFOOT && tn !== $.TH && tn !== $.THEAD && tn !== $.TR) {\n    tokenInTable(p, token);\n  }\n}\n\nfunction tokenInTable(p, token) {\n  var savedFosterParentingState = p.fosterParentingEnabled;\n  p.fosterParentingEnabled = true;\n\n  p._processTokenInBodyMode(token);\n\n  p.fosterParentingEnabled = savedFosterParentingState;\n} //12.2.5.4.10 The \"in table text\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction whitespaceCharacterInTableText(p, token) {\n  p.pendingCharacterTokens.push(token);\n}\n\nfunction characterInTableText(p, token) {\n  p.pendingCharacterTokens.push(token);\n  p.hasNonWhitespacePendingCharacterToken = true;\n}\n\nfunction tokenInTableText(p, token) {\n  if (p.hasNonWhitespacePendingCharacterToken) {\n    for (var i = 0; i < p.pendingCharacterTokens.length; i++) tokenInTable(p, p.pendingCharacterTokens[i]);\n  } else {\n    for (var i = 0; i < p.pendingCharacterTokens.length; i++) p._insertCharacters(p.pendingCharacterTokens[i]);\n  }\n\n  p.insertionMode = p.originalInsertionMode;\n\n  p._processToken(token);\n} //12.2.5.4.11 The \"in caption\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInCaption(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY || tn === $.TD || tn === $.TFOOT || tn === $.TH || tn === $.THEAD || tn === $.TR) {\n    var fakeToken = p._processFakeEndTag($.CAPTION); //NOTE: The fake end tag token here can only be ignored in the fragment case.\n\n\n    if (!fakeToken.ignored) p._processToken(token);\n  } else startTagInBody(p, token);\n}\n\nfunction endTagInCaption(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.CAPTION) {\n    if (p.openElements.hasInTableScope($.CAPTION)) {\n      p.openElements.generateImpliedEndTags();\n      p.openElements.popUntilTagNamePopped($.CAPTION);\n      p.activeFormattingElements.clearToLastMarker();\n      p.insertionMode = IN_TABLE_MODE;\n    } else token.ignored = true;\n  } else if (tn === $.TABLE) {\n    var fakeToken = p._processFakeEndTag($.CAPTION); //NOTE: The fake end tag token here can only be ignored in the fragment case.\n\n\n    if (!fakeToken.ignored) p._processToken(token);\n  } else if (tn !== $.BODY && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML && tn !== $.TBODY && tn !== $.TD && tn !== $.TFOOT && tn !== $.TH && tn !== $.THEAD && tn !== $.TR) {\n    endTagInBody(p, token);\n  }\n} //12.2.5.4.12 The \"in column group\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInColumnGroup(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.COL) p._appendElement(token, NS.HTML);else if (tn === $.TEMPLATE) startTagInHead(p, token);else tokenInColumnGroup(p, token);\n}\n\nfunction endTagInColumnGroup(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.COLGROUP) {\n    if (p.openElements.currentTagName !== $.COLGROUP) token.ignored = true;else {\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_MODE;\n    }\n  } else if (tn === $.TEMPLATE) endTagInHead(p, token);else if (tn !== $.COL) tokenInColumnGroup(p, token);\n}\n\nfunction tokenInColumnGroup(p, token) {\n  var fakeToken = p._processFakeEndTag($.COLGROUP); //NOTE: The fake end tag token here can only be ignored in the fragment case.\n\n\n  if (!fakeToken.ignored) p._processToken(token);\n} //12.2.5.4.13 The \"in table body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInTableBody(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.TR) {\n    p.openElements.clearBackToTableBodyContext();\n\n    p._insertElement(token, NS.HTML);\n\n    p.insertionMode = IN_ROW_MODE;\n  } else if (tn === $.TH || tn === $.TD) {\n    p._processFakeStartTag($.TR);\n\n    p._processToken(token);\n  } else if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\n    if (p.openElements.hasTableBodyContextInTableScope()) {\n      p.openElements.clearBackToTableBodyContext();\n\n      p._processFakeEndTag(p.openElements.currentTagName);\n\n      p._processToken(token);\n    }\n  } else startTagInTable(p, token);\n}\n\nfunction endTagInTableBody(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p.openElements.clearBackToTableBodyContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_MODE;\n    }\n  } else if (tn === $.TABLE) {\n    if (p.openElements.hasTableBodyContextInTableScope()) {\n      p.openElements.clearBackToTableBodyContext();\n\n      p._processFakeEndTag(p.openElements.currentTagName);\n\n      p._processToken(token);\n    }\n  } else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP || tn !== $.HTML && tn !== $.TD && tn !== $.TH && tn !== $.TR) {\n    endTagInTable(p, token);\n  }\n} //12.2.5.4.14 The \"in row\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInRow(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.TH || tn === $.TD) {\n    p.openElements.clearBackToTableRowContext();\n\n    p._insertElement(token, NS.HTML);\n\n    p.insertionMode = IN_CELL_MODE;\n    p.activeFormattingElements.insertMarker();\n  } else if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR) {\n    var fakeToken = p._processFakeEndTag($.TR); //NOTE: The fake end tag token here can only be ignored in the fragment case.\n\n\n    if (!fakeToken.ignored) p._processToken(token);\n  } else startTagInTable(p, token);\n}\n\nfunction endTagInRow(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.TR) {\n    if (p.openElements.hasInTableScope($.TR)) {\n      p.openElements.clearBackToTableRowContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_BODY_MODE;\n    } else token.ignored = true;\n  } else if (tn === $.TABLE) {\n    var fakeToken = p._processFakeEndTag($.TR); //NOTE: The fake end tag token here can only be ignored in the fragment case.\n\n\n    if (!fakeToken.ignored) p._processToken(token);\n  } else if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p._processFakeEndTag($.TR);\n\n      p._processToken(token);\n    }\n  } else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP || tn !== $.HTML && tn !== $.TD && tn !== $.TH) {\n    endTagInTable(p, token);\n  }\n} //12.2.5.4.15 The \"in cell\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInCell(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY || tn === $.TD || tn === $.TFOOT || tn === $.TH || tn === $.THEAD || tn === $.TR) {\n    if (p.openElements.hasInTableScope($.TD) || p.openElements.hasInTableScope($.TH)) {\n      p._closeTableCell();\n\n      p._processToken(token);\n    }\n  } else startTagInBody(p, token);\n}\n\nfunction endTagInCell(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.TD || tn === $.TH) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p.openElements.generateImpliedEndTags();\n      p.openElements.popUntilTagNamePopped(tn);\n      p.activeFormattingElements.clearToLastMarker();\n      p.insertionMode = IN_ROW_MODE;\n    }\n  } else if (tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p._closeTableCell();\n\n      p._processToken(token);\n    }\n  } else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML) endTagInBody(p, token);\n} //12.2.5.4.16 The \"in select\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInSelect(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.OPTION) {\n    if (p.openElements.currentTagName === $.OPTION) p._processFakeEndTag($.OPTION);\n\n    p._insertElement(token, NS.HTML);\n  } else if (tn === $.OPTGROUP) {\n    if (p.openElements.currentTagName === $.OPTION) p._processFakeEndTag($.OPTION);\n    if (p.openElements.currentTagName === $.OPTGROUP) p._processFakeEndTag($.OPTGROUP);\n\n    p._insertElement(token, NS.HTML);\n  } else if (tn === $.SELECT) p._processFakeEndTag($.SELECT);else if (tn === $.INPUT || tn === $.KEYGEN || tn === $.TEXTAREA) {\n    if (p.openElements.hasInSelectScope($.SELECT)) {\n      p._processFakeEndTag($.SELECT);\n\n      p._processToken(token);\n    }\n  } else if (tn === $.SCRIPT || tn === $.TEMPLATE) startTagInHead(p, token);\n}\n\nfunction endTagInSelect(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.OPTGROUP) {\n    var prevOpenElement = p.openElements.items[p.openElements.stackTop - 1],\n        prevOpenElementTn = prevOpenElement && p.treeAdapter.getTagName(prevOpenElement);\n    if (p.openElements.currentTagName === $.OPTION && prevOpenElementTn === $.OPTGROUP) p._processFakeEndTag($.OPTION);\n    if (p.openElements.currentTagName === $.OPTGROUP) p.openElements.pop();\n  } else if (tn === $.OPTION) {\n    if (p.openElements.currentTagName === $.OPTION) p.openElements.pop();\n  } else if (tn === $.SELECT && p.openElements.hasInSelectScope($.SELECT)) {\n    p.openElements.popUntilTagNamePopped($.SELECT);\n\n    p._resetInsertionMode();\n  } else if (tn === $.TEMPLATE) endTagInHead(p, token);\n} //12.2.5.4.17 The \"in select in table\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInSelectInTable(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.CAPTION || tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR || tn === $.TD || tn === $.TH) {\n    p._processFakeEndTag($.SELECT);\n\n    p._processToken(token);\n  } else startTagInSelect(p, token);\n}\n\nfunction endTagInSelectInTable(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.CAPTION || tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR || tn === $.TD || tn === $.TH) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p._processFakeEndTag($.SELECT);\n\n      p._processToken(token);\n    }\n  } else endTagInSelect(p, token);\n} //12.2.5.4.18 The \"in template\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInTemplate(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META || tn === $.NOFRAMES || tn === $.SCRIPT || tn === $.STYLE || tn === $.TEMPLATE || tn === $.TITLE) {\n    startTagInHead(p, token);\n  } else {\n    var newInsertionMode = TEMPLATE_INSERTION_MODE_SWITCH_MAP[tn] || IN_BODY_MODE;\n\n    p._popTmplInsertionMode();\n\n    p._pushTmplInsertionMode(newInsertionMode);\n\n    p.insertionMode = newInsertionMode;\n\n    p._processToken(token);\n  }\n}\n\nfunction endTagInTemplate(p, token) {\n  if (token.tagName === $.TEMPLATE) endTagInHead(p, token);\n}\n\nfunction eofInTemplate(p, token) {\n  if (p.openElements.tmplCount > 0) {\n    p.openElements.popUntilTemplatePopped();\n    p.activeFormattingElements.clearToLastMarker();\n\n    p._popTmplInsertionMode();\n\n    p._resetInsertionMode();\n\n    p._processToken(token);\n  } else p.stopped = true;\n} //12.2.5.4.19 The \"after body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterBody(p, token) {\n  if (token.tagName === $.HTML) startTagInBody(p, token);else tokenAfterBody(p, token);\n}\n\nfunction endTagAfterBody(p, token) {\n  if (token.tagName === $.HTML) {\n    if (!p.fragmentContext) p.insertionMode = AFTER_AFTER_BODY_MODE;\n  } else tokenAfterBody(p, token);\n}\n\nfunction tokenAfterBody(p, token) {\n  p.insertionMode = IN_BODY_MODE;\n\n  p._processToken(token);\n} //12.2.5.4.20 The \"in frameset\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInFrameset(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.FRAMESET) p._insertElement(token, NS.HTML);else if (tn === $.FRAME) p._appendElement(token, NS.HTML);else if (tn === $.NOFRAMES) startTagInHead(p, token);\n}\n\nfunction endTagInFrameset(p, token) {\n  if (token.tagName === $.FRAMESET && !p.openElements.isRootHtmlElementCurrent()) {\n    p.openElements.pop();\n    if (!p.fragmentContext && p.openElements.currentTagName !== $.FRAMESET) p.insertionMode = AFTER_FRAMESET_MODE;\n  }\n} //12.2.5.4.21 The \"after frameset\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterFrameset(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.NOFRAMES) startTagInHead(p, token);\n}\n\nfunction endTagAfterFrameset(p, token) {\n  if (token.tagName === $.HTML) p.insertionMode = AFTER_AFTER_FRAMESET_MODE;\n} //12.2.5.4.22 The \"after after body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterAfterBody(p, token) {\n  if (token.tagName === $.HTML) startTagInBody(p, token);else tokenAfterAfterBody(p, token);\n}\n\nfunction tokenAfterAfterBody(p, token) {\n  p.insertionMode = IN_BODY_MODE;\n\n  p._processToken(token);\n} //12.2.5.4.23 The \"after after frameset\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterAfterFrameset(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.NOFRAMES) startTagInHead(p, token);\n} //12.2.5.5 The rules for parsing tokens in foreign content\n//------------------------------------------------------------------\n\n\nfunction nullCharacterInForeignContent(p, token) {\n  token.chars = UNICODE.REPLACEMENT_CHARACTER;\n\n  p._insertCharacters(token);\n}\n\nfunction characterInForeignContent(p, token) {\n  p._insertCharacters(token);\n\n  p.framesetOk = false;\n}\n\nfunction startTagInForeignContent(p, token) {\n  if (ForeignContent.causesExit(token) && !p.fragmentContext) {\n    while (p.treeAdapter.getNamespaceURI(p.openElements.current) !== NS.HTML && !p._isMathMLTextIntegrationPoint(p.openElements.current) && !p._isHtmlIntegrationPoint(p.openElements.current)) {\n      p.openElements.pop();\n    }\n\n    p._processToken(token);\n  } else {\n    var current = p._getAdjustedCurrentElement(),\n        currentNs = p.treeAdapter.getNamespaceURI(current);\n\n    if (currentNs === NS.MATHML) ForeignContent.adjustTokenMathMLAttrs(token);else if (currentNs === NS.SVG) {\n      ForeignContent.adjustTokenSVGTagName(token);\n      ForeignContent.adjustTokenSVGAttrs(token);\n    }\n    ForeignContent.adjustTokenXMLAttrs(token);\n    if (token.selfClosing) p._appendElement(token, currentNs);else p._insertElement(token, currentNs);\n  }\n}\n\nfunction endTagInForeignContent(p, token) {\n  for (var i = p.openElements.stackTop; i > 0; i--) {\n    var element = p.openElements.items[i];\n\n    if (p.treeAdapter.getNamespaceURI(element) === NS.HTML) {\n      p._processToken(token);\n\n      break;\n    }\n\n    if (p.treeAdapter.getTagName(element).toLowerCase() === token.tagName) {\n      p.openElements.popUntilElementPopped(element);\n      break;\n    }\n  }\n}","map":{"version":3,"sources":["F:/JavaScript/Projects/chemistryphile/node_modules/jsdom-no-contextify/node_modules/parse5/lib/tree_construction/parser.js"],"names":["Tokenizer","require","OpenElementStack","FormattingElementList","LocationInfoMixin","DefaultTreeAdapter","Doctype","ForeignContent","Utils","UNICODE","HTML","$","TAG_NAMES","NS","NAMESPACES","ATTRS","DEFAULT_OPTIONS","decodeHtmlEntities","locationInfo","SEARCHABLE_INDEX_DEFAULT_PROMPT","SEARCHABLE_INDEX_INPUT_NAME","HIDDEN_INPUT_TYPE","AA_OUTER_LOOP_ITER","AA_INNER_LOOP_ITER","INITIAL_MODE","BEFORE_HTML_MODE","BEFORE_HEAD_MODE","IN_HEAD_MODE","AFTER_HEAD_MODE","IN_BODY_MODE","TEXT_MODE","IN_TABLE_MODE","IN_TABLE_TEXT_MODE","IN_CAPTION_MODE","IN_COLUMN_GROUP_MODE","IN_TABLE_BODY_MODE","IN_ROW_MODE","IN_CELL_MODE","IN_SELECT_MODE","IN_SELECT_IN_TABLE_MODE","IN_TEMPLATE_MODE","AFTER_BODY_MODE","IN_FRAMESET_MODE","AFTER_FRAMESET_MODE","AFTER_AFTER_BODY_MODE","AFTER_AFTER_FRAMESET_MODE","INSERTION_MODE_RESET_MAP","TR","TBODY","THEAD","TFOOT","CAPTION","COLGROUP","TABLE","BODY","FRAMESET","TEMPLATE_INSERTION_MODE_SWITCH_MAP","COL","TD","TH","_","CHARACTER_TOKEN","NULL_CHARACTER_TOKEN","tokenInInitialMode","WHITESPACE_CHARACTER_TOKEN","ignoreToken","COMMENT_TOKEN","appendComment","DOCTYPE_TOKEN","doctypeInInitialMode","START_TAG_TOKEN","END_TAG_TOKEN","EOF_TOKEN","tokenBeforeHtml","startTagBeforeHtml","endTagBeforeHtml","tokenBeforeHead","startTagBeforeHead","endTagBeforeHead","tokenInHead","insertCharacters","startTagInHead","endTagInHead","tokenAfterHead","startTagAfterHead","endTagAfterHead","characterInBody","whitespaceCharacterInBody","startTagInBody","endTagInBody","eofInBody","endTagInText","eofInText","characterInTable","startTagInTable","endTagInTable","characterInTableText","whitespaceCharacterInTableText","tokenInTableText","startTagInCaption","endTagInCaption","tokenInColumnGroup","startTagInColumnGroup","endTagInColumnGroup","startTagInTableBody","endTagInTableBody","startTagInRow","endTagInRow","startTagInCell","endTagInCell","startTagInSelect","endTagInSelect","startTagInSelectInTable","endTagInSelectInTable","startTagInTemplate","endTagInTemplate","eofInTemplate","tokenAfterBody","appendCommentToRootHtmlElement","startTagAfterBody","endTagAfterBody","stopParsing","startTagInFrameset","endTagInFrameset","startTagAfterFrameset","endTagAfterFrameset","tokenAfterAfterBody","appendCommentToDocument","startTagAfterAfterBody","startTagAfterAfterFrameset","getSearchableIndexFormAttrs","isindexStartTagToken","indexAction","getTokenAttr","ACTION","attrs","push","name","value","getSearchableIndexLabelText","indexPrompt","PROMPT","getSearchableIndexInputAttrs","isindexAttrs","inputAttrs","i","length","NAME","Parser","module","exports","treeAdapter","options","mergeOptions","scriptHandler","assign","prototype","parse","html","document","createDocument","_reset","_runParsingLoop","parseFragment","fragmentContext","createElement","TEMPLATE","documentMock","getTagName","_pushTmplInsertionMode","_initTokenizerForFragmentParsing","_insertFakeRootElement","_resetInsertionMode","_findFormInFragmentContext","rootElement","getFirstChild","fragment","createDocumentFragment","_adoptNodes","tokenizer","stopped","insertionMode","originalInsertionMode","headElement","formElement","openElements","activeFormattingElements","tmplInsertionModeStack","tmplInsertionModeStackTop","currentTmplInsertionMode","pendingCharacterTokens","hasNonWhitespacePendingCharacterToken","framesetOk","skipNextNewLine","fosterParentingEnabled","_iterateParsingLoop","_setupTokenizerCDATAMode","token","getNextToken","type","chars","substr","_shouldProcessTokenInForeignContent","_processTokenInForeignContent","_processToken","current","_getAdjustedCurrentElement","allowCDATA","getNamespaceURI","_isHtmlIntegrationPoint","_isMathMLTextIntegrationPoint","_switchToTextParsing","currentToken","nextTokenizerState","_insertElement","state","stackTop","node","FORM","getParentNode","tn","TITLE","TEXTAREA","MODE","RCDATA","STYLE","XMP","IFRAME","NOEMBED","NOFRAMES","NOSCRIPT","RAWTEXT","SCRIPT","SCRIPT_DATA","PLAINTEXT","_setDocumentType","setDocumentType","publicId","systemId","_attachElementToTree","element","_shouldFosterParentOnInsertion","_fosterParentElement","parent","currentTmplContent","appendChild","_appendElement","namespaceURI","tagName","_insertTemplate","tmpl","content","_appendCommentNode","commentNode","createCommentNode","data","_insertCharacters","_fosterParentText","insertText","donor","recipient","child","detachNode","ns","ANNOTATION_XML","MATHML","SVG","isCharacterToken","isMathMLTextStartTag","MGLYPH","MALIGNMARK","_processTokenInBodyMode","characterInForeignContent","nullCharacterInForeignContent","startTagInForeignContent","endTagInForeignContent","_processFakeStartTagWithAttrs","fakeToken","buildStartTagToken","_processFakeStartTag","_processFakeEndTag","buildEndTagToken","isMathMLTextIntegrationPoint","getAttrList","isHtmlIntegrationPoint","_reconstructActiveFormattingElements","listLength","unopenIdx","entry","entries","MARKER_ENTRY","contains","_closeTableCell","hasInTableScope","_closePElement","generateImpliedEndTagsWithExclusion","P","popUntilTagNamePopped","last","items","newInsertionMode","HEAD","SELECT","_resetInsertionModeForSelect","selectIdx","ancestor","mode","_popTmplInsertionMode","pop","_isElementCausesFosterParenting","_findFosterParentingLocation","location","beforeElement","openElement","getChildNodes","insertBefore","insertTextBefore","_isSpecialElement","SPECIAL_ELEMENTS","aaObtainFormattingElementEntry","p","formattingElementEntry","getElementEntryInScopeWithTagName","removeEntry","hasInScope","genericEndTagInBody","aaObtainFurthestBlock","furthestBlock","popUntilElementPopped","aaInnerLoop","formattingElement","lastElement","nextElement","getCommonAncestor","elementEntry","getElementEntry","remove","aaRecreateElementFromEntry","bookmark","newElement","replace","aaInsertLastNodeInCommonAncestor","commonAncestor","aaReplaceFormattingElement","insertElementAfterBookmark","insertAfter","callAdoptionAgency","forceQuirks","isQuirks","setQuirksMode","BR","BASE","BASEFONT","BGSOUND","COMMAND","LINK","META","insertMarker","tmplCount","generateImpliedEndTags","popUntilTemplatePopped","clearToLastMarker","htmlStartTagInBody","adoptAttributes","bodyStartTagInBody","bodyElement","tryPeekProperlyNestedBodyElement","framesetStartTagInBody","popAllUpToHtmlElement","addressStartTagInBody","hasInButtonScope","numberedHeaderStartTagInBody","currentTagName","H1","H2","H3","H4","H5","H6","preStartTagInBody","formStartTagInBody","inTemplate","listItemStartTagInBody","LI","DD","DT","ADDRESS","DIV","plaintextStartTagInBody","buttonStartTagInBody","BUTTON","aStartTagInBody","activeElementEntry","A","pushElement","bStartTagInBody","nobrStartTagInBody","NOBR","appletStartTagInBody","tableStartTagInBody","isQuirksMode","areaStartTagInBody","inputStartTagInBody","inputType","TYPE","toLowerCase","paramStartTagInBody","hrStartTagInBody","imageStartTagInBody","IMG","isindexStartTagInBody","HR","LABEL","INPUT","textareaStartTagInBody","xmpStartTagInBody","iframeStartTagInBody","noembedStartTagInBody","selectStartTagInBody","optgroupStartTagInBody","OPTION","rpStartTagInBody","RUBY","menuitemStartTagInBody","mathStartTagInBody","adjustTokenMathMLAttrs","adjustTokenXMLAttrs","selfClosing","svgStartTagInBody","adjustTokenSVGAttrs","genericStartTagInBody","I","S","B","U","DL","OL","UL","EM","TT","RP","RT","DIR","NAV","PRE","BIG","WBR","MAIN","MENU","CODE","FONT","AREA","MATH","ASIDE","SMALL","EMBED","PARAM","TRACK","IMAGE","FRAME","CENTER","FIGURE","FOOTER","HEADER","HGROUP","STRIKE","STRONG","APPLET","OBJECT","KEYGEN","SOURCE","DETAILS","ARTICLE","SECTION","SUMMARY","LISTING","MARQUEE","ISINDEX","MENUITEM","FIELDSET","OPTGROUP","BLOCKQUOTE","FIGCAPTION","bodyEndTagInBody","ignored","htmlEndTagInBody","addressEndTagInBody","formEndTagInBody","pEndTagInBody","liEndTagInBody","hasInListItemScope","ddEndTagInBody","numberedHeaderEndTagInBody","hasNumberedHeaderInScope","popUntilNumberedHeaderPopped","appletEndTagInBody","brEndTagInBody","curTn","tokenInTable","captionStartTagInTable","clearBackToTableContext","colgroupStartTagInTable","colStartTagInTable","tbodyStartTagInTable","tdStartTagInTable","tableStartTagInTable","inputStartTagInTable","formStartTagInTable","savedFosterParentingState","clearBackToTableBodyContext","hasTableBodyContextInTableScope","clearBackToTableRowContext","hasInSelectScope","prevOpenElement","prevOpenElementTn","isRootHtmlElementCurrent","REPLACEMENT_CHARACTER","causesExit","currentNs","adjustTokenSVGTagName"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nvar Tokenizer = require('../tokenization/tokenizer'),\r\n    OpenElementStack = require('./open_element_stack'),\r\n    FormattingElementList = require('./formatting_element_list'),\r\n    LocationInfoMixin = require('./location_info_mixin'),\r\n    DefaultTreeAdapter = require('../tree_adapters/default'),\r\n    Doctype = require('../common/doctype'),\r\n    ForeignContent = require('../common/foreign_content'),\r\n    Utils = require('../common/utils'),\r\n    UNICODE = require('../common/unicode'),\r\n    HTML = require('../common/html');\r\n\r\n//Aliases\r\nvar $ = HTML.TAG_NAMES,\r\n    NS = HTML.NAMESPACES,\r\n    ATTRS = HTML.ATTRS;\r\n\r\n//Default options\r\nvar DEFAULT_OPTIONS = {\r\n    decodeHtmlEntities: true,\r\n    locationInfo: false\r\n};\r\n\r\n//Misc constants\r\nvar SEARCHABLE_INDEX_DEFAULT_PROMPT = 'This is a searchable index. Enter search keywords: ',\r\n    SEARCHABLE_INDEX_INPUT_NAME = 'isindex',\r\n    HIDDEN_INPUT_TYPE = 'hidden';\r\n\r\n//Adoption agency loops iteration count\r\nvar AA_OUTER_LOOP_ITER = 8,\r\n    AA_INNER_LOOP_ITER = 3;\r\n\r\n//Insertion modes\r\nvar INITIAL_MODE = 'INITIAL_MODE',\r\n    BEFORE_HTML_MODE = 'BEFORE_HTML_MODE',\r\n    BEFORE_HEAD_MODE = 'BEFORE_HEAD_MODE',\r\n    IN_HEAD_MODE = 'IN_HEAD_MODE',\r\n    AFTER_HEAD_MODE = 'AFTER_HEAD_MODE',\r\n    IN_BODY_MODE = 'IN_BODY_MODE',\r\n    TEXT_MODE = 'TEXT_MODE',\r\n    IN_TABLE_MODE = 'IN_TABLE_MODE',\r\n    IN_TABLE_TEXT_MODE = 'IN_TABLE_TEXT_MODE',\r\n    IN_CAPTION_MODE = 'IN_CAPTION_MODE',\r\n    IN_COLUMN_GROUP_MODE = 'IN_COLUMN_GROUP_MODE',\r\n    IN_TABLE_BODY_MODE = 'IN_TABLE_BODY_MODE',\r\n    IN_ROW_MODE = 'IN_ROW_MODE',\r\n    IN_CELL_MODE = 'IN_CELL_MODE',\r\n    IN_SELECT_MODE = 'IN_SELECT_MODE',\r\n    IN_SELECT_IN_TABLE_MODE = 'IN_SELECT_IN_TABLE_MODE',\r\n    IN_TEMPLATE_MODE = 'IN_TEMPLATE_MODE',\r\n    AFTER_BODY_MODE = 'AFTER_BODY_MODE',\r\n    IN_FRAMESET_MODE = 'IN_FRAMESET_MODE',\r\n    AFTER_FRAMESET_MODE = 'AFTER_FRAMESET_MODE',\r\n    AFTER_AFTER_BODY_MODE = 'AFTER_AFTER_BODY_MODE',\r\n    AFTER_AFTER_FRAMESET_MODE = 'AFTER_AFTER_FRAMESET_MODE';\r\n\r\n//Insertion mode reset map\r\nvar INSERTION_MODE_RESET_MAP = {};\r\n\r\nINSERTION_MODE_RESET_MAP[$.TR] = IN_ROW_MODE;\r\nINSERTION_MODE_RESET_MAP[$.TBODY] =\r\nINSERTION_MODE_RESET_MAP[$.THEAD] =\r\nINSERTION_MODE_RESET_MAP[$.TFOOT] = IN_TABLE_BODY_MODE;\r\nINSERTION_MODE_RESET_MAP[$.CAPTION] = IN_CAPTION_MODE;\r\nINSERTION_MODE_RESET_MAP[$.COLGROUP] = IN_COLUMN_GROUP_MODE;\r\nINSERTION_MODE_RESET_MAP[$.TABLE] = IN_TABLE_MODE;\r\nINSERTION_MODE_RESET_MAP[$.BODY] = IN_BODY_MODE;\r\nINSERTION_MODE_RESET_MAP[$.FRAMESET] = IN_FRAMESET_MODE;\r\n\r\n//Template insertion mode switch map\r\nvar TEMPLATE_INSERTION_MODE_SWITCH_MAP = {};\r\n\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.CAPTION] =\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.COLGROUP] =\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TBODY] =\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TFOOT] =\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.THEAD] = IN_TABLE_MODE;\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.COL] = IN_COLUMN_GROUP_MODE;\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TR] = IN_TABLE_BODY_MODE;\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TD] =\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TH] = IN_ROW_MODE;\r\n\r\n//Token handlers map for insertion modes\r\nvar _ = {};\r\n\r\n_[INITIAL_MODE] = {};\r\n_[INITIAL_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[INITIAL_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenInInitialMode;\r\n_[INITIAL_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = ignoreToken;\r\n_[INITIAL_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[INITIAL_MODE][Tokenizer.DOCTYPE_TOKEN] = doctypeInInitialMode;\r\n_[INITIAL_MODE][Tokenizer.START_TAG_TOKEN] =\r\n_[INITIAL_MODE][Tokenizer.END_TAG_TOKEN] =\r\n_[INITIAL_MODE][Tokenizer.EOF_TOKEN] = tokenInInitialMode;\r\n\r\n_[BEFORE_HTML_MODE] = {};\r\n_[BEFORE_HTML_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[BEFORE_HTML_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenBeforeHtml;\r\n_[BEFORE_HTML_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = ignoreToken;\r\n_[BEFORE_HTML_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[BEFORE_HTML_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[BEFORE_HTML_MODE][Tokenizer.START_TAG_TOKEN] = startTagBeforeHtml;\r\n_[BEFORE_HTML_MODE][Tokenizer.END_TAG_TOKEN] = endTagBeforeHtml;\r\n_[BEFORE_HTML_MODE][Tokenizer.EOF_TOKEN] = tokenBeforeHtml;\r\n\r\n_[BEFORE_HEAD_MODE] = {};\r\n_[BEFORE_HEAD_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[BEFORE_HEAD_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenBeforeHead;\r\n_[BEFORE_HEAD_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = ignoreToken;\r\n_[BEFORE_HEAD_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[BEFORE_HEAD_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[BEFORE_HEAD_MODE][Tokenizer.START_TAG_TOKEN] = startTagBeforeHead;\r\n_[BEFORE_HEAD_MODE][Tokenizer.END_TAG_TOKEN] = endTagBeforeHead;\r\n_[BEFORE_HEAD_MODE][Tokenizer.EOF_TOKEN] = tokenBeforeHead;\r\n\r\n_[IN_HEAD_MODE] = {};\r\n_[IN_HEAD_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[IN_HEAD_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenInHead;\r\n_[IN_HEAD_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_HEAD_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_HEAD_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_HEAD_MODE][Tokenizer.START_TAG_TOKEN] = startTagInHead;\r\n_[IN_HEAD_MODE][Tokenizer.END_TAG_TOKEN] = endTagInHead;\r\n_[IN_HEAD_MODE][Tokenizer.EOF_TOKEN] = tokenInHead;\r\n\r\n_[AFTER_HEAD_MODE] = {};\r\n_[AFTER_HEAD_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[AFTER_HEAD_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenAfterHead;\r\n_[AFTER_HEAD_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[AFTER_HEAD_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[AFTER_HEAD_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[AFTER_HEAD_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterHead;\r\n_[AFTER_HEAD_MODE][Tokenizer.END_TAG_TOKEN] = endTagAfterHead;\r\n_[AFTER_HEAD_MODE][Tokenizer.EOF_TOKEN] = tokenAfterHead;\r\n\r\n_[IN_BODY_MODE] = {};\r\n_[IN_BODY_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\r\n_[IN_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[IN_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagInBody;\r\n_[IN_BODY_MODE][Tokenizer.END_TAG_TOKEN] = endTagInBody;\r\n_[IN_BODY_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[TEXT_MODE] = {};\r\n_[TEXT_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[TEXT_MODE][Tokenizer.NULL_CHARACTER_TOKEN] =\r\n_[TEXT_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[TEXT_MODE][Tokenizer.COMMENT_TOKEN] =\r\n_[TEXT_MODE][Tokenizer.DOCTYPE_TOKEN] =\r\n_[TEXT_MODE][Tokenizer.START_TAG_TOKEN] = ignoreToken;\r\n_[TEXT_MODE][Tokenizer.END_TAG_TOKEN] = endTagInText;\r\n_[TEXT_MODE][Tokenizer.EOF_TOKEN] = eofInText;\r\n\r\n_[IN_TABLE_MODE] = {};\r\n_[IN_TABLE_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[IN_TABLE_MODE][Tokenizer.NULL_CHARACTER_TOKEN] =\r\n_[IN_TABLE_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = characterInTable;\r\n_[IN_TABLE_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_TABLE_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_TABLE_MODE][Tokenizer.START_TAG_TOKEN] = startTagInTable;\r\n_[IN_TABLE_MODE][Tokenizer.END_TAG_TOKEN] = endTagInTable;\r\n_[IN_TABLE_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_TABLE_TEXT_MODE] = {};\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.CHARACTER_TOKEN] = characterInTableText;\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInTableText;\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.COMMENT_TOKEN] =\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.DOCTYPE_TOKEN] =\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.START_TAG_TOKEN] =\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.END_TAG_TOKEN] =\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.EOF_TOKEN] = tokenInTableText;\r\n\r\n_[IN_CAPTION_MODE] = {};\r\n_[IN_CAPTION_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\r\n_[IN_CAPTION_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_CAPTION_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[IN_CAPTION_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_CAPTION_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_CAPTION_MODE][Tokenizer.START_TAG_TOKEN] = startTagInCaption;\r\n_[IN_CAPTION_MODE][Tokenizer.END_TAG_TOKEN] = endTagInCaption;\r\n_[IN_CAPTION_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_COLUMN_GROUP_MODE] = {};\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenInColumnGroup;\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.START_TAG_TOKEN] = startTagInColumnGroup;\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.END_TAG_TOKEN] = endTagInColumnGroup;\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_TABLE_BODY_MODE] = {};\r\n_[IN_TABLE_BODY_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[IN_TABLE_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] =\r\n_[IN_TABLE_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = characterInTable;\r\n_[IN_TABLE_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_TABLE_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_TABLE_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagInTableBody;\r\n_[IN_TABLE_BODY_MODE][Tokenizer.END_TAG_TOKEN] = endTagInTableBody;\r\n_[IN_TABLE_BODY_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_ROW_MODE] = {};\r\n_[IN_ROW_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[IN_ROW_MODE][Tokenizer.NULL_CHARACTER_TOKEN] =\r\n_[IN_ROW_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = characterInTable;\r\n_[IN_ROW_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_ROW_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_ROW_MODE][Tokenizer.START_TAG_TOKEN] = startTagInRow;\r\n_[IN_ROW_MODE][Tokenizer.END_TAG_TOKEN] = endTagInRow;\r\n_[IN_ROW_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_CELL_MODE] = {};\r\n_[IN_CELL_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\r\n_[IN_CELL_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_CELL_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[IN_CELL_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_CELL_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_CELL_MODE][Tokenizer.START_TAG_TOKEN] = startTagInCell;\r\n_[IN_CELL_MODE][Tokenizer.END_TAG_TOKEN] = endTagInCell;\r\n_[IN_CELL_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_SELECT_MODE] = {};\r\n_[IN_SELECT_MODE][Tokenizer.CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_SELECT_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_SELECT_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_SELECT_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_SELECT_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_SELECT_MODE][Tokenizer.START_TAG_TOKEN] = startTagInSelect;\r\n_[IN_SELECT_MODE][Tokenizer.END_TAG_TOKEN] = endTagInSelect;\r\n_[IN_SELECT_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_SELECT_IN_TABLE_MODE] = {};\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.START_TAG_TOKEN] = startTagInSelectInTable;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.END_TAG_TOKEN] = endTagInSelectInTable;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_TEMPLATE_MODE] = {};\r\n_[IN_TEMPLATE_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\r\n_[IN_TEMPLATE_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_TEMPLATE_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[IN_TEMPLATE_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_TEMPLATE_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_TEMPLATE_MODE][Tokenizer.START_TAG_TOKEN] = startTagInTemplate;\r\n_[IN_TEMPLATE_MODE][Tokenizer.END_TAG_TOKEN] = endTagInTemplate;\r\n_[IN_TEMPLATE_MODE][Tokenizer.EOF_TOKEN] = eofInTemplate;\r\n\r\n_[AFTER_BODY_MODE] = {};\r\n_[AFTER_BODY_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[AFTER_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenAfterBody;\r\n_[AFTER_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[AFTER_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendCommentToRootHtmlElement;\r\n_[AFTER_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[AFTER_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterBody;\r\n_[AFTER_BODY_MODE][Tokenizer.END_TAG_TOKEN] = endTagAfterBody;\r\n_[AFTER_BODY_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\r\n\r\n_[IN_FRAMESET_MODE] = {};\r\n_[IN_FRAMESET_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[IN_FRAMESET_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_FRAMESET_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_FRAMESET_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_FRAMESET_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_FRAMESET_MODE][Tokenizer.START_TAG_TOKEN] = startTagInFrameset;\r\n_[IN_FRAMESET_MODE][Tokenizer.END_TAG_TOKEN] = endTagInFrameset;\r\n_[IN_FRAMESET_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\r\n\r\n_[AFTER_FRAMESET_MODE] = {};\r\n_[AFTER_FRAMESET_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[AFTER_FRAMESET_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[AFTER_FRAMESET_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[AFTER_FRAMESET_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[AFTER_FRAMESET_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[AFTER_FRAMESET_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterFrameset;\r\n_[AFTER_FRAMESET_MODE][Tokenizer.END_TAG_TOKEN] = endTagAfterFrameset;\r\n_[AFTER_FRAMESET_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\r\n\r\n_[AFTER_AFTER_BODY_MODE] = {};\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.CHARACTER_TOKEN] = tokenAfterAfterBody;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenAfterAfterBody;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendCommentToDocument;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterAfterBody;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.END_TAG_TOKEN] = tokenAfterAfterBody;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\r\n\r\n_[AFTER_AFTER_FRAMESET_MODE] = {};\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.COMMENT_TOKEN] = appendCommentToDocument;\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterAfterFrameset;\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.END_TAG_TOKEN] = ignoreToken;\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\r\n\r\n//Searchable index building utils (<isindex> tag)\r\nfunction getSearchableIndexFormAttrs(isindexStartTagToken) {\r\n    var indexAction = Tokenizer.getTokenAttr(isindexStartTagToken, ATTRS.ACTION),\r\n        attrs = [];\r\n\r\n    if (indexAction !== null) {\r\n        attrs.push({\r\n            name: ATTRS.ACTION,\r\n            value: indexAction\r\n        });\r\n    }\r\n\r\n    return attrs;\r\n}\r\n\r\nfunction getSearchableIndexLabelText(isindexStartTagToken) {\r\n    var indexPrompt = Tokenizer.getTokenAttr(isindexStartTagToken, ATTRS.PROMPT);\r\n\r\n    return indexPrompt === null ? SEARCHABLE_INDEX_DEFAULT_PROMPT : indexPrompt;\r\n}\r\n\r\nfunction getSearchableIndexInputAttrs(isindexStartTagToken) {\r\n    var isindexAttrs = isindexStartTagToken.attrs,\r\n        inputAttrs = [];\r\n\r\n    for (var i = 0; i < isindexAttrs.length; i++) {\r\n        var name = isindexAttrs[i].name;\r\n\r\n        if (name !== ATTRS.NAME && name !== ATTRS.ACTION && name !== ATTRS.PROMPT)\r\n            inputAttrs.push(isindexAttrs[i]);\r\n    }\r\n\r\n    inputAttrs.push({\r\n        name: ATTRS.NAME,\r\n        value: SEARCHABLE_INDEX_INPUT_NAME\r\n    });\r\n\r\n    return inputAttrs;\r\n}\r\n\r\n//Parser\r\nvar Parser = module.exports = function (treeAdapter, options) {\r\n    this.treeAdapter = treeAdapter || DefaultTreeAdapter;\r\n    this.options = Utils.mergeOptions(DEFAULT_OPTIONS, options);\r\n    this.scriptHandler = null;\r\n\r\n    if (this.options.locationInfo)\r\n        LocationInfoMixin.assign(this);\r\n};\r\n\r\n//API\r\nParser.prototype.parse = function (html) {\r\n    var document = this.treeAdapter.createDocument();\r\n\r\n    this._reset(html, document, null);\r\n    this._runParsingLoop();\r\n\r\n    return document;\r\n};\r\n\r\nParser.prototype.parseFragment = function (html, fragmentContext) {\r\n    //NOTE: use <template> element as a fragment context if context element was not provided,\r\n    //so we will parse in \"forgiving\" manner\r\n    if (!fragmentContext)\r\n        fragmentContext = this.treeAdapter.createElement($.TEMPLATE, NS.HTML, []);\r\n\r\n    //NOTE: create fake element which will be used as 'document' for fragment parsing.\r\n    //This is important for jsdom there 'document' can't be recreated, therefore\r\n    //fragment parsing causes messing of the main `document`.\r\n    var documentMock = this.treeAdapter.createElement('documentmock', NS.HTML, []);\r\n\r\n    this._reset(html, documentMock, fragmentContext);\r\n\r\n    if (this.treeAdapter.getTagName(fragmentContext) === $.TEMPLATE)\r\n        this._pushTmplInsertionMode(IN_TEMPLATE_MODE);\r\n\r\n    this._initTokenizerForFragmentParsing();\r\n    this._insertFakeRootElement();\r\n    this._resetInsertionMode();\r\n    this._findFormInFragmentContext();\r\n    this._runParsingLoop();\r\n\r\n    var rootElement = this.treeAdapter.getFirstChild(documentMock),\r\n        fragment = this.treeAdapter.createDocumentFragment();\r\n\r\n    this._adoptNodes(rootElement, fragment);\r\n\r\n    return fragment;\r\n};\r\n\r\n//Reset state\r\nParser.prototype._reset = function (html, document, fragmentContext) {\r\n    this.tokenizer = new Tokenizer(html, this.options);\r\n\r\n    this.stopped = false;\r\n\r\n    this.insertionMode = INITIAL_MODE;\r\n    this.originalInsertionMode = '';\r\n\r\n    this.document = document;\r\n    this.fragmentContext = fragmentContext;\r\n\r\n    this.headElement = null;\r\n    this.formElement = null;\r\n\r\n    this.openElements = new OpenElementStack(this.document, this.treeAdapter);\r\n    this.activeFormattingElements = new FormattingElementList(this.treeAdapter);\r\n\r\n    this.tmplInsertionModeStack = [];\r\n    this.tmplInsertionModeStackTop = -1;\r\n    this.currentTmplInsertionMode = null;\r\n\r\n    this.pendingCharacterTokens = [];\r\n    this.hasNonWhitespacePendingCharacterToken = false;\r\n\r\n    this.framesetOk = true;\r\n    this.skipNextNewLine = false;\r\n    this.fosterParentingEnabled = false;\r\n};\r\n\r\n//Parsing loop\r\nParser.prototype._iterateParsingLoop = function () {\r\n    this._setupTokenizerCDATAMode();\r\n\r\n    var token = this.tokenizer.getNextToken();\r\n\r\n    if (this.skipNextNewLine) {\r\n        this.skipNextNewLine = false;\r\n\r\n        if (token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN && token.chars[0] === '\\n') {\r\n            if (token.chars.length === 1)\r\n                return;\r\n\r\n            token.chars = token.chars.substr(1);\r\n        }\r\n    }\r\n\r\n    if (this._shouldProcessTokenInForeignContent(token))\r\n        this._processTokenInForeignContent(token);\r\n\r\n    else\r\n        this._processToken(token);\r\n};\r\n\r\nParser.prototype._runParsingLoop = function () {\r\n    while (!this.stopped)\r\n        this._iterateParsingLoop();\r\n};\r\n\r\n//Text parsing\r\nParser.prototype._setupTokenizerCDATAMode = function () {\r\n    var current = this._getAdjustedCurrentElement();\r\n\r\n    this.tokenizer.allowCDATA = current && current !== this.document &&\r\n                                this.treeAdapter.getNamespaceURI(current) !== NS.HTML &&\r\n                                (!this._isHtmlIntegrationPoint(current)) &&\r\n                                (!this._isMathMLTextIntegrationPoint(current));\r\n};\r\n\r\nParser.prototype._switchToTextParsing = function (currentToken, nextTokenizerState) {\r\n    this._insertElement(currentToken, NS.HTML);\r\n    this.tokenizer.state = nextTokenizerState;\r\n    this.originalInsertionMode = this.insertionMode;\r\n    this.insertionMode = TEXT_MODE;\r\n};\r\n\r\n//Fragment parsing\r\nParser.prototype._getAdjustedCurrentElement = function () {\r\n    return this.openElements.stackTop === 0 && this.fragmentContext ?\r\n           this.fragmentContext :\r\n           this.openElements.current;\r\n};\r\n\r\nParser.prototype._findFormInFragmentContext = function () {\r\n    var node = this.fragmentContext;\r\n\r\n    do {\r\n        if (this.treeAdapter.getTagName(node) === $.FORM) {\r\n            this.formElement = node;\r\n            break;\r\n        }\r\n\r\n        node = this.treeAdapter.getParentNode(node);\r\n    } while (node);\r\n};\r\n\r\nParser.prototype._initTokenizerForFragmentParsing = function () {\r\n    var tn = this.treeAdapter.getTagName(this.fragmentContext);\r\n\r\n    if (tn === $.TITLE || tn === $.TEXTAREA)\r\n        this.tokenizer.state = Tokenizer.MODE.RCDATA;\r\n\r\n    else if (tn === $.STYLE || tn === $.XMP || tn === $.IFRAME ||\r\n             tn === $.NOEMBED || tn === $.NOFRAMES || tn === $.NOSCRIPT) {\r\n        this.tokenizer.state = Tokenizer.MODE.RAWTEXT;\r\n    }\r\n\r\n    else if (tn === $.SCRIPT)\r\n        this.tokenizer.state = Tokenizer.MODE.SCRIPT_DATA;\r\n\r\n    else if (tn === $.PLAINTEXT)\r\n        this.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\r\n};\r\n\r\n//Tree mutation\r\nParser.prototype._setDocumentType = function (token) {\r\n    this.treeAdapter.setDocumentType(this.document, token.name, token.publicId, token.systemId);\r\n};\r\n\r\nParser.prototype._attachElementToTree = function (element) {\r\n    if (this._shouldFosterParentOnInsertion())\r\n        this._fosterParentElement(element);\r\n\r\n    else {\r\n        var parent = this.openElements.currentTmplContent || this.openElements.current;\r\n\r\n        this.treeAdapter.appendChild(parent, element);\r\n    }\r\n};\r\n\r\nParser.prototype._appendElement = function (token, namespaceURI) {\r\n    var element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\r\n\r\n    this._attachElementToTree(element);\r\n};\r\n\r\nParser.prototype._insertElement = function (token, namespaceURI) {\r\n    var element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\r\n\r\n    this._attachElementToTree(element);\r\n    this.openElements.push(element);\r\n};\r\n\r\nParser.prototype._insertTemplate = function (token) {\r\n    var tmpl = this.treeAdapter.createElement(token.tagName, NS.HTML, token.attrs),\r\n        content = this.treeAdapter.createDocumentFragment();\r\n\r\n    this.treeAdapter.appendChild(tmpl, content);\r\n    this._attachElementToTree(tmpl);\r\n    this.openElements.push(tmpl);\r\n};\r\n\r\nParser.prototype._insertFakeRootElement = function () {\r\n    var element = this.treeAdapter.createElement($.HTML, NS.HTML, []);\r\n\r\n    this.treeAdapter.appendChild(this.openElements.current, element);\r\n    this.openElements.push(element);\r\n};\r\n\r\nParser.prototype._appendCommentNode = function (token, parent) {\r\n    var commentNode = this.treeAdapter.createCommentNode(token.data);\r\n\r\n    this.treeAdapter.appendChild(parent, commentNode);\r\n};\r\n\r\nParser.prototype._insertCharacters = function (token) {\r\n    if (this._shouldFosterParentOnInsertion())\r\n        this._fosterParentText(token.chars);\r\n\r\n    else {\r\n        var parent = this.openElements.currentTmplContent || this.openElements.current;\r\n\r\n        this.treeAdapter.insertText(parent, token.chars);\r\n    }\r\n};\r\n\r\nParser.prototype._adoptNodes = function (donor, recipient) {\r\n    while (true) {\r\n        var child = this.treeAdapter.getFirstChild(donor);\r\n\r\n        if (!child)\r\n            break;\r\n\r\n        this.treeAdapter.detachNode(child);\r\n        this.treeAdapter.appendChild(recipient, child);\r\n    }\r\n};\r\n\r\n//Token processing\r\nParser.prototype._shouldProcessTokenInForeignContent = function (token) {\r\n    var current = this._getAdjustedCurrentElement();\r\n\r\n    if (!current || current === this.document)\r\n        return false;\r\n\r\n    var ns = this.treeAdapter.getNamespaceURI(current);\r\n\r\n    if (ns === NS.HTML)\r\n        return false;\r\n\r\n    if (this.treeAdapter.getTagName(current) === $.ANNOTATION_XML && ns === NS.MATHML &&\r\n        token.type === Tokenizer.START_TAG_TOKEN && token.tagName === $.SVG) {\r\n        return false;\r\n    }\r\n\r\n    var isCharacterToken = token.type === Tokenizer.CHARACTER_TOKEN ||\r\n                           token.type === Tokenizer.NULL_CHARACTER_TOKEN ||\r\n                           token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN,\r\n        isMathMLTextStartTag = token.type === Tokenizer.START_TAG_TOKEN &&\r\n                               token.tagName !== $.MGLYPH &&\r\n                               token.tagName !== $.MALIGNMARK;\r\n\r\n    if ((isMathMLTextStartTag || isCharacterToken) && this._isMathMLTextIntegrationPoint(current))\r\n        return false;\r\n\r\n    if ((token.type === Tokenizer.START_TAG_TOKEN || isCharacterToken) && this._isHtmlIntegrationPoint(current))\r\n        return false;\r\n\r\n    return token.type !== Tokenizer.EOF_TOKEN;\r\n};\r\n\r\nParser.prototype._processToken = function (token) {\r\n    _[this.insertionMode][token.type](this, token);\r\n};\r\n\r\nParser.prototype._processTokenInBodyMode = function (token) {\r\n    _[IN_BODY_MODE][token.type](this, token);\r\n};\r\n\r\nParser.prototype._processTokenInForeignContent = function (token) {\r\n    if (token.type === Tokenizer.CHARACTER_TOKEN)\r\n        characterInForeignContent(this, token);\r\n\r\n    else if (token.type === Tokenizer.NULL_CHARACTER_TOKEN)\r\n        nullCharacterInForeignContent(this, token);\r\n\r\n    else if (token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN)\r\n        insertCharacters(this, token);\r\n\r\n    else if (token.type === Tokenizer.COMMENT_TOKEN)\r\n        appendComment(this, token);\r\n\r\n    else if (token.type === Tokenizer.START_TAG_TOKEN)\r\n        startTagInForeignContent(this, token);\r\n\r\n    else if (token.type === Tokenizer.END_TAG_TOKEN)\r\n        endTagInForeignContent(this, token);\r\n};\r\n\r\nParser.prototype._processFakeStartTagWithAttrs = function (tagName, attrs) {\r\n    var fakeToken = this.tokenizer.buildStartTagToken(tagName);\r\n\r\n    fakeToken.attrs = attrs;\r\n    this._processToken(fakeToken);\r\n};\r\n\r\nParser.prototype._processFakeStartTag = function (tagName) {\r\n    var fakeToken = this.tokenizer.buildStartTagToken(tagName);\r\n\r\n    this._processToken(fakeToken);\r\n    return fakeToken;\r\n};\r\n\r\nParser.prototype._processFakeEndTag = function (tagName) {\r\n    var fakeToken = this.tokenizer.buildEndTagToken(tagName);\r\n\r\n    this._processToken(fakeToken);\r\n    return fakeToken;\r\n};\r\n\r\n//Integration points\r\nParser.prototype._isMathMLTextIntegrationPoint = function (element) {\r\n    var tn = this.treeAdapter.getTagName(element),\r\n        ns = this.treeAdapter.getNamespaceURI(element);\r\n\r\n    return ForeignContent.isMathMLTextIntegrationPoint(tn, ns);\r\n};\r\n\r\nParser.prototype._isHtmlIntegrationPoint = function (element) {\r\n    var tn = this.treeAdapter.getTagName(element),\r\n        ns = this.treeAdapter.getNamespaceURI(element),\r\n        attrs = this.treeAdapter.getAttrList(element);\r\n\r\n    return ForeignContent.isHtmlIntegrationPoint(tn, ns, attrs);\r\n};\r\n\r\n//Active formatting elements reconstruction\r\nParser.prototype._reconstructActiveFormattingElements = function () {\r\n    var listLength = this.activeFormattingElements.length;\r\n\r\n    if (listLength) {\r\n        var unopenIdx = listLength,\r\n            entry = null;\r\n\r\n        do {\r\n            unopenIdx--;\r\n            entry = this.activeFormattingElements.entries[unopenIdx];\r\n\r\n            if (entry.type === FormattingElementList.MARKER_ENTRY || this.openElements.contains(entry.element)) {\r\n                unopenIdx++;\r\n                break;\r\n            }\r\n        } while (unopenIdx > 0);\r\n\r\n        for (var i = unopenIdx; i < listLength; i++) {\r\n            entry = this.activeFormattingElements.entries[i];\r\n            this._insertElement(entry.token, this.treeAdapter.getNamespaceURI(entry.element));\r\n            entry.element = this.openElements.current;\r\n        }\r\n    }\r\n};\r\n\r\n//Close elements\r\nParser.prototype._closeTableCell = function () {\r\n    if (this.openElements.hasInTableScope($.TD))\r\n        this._processFakeEndTag($.TD);\r\n\r\n    else\r\n        this._processFakeEndTag($.TH);\r\n};\r\n\r\nParser.prototype._closePElement = function () {\r\n    this.openElements.generateImpliedEndTagsWithExclusion($.P);\r\n    this.openElements.popUntilTagNamePopped($.P);\r\n};\r\n\r\n//Insertion modes\r\nParser.prototype._resetInsertionMode = function () {\r\n    for (var i = this.openElements.stackTop, last = false; i >= 0; i--) {\r\n        var element = this.openElements.items[i];\r\n\r\n        if (i === 0) {\r\n            last = true;\r\n\r\n            if (this.fragmentContext)\r\n                element = this.fragmentContext;\r\n        }\r\n\r\n        var tn = this.treeAdapter.getTagName(element),\r\n            newInsertionMode = INSERTION_MODE_RESET_MAP[tn];\r\n\r\n        if (newInsertionMode) {\r\n            this.insertionMode = newInsertionMode;\r\n            break;\r\n        }\r\n\r\n        else if (!last && (tn === $.TD || tn === $.TH)) {\r\n            this.insertionMode = IN_CELL_MODE;\r\n            break;\r\n        }\r\n\r\n        else if (!last && tn === $.HEAD) {\r\n            this.insertionMode = IN_HEAD_MODE;\r\n            break;\r\n        }\r\n\r\n        else if (tn === $.SELECT) {\r\n            this._resetInsertionModeForSelect(i);\r\n            break;\r\n        }\r\n\r\n        else if (tn === $.TEMPLATE) {\r\n            this.insertionMode = this.currentTmplInsertionMode;\r\n            break;\r\n        }\r\n\r\n        else if (tn === $.HTML) {\r\n            this.insertionMode = this.headElement ? AFTER_HEAD_MODE : BEFORE_HEAD_MODE;\r\n            break;\r\n        }\r\n\r\n        else if (last) {\r\n            this.insertionMode = IN_BODY_MODE;\r\n            break;\r\n        }\r\n    }\r\n};\r\n\r\nParser.prototype._resetInsertionModeForSelect = function (selectIdx) {\r\n    if (selectIdx > 0) {\r\n        for (var i = selectIdx - 1; i > 0; i--) {\r\n            var ancestor = this.openElements.items[i],\r\n                tn = this.treeAdapter.getTagName(ancestor);\r\n\r\n            if (tn === $.TEMPLATE)\r\n                break;\r\n\r\n            else if (tn === $.TABLE) {\r\n                this.insertionMode = IN_SELECT_IN_TABLE_MODE;\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    this.insertionMode = IN_SELECT_MODE;\r\n};\r\n\r\nParser.prototype._pushTmplInsertionMode = function (mode) {\r\n    this.tmplInsertionModeStack.push(mode);\r\n    this.tmplInsertionModeStackTop++;\r\n    this.currentTmplInsertionMode = mode;\r\n};\r\n\r\nParser.prototype._popTmplInsertionMode = function () {\r\n    this.tmplInsertionModeStack.pop();\r\n    this.tmplInsertionModeStackTop--;\r\n    this.currentTmplInsertionMode = this.tmplInsertionModeStack[this.tmplInsertionModeStackTop];\r\n};\r\n\r\n//Foster parenting\r\nParser.prototype._isElementCausesFosterParenting = function (element) {\r\n    var tn = this.treeAdapter.getTagName(element);\r\n\r\n    return tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn == $.THEAD || tn === $.TR;\r\n};\r\n\r\nParser.prototype._shouldFosterParentOnInsertion = function () {\r\n    return this.fosterParentingEnabled && this._isElementCausesFosterParenting(this.openElements.current);\r\n};\r\n\r\nParser.prototype._findFosterParentingLocation = function () {\r\n    var location = {\r\n        parent: null,\r\n        beforeElement: null\r\n    };\r\n\r\n    for (var i = this.openElements.stackTop; i >= 0; i--) {\r\n        var openElement = this.openElements.items[i],\r\n            tn = this.treeAdapter.getTagName(openElement),\r\n            ns = this.treeAdapter.getNamespaceURI(openElement);\r\n\r\n        if (tn === $.TEMPLATE && ns === NS.HTML) {\r\n            location.parent = this.treeAdapter.getChildNodes(openElement)[0];\r\n            break;\r\n        }\r\n\r\n        else if (tn === $.TABLE) {\r\n            location.parent = this.treeAdapter.getParentNode(openElement);\r\n\r\n            if (location.parent)\r\n                location.beforeElement = openElement;\r\n            else\r\n                location.parent = this.openElements.items[i - 1];\r\n\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (!location.parent)\r\n        location.parent = this.openElements.items[0];\r\n\r\n    return location;\r\n};\r\n\r\nParser.prototype._fosterParentElement = function (element) {\r\n    var location = this._findFosterParentingLocation();\r\n\r\n    if (location.beforeElement)\r\n        this.treeAdapter.insertBefore(location.parent, element, location.beforeElement);\r\n    else\r\n        this.treeAdapter.appendChild(location.parent, element);\r\n};\r\n\r\nParser.prototype._fosterParentText = function (chars) {\r\n    var location = this._findFosterParentingLocation();\r\n\r\n    if (location.beforeElement)\r\n        this.treeAdapter.insertTextBefore(location.parent, chars, location.beforeElement);\r\n    else\r\n        this.treeAdapter.insertText(location.parent, chars);\r\n};\r\n\r\n//Special elements\r\nParser.prototype._isSpecialElement = function (element) {\r\n    var tn = this.treeAdapter.getTagName(element),\r\n        ns = this.treeAdapter.getNamespaceURI(element);\r\n\r\n    return HTML.SPECIAL_ELEMENTS[ns][tn];\r\n};\r\n\r\n//Adoption agency algorithm\r\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#adoptionAgency)\r\n//------------------------------------------------------------------\r\n\r\n//Steps 5-8 of the algorithm\r\nfunction aaObtainFormattingElementEntry(p, token) {\r\n    var formattingElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(token.tagName);\r\n\r\n    if (formattingElementEntry) {\r\n        if (!p.openElements.contains(formattingElementEntry.element)) {\r\n            p.activeFormattingElements.removeEntry(formattingElementEntry);\r\n            formattingElementEntry = null;\r\n        }\r\n\r\n        else if (!p.openElements.hasInScope(token.tagName))\r\n            formattingElementEntry = null;\r\n    }\r\n\r\n    else\r\n        genericEndTagInBody(p, token);\r\n\r\n    return formattingElementEntry;\r\n}\r\n\r\n//Steps 9 and 10 of the algorithm\r\nfunction aaObtainFurthestBlock(p, formattingElementEntry) {\r\n    var furthestBlock = null;\r\n\r\n    for (var i = p.openElements.stackTop; i >= 0; i--) {\r\n        var element = p.openElements.items[i];\r\n\r\n        if (element === formattingElementEntry.element)\r\n            break;\r\n\r\n        if (p._isSpecialElement(element))\r\n            furthestBlock = element;\r\n    }\r\n\r\n    if (!furthestBlock) {\r\n        p.openElements.popUntilElementPopped(formattingElementEntry.element);\r\n        p.activeFormattingElements.removeEntry(formattingElementEntry);\r\n    }\r\n\r\n    return furthestBlock;\r\n}\r\n\r\n//Step 13 of the algorithm\r\nfunction aaInnerLoop(p, furthestBlock, formattingElement) {\r\n    var element = null,\r\n        lastElement = furthestBlock,\r\n        nextElement = p.openElements.getCommonAncestor(furthestBlock);\r\n\r\n    for (var i = 0; i < AA_INNER_LOOP_ITER; i++) {\r\n        element = nextElement;\r\n\r\n        //NOTE: store next element for the next loop iteration (it may be deleted from the stack by step 9.5)\r\n        nextElement = p.openElements.getCommonAncestor(element);\r\n\r\n        var elementEntry = p.activeFormattingElements.getElementEntry(element);\r\n\r\n        if (!elementEntry) {\r\n            p.openElements.remove(element);\r\n            continue;\r\n        }\r\n\r\n        if (element === formattingElement)\r\n            break;\r\n\r\n        element = aaRecreateElementFromEntry(p, elementEntry);\r\n\r\n        if (lastElement === furthestBlock)\r\n            p.activeFormattingElements.bookmark = elementEntry;\r\n\r\n        p.treeAdapter.detachNode(lastElement);\r\n        p.treeAdapter.appendChild(element, lastElement);\r\n        lastElement = element;\r\n    }\r\n\r\n    return lastElement;\r\n}\r\n\r\n//Step 13.7 of the algorithm\r\nfunction aaRecreateElementFromEntry(p, elementEntry) {\r\n    var ns = p.treeAdapter.getNamespaceURI(elementEntry.element),\r\n        newElement = p.treeAdapter.createElement(elementEntry.token.tagName, ns, elementEntry.token.attrs);\r\n\r\n    p.openElements.replace(elementEntry.element, newElement);\r\n    elementEntry.element = newElement;\r\n\r\n    return newElement;\r\n}\r\n\r\n//Step 14 of the algorithm\r\nfunction aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement) {\r\n    if (p._isElementCausesFosterParenting(commonAncestor))\r\n        p._fosterParentElement(lastElement);\r\n\r\n    else {\r\n        var tn = p.treeAdapter.getTagName(commonAncestor),\r\n            ns = p.treeAdapter.getNamespaceURI(commonAncestor);\r\n\r\n        if (tn === $.TEMPLATE && ns === NS.HTML)\r\n            commonAncestor = p.treeAdapter.getChildNodes(commonAncestor)[0];\r\n\r\n        p.treeAdapter.appendChild(commonAncestor, lastElement);\r\n    }\r\n}\r\n\r\n//Steps 15-19 of the algorithm\r\nfunction aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry) {\r\n    var ns = p.treeAdapter.getNamespaceURI(formattingElementEntry.element),\r\n        token = formattingElementEntry.token,\r\n        newElement = p.treeAdapter.createElement(token.tagName, ns, token.attrs);\r\n\r\n    p._adoptNodes(furthestBlock, newElement);\r\n    p.treeAdapter.appendChild(furthestBlock, newElement);\r\n\r\n    p.activeFormattingElements.insertElementAfterBookmark(newElement, formattingElementEntry.token);\r\n    p.activeFormattingElements.removeEntry(formattingElementEntry);\r\n\r\n    p.openElements.remove(formattingElementEntry.element);\r\n    p.openElements.insertAfter(furthestBlock, newElement);\r\n}\r\n\r\n//Algorithm entry point\r\nfunction callAdoptionAgency(p, token) {\r\n    for (var i = 0; i < AA_OUTER_LOOP_ITER; i++) {\r\n        var formattingElementEntry = aaObtainFormattingElementEntry(p, token, formattingElementEntry);\r\n\r\n        if (!formattingElementEntry)\r\n            break;\r\n\r\n        var furthestBlock = aaObtainFurthestBlock(p, formattingElementEntry);\r\n\r\n        if (!furthestBlock)\r\n            break;\r\n\r\n        p.activeFormattingElements.bookmark = formattingElementEntry;\r\n\r\n        var lastElement = aaInnerLoop(p, furthestBlock, formattingElementEntry.element),\r\n            commonAncestor = p.openElements.getCommonAncestor(formattingElementEntry.element);\r\n\r\n        p.treeAdapter.detachNode(lastElement);\r\n        aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement);\r\n        aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry);\r\n    }\r\n}\r\n\r\n\r\n//Generic token handlers\r\n//------------------------------------------------------------------\r\nfunction ignoreToken(p, token) {\r\n    //NOTE: do nothing =)\r\n}\r\n\r\nfunction appendComment(p, token) {\r\n    p._appendCommentNode(token, p.openElements.currentTmplContent || p.openElements.current)\r\n}\r\n\r\nfunction appendCommentToRootHtmlElement(p, token) {\r\n    p._appendCommentNode(token, p.openElements.items[0]);\r\n}\r\n\r\nfunction appendCommentToDocument(p, token) {\r\n    p._appendCommentNode(token, p.document);\r\n}\r\n\r\nfunction insertCharacters(p, token) {\r\n    p._insertCharacters(token);\r\n}\r\n\r\nfunction stopParsing(p, token) {\r\n    p.stopped = true;\r\n}\r\n\r\n//12.2.5.4.1 The \"initial\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction doctypeInInitialMode(p, token) {\r\n    p._setDocumentType(token);\r\n\r\n    if (token.forceQuirks || Doctype.isQuirks(token.name, token.publicId, token.systemId))\r\n        p.treeAdapter.setQuirksMode(p.document);\r\n\r\n    p.insertionMode = BEFORE_HTML_MODE;\r\n}\r\n\r\nfunction tokenInInitialMode(p, token) {\r\n    p.treeAdapter.setQuirksMode(p.document);\r\n    p.insertionMode = BEFORE_HTML_MODE;\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.2 The \"before html\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagBeforeHtml(p, token) {\r\n    if (token.tagName === $.HTML) {\r\n        p._insertElement(token, NS.HTML);\r\n        p.insertionMode = BEFORE_HEAD_MODE;\r\n    }\r\n\r\n    else\r\n        tokenBeforeHtml(p, token);\r\n}\r\n\r\nfunction endTagBeforeHtml(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML || tn === $.HEAD || tn === $.BODY || tn === $.BR)\r\n        tokenBeforeHtml(p, token);\r\n}\r\n\r\nfunction tokenBeforeHtml(p, token) {\r\n    p._insertFakeRootElement();\r\n    p.insertionMode = BEFORE_HEAD_MODE;\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.3 The \"before head\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagBeforeHead(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.HEAD) {\r\n        p._insertElement(token, NS.HTML);\r\n        p.headElement = p.openElements.current;\r\n        p.insertionMode = IN_HEAD_MODE;\r\n    }\r\n\r\n    else\r\n        tokenBeforeHead(p, token);\r\n}\r\n\r\nfunction endTagBeforeHead(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HEAD || tn === $.BODY || tn === $.HTML || tn === $.BR)\r\n        tokenBeforeHead(p, token);\r\n}\r\n\r\nfunction tokenBeforeHead(p, token) {\r\n    p._processFakeStartTag($.HEAD);\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.4 The \"in head\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInHead(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND ||\r\n             tn === $.COMMAND || tn === $.LINK || tn === $.META) {\r\n        p._appendElement(token, NS.HTML);\r\n    }\r\n\r\n    else if (tn === $.TITLE)\r\n        p._switchToTextParsing(token, Tokenizer.MODE.RCDATA);\r\n\r\n    //NOTE: here we assume that we always act as an interactive user agent with enabled scripting, so we parse\r\n    //<noscript> as a rawtext.\r\n    else if (tn === $.NOSCRIPT || tn === $.NOFRAMES || tn === $.STYLE)\r\n        p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\r\n\r\n    else if (tn === $.SCRIPT)\r\n        p._switchToTextParsing(token, Tokenizer.MODE.SCRIPT_DATA);\r\n\r\n    else if (tn === $.TEMPLATE) {\r\n        p._insertTemplate(token, NS.HTML);\r\n        p.activeFormattingElements.insertMarker();\r\n        p.framesetOk = false;\r\n        p.insertionMode = IN_TEMPLATE_MODE;\r\n        p._pushTmplInsertionMode(IN_TEMPLATE_MODE);\r\n    }\r\n\r\n    else if (tn !== $.HEAD)\r\n        tokenInHead(p, token);\r\n}\r\n\r\nfunction endTagInHead(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HEAD) {\r\n        p.openElements.pop();\r\n        p.insertionMode = AFTER_HEAD_MODE;\r\n    }\r\n\r\n    else if (tn === $.BODY || tn === $.BR || tn === $.HTML)\r\n        tokenInHead(p, token);\r\n\r\n    else if (tn === $.TEMPLATE && p.openElements.tmplCount > 0) {\r\n        p.openElements.generateImpliedEndTags();\r\n        p.openElements.popUntilTemplatePopped();\r\n        p.activeFormattingElements.clearToLastMarker();\r\n        p._popTmplInsertionMode();\r\n        p._resetInsertionMode();\r\n    }\r\n}\r\n\r\nfunction tokenInHead(p, token) {\r\n    p._processFakeEndTag($.HEAD);\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.6 The \"after head\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagAfterHead(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.BODY) {\r\n        p._insertElement(token, NS.HTML);\r\n        p.framesetOk = false;\r\n        p.insertionMode = IN_BODY_MODE;\r\n    }\r\n\r\n    else if (tn === $.FRAMESET) {\r\n        p._insertElement(token, NS.HTML);\r\n        p.insertionMode = IN_FRAMESET_MODE;\r\n    }\r\n\r\n    else if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META ||\r\n             tn === $.NOFRAMES || tn === $.SCRIPT || tn === $.STYLE || tn === $.TEMPLATE || tn === $.TITLE) {\r\n        p.openElements.push(p.headElement);\r\n        startTagInHead(p, token);\r\n        p.openElements.remove(p.headElement);\r\n    }\r\n\r\n    else if (tn !== $.HEAD)\r\n        tokenAfterHead(p, token);\r\n}\r\n\r\nfunction endTagAfterHead(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.BODY || tn === $.HTML || tn === $.BR)\r\n        tokenAfterHead(p, token);\r\n\r\n    else if (tn === $.TEMPLATE)\r\n        endTagInHead(p, token);\r\n}\r\n\r\nfunction tokenAfterHead(p, token) {\r\n    p._processFakeStartTag($.BODY);\r\n    p.framesetOk = true;\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.7 The \"in body\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction whitespaceCharacterInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertCharacters(token);\r\n}\r\n\r\nfunction characterInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertCharacters(token);\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction htmlStartTagInBody(p, token) {\r\n    if (p.openElements.tmplCount === 0)\r\n        p.treeAdapter.adoptAttributes(p.openElements.items[0], token.attrs);\r\n}\r\n\r\nfunction bodyStartTagInBody(p, token) {\r\n    var bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\r\n\r\n    if (bodyElement && p.openElements.tmplCount === 0) {\r\n        p.framesetOk = false;\r\n        p.treeAdapter.adoptAttributes(bodyElement, token.attrs);\r\n    }\r\n}\r\n\r\nfunction framesetStartTagInBody(p, token) {\r\n    var bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\r\n\r\n    if (p.framesetOk && bodyElement) {\r\n        p.treeAdapter.detachNode(bodyElement);\r\n        p.openElements.popAllUpToHtmlElement();\r\n        p._insertElement(token, NS.HTML);\r\n        p.insertionMode = IN_FRAMESET_MODE;\r\n    }\r\n}\r\n\r\nfunction addressStartTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\nfunction numberedHeaderStartTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    var tn = p.openElements.currentTagName;\r\n\r\n    if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6)\r\n        p.openElements.pop();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\nfunction preStartTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n    //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\r\n    //on to the next one. (Newlines at the start of pre blocks are ignored as an authoring convenience.)\r\n    p.skipNextNewLine = true;\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction formStartTagInBody(p, token) {\r\n    var inTemplate = p.openElements.tmplCount > 0;\r\n\r\n    if (!p.formElement || inTemplate) {\r\n        if (p.openElements.hasInButtonScope($.P))\r\n            p._closePElement();\r\n\r\n        p._insertElement(token, NS.HTML);\r\n\r\n        if (!inTemplate)\r\n            p.formElement = p.openElements.current;\r\n    }\r\n}\r\n\r\nfunction listItemStartTagInBody(p, token) {\r\n    p.framesetOk = false;\r\n\r\n    for (var i = p.openElements.stackTop; i >= 0; i--) {\r\n        var element = p.openElements.items[i],\r\n            tn = p.treeAdapter.getTagName(element);\r\n\r\n        if ((token.tagName === $.LI && tn === $.LI) ||\r\n            ((token.tagName === $.DD || token.tagName === $.DT) && (tn === $.DD || tn == $.DT))) {\r\n            p._processFakeEndTag(tn);\r\n            break;\r\n        }\r\n\r\n        if (tn !== $.ADDRESS && tn !== $.DIV && tn !== $.P && p._isSpecialElement(element))\r\n            break;\r\n    }\r\n\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\nfunction plaintextStartTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n    p.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\r\n}\r\n\r\nfunction buttonStartTagInBody(p, token) {\r\n    if (p.openElements.hasInScope($.BUTTON)) {\r\n        p._processFakeEndTag($.BUTTON);\r\n        buttonStartTagInBody(p, token);\r\n    }\r\n\r\n    else {\r\n        p._reconstructActiveFormattingElements();\r\n        p._insertElement(token, NS.HTML);\r\n        p.framesetOk = false;\r\n    }\r\n}\r\n\r\nfunction aStartTagInBody(p, token) {\r\n    var activeElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName($.A);\r\n\r\n    if (activeElementEntry) {\r\n        p._processFakeEndTag($.A);\r\n        p.openElements.remove(activeElementEntry.element);\r\n        p.activeFormattingElements.removeEntry(activeElementEntry);\r\n    }\r\n\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertElement(token, NS.HTML);\r\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\r\n}\r\n\r\nfunction bStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertElement(token, NS.HTML);\r\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\r\n}\r\n\r\nfunction nobrStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n\r\n    if (p.openElements.hasInScope($.NOBR)) {\r\n        p._processFakeEndTag($.NOBR);\r\n        p._reconstructActiveFormattingElements();\r\n    }\r\n\r\n    p._insertElement(token, NS.HTML);\r\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\r\n}\r\n\r\nfunction appletStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertElement(token, NS.HTML);\r\n    p.activeFormattingElements.insertMarker();\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction tableStartTagInBody(p, token) {\r\n    if (!p.treeAdapter.isQuirksMode(p.document) && p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n    p.framesetOk = false;\r\n    p.insertionMode = IN_TABLE_MODE;\r\n}\r\n\r\nfunction areaStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._appendElement(token, NS.HTML);\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction inputStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._appendElement(token, NS.HTML);\r\n\r\n    var inputType = Tokenizer.getTokenAttr(token, ATTRS.TYPE);\r\n\r\n    if (!inputType || inputType.toLowerCase() !== HIDDEN_INPUT_TYPE)\r\n        p.framesetOk = false;\r\n\r\n}\r\n\r\nfunction paramStartTagInBody(p, token) {\r\n    p._appendElement(token, NS.HTML);\r\n}\r\n\r\nfunction hrStartTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    p._appendElement(token, NS.HTML);\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction imageStartTagInBody(p, token) {\r\n    token.tagName = $.IMG;\r\n    areaStartTagInBody(p, token);\r\n}\r\n\r\nfunction isindexStartTagInBody(p, token) {\r\n    if (!p.formElement || p.openElements.tmplCount > 0) {\r\n        p._processFakeStartTagWithAttrs($.FORM, getSearchableIndexFormAttrs(token));\r\n        p._processFakeStartTag($.HR);\r\n        p._processFakeStartTag($.LABEL);\r\n        p.treeAdapter.insertText(p.openElements.current, getSearchableIndexLabelText(token));\r\n        p._processFakeStartTagWithAttrs($.INPUT, getSearchableIndexInputAttrs(token));\r\n        p._processFakeEndTag($.LABEL);\r\n        p._processFakeStartTag($.HR);\r\n        p._processFakeEndTag($.FORM);\r\n    }\r\n}\r\n\r\nfunction textareaStartTagInBody(p, token) {\r\n    p._insertElement(token, NS.HTML);\r\n    //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\r\n    //on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)\r\n    p.skipNextNewLine = true;\r\n    p.tokenizer.state = Tokenizer.MODE.RCDATA;\r\n    p.originalInsertionMode = p.insertionMode;\r\n    p.framesetOk = false;\r\n    p.insertionMode = TEXT_MODE;\r\n}\r\n\r\nfunction xmpStartTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    p._reconstructActiveFormattingElements();\r\n    p.framesetOk = false;\r\n    p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\r\n}\r\n\r\nfunction iframeStartTagInBody(p, token) {\r\n    p.framesetOk = false;\r\n    p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\r\n}\r\n\r\n//NOTE: here we assume that we always act as an user agent with enabled plugins, so we parse\r\n//<noembed> as a rawtext.\r\nfunction noembedStartTagInBody(p, token) {\r\n    p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\r\n}\r\n\r\nfunction selectStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertElement(token, NS.HTML);\r\n    p.framesetOk = false;\r\n\r\n    if (p.insertionMode === IN_TABLE_MODE || p.insertionMode === IN_CAPTION_MODE ||\r\n        p.insertionMode === IN_TABLE_BODY_MODE || p.insertionMode === IN_ROW_MODE ||\r\n        p.insertionMode === IN_CELL_MODE) {\r\n        p.insertionMode = IN_SELECT_IN_TABLE_MODE;\r\n    }\r\n\r\n    else\r\n        p.insertionMode = IN_SELECT_MODE;\r\n}\r\n\r\nfunction optgroupStartTagInBody(p, token) {\r\n    if (p.openElements.currentTagName === $.OPTION)\r\n        p._processFakeEndTag($.OPTION);\r\n\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\nfunction rpStartTagInBody(p, token) {\r\n    if (p.openElements.hasInScope($.RUBY))\r\n        p.openElements.generateImpliedEndTags();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\nfunction menuitemStartTagInBody(p, token) {\r\n    p._appendElement(token, NS.HTML);\r\n}\r\n\r\nfunction mathStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n\r\n    ForeignContent.adjustTokenMathMLAttrs(token);\r\n    ForeignContent.adjustTokenXMLAttrs(token);\r\n\r\n    if (token.selfClosing)\r\n        p._appendElement(token, NS.MATHML);\r\n    else\r\n        p._insertElement(token, NS.MATHML);\r\n}\r\n\r\nfunction svgStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n\r\n    ForeignContent.adjustTokenSVGAttrs(token);\r\n    ForeignContent.adjustTokenXMLAttrs(token);\r\n\r\n    if (token.selfClosing)\r\n        p._appendElement(token, NS.SVG);\r\n    else\r\n        p._insertElement(token, NS.SVG);\r\n}\r\n\r\nfunction genericStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\r\n//It's faster than using dictionary.\r\nfunction startTagInBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    switch (tn.length) {\r\n        case 1:\r\n            if (tn === $.I || tn === $.S || tn === $.B || tn === $.U)\r\n                bStartTagInBody(p, token);\r\n\r\n            else if (tn === $.P)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.A)\r\n                aStartTagInBody(p, token);\r\n\r\n            else\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 2:\r\n            if (tn === $.DL || tn === $.OL || tn === $.UL)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6)\r\n                numberedHeaderStartTagInBody(p, token);\r\n\r\n            else if (tn === $.LI || tn === $.DD || tn === $.DT)\r\n                listItemStartTagInBody(p, token);\r\n\r\n            else if (tn === $.EM || tn === $.TT)\r\n                bStartTagInBody(p, token);\r\n\r\n            else if (tn === $.BR)\r\n                areaStartTagInBody(p, token);\r\n\r\n            else if (tn === $.HR)\r\n                hrStartTagInBody(p, token);\r\n\r\n            else if (tn === $.RP || tn === $.RT)\r\n                rpStartTagInBody(p, token);\r\n\r\n            else if (tn !== $.TH && tn !== $.TD && tn !== $.TR)\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 3:\r\n            if (tn === $.DIV || tn === $.DIR || tn === $.NAV)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.PRE)\r\n                preStartTagInBody(p, token);\r\n\r\n            else if (tn === $.BIG)\r\n                bStartTagInBody(p, token);\r\n\r\n            else if (tn === $.IMG || tn === $.WBR)\r\n                areaStartTagInBody(p, token);\r\n\r\n            else if (tn === $.XMP)\r\n                xmpStartTagInBody(p, token);\r\n\r\n            else if (tn === $.SVG)\r\n                svgStartTagInBody(p, token);\r\n\r\n            else if (tn !== $.COL)\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 4:\r\n            if (tn === $.HTML)\r\n                htmlStartTagInBody(p, token);\r\n\r\n            else if (tn === $.BASE || tn === $.LINK || tn === $.META)\r\n                startTagInHead(p, token);\r\n\r\n            else if (tn === $.BODY)\r\n                bodyStartTagInBody(p, token);\r\n\r\n            else if (tn === $.MAIN || tn === $.MENU)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.FORM)\r\n                formStartTagInBody(p, token);\r\n\r\n            else if (tn === $.CODE || tn === $.FONT)\r\n                bStartTagInBody(p, token);\r\n\r\n            else if (tn === $.NOBR)\r\n                nobrStartTagInBody(p, token);\r\n\r\n            else if (tn === $.AREA)\r\n                areaStartTagInBody(p, token);\r\n\r\n            else if (tn === $.MATH)\r\n                mathStartTagInBody(p, token);\r\n\r\n            else if (tn !== $.HEAD)\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 5:\r\n            if (tn === $.STYLE || tn === $.TITLE)\r\n                startTagInHead(p, token);\r\n\r\n            else if (tn === $.ASIDE)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.SMALL)\r\n                bStartTagInBody(p, token);\r\n\r\n            else if (tn === $.TABLE)\r\n                tableStartTagInBody(p, token);\r\n\r\n            else if (tn === $.EMBED)\r\n                areaStartTagInBody(p, token);\r\n\r\n            else if (tn === $.INPUT)\r\n                inputStartTagInBody(p, token);\r\n\r\n            else if (tn === $.PARAM || tn === $.TRACK)\r\n                paramStartTagInBody(p, token);\r\n\r\n            else if (tn === $.IMAGE)\r\n                imageStartTagInBody(p, token);\r\n\r\n            else if (tn !== $.FRAME && tn !== $.TBODY && tn !== $.TFOOT && tn !== $.THEAD)\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 6:\r\n            if (tn === $.SCRIPT)\r\n                startTagInHead(p, token);\r\n\r\n            else if (tn === $.CENTER || tn === $.FIGURE || tn === $.FOOTER || tn === $.HEADER || tn === $.HGROUP)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.BUTTON)\r\n                buttonStartTagInBody(p, token);\r\n\r\n            else if (tn === $.STRIKE || tn === $.STRONG)\r\n                bStartTagInBody(p, token);\r\n\r\n            else if (tn === $.APPLET || tn === $.OBJECT)\r\n                appletStartTagInBody(p, token);\r\n\r\n            else if (tn === $.KEYGEN)\r\n                areaStartTagInBody(p, token);\r\n\r\n            else if (tn === $.SOURCE)\r\n                paramStartTagInBody(p, token);\r\n\r\n            else if (tn === $.IFRAME)\r\n                iframeStartTagInBody(p, token);\r\n\r\n            else if (tn === $.SELECT)\r\n                selectStartTagInBody(p, token);\r\n\r\n            else if (tn === $.OPTION)\r\n                optgroupStartTagInBody(p, token);\r\n\r\n            else\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 7:\r\n            if (tn === $.BGSOUND || tn === $.COMMAND)\r\n                startTagInHead(p, token);\r\n\r\n            else if (tn === $.DETAILS || tn === $.ADDRESS || tn === $.ARTICLE || tn === $.SECTION || tn === $.SUMMARY)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.LISTING)\r\n                preStartTagInBody(p, token);\r\n\r\n            else if (tn === $.MARQUEE)\r\n                appletStartTagInBody(p, token);\r\n\r\n            else if (tn === $.ISINDEX)\r\n                isindexStartTagInBody(p, token);\r\n\r\n            else if (tn === $.NOEMBED)\r\n                noembedStartTagInBody(p, token);\r\n\r\n            else if (tn !== $.CAPTION)\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 8:\r\n            if (tn === $.BASEFONT || tn === $.MENUITEM)\r\n                menuitemStartTagInBody(p, token);\r\n\r\n            else if (tn === $.FRAMESET)\r\n                framesetStartTagInBody(p, token);\r\n\r\n            else if (tn === $.FIELDSET)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.TEXTAREA)\r\n                textareaStartTagInBody(p, token);\r\n\r\n            else if (tn === $.TEMPLATE)\r\n                startTagInHead(p, token);\r\n\r\n            else if (tn === $.NOSCRIPT)\r\n                noembedStartTagInBody(p, token);\r\n\r\n            else if (tn === $.OPTGROUP)\r\n                optgroupStartTagInBody(p, token);\r\n\r\n            else if (tn !== $.COLGROUP)\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 9:\r\n            if (tn === $.PLAINTEXT)\r\n                plaintextStartTagInBody(p, token);\r\n\r\n            else\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 10:\r\n            if (tn === $.BLOCKQUOTE || tn === $.FIGCAPTION)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        default:\r\n            genericStartTagInBody(p, token);\r\n    }\r\n}\r\n\r\nfunction bodyEndTagInBody(p, token) {\r\n    if (p.openElements.hasInScope($.BODY))\r\n        p.insertionMode = AFTER_BODY_MODE;\r\n\r\n    else\r\n        token.ignored = true;\r\n}\r\n\r\nfunction htmlEndTagInBody(p, token) {\r\n    var fakeToken = p._processFakeEndTag($.BODY);\r\n\r\n    if (!fakeToken.ignored)\r\n        p._processToken(token);\r\n}\r\n\r\nfunction addressEndTagInBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (p.openElements.hasInScope(tn)) {\r\n        p.openElements.generateImpliedEndTags();\r\n        p.openElements.popUntilTagNamePopped(tn);\r\n    }\r\n}\r\n\r\nfunction formEndTagInBody(p, token) {\r\n    var inTemplate = p.openElements.tmplCount > 0,\r\n        formElement = p.formElement;\r\n\r\n    if (!inTemplate)\r\n        p.formElement = null;\r\n\r\n    if ((formElement || inTemplate) && p.openElements.hasInScope($.FORM)) {\r\n        p.openElements.generateImpliedEndTags();\r\n\r\n        if (inTemplate)\r\n            p.openElements.popUntilTagNamePopped($.FORM);\r\n\r\n        else\r\n            p.openElements.remove(formElement);\r\n    }\r\n}\r\n\r\nfunction pEndTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P)) {\r\n        p.openElements.generateImpliedEndTagsWithExclusion($.P);\r\n        p.openElements.popUntilTagNamePopped($.P);\r\n    }\r\n\r\n    else {\r\n        p._processFakeStartTag($.P);\r\n        p._processToken(token);\r\n    }\r\n}\r\n\r\nfunction liEndTagInBody(p, token) {\r\n    if (p.openElements.hasInListItemScope($.LI)) {\r\n        p.openElements.generateImpliedEndTagsWithExclusion($.LI);\r\n        p.openElements.popUntilTagNamePopped($.LI);\r\n    }\r\n}\r\n\r\nfunction ddEndTagInBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (p.openElements.hasInScope(tn)) {\r\n        p.openElements.generateImpliedEndTagsWithExclusion(tn);\r\n        p.openElements.popUntilTagNamePopped(tn);\r\n    }\r\n}\r\n\r\nfunction numberedHeaderEndTagInBody(p, token) {\r\n    if (p.openElements.hasNumberedHeaderInScope()) {\r\n        p.openElements.generateImpliedEndTags();\r\n        p.openElements.popUntilNumberedHeaderPopped();\r\n    }\r\n}\r\n\r\nfunction appletEndTagInBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (p.openElements.hasInScope(tn)) {\r\n        p.openElements.generateImpliedEndTags();\r\n        p.openElements.popUntilTagNamePopped(tn);\r\n        p.activeFormattingElements.clearToLastMarker();\r\n    }\r\n}\r\n\r\nfunction brEndTagInBody(p, token) {\r\n    p._processFakeStartTag($.BR);\r\n}\r\n\r\nfunction genericEndTagInBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    for (var i = p.openElements.stackTop; i > 0; i--) {\r\n        var element = p.openElements.items[i];\r\n\r\n        if (p.treeAdapter.getTagName(element) === tn) {\r\n            p.openElements.generateImpliedEndTagsWithExclusion(tn);\r\n            p.openElements.popUntilElementPopped(element);\r\n            break;\r\n        }\r\n\r\n        if (p._isSpecialElement(element))\r\n            break;\r\n    }\r\n}\r\n\r\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\r\n//It's faster than using dictionary.\r\nfunction endTagInBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    switch (tn.length) {\r\n        case 1:\r\n            if (tn === $.A || tn === $.B || tn === $.I || tn === $.S || tn == $.U)\r\n                callAdoptionAgency(p, token);\r\n\r\n            else if (tn === $.P)\r\n                pEndTagInBody(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 2:\r\n            if (tn == $.DL || tn === $.UL || tn === $.OL)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else if (tn === $.LI)\r\n                liEndTagInBody(p, token);\r\n\r\n            else if (tn === $.DD || tn === $.DT)\r\n                ddEndTagInBody(p, token);\r\n\r\n            else if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6)\r\n                numberedHeaderEndTagInBody(p, token);\r\n\r\n            else if (tn === $.BR)\r\n                brEndTagInBody(p, token);\r\n\r\n            else if (tn === $.EM || tn === $.TT)\r\n                callAdoptionAgency(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 3:\r\n            if (tn === $.BIG)\r\n                callAdoptionAgency(p, token);\r\n\r\n            else if (tn === $.DIR || tn === $.DIV || tn === $.NAV)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 4:\r\n            if (tn === $.BODY)\r\n                bodyEndTagInBody(p, token);\r\n\r\n            else if (tn === $.HTML)\r\n                htmlEndTagInBody(p, token);\r\n\r\n            else if (tn === $.FORM)\r\n                formEndTagInBody(p, token);\r\n\r\n            else if (tn === $.CODE || tn === $.FONT || tn === $.NOBR)\r\n                callAdoptionAgency(p, token);\r\n\r\n            else if (tn === $.MAIN || tn === $.MENU)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 5:\r\n            if (tn === $.ASIDE)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else if (tn === $.SMALL)\r\n                callAdoptionAgency(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 6:\r\n            if (tn === $.CENTER || tn === $.FIGURE || tn === $.FOOTER || tn === $.HEADER || tn === $.HGROUP)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else if (tn === $.APPLET || tn === $.OBJECT)\r\n                appletEndTagInBody(p, token);\r\n\r\n            else if (tn == $.STRIKE || tn === $.STRONG)\r\n                callAdoptionAgency(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 7:\r\n            if (tn === $.ADDRESS || tn === $.ARTICLE || tn === $.DETAILS || tn === $.SECTION || tn === $.SUMMARY)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else if (tn === $.MARQUEE)\r\n                appletEndTagInBody(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 8:\r\n            if (tn === $.FIELDSET)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else if (tn === $.TEMPLATE)\r\n                endTagInHead(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 10:\r\n            if (tn === $.BLOCKQUOTE || tn === $.FIGCAPTION)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        default :\r\n            genericEndTagInBody(p, token);\r\n    }\r\n}\r\n\r\nfunction eofInBody(p, token) {\r\n    if (p.tmplInsertionModeStackTop > -1)\r\n        eofInTemplate(p, token);\r\n\r\n    else\r\n        p.stopped = true;\r\n}\r\n\r\n//12.2.5.4.8 The \"text\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction endTagInText(p, token) {\r\n    if (!p.fragmentContext && p.scriptHandler && token.tagName === $.SCRIPT)\r\n        p.scriptHandler(p.document, p.openElements.current);\r\n\r\n    p.openElements.pop();\r\n    p.insertionMode = p.originalInsertionMode;\r\n}\r\n\r\n\r\nfunction eofInText(p, token) {\r\n    p.openElements.pop();\r\n    p.insertionMode = p.originalInsertionMode;\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.9 The \"in table\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction characterInTable(p, token) {\r\n    var curTn = p.openElements.currentTagName;\r\n\r\n    if (curTn === $.TABLE || curTn === $.TBODY || curTn === $.TFOOT || curTn === $.THEAD || curTn === $.TR) {\r\n        p.pendingCharacterTokens = [];\r\n        p.hasNonWhitespacePendingCharacterToken = false;\r\n        p.originalInsertionMode = p.insertionMode;\r\n        p.insertionMode = IN_TABLE_TEXT_MODE;\r\n        p._processToken(token);\r\n    }\r\n\r\n    else\r\n        tokenInTable(p, token);\r\n}\r\n\r\nfunction captionStartTagInTable(p, token) {\r\n    p.openElements.clearBackToTableContext();\r\n    p.activeFormattingElements.insertMarker();\r\n    p._insertElement(token, NS.HTML);\r\n    p.insertionMode = IN_CAPTION_MODE;\r\n}\r\n\r\nfunction colgroupStartTagInTable(p, token) {\r\n    p.openElements.clearBackToTableContext();\r\n    p._insertElement(token, NS.HTML);\r\n    p.insertionMode = IN_COLUMN_GROUP_MODE;\r\n}\r\n\r\nfunction colStartTagInTable(p, token) {\r\n    p._processFakeStartTag($.COLGROUP);\r\n    p._processToken(token);\r\n}\r\n\r\nfunction tbodyStartTagInTable(p, token) {\r\n    p.openElements.clearBackToTableContext();\r\n    p._insertElement(token, NS.HTML);\r\n    p.insertionMode = IN_TABLE_BODY_MODE;\r\n}\r\n\r\nfunction tdStartTagInTable(p, token) {\r\n    p._processFakeStartTag($.TBODY);\r\n    p._processToken(token);\r\n}\r\n\r\nfunction tableStartTagInTable(p, token) {\r\n    var fakeToken = p._processFakeEndTag($.TABLE);\r\n\r\n    //NOTE: The fake end tag token here can only be ignored in the fragment case.\r\n    if (!fakeToken.ignored)\r\n        p._processToken(token);\r\n}\r\n\r\nfunction inputStartTagInTable(p, token) {\r\n    var inputType = Tokenizer.getTokenAttr(token, ATTRS.TYPE);\r\n\r\n    if (inputType && inputType.toLowerCase() === HIDDEN_INPUT_TYPE)\r\n        p._appendElement(token, NS.HTML);\r\n\r\n    else\r\n        tokenInTable(p, token);\r\n}\r\n\r\nfunction formStartTagInTable(p, token) {\r\n    if (!p.formElement && p.openElements.tmplCount === 0) {\r\n        p._insertElement(token, NS.HTML);\r\n        p.formElement = p.openElements.current;\r\n        p.openElements.pop();\r\n    }\r\n}\r\n\r\nfunction startTagInTable(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    switch (tn.length) {\r\n        case 2:\r\n            if (tn === $.TD || tn === $.TH || tn === $.TR)\r\n                tdStartTagInTable(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        case 3:\r\n            if (tn === $.COL)\r\n                colStartTagInTable(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        case 4:\r\n            if (tn === $.FORM)\r\n                formStartTagInTable(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        case 5:\r\n            if (tn === $.TABLE)\r\n                tableStartTagInTable(p, token);\r\n\r\n            else if (tn === $.STYLE)\r\n                startTagInHead(p, token);\r\n\r\n            else if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD)\r\n                tbodyStartTagInTable(p, token);\r\n\r\n            else if (tn === $.INPUT)\r\n                inputStartTagInTable(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        case 6:\r\n            if (tn === $.SCRIPT)\r\n                startTagInHead(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        case 7:\r\n            if (tn === $.CAPTION)\r\n                captionStartTagInTable(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        case 8:\r\n            if (tn === $.COLGROUP)\r\n                colgroupStartTagInTable(p, token);\r\n\r\n            else if (tn === $.TEMPLATE)\r\n                startTagInHead(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        default:\r\n            tokenInTable(p, token);\r\n    }\r\n\r\n}\r\n\r\nfunction endTagInTable(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.TABLE) {\r\n        if (p.openElements.hasInTableScope($.TABLE)) {\r\n            p.openElements.popUntilTagNamePopped($.TABLE);\r\n            p._resetInsertionMode();\r\n        }\r\n\r\n        else\r\n            token.ignored = true;\r\n    }\r\n\r\n    else if (tn === $.TEMPLATE)\r\n        endTagInHead(p, token);\r\n\r\n    else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML &&\r\n             tn !== $.TBODY && tn !== $.TD && tn !== $.TFOOT && tn !== $.TH && tn !== $.THEAD && tn !== $.TR) {\r\n        tokenInTable(p, token);\r\n    }\r\n}\r\n\r\nfunction tokenInTable(p, token) {\r\n    var savedFosterParentingState = p.fosterParentingEnabled;\r\n\r\n    p.fosterParentingEnabled = true;\r\n    p._processTokenInBodyMode(token);\r\n    p.fosterParentingEnabled = savedFosterParentingState;\r\n}\r\n\r\n\r\n//12.2.5.4.10 The \"in table text\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction whitespaceCharacterInTableText(p, token) {\r\n    p.pendingCharacterTokens.push(token);\r\n}\r\n\r\nfunction characterInTableText(p, token) {\r\n    p.pendingCharacterTokens.push(token);\r\n    p.hasNonWhitespacePendingCharacterToken = true;\r\n}\r\n\r\nfunction tokenInTableText(p, token) {\r\n    if (p.hasNonWhitespacePendingCharacterToken) {\r\n        for (var i = 0; i < p.pendingCharacterTokens.length; i++)\r\n            tokenInTable(p, p.pendingCharacterTokens[i]);\r\n    }\r\n\r\n    else {\r\n        for (var i = 0; i < p.pendingCharacterTokens.length; i++)\r\n            p._insertCharacters(p.pendingCharacterTokens[i]);\r\n    }\r\n\r\n    p.insertionMode = p.originalInsertionMode;\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.11 The \"in caption\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInCaption(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY ||\r\n        tn === $.TD || tn === $.TFOOT || tn === $.TH || tn === $.THEAD || tn === $.TR) {\r\n        var fakeToken = p._processFakeEndTag($.CAPTION);\r\n\r\n        //NOTE: The fake end tag token here can only be ignored in the fragment case.\r\n        if (!fakeToken.ignored)\r\n            p._processToken(token);\r\n    }\r\n\r\n    else\r\n        startTagInBody(p, token);\r\n}\r\n\r\nfunction endTagInCaption(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.CAPTION) {\r\n        if (p.openElements.hasInTableScope($.CAPTION)) {\r\n            p.openElements.generateImpliedEndTags();\r\n            p.openElements.popUntilTagNamePopped($.CAPTION);\r\n            p.activeFormattingElements.clearToLastMarker();\r\n            p.insertionMode = IN_TABLE_MODE;\r\n        }\r\n\r\n        else\r\n            token.ignored = true;\r\n    }\r\n\r\n    else if (tn === $.TABLE) {\r\n        var fakeToken = p._processFakeEndTag($.CAPTION);\r\n\r\n        //NOTE: The fake end tag token here can only be ignored in the fragment case.\r\n        if (!fakeToken.ignored)\r\n            p._processToken(token);\r\n    }\r\n\r\n    else if (tn !== $.BODY && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML && tn !== $.TBODY &&\r\n             tn !== $.TD && tn !== $.TFOOT && tn !== $.TH && tn !== $.THEAD && tn !== $.TR) {\r\n        endTagInBody(p, token);\r\n    }\r\n}\r\n\r\n\r\n//12.2.5.4.12 The \"in column group\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInColumnGroup(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.COL)\r\n        p._appendElement(token, NS.HTML);\r\n\r\n    else if (tn === $.TEMPLATE)\r\n        startTagInHead(p, token);\r\n\r\n    else\r\n        tokenInColumnGroup(p, token);\r\n}\r\n\r\nfunction endTagInColumnGroup(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.COLGROUP) {\r\n        if (p.openElements.currentTagName !== $.COLGROUP)\r\n            token.ignored = true;\r\n\r\n        else {\r\n            p.openElements.pop();\r\n            p.insertionMode = IN_TABLE_MODE;\r\n        }\r\n    }\r\n\r\n    else if (tn === $.TEMPLATE)\r\n        endTagInHead(p, token);\r\n\r\n    else if (tn !== $.COL)\r\n        tokenInColumnGroup(p, token);\r\n}\r\n\r\nfunction tokenInColumnGroup(p, token) {\r\n    var fakeToken = p._processFakeEndTag($.COLGROUP);\r\n\r\n    //NOTE: The fake end tag token here can only be ignored in the fragment case.\r\n    if (!fakeToken.ignored)\r\n        p._processToken(token);\r\n}\r\n\r\n//12.2.5.4.13 The \"in table body\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInTableBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.TR) {\r\n        p.openElements.clearBackToTableBodyContext();\r\n        p._insertElement(token, NS.HTML);\r\n        p.insertionMode = IN_ROW_MODE;\r\n    }\r\n\r\n    else if (tn === $.TH || tn === $.TD) {\r\n        p._processFakeStartTag($.TR);\r\n        p._processToken(token);\r\n    }\r\n\r\n    else if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP ||\r\n             tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\r\n\r\n        if (p.openElements.hasTableBodyContextInTableScope()) {\r\n            p.openElements.clearBackToTableBodyContext();\r\n            p._processFakeEndTag(p.openElements.currentTagName);\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else\r\n        startTagInTable(p, token);\r\n}\r\n\r\nfunction endTagInTableBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\r\n        if (p.openElements.hasInTableScope(tn)) {\r\n            p.openElements.clearBackToTableBodyContext();\r\n            p.openElements.pop();\r\n            p.insertionMode = IN_TABLE_MODE;\r\n        }\r\n    }\r\n\r\n    else if (tn === $.TABLE) {\r\n        if (p.openElements.hasTableBodyContextInTableScope()) {\r\n            p.openElements.clearBackToTableBodyContext();\r\n            p._processFakeEndTag(p.openElements.currentTagName);\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP ||\r\n             tn !== $.HTML && tn !== $.TD && tn !== $.TH && tn !== $.TR) {\r\n        endTagInTable(p, token);\r\n    }\r\n}\r\n\r\n//12.2.5.4.14 The \"in row\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInRow(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.TH || tn === $.TD) {\r\n        p.openElements.clearBackToTableRowContext();\r\n        p._insertElement(token, NS.HTML);\r\n        p.insertionMode = IN_CELL_MODE;\r\n        p.activeFormattingElements.insertMarker();\r\n    }\r\n\r\n    else if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY ||\r\n             tn === $.TFOOT || tn === $.THEAD || tn === $.TR) {\r\n        var fakeToken = p._processFakeEndTag($.TR);\r\n\r\n        //NOTE: The fake end tag token here can only be ignored in the fragment case.\r\n        if (!fakeToken.ignored)\r\n            p._processToken(token);\r\n    }\r\n\r\n    else\r\n        startTagInTable(p, token);\r\n}\r\n\r\nfunction endTagInRow(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.TR) {\r\n        if (p.openElements.hasInTableScope($.TR)) {\r\n            p.openElements.clearBackToTableRowContext();\r\n            p.openElements.pop();\r\n            p.insertionMode = IN_TABLE_BODY_MODE;\r\n        }\r\n\r\n        else\r\n            token.ignored = true;\r\n    }\r\n\r\n    else if (tn === $.TABLE) {\r\n        var fakeToken = p._processFakeEndTag($.TR);\r\n\r\n        //NOTE: The fake end tag token here can only be ignored in the fragment case.\r\n        if (!fakeToken.ignored)\r\n            p._processToken(token);\r\n    }\r\n\r\n    else if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\r\n        if (p.openElements.hasInTableScope(tn)) {\r\n            p._processFakeEndTag($.TR);\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP ||\r\n             tn !== $.HTML && tn !== $.TD && tn !== $.TH) {\r\n        endTagInTable(p, token);\r\n    }\r\n}\r\n\r\n\r\n//12.2.5.4.15 The \"in cell\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInCell(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY ||\r\n        tn === $.TD || tn === $.TFOOT || tn === $.TH || tn === $.THEAD || tn === $.TR) {\r\n\r\n        if (p.openElements.hasInTableScope($.TD) || p.openElements.hasInTableScope($.TH)) {\r\n            p._closeTableCell();\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else\r\n        startTagInBody(p, token);\r\n}\r\n\r\nfunction endTagInCell(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.TD || tn === $.TH) {\r\n        if (p.openElements.hasInTableScope(tn)) {\r\n            p.openElements.generateImpliedEndTags();\r\n            p.openElements.popUntilTagNamePopped(tn);\r\n            p.activeFormattingElements.clearToLastMarker();\r\n            p.insertionMode = IN_ROW_MODE;\r\n        }\r\n    }\r\n\r\n    else if (tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR) {\r\n        if (p.openElements.hasInTableScope(tn)) {\r\n            p._closeTableCell();\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML)\r\n        endTagInBody(p, token);\r\n}\r\n\r\n//12.2.5.4.16 The \"in select\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInSelect(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.OPTION) {\r\n        if (p.openElements.currentTagName === $.OPTION)\r\n            p._processFakeEndTag($.OPTION);\r\n\r\n        p._insertElement(token, NS.HTML);\r\n    }\r\n\r\n    else if (tn === $.OPTGROUP) {\r\n        if (p.openElements.currentTagName === $.OPTION)\r\n            p._processFakeEndTag($.OPTION);\r\n\r\n        if (p.openElements.currentTagName === $.OPTGROUP)\r\n            p._processFakeEndTag($.OPTGROUP);\r\n\r\n        p._insertElement(token, NS.HTML);\r\n    }\r\n\r\n    else if (tn === $.SELECT)\r\n        p._processFakeEndTag($.SELECT);\r\n\r\n    else if (tn === $.INPUT || tn === $.KEYGEN || tn === $.TEXTAREA) {\r\n        if (p.openElements.hasInSelectScope($.SELECT)) {\r\n            p._processFakeEndTag($.SELECT);\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else if (tn === $.SCRIPT || tn === $.TEMPLATE)\r\n        startTagInHead(p, token);\r\n}\r\n\r\nfunction endTagInSelect(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.OPTGROUP) {\r\n        var prevOpenElement = p.openElements.items[p.openElements.stackTop - 1],\r\n            prevOpenElementTn = prevOpenElement && p.treeAdapter.getTagName(prevOpenElement);\r\n\r\n        if (p.openElements.currentTagName === $.OPTION && prevOpenElementTn === $.OPTGROUP)\r\n            p._processFakeEndTag($.OPTION);\r\n\r\n        if (p.openElements.currentTagName === $.OPTGROUP)\r\n            p.openElements.pop();\r\n    }\r\n\r\n    else if (tn === $.OPTION) {\r\n        if (p.openElements.currentTagName === $.OPTION)\r\n            p.openElements.pop();\r\n    }\r\n\r\n    else if (tn === $.SELECT && p.openElements.hasInSelectScope($.SELECT)) {\r\n        p.openElements.popUntilTagNamePopped($.SELECT);\r\n        p._resetInsertionMode();\r\n    }\r\n\r\n    else if (tn === $.TEMPLATE)\r\n        endTagInHead(p, token);\r\n}\r\n\r\n//12.2.5.4.17 The \"in select in table\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInSelectInTable(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.CAPTION || tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT ||\r\n        tn === $.THEAD || tn === $.TR || tn === $.TD || tn === $.TH) {\r\n        p._processFakeEndTag($.SELECT);\r\n        p._processToken(token);\r\n    }\r\n\r\n    else\r\n        startTagInSelect(p, token);\r\n}\r\n\r\nfunction endTagInSelectInTable(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.CAPTION || tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT ||\r\n        tn === $.THEAD || tn === $.TR || tn === $.TD || tn === $.TH) {\r\n        if (p.openElements.hasInTableScope(tn)) {\r\n            p._processFakeEndTag($.SELECT);\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else\r\n        endTagInSelect(p, token);\r\n}\r\n\r\n//12.2.5.4.18 The \"in template\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInTemplate(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META ||\r\n        tn === $.NOFRAMES || tn === $.SCRIPT || tn === $.STYLE || tn === $.TEMPLATE || tn === $.TITLE) {\r\n        startTagInHead(p, token);\r\n    }\r\n\r\n    else {\r\n        var newInsertionMode = TEMPLATE_INSERTION_MODE_SWITCH_MAP[tn] || IN_BODY_MODE;\r\n\r\n        p._popTmplInsertionMode();\r\n        p._pushTmplInsertionMode(newInsertionMode);\r\n        p.insertionMode = newInsertionMode;\r\n        p._processToken(token);\r\n    }\r\n}\r\n\r\nfunction endTagInTemplate(p, token) {\r\n    if (token.tagName === $.TEMPLATE)\r\n        endTagInHead(p, token);\r\n}\r\n\r\nfunction eofInTemplate(p, token) {\r\n    if (p.openElements.tmplCount > 0) {\r\n        p.openElements.popUntilTemplatePopped();\r\n        p.activeFormattingElements.clearToLastMarker();\r\n        p._popTmplInsertionMode();\r\n        p._resetInsertionMode();\r\n        p._processToken(token);\r\n    }\r\n\r\n    else\r\n        p.stopped = true;\r\n}\r\n\r\n\r\n//12.2.5.4.19 The \"after body\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagAfterBody(p, token) {\r\n    if (token.tagName === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else\r\n        tokenAfterBody(p, token);\r\n}\r\n\r\nfunction endTagAfterBody(p, token) {\r\n    if (token.tagName === $.HTML) {\r\n        if (!p.fragmentContext)\r\n            p.insertionMode = AFTER_AFTER_BODY_MODE;\r\n    }\r\n\r\n    else\r\n        tokenAfterBody(p, token);\r\n}\r\n\r\nfunction tokenAfterBody(p, token) {\r\n    p.insertionMode = IN_BODY_MODE;\r\n    p._processToken(token);\r\n}\r\n\r\n//12.2.5.4.20 The \"in frameset\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInFrameset(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.FRAMESET)\r\n        p._insertElement(token, NS.HTML);\r\n\r\n    else if (tn === $.FRAME)\r\n        p._appendElement(token, NS.HTML);\r\n\r\n    else if (tn === $.NOFRAMES)\r\n        startTagInHead(p, token);\r\n}\r\n\r\nfunction endTagInFrameset(p, token) {\r\n    if (token.tagName === $.FRAMESET && !p.openElements.isRootHtmlElementCurrent()) {\r\n        p.openElements.pop();\r\n\r\n        if (!p.fragmentContext && p.openElements.currentTagName !== $.FRAMESET)\r\n            p.insertionMode = AFTER_FRAMESET_MODE;\r\n    }\r\n}\r\n\r\n//12.2.5.4.21 The \"after frameset\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagAfterFrameset(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.NOFRAMES)\r\n        startTagInHead(p, token);\r\n}\r\n\r\nfunction endTagAfterFrameset(p, token) {\r\n    if (token.tagName === $.HTML)\r\n        p.insertionMode = AFTER_AFTER_FRAMESET_MODE;\r\n}\r\n\r\n//12.2.5.4.22 The \"after after body\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagAfterAfterBody(p, token) {\r\n    if (token.tagName === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else\r\n        tokenAfterAfterBody(p, token);\r\n}\r\n\r\nfunction tokenAfterAfterBody(p, token) {\r\n    p.insertionMode = IN_BODY_MODE;\r\n    p._processToken(token);\r\n}\r\n\r\n//12.2.5.4.23 The \"after after frameset\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagAfterAfterFrameset(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.NOFRAMES)\r\n        startTagInHead(p, token);\r\n}\r\n\r\n\r\n//12.2.5.5 The rules for parsing tokens in foreign content\r\n//------------------------------------------------------------------\r\nfunction nullCharacterInForeignContent(p, token) {\r\n    token.chars = UNICODE.REPLACEMENT_CHARACTER;\r\n    p._insertCharacters(token);\r\n}\r\n\r\nfunction characterInForeignContent(p, token) {\r\n    p._insertCharacters(token);\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction startTagInForeignContent(p, token) {\r\n    if (ForeignContent.causesExit(token) && !p.fragmentContext) {\r\n        while (p.treeAdapter.getNamespaceURI(p.openElements.current) !== NS.HTML &&\r\n               (!p._isMathMLTextIntegrationPoint(p.openElements.current)) &&\r\n               (!p._isHtmlIntegrationPoint(p.openElements.current))) {\r\n            p.openElements.pop();\r\n        }\r\n\r\n        p._processToken(token);\r\n    }\r\n\r\n    else {\r\n        var current = p._getAdjustedCurrentElement(),\r\n            currentNs = p.treeAdapter.getNamespaceURI(current);\r\n\r\n        if (currentNs === NS.MATHML)\r\n            ForeignContent.adjustTokenMathMLAttrs(token);\r\n\r\n        else if (currentNs === NS.SVG) {\r\n            ForeignContent.adjustTokenSVGTagName(token);\r\n            ForeignContent.adjustTokenSVGAttrs(token);\r\n        }\r\n\r\n        ForeignContent.adjustTokenXMLAttrs(token);\r\n\r\n        if (token.selfClosing)\r\n            p._appendElement(token, currentNs);\r\n        else\r\n            p._insertElement(token, currentNs);\r\n    }\r\n}\r\n\r\nfunction endTagInForeignContent(p, token) {\r\n    for (var i = p.openElements.stackTop; i > 0; i--) {\r\n        var element = p.openElements.items[i];\r\n\r\n        if (p.treeAdapter.getNamespaceURI(element) === NS.HTML) {\r\n            p._processToken(token);\r\n            break;\r\n        }\r\n\r\n        if (p.treeAdapter.getTagName(element).toLowerCase() === token.tagName) {\r\n            p.openElements.popUntilElementPopped(element);\r\n            break;\r\n        }\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"script"}